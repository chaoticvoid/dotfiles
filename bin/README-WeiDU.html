<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>WeiDU Documentation
</TITLE>

<META http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<META name="GENERATOR" content="hevea 1.10">
<STYLE type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.title{margin:2ex auto;text-align:center}
DIV TABLE{margin-left:inherit;margin-right:inherit;}
PRE{text-align:left;margin-left:0ex;margin-right:auto;}
BLOCKQUOTE{margin-left:4ex;margin-right:4ex;text-align:left;}
TD P{margin:0px;}
BODY{background:white;}
.title{padding:1ex;background:#00B200;}
.titlemain{padding:1ex;background:#00B200;}
.titlerest{padding:1ex;background:#00B200;}
.section{padding:.5ex;background:#2DE52D;}
.subsection{padding:0.3ex;background:#66FF66;}
.ftoc1{list-style:none;margin:0ex 1ex;padding:0ex 1ex;border-left:1ex solid #00CC00;}
.ftoc2{list-style:none;margin:1ex 1ex;padding:0ex 1ex;border-left:1ex solid #2DE52D;}
</STYLE>
</HEAD>
<BODY >
<!--HEVEA command line is: /usr/bin/hevea article.hva fancysection.hva -fix -O README-WeiDU.tex -->
<!--CUT DEF section 1 --><TABLE CLASS="title"><TR><TD><H1 CLASS="titlemain">WeiDU Documentation</H1><H3 CLASS="titlerest">Valerio Bigiani, AKA The Bigg<BR>
<A HREF="mailto:thebigg@spellholdstudios.net">thebigg@spellholdstudios.net</A><BR>
edited according to the GPL from the original version by<BR>
Westley Weimer<BR>
 <A HREF="mailto:weimer@cs.berkley.edu">weimer@cs.berkley.edu</A></H3></TD></TR>
</TABLE><!--TOC section Contents-->
<H2 CLASS="section"><!--SEC ANCHOR -->Contents</H2><!--SEC END --><UL CLASS="ftoc1"><LI CLASS="li-toc">
<A HREF="#htoc1">1&#XA0;&#XA0;About WeiDU</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc2">2&#XA0;&#XA0;Don&#X2019;t Panic!</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc3">3&#XA0;&#XA0;<TT>D and <B>DLG</B> File Concepts</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc4">4&#XA0;&#XA0;<TT>D</TT> Dialogue File Format</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc5">5&#XA0;&#XA0;Command Line Options</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc6">6&#XA0;&#XA0;Example Uses</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc7">7&#XA0;&#XA0;WeiDU Tutorials</A>
<UL CLASS="ftoc2"><LI CLASS="li-toc">
<A HREF="#htoc8">7.1&#XA0;&#XA0;<TT>Multisay</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc9">7.2&#XA0;&#XA0;<TT>CHAIN</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc10">7.3&#XA0;&#XA0;<TT>COPY_TRANS</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc11">7.4&#XA0;&#XA0;<TT>INTERJECT</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc12">7.5&#XA0;&#XA0;<B><TT>INTERJECT_COPY_TRANS</TT></B></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc13">7.6&#XA0;&#XA0;<B><TT>INTERJECT_COPY_TRANS2</TT></B></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc14">7.7&#XA0;&#XA0;<TT>state WEIGHTs</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc15">7.8&#XA0;&#XA0;<B><TT>TRA</TT></B> Translation Files</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc16">7.9&#XA0;&#XA0;Converting a &#X201C;hard-coded&#X201D; <TT>D to a D/TRA pair (Last Update: v200)</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc17">7.10&#XA0;&#XA0;<TT>REPLACE_ACTION_TEXT</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc18">7.11&#XA0;&#XA0;<B><TT>ALTER_TRANS</TT></B> (Last Update: 204.)</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc19">8&#XA0;&#XA0;Module Packaging: <B><TT>TP2</TT></B> Files</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc20">9&#XA0;&#XA0;WeiDU <TT>TP2 Tutorials</TT></A>
<UL CLASS="ftoc2"><LI CLASS="li-toc">
<A HREF="#htoc21">9.1&#XA0;&#XA0;<TT>COPY_EXISTING_REGEXP</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc22">9.2&#XA0;&#XA0;<TT>EXTEND_TOP_REGEXP</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc23">9.3&#XA0;&#XA0;<TT>READ_BYTE and PATCH_IF (Last update: v189)</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc24">9.4&#XA0;&#XA0;<TT>values and expressions (Last update: v189)</TT></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc25">9.5&#XA0;&#XA0;<B><TT>ADD_STORE_ITEM</TT></B> (Last Update: v211)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc26">9.6&#XA0;&#XA0;<B><TT>ADD_GAM_NPC</TT></B></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc27">9.7&#XA0;&#XA0;<B><TT>SET_2DA_ENTRY</TT></B></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc28">9.8&#XA0;&#XA0;<B><TT>WHILE</TT></B> Loops (Last update: v189)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc29">9.9&#XA0;&#XA0;Bitwise Operators (Last update: v189)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc30">9.10&#XA0;&#XA0;Scripting Styles</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc31">9.11&#XA0;&#XA0;TP2 <B><TT>SUBCOMPONENT</TT></B> Groups (Last Update: v192)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc32">9.12&#XA0;&#XA0;<B><TT>ADD_CRE_ITEM</TT></B> (Last Update: v213)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc33">9.13&#XA0;&#XA0;<B><TT>Prompt Customization</TT></B></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc34">9.14&#XA0;&#XA0;<B><TT>INNER_ACTION</TT></B></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc35">9.15&#XA0;&#XA0;<B><TT>SET_2DA_ENTRY_LATER</TT></B> and <B><TT>SET_2DA_ENTRIES_NOW</TT></B> (Last Update: v188)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc36">9.16&#XA0;&#XA0;<B><TT>READ_2DA_ENTRIES_NOW</TT></B> and <B><TT>READ_2DA_ENTRY_FORMER</TT></B> (Last Update: v188)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc37">9.17&#XA0;&#XA0;DEFINE,LAUNCH,LOCAL and everything else about personal macros (Last Update: v188)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc38">9.18&#XA0;&#XA0;standard macros (Last Update: v188)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc39">9.19&#XA0;&#XA0;<B><TT>GROUP</TT></B> (Last update: V221)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc40">9.20&#XA0;&#XA0;<B><TT>array construct</TT></B></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc41">9.21&#XA0;&#XA0;<B><TT>MODDER</TT></B> (Last update: v230)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc42">9.22&#XA0;&#XA0;<B><TT>READLN</TT></B> (Last update: v203)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc43">9.23&#XA0;&#XA0;<B><TT>Functions</TT></B> (Last update: V210)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc44">9.24&#XA0;&#XA0;<B><TT>GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2</TT></B> (last edit: 218)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc45">9.25&#XA0;&#XA0;<B><TT>MATCH and TRY</TT></B> (last edit: 225)</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc46">9.26&#XA0;&#XA0;<B><TT>QUICK_MENU</TT></B> (last edit: 227)</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc47">10&#XA0;&#XA0;<B><TT>Code dumps</TT></B></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc48">11&#XA0;&#XA0;<B><TT>Macros Listing</TT></B></A>
<UL CLASS="ftoc2"><LI CLASS="li-toc">
<A HREF="#htoc49">11.1&#XA0;&#XA0;<B><TT>fj_are_structure</TT></B></A>
</LI><LI CLASS="li-toc"><A HREF="#htoc50">11.2&#XA0;&#XA0;<B><TT>sc#addWmpAre</TT></B></A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc51">12&#XA0;&#XA0;<B><TT>Module Distribution</TT></B>: <TT>Setup-MyMod.exe</TT></A>
<UL CLASS="ftoc2"><LI CLASS="li-toc">
<A HREF="#htoc52">12.1&#XA0;&#XA0;Module Distribution Conventions</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc53">12.2&#XA0;&#XA0;WeiDU Return Values</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc54">13&#XA0;&#XA0;Regular Expressions</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc55">14&#XA0;&#XA0;WeiDU <B><TT>constant</TT></B>s</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc56">15&#XA0;&#XA0;Common File Formats</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc57">16&#XA0;&#XA0;The Source Code</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc58">17&#XA0;&#XA0;Special Thanks</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc59">18&#XA0;&#XA0;Informal Copyright Notice</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc60">19&#XA0;&#XA0;Undocumented Features</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc61">20&#XA0;&#XA0;Index of Terms</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc62">21&#XA0;&#XA0;Changes</A>
</LI></UL><!--TOC section About WeiDU-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc1">1</A>&#XA0;&#XA0;About WeiDU</H2><!--SEC END --><P>The main home page for WeiDU is:
<TT><A HREF="http://weidu.org/">http://weidu.org/</A></TT>.
I encourage you to download the latest version. </P><P>WeiDU is designed to make it easier to write and distribute modifications
to Infinity Engine games. It can load and modify Infinity Engine resources
according to instructions you provide. WeiDU is ideal for packaging
modifications that include dialogue or that want to be compatible with
other modifications. </P><P>I&#X2019;ll be honest with you up front: WeiDU is initially harder to use than
some of its alternatives. However, most users report that (1) the
alternatives are insufficient because they lack features that only WeiDU
provides and (2) WeiDU grows on you over time. </P><P>You are welcome to use these utilities to make and distribute your own
Infinity Engine mods. This utility is covered by the GNU General Public
License, but you are also allowed to distribute an unmodified binary copy
of <TT>WeiDU.EXE</TT> (without the source code) with your mod if you like.</P><P>I decided to write my own Infinity Engine <TT><A HREF="#DLG">DLG</A></TT> and <TT><A HREF="#TLK">TLK</A></TT>
utilities because I was unable to get the TeamBG DLG Editor and Mass
Converter to work properly. Either they wouldn&#X2019;t parse the strings or they
would mangle the text or they would randomly crash ... it was bad all
around. Also, they were all GUIs. As a unix weenie I&#X2019;m in love with command
line utilities and as a PL doctoral student I love making little languages
and compilers. WeiDU was originally a family of small programs with
unimaginative names like DC, DD and TP. The more appealing term &#X201C;WeiDU&#X201D;
(which rhymes with &#X201C;IDU&#X201D;, Eye-Dee-You) was coined by Jason Compton and
Ghreyfain, noted BGII mod authors. </P><!--TOC section Don&#X2019;t Panic!-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc2">2</A>&#XA0;&#XA0;Don&#X2019;t Panic!</H2><!--SEC END --><P>Step-By-Step Beginner&#X2019;s Guide to WeiDU:</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">Don&#X2019;t Panic. Many of you are children of the GUI era. But programs
that run from the command line can be your friend, and in the long run are
often much faster and, yes, easier to use.</LI><LI CLASS="li-enumerate">The Best Way To Learn How To Write Code In WeiDU&#X2019;s <TT><A HREF="#D">D</A></TT> Format
Is To <EM>Read</EM> Code Written In WeiDU&#X2019;s <TT><A HREF="#D">D</A></TT> Format. Start by decompiling
existing in-game <TT><A HREF="#DLG">DLG</A></TT>s that you understand and read through them.
Compare how they appear in WeiDU to how they appear in other BG2 editing
tools you may be more comfortable with, such as Near Infinity or Infinity
Explorer.</LI><LI CLASS="li-enumerate">The Best Way To Learn How To Write Code In WeiDU&#X2019;s <TT><A HREF="#D">D</A></TT> Format
Is To <EM>Read</EM> Code Written In WeiDU&#X2019;s <TT><A HREF="#D">D</A></TT> Format, Part 2. A growing
number of BG2 add-on packs are being created using WeiDU. A list is
available at
<TT><A HREF="http://www.pocketplane.net/modlist/">http://www.pocketplane.net/modlist/</A></TT>.
These
can help you understand how WeiDU&#X2019;s advanced features, such as dialogue
appending, script and <TT><A HREF="#2DA">2DA</A></TT> patching, and item/spell/creature
patching work in a &#X201C;real-world&#X201D; setting. Make it a point to download some
of them and understand HOW they work.</LI><LI CLASS="li-enumerate">Take a look at some of the examples in this document. 
There is a lovely WeiDU tutorial (written by
Japheth) available at
<TT><A HREF="http://forums.pocketplane.net/index.php?topic=55.0">http://forums.pocketplane.net/index.php?topic=55.0</A></TT>. 
If you
are feeling overwhelmed, start there first. It also covers installation.
Ghreyfain also has a &#X201C;how to create an NPC with WeiDU&#X201D; tutorial at
<TT><A HREF="http://forums.pocketplane.net/index.php?topic=52.0">http://forums.pocketplane.net/index.php?topic=52.0</A></TT>. </LI><LI CLASS="li-enumerate">There is a WeiDU discussion board at
<TT><A HREF="http://forums.pocketplane.net/index.php?board=50.0">http://forums.pocketplane.net/index.php?board=50.0</A></TT>. The
discussion board is the best place to have your WeiDU (and mod-making)
questions answered. </LI><LI CLASS="li-enumerate">Finally, if you are using a Mac and you want to play around with
WeiDU, check out <TT><A HREF="http://weidu.org/Mac.html">http://weidu.org/Mac.html</A></TT> for more
information on obtaining a copy of WeiDU that works under OS X. </LI></OL><!--TOC section <TT>D and </TT><TT><B>DLG</B></TT><TT> File Concepts</TT>-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc3">3</A>&#XA0;&#XA0;<TT><A HREF="#D">D</A></TT> and <B><TT>DLG</TT></B><A NAME="DLG"></A><A NAME="@default0"></A> File Concepts</H2><!--SEC END --><P>This section is a gentle introduction to how Infinity Engine <TT><A HREF="#DLG">DLG</A></TT>
files are structured. First, let&#X2019;s use WeiDU to create
<TT>SCSARLES.<A HREF="#D">D</A></TT> and take a look at the dialogue of Sir Sarles. </P><P>You may install <TT>WeiDU.exe</TT> anywhere on your system. However, I recommend
that you put it in your Baldur&#X2019;s Gate 2 installation directory. However,
WeiDU will use the Windows Registry to attempt to locate your BG2 game
files. </P><P>To run the effect described, open up a DOS prompt window and change
directories to get to your BGII directory. Then just type in the
 <FONT COLOR="red"><TT>text in red</TT></FONT> at the DOS Prompt. </P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red">weidu SCSARLES.DLG</FONT> </TT> </P><P>This will create a text file called <TT>SCSARLES.D</TT> in the current
directory. Open it up with Notepad or Microsoft Word or something. It&#X2019;s
just a text file that describes the game dialogue.</P><P>It will look something like: 

<pre width="80"><font color="#219121">// creator  : c:\bgate\weidu\weidu.exe
</font><font color="#219121">// argument : SCSARLES.DLG
</font><font color="#219121">// game     : C:\Program Files\Black Isle\BGII - SoA
</font><font color="#219121">// source   : C:\Program Files\Black Isle\BGII - SoA\data\Dialog.bif
</font><font color="#219121">// dialog   : C:\Program Files\Black Isle\BGII - SoA\DIALOG.TLK
</font><font color="#219121">// dialogF  : (none)
</font>
<font color="#3159D1">BEGIN <font color="#868626">~SCSARLES~</font>

IF <font color="#868626">~NumTimesTalkedTo(0)~</font> THEN BEGIN <font color="#0000FF">0</font> <font color="#219121">// from:
</font>  SAY <font color="#0000FF">#28655</font> <font color="#219121">/* ~Who is it? Might I ask why you have disturbed my
    meditations? My creative muse must be gently awakened, and your
    stomping about is simply not conducive to this.~ [SARLES02] */</font>
  IF <font color="#868626">~~</font> THEN REPLY <font color="#0000FF">#28656</font> <font color="#219121">/* ~My apologies. I will leave you to your
    thinking.~ */</font> GOTO <font color="#0000FF">1</font>
  IF <font color="#868626">~~</font> THEN REPLY <font color="#0000FF">#28657</font> <font color="#219121">/* ~I apologize, but I have come to request your
    talent on a commissioned artwork.~ */</font> 
      DO <font color="#868626">~SetGlobal("TalkedToSarles","GLOBAL",1)~</font> GOTO <font color="#0000FF">2</font>
END

IF <font color="#868626">~~</font> THEN BEGIN <font color="#0000FF">1</font> <font color="#219121">// from: 0.0
</font>  SAY <font color="#0000FF">#28661</font> <font color="#219121">/* ~Then I shall forget you were ever here. Actually, it is an
    astoundingly easy thing to do.~ */</font>
  IF <font color="#868626">~~</font> THEN DO <font color="#868626">~SetNumTimesTalkedTo(0)~</font> EXIT
END</font></pre>
Dialogues in Infinity Engine games behave like finite state machines. If
you aren&#X2019;t familiar with the concept of a finite state machine, see
<TT><A HREF="http://whatis.techtarget.com/definition/0,,sid9_gci213052,00.html">http://whatis.techtarget.com/definition/0,,sid9_gci213052,00.html</A></TT> or
<TT><A HREF="http://www.c3.lanl.gov/mega-math/workbk/machine/mabkgd.html">http://www.c3.lanl.gov/mega-math/workbk/machine/mabkgd.html</A></TT>.
Each block of the form: 

<pre width="80">  <font color="#3159D1">IF <font color="#868626">~Initial Condition~</font> THEN BEGIN</font> state1
    <font color="#3159D1">SAY <font color="#868626">~Something~</font>
    IF <font color="#868626">~Reply Condition~</font> THEN REPLY <font color="#868626">~Reply Text~</font> GOTO</font> state2
  <font color="#3159D1">END</font></pre>
represents a <TT><A HREF="#state">state</A></TT> (more details below). When the player starts a
conversation with an NPC, the game engine scans through all
of the <TT><A HREF="#state">state</A></TT>s in that NPC&#X2019;s <TT><A HREF="#DLG">DLG</A></TT> file in a special
<TT><A HREF="#WEIGHT">WEIGHT</A></TT>ed order and picks the one with a non-empty and true "Initial
Condition". If no state has a non-empty and true "Initial Condition" then
you get that &#X201C;Bob - has nothing to say to you.&#X201D; message. Don&#X2019;t worry about
the weighting process for now. </P><P>The speaker (in this case, Sir Sarles) then says whatever appears after
<TT><A HREF="#SAY">SAY</A></TT>. The <TT><A HREF="#REPLY">REPLY</A></TT> lines represent responses the PC can say
back. If the "Reply Condition" is true, the player is given the option of
saying the "Reply Text" and moving to another state in the dialogue (where
Sarles will probably say something else). </P><P>Remember: <TT><A HREF="#SAY">SAY</A></TT> is for what the NPC says, <TT><A HREF="#REPLY">REPLY</A></TT> is for what
the player says back. If you think carefully, you&#X2019;ll notice that all
dialogue in Infinity Engine games is structed in this manner. </P><P>Conditions use the same syntax as triggers do in Infinity Engine
<TT><A HREF="#BCS">BCS</A></TT> scripting. You will need to learn Infinity Engine scripting
before too long. <TT><A HREF="#String">String</A></TT>s are delineated by tildes or %%
or "" (your choice, but WeiDU uses the tilde by default). After
<TT><A HREF="#SAY">SAY</A></TT> or <TT><A HREF="#REPLY">REPLY</A></TT> or <TT><A HREF="#JOURNAL">JOURNAL</A></TT> you may give two
<TT><A HREF="#String">String</A></TT>s
instead of one. The first is used with <TT>DIALOG.<A HREF="#TLK">TLK</A></TT>, the second
is used with <TT>DIALOGF.<A HREF="#TLK">TLK</A></TT> (foreign language version for when the
main character is female). If you do not give two <TT><A HREF="#String">String</A></TT>s, the one
<TT><A HREF="#String">String</A></TT> you gave is used for both. </P><P>You may also use raw numbers prefaced with a number sign (like <TT>#1234</TT>)
to specify a strref inside <TT>DIALOG.<A HREF="#TLK">TLK</A></TT> directly. This is useful
when modifying existing dialogues (say, the Fate Spirit in ToB) so that you
if a foreign user installs your dialogue they will retain all of the
foreign versions of the strings you didn&#X2019;t change or add. Normally
the string reference numbers are put right after the <TT><A HREF="#SAY">SAY</A></TT> keyword
and the string text is put in comments. The <TT>--text</TT> command-line option
causes string text to be emitted with the string number in comments. </P><P>You may also indicate that a sound file (WAV/WAVC) should be associated
with a given <TT><A HREF="#String">String</A></TT> by including its up-to-8-letter resource name in
<TT>[brackets]</TT> after the string, as in:

<pre width="80">  <font color="#3159D1">SAY</font> <font color="#868626">~Hello~</font> [HELLO]
</pre>
Comments are C/C++ style: everything from // to the end of the line is a
comment, as is /* everything in these star-slash things */. Comments are
ignored by WeiDU. They are there for your benefit. Example: 

<pre width="80">  <font color="#3159D1">SAY</font> <font color="#868626">~Hello~</font> [HELLO]   <font color="#219121">// this is a comment        ... way out to here!
  <font color="#3159D1">IF</font> /* this is also a comment */</font> <font color="#868626">~~</font> <font color="#3159D1">THEN</font> <font color="#3159D1">EXIT</font>
</pre>
Replies can also contain actions (using the <TT><A HREF="#DO">DO</A></TT> keyword) which
behave just like Infinity Engine <TT><A HREF="#BCS">BCS</A></TT> script actions. They can also
add Journal entries, end the dialogue or transfer to another speaker. </P><P>Examples: 

<pre width="80">  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> <font color="#0000FF">2</font> <font color="#219121">// from: 0.1
</font></pre>
This line marks the beginning of <TT><A HREF="#state">state</A></TT> 2 in a dialogue. The comment
tells you that it can be reached by the first reply <TT><A HREF="#transition">transition</A></TT> from
state 0. 

<pre width="80">  <font color="#3159D1">IF <font color="#868626">~~</font> THEN REPLY <font color="#868626">~My apologies. I will leave you to your thinking.~</font> <font color="#219121">// </font><font color="#0000FF">#28656</font>
      GOTO</font> <font color="#0000FF">1</font>
</pre>
This <TT><A HREF="#REPLY">REPLY</A></TT> can always be chosen and involves the spoken text "My
apologies...". That text is string reference number 28656. If the PC
chooses that reply, it transitions to state 1.</P><P>Finally, a <TT><A HREF="#transition">transition</A></TT> may also take the form:

<pre width="80">  <font color="#3159D1">COPY_TRANS</font> filename label
</pre>
During processing, <TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT> will be replaced by all of the
transitions from state "label" of file "filename". The copying takes place
before all other <TT><A HREF="#D">D</A></TT> actions. </P><!--TOC section <TT>D</TT> Dialogue File Format-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc4">4</A>&#XA0;&#XA0;<TT>D</TT> Dialogue File Format</H2><!--SEC END --><P> <A NAME="D"></A>
</P><P>The <TT><A HREF="#D">D</A></TT> file format is a way of describing Infinity Engine dialogues
and modifications to Infinity Engine Dialogues in a portable,
easy-to-understand format. It supports foreign language translations and
allows you to describe extensions to existing game dialogues without
forcing you to describe their content. This allows you to write mods that
work with mods written by others. </P><P>The <TT><A HREF="#D">D</A></TT> file format is presented here in an extended context-free
grammar notation. If you are unfamiliar with CFGs, take a look
<TT><A HREF="http://www.wikipedia.com/wiki/Context-free_grammar">http://www.wikipedia.com/wiki/Context-free_grammar</A></TT>,
<TT><A HREF="http://cs.wpi.edu/~kal/PLT/PLT2.1.2.html">http://cs.wpi.edu/~kal/PLT/PLT2.1.2.html</A></TT>
or 
<TT><A HREF="http://www.cs.rochester.edu/users/faculty/nelson/courses/csc_173/grammars/cfg.html">http://www.cs.rochester.edu/users/faculty/nelson/courses/csc_173/grammars/cfg.html</A></TT>. 
You don&#X2019;t really need to understand a CFG formally, though. </P><P>To get a real idea of how they work, use WeiDU to create JAHEIRA.D for
yourself and look at it in a text editor. You can also browse the <TT>examples</TT>
and <TT>test</TT> directories that come with WeiDU.</P><P>All of the syntax keywords are given in a <TT>UPPERCASE COURIER</TT>.
All other keywords are symbolic. Notes:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
bar <FONT COLOR="red"> list </FONT>means "0 or more copies of bar".
</LI><LI CLASS="li-itemize"><FONT COLOR="red"> [ </FONT>foo <FONT COLOR="red"> ] </FONT>means "an optional foo" or "0 or 1 copies of foo".
</LI><LI CLASS="li-itemize">foo bar ... means "you may repeat foo bar as often as you like here". 
</LI></UL><TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1><TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>D File</TT></B><A NAME="D File"></A><A NAME="@default1"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left> A <TT><A HREF="#D file">D file</A></TT> is a text file that contains a number of <TT><A HREF="#D
Actions">D
Actions</A></TT>. <TT><A HREF="#D File">D File</A></TT>s tell WeiDU how to create and modify Infinity
Engine <TT><A HREF="#DLG">DLG</A></TT> files.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
is</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#D Action">D Action</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> A <TT><A HREF="#D File">D File</A></TT> is a list of <TT><A HREF="#D Action">D Action</A></TT>s. Typically the first and
only one is <TT><A HREF="#BEGIN">BEGIN</A></TT>, which defines the content of a new dialogue.
Other <TT><A HREF="#D Action">D Action</A></TT>s can be used to modify existing dialogues.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>D Action</TT></B><A NAME="D Action"></A><A NAME="@default2"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left> A <TT><A HREF="#D Action">D Action</A></TT> tells WeiDU how to create or modify Infinity Engine
<TT><A HREF="#DLG">DLG</A></TT> files.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
is</TD><TD VALIGN=top ALIGN=left><B><TT>BEGIN</TT></B><A NAME="BEGIN"></A><A NAME="@default3"></A> filename <FONT COLOR="red"> [ </FONT><B><TT>nonPausing</TT></B><A NAME="nonPausing"></A><A NAME="@default4"></A> <FONT COLOR="red"> ] </FONT><TT><A HREF="#state">state</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> <TT><A HREF="#BEGIN">BEGIN</A></TT> tells WeiDU that you are creating a new DLG file from
scratch. Any existing DLG file with the same name will be overwritten. 
The new DLG file contains exactly the <TT><A HREF="#state">state</A></TT>s in the list. 
If you set <TT><A HREF="#nonPausing">nonPausing</A></TT> to a non-zero integer, the game will not
&#X201C;stop time&#X201D; while the conversation takes place. By default time stops
during conversations.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>APPEND</TT></B><A NAME="APPEND"></A><A NAME="@default5"></A> <FONT COLOR="red"> [ </FONT><TT>IF_FILE_EXISTS</TT> <FONT COLOR="red"> ] </FONT>filename <TT><A HREF="#state">state</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> This tells WeiDU to place the given <TT><A HREF="#state">state</A></TT>s at the end of the
already-existing dialogue <TT>filename.<A HREF="#DLG">DLG</A></TT>. If there is IF_FILE_EXISTS
and the file doesn&#X2019;t exists, this action is skipped.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>APPEND_EARLY</TT></B><A NAME="APPEND_EARLY"></A><A NAME="@default6"></A> <FONT COLOR="red"> [ </FONT><TT>IF_FILE_EXISTS</TT> <FONT COLOR="red"> ] </FONT>filename <TT><A HREF="#state">state</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Works like <TT><A HREF="#APPEND">APPEND</A></TT>, but the <TT><A HREF="#state">state</A></TT>s are added early on in
the compilation timeline (just after <TT><A HREF="#BEGIN">BEGIN</A></TT> is processed). Thus
they can be the targets for <TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT> and friends.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>CHAIN</TT></B><A NAME="CHAIN"></A><A NAME="@default7"></A>
<FONT COLOR="red"> [ </FONT><TT>IF</TT> <FONT COLOR="red"> [ </FONT><TT>WEIGHT</TT> <TT>#</TT>weight <FONT COLOR="red"> ] </FONT><TT>stateTriggerString</TT> <TT>THEN</TT> <FONT COLOR="red"> ]  [ </FONT><TT>IF_FILE_EXISTS</TT> <FONT COLOR="red"> ] </FONT>entryFilename entryLabel <TT><A HREF="#chainText">chainText</A></TT> <FONT COLOR="red"> list </FONT><TT><A HREF="#chainEpilogue">chainEpilogue</A></TT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to make a long conversation in which the PC can say
nothing. This is useful when you want the NPCs to talk among themselves
for a long time. It and its friends, <TT><A HREF="#INTERJECT">INTERJECT</A></TT> and
<TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT> can incredible time-savers when you&#X2019;re
writing non-trivial dialogue. See the examples for ideas. <TT><A HREF="#CHAIN">CHAIN</A></TT>
will only append to existing dialogues. You cannot use <TT><A HREF="#CHAIN">CHAIN</A></TT> to
create a new DLG. If the entryFilename file is missing and there is IF_FILE_EXISTS,
the whole CHAIN is not compiled.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INTERJECT</TT></B><A NAME="INTERJECT"></A><A NAME="@default8"></A> entryFilename entryLabel <TT>globalVariable</TT>
<TT><A HREF="#chainText">chainText</A></TT> <FONT COLOR="red"> list </FONT><TT><A HREF="#chainEpilogue">chainEpilogue</A></TT></TD><TD VALIGN=top ALIGN=left> Behaves like <TT><A HREF="#CHAIN">CHAIN</A></TT> except that all of the <TT><A HREF="#chainText">chainText</A></TT> is
additionally guarded by the <TT><A HREF="#transition">transition</A></TT> predicate <TT>Global("globalVariable","GLOBAL",0)</TT> and accompanied by the action <TT>SetGlobal("globalVariable","GLOBAL",1)</TT>. If you pick <TT>globalVariable </TT> to be unique, this will ensure that the <TT><A HREF="#chainText">chainText</A></TT> is only ever seen once per game. This is useful for making interjections.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INTERJECT_COPY_TRANS</TT></B><A NAME="@default9"></A> entryFilename entryLabel <TT>globalVariable</TT> <TT><A HREF="#chainText">chainText</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This behaves just like <TT><A HREF="#INTERJECT">INTERJECT</A></TT> except that the exitFilename and
exitLabel are not present. Instead, whenever the dialogue would pass out
of the <TT><A HREF="#chainText">chainText</A></TT> it follows a copy of the <TT><A HREF="#transition">transition</A></TT>s
that were at the <TT><A HREF="#state">state</A></TT> with <TT><A HREF="#stateLabel">stateLabel</A></TT> originally. This
is convenient for making quick interjections from NPCs that do not actually
change the true flow of the conversation. See the <TT><A HREF="#transition">transition</A></TT>
<TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT> and the <TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT> tutorial
for more information about this idea.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INTERJECT_COPY_TRANS2</TT></B><A NAME="@default10"></A> entryFilename entryLabel <TT>globalVariable</TT> <TT><A HREF="#chainText">chainText</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This works just like <TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT>, except that any
actions taken in the transitions of the state specified by entryFilename
and entryLabel are preserved and kept with the speaker associated with
entryFilename (rather than being mistakenly performed by your new
speaker). See the <TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INTERJECT_COPY_TRANS3</TT></B><A NAME="INTERJECT_COPY_TRANS3"></A><A NAME="@default11"></A> entryFilename entryLabel <TT>globalVariable</TT> <TT><A HREF="#chainText">chainText</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This works just like <TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT>, except that all
states in chainText get a link in the entry state, rather than only the
first one. Expecting documentation.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INTERJECT_COPY_TRANS4</TT></B><A NAME="INTERJECT_COPY_TRANS4"></A><A NAME="@default12"></A> entryFilename entryLabel <TT>globalVariable</TT> <TT><A HREF="#chainText">chainText</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This is either <TT><A HREF="#INTERJECT_COPY_TRANS3">INTERJECT_COPY_TRANS3</A></TT> with <TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT>-style
action handling, or <TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT> with the extended
<TT><A HREF="#INTERJECT_COPY_TRANS3">INTERJECT_COPY_TRANS3</A></TT> state creation rules, depending at how you
look at it.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left> <B><TT>EXTEND_TOP</TT></B><A NAME="EXTEND_TOP"></A><A NAME="@default13"></A>
filename <TT><A HREF="#stateLabel">stateLabel</A></TT> <FONT COLOR="red"> list  [ </FONT><TT>#positionNumber</TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#transition">transition</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to add the <TT><A HREF="#transition">transition</A></TT>s in list to the top of
the <TT><A HREF="#transition">transition</A></TT> list for the specified states in <TT>filename.<A HREF="#DLG">DLG</A></TT>
(which must already exist). <P>If a <TT>positionNumber</TT> is given, WeiDU to insert the <TT><A HREF="#transition">transition</A></TT>s
just between already-existing transitions <TT>#positionNumber</TT> and
<TT>#positionNumber+1</TT> in the given states for the given file. The first
<TT><A HREF="#transition">transition</A></TT> is number 1.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>EXTEND_BOTTOM</TT></B><A NAME="EXTEND_BOTTOM"></A><A NAME="@default14"></A> filename <TT><A HREF="#stateNumber">stateNumber</A></TT> <FONT COLOR="red"> list  [ </FONT><TT>#positionNumber</TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#transition">transition</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Behaves just like <TT><A HREF="#EXTEND_TOP">EXTEND_TOP</A></TT> but adds the transitions to the
bottom of the list instead.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_STATE_TRIGGER</TT></B><A NAME="ADD_STATE_TRIGGER"></A><A NAME="@default15"></A> filename <TT><A HREF="#stateNumber">stateNumber</A></TT> 
<TT><A HREF="#stateTriggerString">stateTriggerString</A></TT> <FONT COLOR="red"> [ </FONT><TT><A HREF="#stateNumber">stateNumber</A></TT> <FONT COLOR="red"> list  ] </FONT>	<TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to add the <TT><A HREF="#stateTriggerString">stateTriggerString</A></TT> to all
of the <TT><A HREF="#state">state</A></TT>s with the given <TT><A HREF="#stateNumber">stateNumber</A></TT>s in 
the file <TT>filename.<A HREF="#DLG">DLG</A></TT> (which must already exist). This is handy for
adding extra conditions to an existing dialogue <TT><A HREF="#state">state</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_TRANS_TRIGGER</TT></B><A NAME="ADD_TRANS_TRIGGER"></A><A NAME="@default16"></A> filename <TT><A HREF="#stateNumber">stateNumber</A></TT> 
<TT><A HREF="#transTriggerString">transTriggerString</A></TT> <FONT COLOR="red"> [ </FONT><TT><A HREF="#moreStateNumbers">moreStateNumbers</A></TT> <FONT COLOR="red"> list  ]  [ </FONT><TT>DO</TT> <TT><A HREF="#transNumber">transNumber</A></TT> <FONT COLOR="red"> list  ] </FONT><TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to add the <TT><A HREF="#transTriggerString">transTriggerString</A></TT> to all
of the <TT><A HREF="#transition">transition</A></TT>s in all of the <TT><A HREF="#state">state</A></TT>s with the given
<TT><A HREF="#stateNumber">stateNumber</A></TT>s in the file <TT>filename.<A HREF="#DLG">DLG</A></TT> (which must already
exist). This is often used in conjunction with <TT><A HREF="#EXTEND_BOTTOM">EXTEND_BOTTOM</A></TT> to
make a new branch in an existing <TT><A HREF="#state">state</A></TT>. Use
<TT><A HREF="#ADD_TRANS_TRIGGER">ADD_TRANS_TRIGGER</A></TT> to add the negation of some predicate to all of
the existing <TT><A HREF="#transition">transition</A></TT>s, then use <TT><A HREF="#EXTEND_BOTTOM">EXTEND_BOTTOM</A></TT> to add a
<TT><A HREF="#transition">transition</A></TT> with that predicate to that <TT><A HREF="#state">state</A></TT>. 
If a list of <TT><A HREF="#transNumber">transNumber</A></TT>s is specified, only those transitions 
will have <TT><A HREF="#transTriggerString">transTriggerString</A></TT> added to them. If such a list is not
specified, every transition in every specified state will be modified.
Note that the &#X201C;first&#X201D; transition is number 0.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_TRANS_ACTION</TT></B><A NAME="ADD_TRANS_ACTION"></A><A NAME="@default17"></A> filename 
<TT>BEGIN</TT> <TT><A HREF="#stateNumber">stateNumber</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT> 
<TT>BEGIN</TT> <TT><A HREF="#transNumber">transNumber</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT>
<TT><A HREF="#transActionString">transActionString</A></TT> <TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to add the <TT><A HREF="#transActionString">transActionString</A></TT> to all
of the actions in all the <TT><A HREF="#transition">transition</A></TT>s in all of the <TT><A HREF="#state">state</A></TT>s specified by the
<TT>stateNumber</TT> list and the <TT>transNumber</TT> list. You may use
state labels in the <TT>stateNumber</TT> list. If the <TT>transNumber</TT> list
is empty, the text added to all transitions on all listed states.
Note that the <TT>BEGIN</TT> and <TT>END</TT> keywords must be present, even if you
specify an empty list of <TT>transNumber</TT>s.
The &#X201C;first&#X201D; transition is number 0. Any out-of-bounds <TT>transNumbers</TT>
are silently ignored. The <TT>transActionString</TT> is prepended to any
existing action text on a per-<TT><A HREF="#transition">transition</A></TT>, per-<TT><A HREF="#state">state</A></TT>
basis.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_TRANS_ACTION</TT></B><A NAME="REPLACE_TRANS_ACTION"></A><A NAME="@default18"></A> filename
<TT>BEGIN</TT> <TT><A HREF="#stateNumber">stateNumber</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT>
<TT>BEGIN</TT> <TT><A HREF="#transNumber">transNumber</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT>
oldText newText <TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to replace all instances of oldText in newText to all
of the actions in all the <TT><A HREF="#transition">transition</A></TT>s in all of the <TT><A HREF="#state">state</A></TT>s specified by the
<TT>stateNumber</TT> list and the <TT>transNumber</TT> list. You may use
state labels in the <TT>stateNumber</TT> list. If the <TT>transNumber</TT> list
is empty, the text added to all transitions on all listed states.
Note that the <TT>BEGIN</TT> and <TT>END</TT> keywords must be present, even if you
specify an empty list of <TT>transNumber</TT>s.
The &#X201C;first&#X201D; transition is number 0. Any out-of-bounds <TT>transNumbers</TT>
are silently ignored.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_TRANS_TRIGGER</TT></B><A NAME="REPLACE_TRANS_TRIGGER"></A><A NAME="@default19"></A> filename
<TT>BEGIN</TT> <TT><A HREF="#stateNumber">stateNumber</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT>
<TT>BEGIN</TT> <TT><A HREF="#transNumber">transNumber</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT>
oldText newText <TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to replace all instances of oldText in newText to all
of the triggers in all of the <TT><A HREF="#transition">transition</A></TT>s in all of the <TT><A HREF="#state">state</A></TT>s specified by the
<TT>stateNumber</TT> list and the <TT>transNumber</TT> list. You may use
state labels in the <TT>stateNumber</TT> list. If the <TT>transNumber</TT> list
is empty, the text added to all transitions on all listed states.
Note that the <TT>BEGIN</TT> and <TT>END</TT> keywords must be present, even if you
specify an empty list of <TT>transNumber</TT>s.
The &#X201C;first&#X201D; transition is number 0. Any out-of-bounds <TT>transNumbers</TT>
are silently ignored.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ALTER_TRANS</TT></B><A NAME="@default20"></A> filename
<TT>BEGIN</TT> <TT><A HREF="#stateNumber">stateNumber</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT>
<TT>BEGIN</TT> <TT><A HREF="#transNumber">transNumber</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT>
<TT>BEGIN</TT> changeWhat changeInto <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Fine altering of a single transition. See the <TT><A HREF="#ALTER_TRANS">ALTER_TRANS</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE</TT></B><A NAME="REPLACE"></A><A NAME="@default21"></A> filename <TT><A HREF="#state">state</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to load <TT>filename.<A HREF="#DLG">DLG</A></TT> and replace some of its 
<TT><A HREF="#state">state</A></TT>s with the new ones described in the <TT><A HREF="#state">state</A></TT> list.
All of the <TT><A HREF="#state">state</A></TT>s should have numeric stateLabels (e.g., "5" or
"67"). A new <TT><A HREF="#state">state</A></TT> with label <TT>X</TT> will replace the old
<TT><A HREF="#state">state</A></TT> number <TT>X</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>SET_WEIGHT</TT></B><A NAME="SET_WEIGHT"></A><A NAME="@default22"></A> filename <TT><A HREF="#stateLabel">stateLabel</A></TT> <TT>#stateWeight</TT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to destructively change the <TT><A HREF="#WEIGHT">WEIGHT</A></TT> of the
given <TT><A HREF="#state">state</A></TT> in <TT>filename.<A HREF="#DLG">DLG</A></TT> (which must exist). This should only
be used to patch or workaround existing dialogues. Never use
<TT><A HREF="#SET_WEIGHT">SET_WEIGHT</A></TT> if you can help it.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_SAY</TT></B><A NAME="REPLACE_SAY"></A><A NAME="@default23"></A> filename <TT><A HREF="#stateLabel">stateLabel</A></TT> <TT><A HREF="#sayString">sayString</A></TT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to destructively change the <TT><A HREF="#sayString">sayString</A></TT> of the
given <TT><A HREF="#state">state</A></TT> in <TT>filename.<A HREF="#DLG">DLG</A></TT> (which must exist). This should only
be used to patch or workaround existing dialogues. Never use
<TT><A HREF="#REPLACE_SAY">REPLACE_SAY</A></TT> if you can help it.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_STATE_TRIGGER</TT></B><A NAME="REPLACE_STATE_TRIGGER"></A><A NAME="@default24"></A> filename <TT><A HREF="#stateNumber">stateNumber</A></TT> 
<TT><A HREF="#stateTriggerString">stateTriggerString</A></TT> <FONT COLOR="red"> [ </FONT><TT><A HREF="#stateNumber">stateNumber</A></TT> <FONT COLOR="red"> list  ] </FONT>	<TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to destructively set the
<TT><A HREF="#stateTriggerString">stateTriggerString</A></TT> of all of the <TT><A HREF="#state">state</A></TT>s with the given
<TT><A HREF="#stateNumber">stateNumber</A></TT>s in the file <TT>filename.<A HREF="#DLG">DLG</A></TT> (which must already
exist). It should be used with caution.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_TRIGGER_TEXT</TT></B><A NAME="REPLACE_TRIGGER_TEXT"></A><A NAME="@default25"></A> filename oldText newText
<TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to destructively replace every occurrence of oldText
(which may be a <TT><A HREF="#regexp">regexp</A></TT>) in the <TT><A HREF="#stateTriggerString">stateTriggerString</A></TT>s and
<TT><A HREF="#transTriggerString">transTriggerString</A></TT>s of <TT>filename.<A HREF="#DLG">DLG</A></TT> (which must exist). 
This should only be used to patch or workaround existing dialogues. Never
use this if you can help it.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_TRIGGER_TEXT_REGEXP</TT></B><A NAME="REPLACE_TRIGGER_TEXT_REGEXP"></A><A NAME="@default26"></A> filenameRegexp oldText newText
<TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Just like <TT><A HREF="#REPLACE_TRIGGER_TEXT">REPLACE_TRIGGER_TEXT</A></TT> but the filename is a
<TT><A HREF="#regexp">regexp</A></TT>. The <TT><A HREF="#.DLG">.DLG</A></TT> is implied.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_ACTION_TEXT</TT></B><A NAME="REPLACE_ACTION_TEXT"></A><A NAME="@default27"></A> filename oldText newText 
<FONT COLOR="red"> [ </FONT>moreFilenames <FONT COLOR="red"> ] </FONT><TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to destructively replace every occurrence of oldText
(which may be a <TT><A HREF="#regexp">regexp</A></TT>) in the <TT><A HREF="#stateActionString">stateActionString</A></TT>s 
of <TT>filename.<A HREF="#DLG">DLG</A></TT> (which must exist). This should only be used
to patch or workaround existing dialogues. Never use this if you can help
it.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_ACTION_TEXT_REGEXP</TT></B><A NAME="REPLACE_ACTION_TEXT_REGEXP"></A><A NAME="@default28"></A> filenameRegexp oldText newText 
<FONT COLOR="red"> [ </FONT>moreFilenameRegexps <FONT COLOR="red"> ] </FONT><TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Just like <TT><A HREF="#REPLACE_ACTION_TEXT">REPLACE_ACTION_TEXT</A></TT> but the filenames are
<TT><A HREF="#regexp">regexp</A></TT>s. The <TT><A HREF="#.DLG">.DLG</A></TT> is implied, do not include it in your
<TT><A HREF="#regexp">regexp</A></TT>s.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_ACTION_TEXT_PROCESS</TT></B><A NAME="REPLACE_ACTION_TEXT_PROCESS"></A><A NAME="@default29"></A> filename oldText newText
<FONT COLOR="red"> [ </FONT>moreFilenames <FONT COLOR="red"> ] </FONT><TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to destructively replace every occurrence of oldText
(which may be a <TT><A HREF="#regexp">regexp</A></TT>) in the <TT><A HREF="#stateActionString">stateActionString</A></TT>s 
of <TT>filename.<A HREF="#DLG">DLG</A></TT> (which must exist) with newText. However,
newText is first compiled as a <TT><A HREF="#BAF">BAF</A></TT> action list. In particular,
this means that replacing with commands like:
<PRE CLASS="verbatim">  ~DisplayString(Myself,@123)~
  </PRE>... will do what you expect. This should only be used to patch or
workaround existing dialogues. Never use this if you can help it.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>R_A_T_P_R</TT></B><A NAME="R_A_T_P_R"></A><A NAME="@default30"></A>
filenameRegexp oldText newText
<FONT COLOR="red"> [ </FONT>moreFilenameRegexps <FONT COLOR="red"> ] </FONT><TT><A HREF="#dActionWhen">dActionWhen</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Just like <TT><A HREF="#REPLACE_ACTION_TEXT_PROCESS">REPLACE_ACTION_TEXT_PROCESS</A></TT>, but the filenames are
<TT><A HREF="#regexp">regexp</A></TT>s. The <TT><A HREF="#.DLG">.DLG</A></TT> is implied. R_A_T_P_R is
shorthand for REPLACE_ACTION_TEXT_PROCESS_REGEXP (to avoid undue scrollbars
in the readme on a 1024x768 monitor).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>dActionWhen</TT></B><A NAME="dActionWhen"></A><A NAME="@default31"></A></TD><TD VALIGN=top ALIGN=left>defines when a D action (E.G. ADD_TRANS_ACTION) will
be processed or not.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><B><TT>IF</TT></B><A NAME="@default32"></A> String</TD><TD VALIGN=top ALIGN=left>The action is processed if the element being
altered/replaced/added to contains a substring matching against the String
regexp.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>UNLESS</TT></B><A NAME="@default33"></A> String</TD><TD VALIGN=top ALIGN=left>The action is not processed if the element being
altered/replaced/added to contains a substring matching against the String
regexp.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>chainEpilogue</TT></B><A NAME="chainEpilogue"></A><A NAME="@default34"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>Determines where the dialogue should flow at the
end of the <TT><A HREF="#CHAIN">CHAIN</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><TT>END</TT> filename stateNumber</TD><TD VALIGN=top ALIGN=left>Transfer to the given state in the given dialogue file.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>EXTERN</TT> filename stateNumber</TD><TD VALIGN=top ALIGN=left>Transfer to the given state in the given dialogue file.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>COPY_TRANS</TT> filename stateNumber</TD><TD VALIGN=top ALIGN=left>At the end of the
<TT><A HREF="#CHAIN">CHAIN</A></TT> text, copy all transitions from the given state in the
given file. This is useful for interjections (see <TT><A HREF="#INTERJECT">INTERJECT</A></TT>).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>COPY_TRANS_LATE</TT> filename stateNumber</TD><TD VALIGN=top ALIGN=left>Same as above, but only copy after all the other <TT><A HREF="#D Action">D Action</A></TT>s have been applied.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>EXIT</TT></TD><TD VALIGN=top ALIGN=left>At the end of the <TT><A HREF="#CHAIN">CHAIN</A></TT> text, exit the dialogue.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>END</TT> <TT><A HREF="#transition">transition</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left>Execute the given <TT><A HREF="#transition">transition</A></TT>s
after the final state in the <TT><A HREF="#CHAIN">CHAIN</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>state</TT></B><A NAME="state"></A><A NAME="@default35"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>In Infinity Engine games, this is the fundamental unit
of dialogue.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><TT>IF</TT> <FONT COLOR="red"> [ </FONT><B><TT>WEIGHT</TT></B><A NAME="WEIGHT"></A><A NAME="@default36"></A> <TT>#weightNumber</TT> <FONT COLOR="red"> ] </FONT><B><TT>stateTriggerString</TT></B><A NAME="stateTriggerString"></A><A NAME="@default37"></A> <FONT COLOR="red"> [ </FONT><TT>THEN</TT> <FONT COLOR="red"> ]  [ </FONT><TT>BEGIN</TT> <FONT COLOR="red"> ] </FONT><B><TT>stateLabel</TT><A NAME="stateLabel"></A><A NAME="@default38"></A> <TT>SAY</TT></B><A NAME="SAY"></A><A NAME="@default39"></A> <TT><A HREF="#sayText">sayText</A></TT> <FONT COLOR="red"> [ </FONT>=
<TT><A HREF="#sayText">sayText</A></TT> ... <FONT COLOR="red"> ] </FONT><TT><A HREF="#transition">transition</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> When you start conversing with a creature that uses a <TT><A HREF="#DLG">DLG</A></TT> file, the
Infinity Engine searches through all of the <TT><A HREF="#state">state</A></TT>s in that file
in order of increasing <TT><A HREF="#WEIGHT">WEIGHT</A></TT> and selects the first one it finds
for which the <TT><A HREF="#stateTriggerString">stateTriggerString</A></TT> is both true and not empty. 
The creature then says all of the associated <TT><A HREF="#sayText">sayText</A></TT>. Finally,
the <TT><A HREF="#transitions">transitions</A></TT> are evaluated in bottom-up (i.e., reverse) order.
If a <TT><A HREF="#transition">transition</A></TT> is found with a <TT><A HREF="#transTriggerString">transTriggerString</A></TT> that
evaluates to True and no <TT><A HREF="#replyText">replyText</A></TT>, that <TT><A HREF="#transition">transition</A></TT> is
immediately executed. Otherwise, all of the <TT><A HREF="#transition">transition</A></TT>s are
presented as options to the PC. <P>If a <TT><A HREF="#stateLabel">stateLabel</A></TT> is an integer it is called a
<B><TT>stateNumber</TT></B><A NAME="stateNumber"></A><A NAME="@default40"></A>. All of the states in the <TT><A HREF="#DLG">DLG</A></TT> files that
come with the original game use <TT><A HREF="#stateNumber">stateNumber</A></TT>s. Only <TT><A HREF="#D">D</A></TT>
files use symbolic strings for <TT><A HREF="#stateLabel">stateLabel</A></TT>s. </P><P>Including more than one bit of <TT><A HREF="#sayText">sayText</A></TT> here is often called
<TT><A HREF="#Multisay">Multisay</A></TT>. </P><P>Finally, once you are familiar with the syntax you may omit the <TT>THEN</TT>
and <TT>BEGIN</TT> keywords if you like.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>APPENDI</TT></B><A NAME="APPENDI"></A><A NAME="@default41"></A> filename <TT><A HREF="#state">state</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> This is legacy syntax that behaves just like the <TT><A HREF="#D Action">D Action</A></TT>
<TT><A HREF="#APPEND">APPEND</A></TT> but is considered a <TT><A HREF="#state">state</A></TT>. Avoid it.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>CHAIN2</TT></B><A NAME="CHAIN2"></A><A NAME="@default42"></A> entryFilename entryLabel 
<TT>chain2Text</TT> <FONT COLOR="red"> list </FONT>exitFilename exitLabel</TD><TD VALIGN=top ALIGN=left> This is legacy syntax that behaves somewhat like the <TT><A HREF="#D Action">D Action</A></TT>
<TT><A HREF="#CHAIN">CHAIN</A></TT> but is considered a <TT><A HREF="#state">state</A></TT>. In addition, 
<TT>chain2Text</TT> is slightly different from <TT><A HREF="#chainText">chainText</A></TT>. Avoid
this construction.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>sayText</TT></B><A NAME="sayText"></A><A NAME="@default43"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left><TT>sayText</TT> and <B><TT>replyText</TT></B><A NAME="replyText"></A><A NAME="@default44"></A> are displayed to
the user as part of a dialogue.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#text">text</A></TT></TD><TD VALIGN=top ALIGN=left><TT>sayText</TT> and <TT>replyText</TT> are both <TT><A HREF="#text">text</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>transition</TT></B><A NAME="transition"></A><A NAME="@default45"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>Transitions determine how dialogue flows from one
state to another.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
is</TD><TD VALIGN=top ALIGN=left><TT>IF</TT> <B><TT>transTriggerString</TT></B><A NAME="transTriggerString"></A><A NAME="@default46"></A> <FONT COLOR="red"> [ </FONT><TT>THEN</TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#transFeature">transFeature</A></TT> <FONT COLOR="red"> list </FONT><TT><A HREF="#transNext">transNext</A></TT></TD><TD VALIGN=top ALIGN=left> If the <TT><A HREF="#transTriggerString">transTriggerString</A></TT> evaluates to true or is empty, this
<TT><A HREF="#transition">transition</A></TT> is viable. If it contains no <TT><A HREF="#replyText">replyText</A></TT>
within its <TT><A HREF="#transFeature">transFeature</A></TT> list, it is immediately taken.
Otherwise, the <TT><A HREF="#replyText">replyText</A></TT> is presented as an option to the user. 
If the transition is taken, any actions in the <TT><A HREF="#transFeature">transFeature</A></TT>
list are performed and the dialogue flows to the point indicated by the
<TT><A HREF="#transNext">transNext</A></TT>. 
<TT><A HREF="#transition">transition</A></TT>s are evaluated in "reverse order". That is, the "bottom"
or "last" response for a <TT><A HREF="#state">state</A></TT> is checked first. If its
<TT><A HREF="#transTriggerString">transTriggerString</A></TT>
evaluates to true and it has no <TT><A HREF="#REPLY">REPLY</A></TT> text, that transition is
immediately taken. See <TT>SAREV25A</TT> <TT><A HREF="#state">state</A></TT> 1 for an example of a
<TT><A HREF="#state">state</A></TT> with all kinds of <TT><A HREF="#transition">transition</A></TT>s.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>+</TT> <FONT COLOR="red"> [ </FONT><TT><A HREF="#transTriggerString">transTriggerString</A></TT> <FONT COLOR="red"> ] </FONT><TT>+</TT> <TT><A HREF="#replyText">replyText</A></TT>
<TT><A HREF="#transFeature">transFeature</A></TT> <FONT COLOR="red"> list </FONT><TT><A HREF="#transNext">transNext</A></TT></TD><TD VALIGN=top ALIGN=left> This abbreviated syntax for transitions that would contain <TT><A HREF="#REPLY">REPLY</A></TT>
(which is by far the most common case) allows you to save yourself 
some time and typing. It behaves like the full form above.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>COPY_TRANS</TT></B><A NAME="COPY_TRANS"></A><A NAME="@default47"></A> filename <TT><A HREF="#stateLabel">stateLabel</A></TT></TD><TD VALIGN=top ALIGN=left> This instructs WeiDU to copy all of the <TT><A HREF="#transition">transition</A></TT>s from the
<TT><A HREF="#state">state</A></TT> with the given <TT><A HREF="#stateLabel">stateLabel</A></TT> in <TT>filename.<A HREF="#DLG">DLG</A></TT>. This
copying takes place before all other <TT><A HREF="#D Action">D Action</A></TT>s. For example,
this is a valid <TT><A HREF="#transition">transition</A></TT> list:

<pre width="40"><font color="#3159D1">IF <font color="#868626">~Before()~</font> THEN GOTO</font> my_state
<font color="#3159D1">COPY_TRANS</font> PLAYER1 <font color="#0000FF">33</font>
<font color="#3159D1">IF <font color="#868626">~After()~</font> THEN EXTERN</font> SOLA <font color="#0000FF">55</font></pre></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>COPY_TRANS_LATE</TT></B><A NAME="COPY_TRANS_LATE"></A><A NAME="@default48"></A> filename <TT><A HREF="#stateLabel">stateLabel</A></TT></TD><TD VALIGN=top ALIGN=left> Same as <TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT>, but is invoked after all other <TT><A HREF="#D Action">D Action</A></TT>s.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>transFeature</TT></B><A NAME="transFeature"></A><A NAME="@default49"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>These are features or actions associated with
taking a transition.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><B><TT>REPLY</TT></B><A NAME="REPLY"></A><A NAME="@default50"></A> <TT><A HREF="#replyText">replyText</A></TT></TD><TD VALIGN=top ALIGN=left> If this <TT><A HREF="#transition">transition</A></TT> is taken, the PC says the <TT><A HREF="#replyText">replyText</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>DO</TT><A NAME="DO"></A><A NAME="@default51"></A> <TT>stateActionString</TT></B><A NAME="stateActionString"></A><A NAME="@default52"></A></TD><TD VALIGN=top ALIGN=left> If this <TT><A HREF="#transition">transition</A></TT> is taken, the <TT><A HREF="#stateActionString">stateActionString</A></TT> is
executed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>JOURNAL</TT></B><A NAME="JOURNAL"></A><A NAME="@default53"></A> <TT><A HREF="#text">text</A></TT></TD><TD VALIGN=top ALIGN=left> If this <TT><A HREF="#transition">transition</A></TT> is taken, the <TT><A HREF="#text">text</A></TT> is added to the
PC&#X2019;s journal.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SOLVED_JOURNAL</TT></B><A NAME="SOLVED_JOURNAL"></A><A NAME="@default54"></A> <TT><A HREF="#text">text</A></TT></TD><TD VALIGN=top ALIGN=left> If this <TT><A HREF="#transition">transition</A></TT> is taken, the <TT><A HREF="#text">text</A></TT> is added to the
&#X201C;solved&#X201D; section of the PC&#X2019;s journal.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>UNSOLVED_JOURNAL</TT></B><A NAME="UNSOLVED_JOURNAL"></A><A NAME="@default55"></A> <TT><A HREF="#text">text</A></TT></TD><TD VALIGN=top ALIGN=left> If this <TT><A HREF="#transition">transition</A></TT> is taken, the <TT><A HREF="#text">text</A></TT> is added to the
&#X201C;unsolved&#X201D; section of the PC&#X2019;s journal.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>FLAGS</TT></B><A NAME="FLAGS"></A><A NAME="@default56"></A> integer</TD><TD VALIGN=top ALIGN=left> This allows you to set the features associated with a transition directly
using the binary format of <TT><A HREF="#DLG">DLG</A></TT> files.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>transNext</TT></B><A NAME="transNext"></A><A NAME="@default57"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>This determines where dialogue flows after a
transition has been taken.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><B><TT>GOTO</TT></B><A NAME="GOTO"></A><A NAME="@default58"></A> <TT><A HREF="#stateLabel">stateLabel</A></TT></TD><TD VALIGN=top ALIGN=left> The dialogue continues at the state with label <TT><A HREF="#stateLabel">stateLabel</A></TT> in the
same <TT><A HREF="#DLG">DLG</A></TT> file as the current <TT><A HREF="#state">state</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>EXTERN</TT></B><A NAME="EXTERN"></A><A NAME="@default59"></A> <FONT COLOR="red"> [ </FONT><TT>IF_FILE_EXISTS</TT> <FONT COLOR="red"> ] </FONT>filename <TT><A HREF="#stateLabel">stateLabel</A></TT></TD><TD VALIGN=top ALIGN=left> The dialogue continues at the state with label <TT><A HREF="#stateLabel">stateLabel</A></TT> in the
file <TT>filename.<A HREF="#DLG">DLG</A></TT>. The whole transition is not compiled if there&#X2019;s
IF_FILE_EXISTS and the file filename doesn&#X2019;t exist.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>EXIT</TT></B><A NAME="EXIT"></A><A NAME="@default60"></A></TD><TD VALIGN=top ALIGN=left> The conversation ends.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>+</TT> <TT><A HREF="#stateLabel">stateLabel</A></TT></TD><TD VALIGN=top ALIGN=left> This is a synonym for <TT><A HREF="#GOTO">GOTO</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>chainText</TT></B><A NAME="chainText"></A><A NAME="@default61"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>This is a rapid shorthand for chaining together many
little bits of dialogue when the PC is not saying anything.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><FONT COLOR="red"> [ </FONT><TT>IF</TT> <TT><A HREF="#transTriggerString">transTriggerString</A></TT> <TT>THEN</TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#sayText">sayText</A></TT> 
= <TT><A HREF="#sayText">sayText</A></TT> ...</TD><TD VALIGN=top ALIGN=left>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>followed by</TD><TD VALIGN=top ALIGN=left> <FONT COLOR="red"> [ </FONT>== <FONT COLOR="red"> [ </FONT><TT>IF_FILE_EXISTS</TT> <FONT COLOR="red"> ] </FONT>fileName
<FONT COLOR="red"> [ </FONT><TT>IF</TT> <TT><A HREF="#transTriggerString">transTriggerString</A></TT> <TT>THEN</TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#sayText">sayText</A></TT>
= <TT><A HREF="#sayText">sayText</A></TT> ... <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> The == (that&#X2019;s two consecutive equal signs) marks the beginning of a
new speaker (indicated by fileName). If the
<TT><A HREF="#transTriggerString">transTriggerString</A></TT> is true or if it is not present, this new
speaker says all of its <TT><A HREF="#sayText">sayText</A></TT> in order. If the <TT>IF_FILE_EXISTS</TT>
part is present, these lines are not compiled at all if the current file is
not missing.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or followed by</TD><TD VALIGN=top ALIGN=left> <TT>BRANCH</TT> <TT><A HREF="#transTriggerString">transTriggerString</A></TT> <TT>BEGIN</TT>
<FONT COLOR="red"> [ </FONT>== <FONT COLOR="red"> [ </FONT><TT>IF_FILE_EXISTS</TT> <FONT COLOR="red"> ] </FONT>fileName
<FONT COLOR="red"> [ </FONT><TT>IF</TT> <TT><A HREF="#transTriggerString">transTriggerString</A></TT> <TT>THEN</TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#sayText">sayText</A></TT>
= <TT><A HREF="#sayText">sayText</A></TT> ... <FONT COLOR="red"> ] </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> As above, except that the first transTriggerString is appended to all
existing dialogue units.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>text</TT></B><A NAME="text"></A><A NAME="@default62"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>This represents strings that are shown to the player,
rather than strings that the game uses internally for predicates and
actions.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> [ </FONT><TT>[WAVEFILE]</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left>The given string is used for both male and
female players. The optional <TT>[WAVEFILE]</TT> is the associated sound.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> [ </FONT><TT>[WAVEFILE]</TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> [ </FONT><TT>[WAVEFILE]</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left>The first string and sound file are used if the PC is male, the second
string and sound file are used if the PC is female. This is useful mainly
for international versions of Infinity Engine games.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>#integer</TT></TD><TD VALIGN=top ALIGN=left>The string with reference number <TT>#integer</TT> from
<TT>DIALOG.<A HREF="#TLK">TLK</A></TT> should be used unchanged.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>@integer</TT></TD><TD VALIGN=top ALIGN=left>The last definition of the translation string
<TT>@integer</TT> given in any <TT><A HREF="#TRA">TRA</A></TT> file should be used.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>( AT <B>"</B>var<B>"</B> )</TT></TD><TD VALIGN=top ALIGN=left>The last definition of the translation string
(with value defined by a variable) given in any <TT><A HREF="#TRA">TRA</A></TT> file should be used.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>!integer</TT> <TT><A HREF="#text">text</A></TT></TD><TD VALIGN=top ALIGN=left><B><TT>Forced String Reference</TT></B><A NAME="Forced String Reference"></A><A NAME="@default63"></A>. As with
<TT><A HREF="#text">text</A></TT> in general, but rather than being assigned a new,
previously-unused <TT>DIALOG.TLK</TT> string entry (or merging with an existing
one that has the same <TT><A HREF="#text">text</A></TT>), this <TT><A HREF="#text">text</A></TT> is written over
<TT>DIALOG.TLK</TT> string entry #<TT>integer</TT>. Do not use this without a real reason.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>String</TT></B><A NAME="String"></A><A NAME="@default64"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>This is how you tell WeiDU what text you want shown
to the player. For international mods or international translations, you 
may use any encoding you like (that is, you are not restricted to 7-bit
characters or Latin-1 or anything like that).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><B>"</B>abcdef<B>"</B></TD><TD VALIGN=top ALIGN=left>A string can be any sequence of characters not
including a " that is enclosed in ""s.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><CODE>~</CODE></B>abcdef<B><CODE>~</CODE></B></TD><TD VALIGN=top ALIGN=left>A string can be any sequence of
characters not including a <CODE>~</CODE> that is enclosed in
<CODE>~~</CODE>s.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B>%</B>abcdef<B>%</B></TD><TD VALIGN=top ALIGN=left>A string can be any sequence of characters not
including a % that is enclosed in %%s. This is handy for Big5
translations, since " and <CODE>~</CODE> can be part of Big5-encoded characters.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><CODE>~~~~~</CODE></B>abcdef<B><CODE>~~~~~</CODE></B></TD><TD VALIGN=top ALIGN=left>That&#X2019;s five consecutive
tildes on each side. A string can be any
sequence of characters not including <CODE>~~~~~</CODE> that is enclosed in 
<CODE>~~~~~</CODE>s. For example, 
string #8750 is
<FONT COLOR="red"><CODE>~!@#$\%^&amp;*()_+-=[]{}\|;:'",&lt;.&gt;/?</CODE></FONT>
and can be given to WeiDU as
<CODE>~~~~~<FONT COLOR="red">~!@#$\%^&amp;*()_+-=[]{}\|;:'",&lt;.&gt;/?</FONT>~~~~~</CODE>
(the content of the string is shown in red for clarity).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#String">String</A></TT> <TT>^</TT> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>String literal concatenation.
The second string is appended to the first string. No whitespace is added.
Thus <TT>"hello" ^ "World"</TT> is the same as <TT>"helloWorld"</TT>.</TD></TR>
</TABLE><!--TOC section Command Line Options-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc5">5</A>&#XA0;&#XA0;Command Line Options</H2><!--SEC END --><P>WeiDU is a command-line utility. GUIs are available, but this document only
describes command-line invocation. Use the DOS Shell ("command" or "cmd")
to run WeiDU. You control its behavior by passing arguments to it on the
command line. </P><P>You invoke WeiDU by typing <TT>WeiDU</TT> and then any number of options and
files, as described below. </P><P>Note: since it may not be obvious, if an option accepts &#X2019;X&#X2019; and says to be
cumulative, if you want to apply it multiple times you have to use the following
hideousness:
</P><PRE CLASS="verbatim">weidu --string 1 --string 2 --string 3
</PRE><P>This does not apply to *-rest commands like --biff-get-rest and --force-install-rest.</P><P>Moreover, *-rest commands must be the last, EG
</P><PRE CLASS="verbatim">weidu --biff-get-rest sw1h01.itm --out foo
</PRE><P>will try to extract sw1h01.itm, --out and foo from the biffs; you have to express the above as
</P><PRE CLASS="verbatim">weidu --out foo --biff-get-rest sw1h01.itm
</PRE><P>*-list commands work like the -rest variants, except that they stop parsing for the current
switch once they find an option starting with &#X2019;-&#X2019;. Basically, this works like you&#X2019;d expect:
</P><PRE CLASS="verbatim">weidu --biff-get-list sw1h01.itm --out foo
</PRE><TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1><TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Compiling And Decompiling </FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>FILE.<A HREF="#D">D</A></TT></TD><TD VALIGN=top ALIGN=left>Compile <TT>FILE</TT> to a <TT><A HREF="#DLG">DLG</A></TT> (dialogue file).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>FILE.<A HREF="#DLG">DLG</A></TT></TD><TD VALIGN=top ALIGN=left>Decompile <TT>FILE</TT> to a <TT><A HREF="#D">D</A></TT> (dialogue text file).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>number</TT></TD><TD VALIGN=top ALIGN=left>When decompiling a <TT><A HREF="#DLG">DLG</A></TT> file to a <TT><A HREF="#D">D</A></TT>
file, emit only state <TT>number</TT>. You may specify this multiple times and
only the states you specify will be emitted.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>numberA-numberB</TT></TD><TD VALIGN=top ALIGN=left>When decompiling a <TT><A HREF="#DLG">DLG</A></TT> file to a
<TT><A HREF="#D">D</A></TT> file, emit only states between <TT>numberA</TT> and <TT>numberB</TT>
(inclusive). You may specify this multiple times and only the states you
specify will be emitted.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>FILE.<A HREF="#BAF">BAF</A></TT></TD><TD VALIGN=top ALIGN=left>Compile <TT>FILE</TT> to a <TT><A HREF="#BCS">BCS</A></TT> (script file).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>FILE.<A HREF="#BCS">BCS</A></TT></TD><TD VALIGN=top ALIGN=left>Decompile <TT>FILE</TT> to a <TT><A HREF="#BAF">BAF</A></TT> (script text file).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--script-style</TT></B><A NAME="--script-style"></A><A NAME="@default65"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Use the given <TT><A HREF="#BAF">BAF</A></TT>/<TT><A HREF="#BCS">BCS</A></TT>
scripting style. <TT>X</TT> must be <TT>BG</TT> or <TT>BG1</TT> or <TT>BG2</TT> or <TT>PST</TT> or <TT>IWD</TT> or <TT>IWD1</TT>
or <TT>IWD2</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--transin</TT></B><A NAME="--transin"></A><A NAME="@default66"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Use <TT>FILE</TT> as a source of translation strings
when processing <TT><A HREF="#D">D</A></TT> and <TT><A HREF="#BAF">BAF</A></TT> files.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>FILE.<A HREF="#TRA">TRA</A></TT></TD><TD VALIGN=top ALIGN=left>Equivalent to <TT><A HREF="#--transin">--transin</A></TT> <TT>FILE.TRA</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Module Packaging Input And Control</FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>FILE.<A HREF="#TP">TP</A></TT> or
<TT>FILE.<A HREF="#TP2">TP2</A></TT></TD><TD VALIGN=top ALIGN=left>Read <TT>FILE</TT> and ask the user whether to install,
reinstall or uninstall its <TT><A HREF="#TP2">TP2</A></TT> <TT><A HREF="#Component">Component</A></TT>s.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--yes</TT></B><A NAME="--yes"></A><A NAME="@default67"></A></TD><TD VALIGN=top ALIGN=left>Answer all <TT><A HREF="#TP2">TP2</A></TT> questions with &#X2019;Yes&#X2019; and do not
prompt for a key to be pressed at the end of <TT><A HREF="#TP2">TP2</A></TT> processing.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--uninstall</TT></B><A NAME="--uninstall"></A><A NAME="@default68"></A> 	</TD><TD VALIGN=top ALIGN=left>Answer all <TT><A HREF="#TP2">TP2</A></TT> questions with &#X2019;Uninstall&#X2019;
and do not prompt for a key to be pressed at the end of <TT><A HREF="#TP2">TP2</A></TT>
processing.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--reinstall</TT></B><A NAME="--reinstall"></A><A NAME="@default69"></A> 	</TD><TD VALIGN=top ALIGN=left>Re-install all <TT><A HREF="#TP2">TP2</A></TT> components that are
already installed and do not prompt for a key to be pressed at the end of
<TT><A HREF="#TP2">TP2</A></TT> processing.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--language</TT></B><A NAME="--language"></A><A NAME="@default70"></A>m <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Sets the <TT><A HREF="#TP2">TP2</A></TT> <TT><A HREF="#Language">Language</A></TT> to the one
passed here. Has no effect if the value is bigger than the language count
(I.E. you&#X2019;ll get asked for the language, unless you gave --uninstall, --reinstall
or --force-uninstall).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--force-install</TT></B><A NAME="--force-install"></A><A NAME="@default71"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>installs component number X, skips the others (cumulative).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--force-uninstall</TT></B><A NAME="--force-uninstall"></A><A NAME="@default72"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>uninstalls component number X, skips the others (cumulative).
If there is no --force-install, you don&#X2019;t get asked for the language.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--force-install-rest</TT></B><A NAME="--force-install-rest"></A><A NAME="@default73"></A> <TT>X Y...</TT></TD><TD VALIGN=top ALIGN=left>installs component number X Y...,
skips the others (cumulative).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--force-uninstall-rest</TT></B><A NAME="--force-uninstall-rest"></A><A NAME="@default74"></A> <TT>X Y...</TT></TD><TD VALIGN=top ALIGN=left>uninstalls component number X Y...,
skips the others (cumulative).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--force-install-list</TT></B><A NAME="--force-install-list"></A><A NAME="@default75"></A> <TT>X Y...</TT></TD><TD VALIGN=top ALIGN=left>installs component number X Y...,
skips the others (cumulative).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--force-uninstall-list</TT></B><A NAME="--force-uninstall-list"></A><A NAME="@default76"></A> <TT>X Y...</TT></TD><TD VALIGN=top ALIGN=left>uninstalls component number X Y...,
skips the others (cumulative).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--quick-menu</TT></B><A NAME="--quick-menu"></A><A NAME="@default77"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>installs the <TT><A HREF="#QUICK_MENU">QUICK_MENU</A></TT> selection X. Can be combined with
--force-install and friends, but only if the latter components are defined in ALWAYS_ASK.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--skip-at-view</TT></B><A NAME="--skip-at-view"></A><A NAME="@default78"></A></TD><TD VALIGN=top ALIGN=left>AT_* &#XA0;VIEW this&#XA0; actions (and the extra chromosome versions like
&#XA0;NOTEPAD this&#XA0;) aren&#X2019;t processed, while still processing batch files and similia.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--safe-exit</TT></B><A NAME="--safe-exit"></A><A NAME="@default79"></A></TD><TD VALIGN=top ALIGN=left>Save weidu.log every time a component installation is begun.
This makes it impossible to uninstall components (don&#X2019;t ask), but allows the user to kill
the weidu process (E.G. closing the DOS console via the X button) without leaving the game in an
unrecoverably inconsistent state (you can [R]e or [U]ninstall the component and the game will be
consistent again). This might break with mods using overly complicated AT_* actions (basically
don&#X2019;t use this with Big Mods).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--save-components-name</TT></B><A NAME="--save-components-name"></A><A NAME="@default80"></A></TD><TD VALIGN=top ALIGN=left>Reprints weidu.log. Useful if you install with --quick-log.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--ask-every</TT></B><A NAME="--ask-every"></A><A NAME="@default81"></A></TD><TD VALIGN=top ALIGN=left>Behave as if <TT><A HREF="#ASK_EVERY_COMPONENT">ASK_EVERY_COMPONENT</A></TT> were
present for all <TT><A HREF="#TP2">TP2</A></TT> components.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--continue</TT></B><A NAME="--continue"></A><A NAME="@default82"></A></TD><TD VALIGN=top ALIGN=left>Continue <TT><A HREF="#TP2">TP2</A></TT> processing despite
<TT><A HREF="#TP2 Action">TP2 Action</A></TT> errors.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--args</TT></B><A NAME="--args"></A><A NAME="@default83"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>X will be stored in the tp2 variable <CODE>%argv[n]%</CODE>, where
n is 0 for the first argument, 1 for the second, etc. <P>If the installation is non-interactive, said variables will be loaded from the last interactive
session.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--args-rest</TT></B><A NAME="--args-rest"></A><A NAME="@default84"></A> <TT>X Y...</TT></TD><TD VALIGN=top ALIGN=left>X Y Z will be stored in the tp2 variables <CODE>%argv[n]%</CODE>,
where n is 0 for the first argument, 1 for the second, etc.<P>If the installation is non-interactive, said variables will be loaded from the last interactive
session.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--args-list</TT></B><A NAME="--args-list"></A><A NAME="@default85"></A> <TT>X Y...</TT></TD><TD VALIGN=top ALIGN=left>X Y Z will be stored in the tp2 variables <CODE>%argv[n]%</CODE>,
where n is 0 for the first argument, 1 for the second, etc.<P>If the installation is non-interactive, said variables will be loaded from the last interactive
session.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--debug-assign</TT></B><A NAME="--debug-assign"></A><A NAME="@default86"></A></TD><TD VALIGN=top ALIGN=left>Print out all values assigned to <TT><A HREF="#TP2">TP2</A></TT>
variables (even implicit ones created by <TT>WeiDU</TT>).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--debug-value</TT></B><A NAME="--debug-value"></A><A NAME="@default87"></A></TD><TD VALIGN=top ALIGN=left>Print out all <TT><A HREF="#value">value</A></TT>s encountered in
<TT><A HREF="#TP2">TP2</A></TT> processing and the results they evaluate to. Among other
things, this is useful for catching parenthesis errors in your
<TT><A HREF="#value">value</A></TT>s.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--modder</TT></B><A NAME="--modder"></A><A NAME="@default88"></A><TT> <FONT COLOR="red"> [ </FONT>X Y <FONT COLOR="red"> ]  list </FONT></TT></TD><TD VALIGN=top ALIGN=left>enables the 
<TT><A HREF="#MODDER">MODDER</A></TT> mode and sets the <TT><A HREF="#MODDER">MODDER</A></TT> option X to Y (cumulative,
-list synthax).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--clear-memory</TT></B><A NAME="--clear-memory"></A><A NAME="@default89"></A></TD><TD VALIGN=top ALIGN=left>calls <TT><A HREF="#CLEAR_MEMORY">CLEAR_MEMORY</A></TT> after every <TT><A HREF="#TP2">TP2</A></TT> action.</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Automatic Updating Options </FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--update-all</TT></B><A NAME="--update-all"></A><A NAME="@default90"></A></TD><TD VALIGN=top ALIGN=left>Auto-update all <TT>WeiDU</TT> setup files (e.g.,
<TT>Setup-MyMod.exe</TT>) in the current directory.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--noautoupdate</TT></B><A NAME="--noautoupdate"></A><A NAME="@default91"></A></TD><TD VALIGN=top ALIGN=left>If you are running <TT>WeiDU</TT> as
<TT>Setup-MyMod.exe</TT>, do not attempt to update yourself or any other mod.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--noselfupdatemsg</TT></B><A NAME="--noselfupdatemsg"></A><A NAME="@default92"></A></TD><TD VALIGN=top ALIGN=left>If you are running <TT>WeiDU</TT> as
<TT>Setup-MyMod.exe</TT> and it automatically updates itself, do not display a
message or ask the user to press return.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Infinity Engine Game Location Options </FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--game</TT></B><A NAME="--game"></A><A NAME="@default93"></A><TT> X	</TT></TD><TD VALIGN=top ALIGN=left>Set main game directory to <TT>X</TT>. WeiDU looks for
<TT>CHITIN.<A HREF="#KEY">KEY</A></TT> and <TT>DIALOG.<A HREF="#TLK">TLK</A></TT> and the <TT>override</TT>
directory in the main game directory (but see <TT><A HREF="#--tlkin">--tlkin</A></TT> and
<TT><A HREF="#--search">--search</A></TT>). WeiDU will look in the current directory and use the
registry to find your game. If this fails, you will need to run WeiDU using
the <TT><A HREF="#--game">--game</A></TT> switch to define the full path to the BG2 directory.
WeiDU will also search for BG1, IWD and PST.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--nogame</TT></B><A NAME="--nogame"></A><A NAME="@default94"></A></TD><TD VALIGN=top ALIGN=left>Do not
load any default game files. Unless you also specified <TT><A HREF="#--tlkin">--tlkin</A></TT>, no
<TT>DIALOG.TLK</TT> will be loaded. Unless you also specified <TT><A HREF="#--search">--search</A></TT>,
no <TT>override</TT> directory will be used.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>tt <B><TT>--game-by-type</TT></B><A NAME="--game-by-type"></A><A NAME="@default95"></A> X</TD><TD VALIGN=top ALIGN=left>tries to guess the game path by reading
the registry; X can be one of BG1, BG2, PST, IWD1 or IWD2.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--search</TT></B><A NAME="--search"></A><A NAME="@default96"></A> <TT>X</TT>	</TD><TD VALIGN=top ALIGN=left>Look in <TT>X</TT> for input files (cumulative).
<TT>X</TT> is treated as an <TT>override</TT> directory and is given priority over 
the default <TT>override</TT> directory.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Game Text (</FONT><TT><A HREF="#TLK"><FONT COLOR="red">TLK</FONT></A></TT><FONT COLOR="red">) File Input</FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--tlkin</TT></B><A NAME="--tlkin"></A><A NAME="@default97"></A> <TT>X</TT>	</TD><TD VALIGN=top ALIGN=left>Use <TT>X</TT> as <TT>DIALOG.<A HREF="#TLK">TLK</A></TT> (instead
of looking for <TT>DIALOG.TLK</TT> in the game directory).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--ftlkin</TT></B><A NAME="--ftlkin"></A><A NAME="@default98"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Use <TT>X</TT> as <TT>DIALOGF.<A HREF="#TLK">TLK</A></TT> (instead
of looking for <TT>DIALOGF.TLK</TT> in the game directory).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>FILE.<A HREF="#TLK">TLK</A></TT></TD><TD VALIGN=top ALIGN=left>Equivalent to <TT><A HREF="#--tlkin">--tlkin</A></TT> <TT>X</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--tlkmerge</TT></B><A NAME="--tlkmerge"></A><A NAME="@default99"></A> <TT>X</TT>	</TD><TD VALIGN=top ALIGN=left>Merge strings from <TT>X</TT> over the strings from any other loaded <TT>DIALOG.<A HREF="#TLK">TLK</A>.</TT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> General Output Options</FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--out</TT></B><A NAME="--out"></A><A NAME="@default100"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Emit most output files generated by command-line
options (e.g., <TT><A HREF="#D">D</A></TT>, <TT><A HREF="#DLG">DLG</A></TT>, kits, <TT><A HREF="#--biff-get">--biff-get</A></TT>,
<TT><A HREF="#BAF">BAF</A></TT>, <TT><A HREF="#BCS">BCS</A></TT>, <TT><A HREF="#--automate">--automate</A></TT>, <TT><A HREF="#--traify-tlk">--traify-tlk</A></TT>,
<TT><A HREF="#--extract-kits">--extract-kits</A></TT>, <TT><A HREF="#--list-biff">--list-biff</A></TT>, <TT><A HREF="#--cmp-from">--cmp-from</A></TT>,
<TT><A HREF="#--dcmp-from">--dcmp-from</A></TT>, etc.) to file <TT>X</TT>. If <TT>X</TT> is a directory,
certain commands (e.g., <TT><A HREF="#D">D</A></TT>, <TT><A HREF="#DLG">DLG</A></TT>, <TT><A HREF="#--biff-get">--biff-get</A></TT>, etc.)
will place their output there. Does not affect <TT><A HREF="#TP2">TP2</A></TT> processing.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--append</TT></B><A NAME="--append"></A><A NAME="@default101"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Like <TT><A HREF="#--out">--out</A></TT>, but if <TT>X</TT> is an existing
file then the result will be appended to it instead of overwriting it.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--backup</TT></B><A NAME="--backup"></A><A NAME="@default102"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Backup files to directory <TT>X</TT> before overwriting. Does not affect <TT><A HREF="#TP2">TP2</A></TT> processing.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--tlkout</TT></B><A NAME="--tlkout"></A><A NAME="@default103"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	If any strings were added to or changed in the loaded <TT>DIALOG.TLK</TT>, emit <TT>X</TT> as an updated version that reflects those changes. Many operations (e.g., compiling <TT>D</TT> files, <TT><A HREF="#--tlkmerge">--tlkmerge</A></TT>, <TT><A HREF="#STRING_SET">STRING_SET</A></TT>) can add to or modify <TT>DIALOG.TLK</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--ftlkout</TT></B><A NAME="--ftlkout"></A><A NAME="@default104"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>If any strings were added to or changed in the
loaded <TT>DIALOGF.TLK</TT>, emit <TT>X</TT> as an updated version that reflects
those changes.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Dialogue Text File (</FONT><TT><A HREF="#D"><FONT COLOR="red">D</FONT></A></TT><FONT COLOR="red">) Options</FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--noheader</TT></B><A NAME="--noheader"></A><A NAME="@default105"></A></TD><TD VALIGN=top ALIGN=left>	Do not emit <TT><A HREF="#D">D</A></TT> header comments.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--nofrom</TT></B><A NAME="--nofrom"></A><A NAME="@default106"></A></TD><TD VALIGN=top ALIGN=left>	Do not emit <TT><A HREF="#D">D</A></TT> <TT>// from:</TT> comments.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--full-from</TT></B><A NAME="--full-from"></A><A NAME="@default107"></A></TD><TD VALIGN=top ALIGN=left>Generate complete <TT>// from:</TT> comments with a
slower two-pass process.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--nocom</TT></B><A NAME="--nocom"></A><A NAME="@default108"></A></TD><TD VALIGN=top ALIGN=left>Do not emit ANY <TT><A HREF="#D">D</A></TT> or <TT><A HREF="#BAF">BAF</A></TT> comments.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--text</TT></B><A NAME="--text"></A><A NAME="@default109"></A></TD><TD VALIGN=top ALIGN=left>Emit string text with string references in comments.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--transitive</TT></B><A NAME="--transitive"></A><A NAME="@default110"></A></TD><TD VALIGN=top ALIGN=left>Follow <TT><A HREF="#EXTERN">EXTERN</A></TT> links when making <TT><A HREF="#D">D</A></TT>
files. See the tutorial on <TT><A HREF="#--transitive">--transitive</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--toplevel</TT></B><A NAME="--toplevel"></A><A NAME="@default111"></A></TD><TD VALIGN=top ALIGN=left>Emit only top-level dialogue states -- that is,
states with non-empty triggers.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Translation Options</FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--traify</TT></B><A NAME="--traify"></A><A NAME="@default112"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Convert <TT>X</TT> (which should be a <TT><A HREF="#D">D</A></TT> or <TT><A HREF="#TP2">TP2</A></TT> or <TT><A HREF="#BAF">BAF</A></TT>) so that it uses translation references instead of literal strings. Use <TT><A HREF="#--out">--out</A></TT> <TT>Y</TT> to specify a name for the transformed version of <TT>X</TT> and its new <TT><A HREF="#TRA">TRA</A></TT> file.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>--traify#</TT> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Use with <TT><A HREF="#--traify">--traify</A></TT> and <TT><A HREF="#--traify-tlk">--traify-tlk</A></TT>. Start the newly-created <TT><A HREF="#TRA">TRA</A></TT> file at translation string <TT>@X</TT> instead of <TT>@0</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--traify-old-tra</TT></B><A NAME="--traify-old-tra"></A><A NAME="@default113"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Assumes file X to contain strings already in .tra format.
Use this over <TT>--traify#</TT> for merging new strings in an already traified <TT><A HREF="#D">D</A></TT> or <TT><A HREF="#TP2">TP2</A></TT> or <TT><A HREF="#BAF">BAF</A></TT> file.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--untraify-d</TT></B><A NAME="--untraify-d"></A><A NAME="@default114"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>convert .D file X to use hardcoded strings...</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--untraify-tra</TT></B><A NAME="--untraify-tra"></A><A NAME="@default115"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>...from TRA file X. Please note that the outcoming file
could not work properly (if baf code embedded in a d file contains @ references, or if a string contains
the<CODE>~</CODE> character).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--trans</TT></B><A NAME="--trans"></A><A NAME="@default116"></A></TD><TD VALIGN=top ALIGN=left>Emit coupled <TT><A HREF="#D">D</A></TT> and <TT><A HREF="#TRA">TRA</A></TT> files when
decompiling a <TT><A HREF="#DLG">DLG</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--transref</TT></B><A NAME="--transref"></A><A NAME="@default117"></A></TD><TD VALIGN=top ALIGN=left>	Emit string reference numbers in <TT><A HREF="#TRA">TRA</A></TT> files
when using <TT><A HREF="#--trans">--trans</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--traify-tlk</TT></B><A NAME="--traify-tlk"></A><A NAME="@default118"></A></TD><TD VALIGN=top ALIGN=left>Emit a <TT><A HREF="#TRA">TRA</A></TT> file for the loaded <TT><A HREF="#TLK">TLK</A></TT> file (see <TT><A HREF="#--tlkin">--tlkin</A></TT>, <TT><A HREF="#--out">--out</A></TT>, <TT><A HREF="#--min">--min</A></TT> and <TT>--traify#</TT>).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--make-tlk</TT></B><A NAME="--make-tlk"></A><A NAME="@default119"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Create a <TT><A HREF="#TLK">TLK</A></TT> file from <TT><A HREF="#TRA">TRA</A></TT> file X (cumulative, see <TT><A HREF="#--tlkout">--tlkout</A></TT>).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--testtrans</TT></B><A NAME="--testtrans"></A><A NAME="@default120"></A></TD><TD VALIGN=top ALIGN=left>	Test all specified <TT><A HREF="#TRA">TRA</A></TT> translation files to
see if any of them use text that is already in the loaded
<TT><A HREF="#DIALOG.TLK">DIALOG.TLK</A></TT>. If they do you can save translation effort by using
string references instead.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--forceify</TT></B><A NAME="--forceify"></A><A NAME="@default121"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Convert the given <TT><A HREF="#D">D</A></TT> file to use forced
strrefs (see <TT><A HREF="#--out">--out</A></TT>, <TT><A HREF="#SAY">SAY</A></TT>, <TT><A HREF="#Forced String Reference">Forced String Reference</A></TT>).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Game Text Repository (</FONT><TT><A HREF="#TLK"><FONT COLOR="red">TLK</FONT></A></TT><FONT COLOR="red">) Options</FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--string</TT></B><A NAME="--string"></A><A NAME="@default122"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Display string reference <TT>#X</TT> (cumulative). If you also specify <TT><A HREF="#--min">--min</A></TT> or <TT><A HREF="#--max">--max</A></TT>, all string references between <TT><A HREF="#--min">--min</A></TT> (or 0) and <TT><A HREF="#--max">--max</A></TT> (or infinity) will be displayed.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--strfind</TT></B><A NAME="--strfind"></A><A NAME="@default123"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Display strings that contain <TT>X</TT> (cumulative, <TT><A HREF="#regexp">regexp</A></TT> allowed).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--strapp</TT></B><A NAME="--strapp"></A><A NAME="@default124"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Append string <TT>X</TT> to <TT>DIALOG.<A HREF="#TLK">TLK</A></TT> (cumulative).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Game Archive (</FONT><TT><A HREF="#BIFF"><FONT COLOR="red">BIFF</FONT></A></TT><FONT COLOR="red">) Options</FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--list-biffs</TT></B><A NAME="--list-biffs"></A><A NAME="@default125"></A></TD><TD VALIGN=top ALIGN=left>	Enumerate all <TT><A HREF="#BIFF">BIFF</A></TT> files in <TT>CHITIN.<A HREF="#KEY">KEY</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--list-files</TT></B><A NAME="--list-files"></A><A NAME="@default126"></A></TD><TD VALIGN=top ALIGN=left>	Enumerate all resource files in <TT>CHITIN.<A HREF="#KEY">KEY</A></TT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--biff</TT></B><A NAME="--biff"></A><A NAME="@default127"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Enumerate contents of <TT><A HREF="#BIFF">BIFF</A></TT> file <TT>X</TT> (cumulative).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--biff-get</TT></B><A NAME="--biff-get"></A><A NAME="@default128"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Extract resource <TT>X</TT> from game <TT><A HREF="#BIFF">BIFF</A></TT>s (cumulative, <TT><A HREF="#regexp">regexp</A></TT> allowed).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--biff-get-rest</TT></B><A NAME="--biff-get-rest"></A><A NAME="@default129"></A> <TT>X</TT> <TT>Y</TT> ...</TD><TD VALIGN=top ALIGN=left>Every argument given on the
command line after <TT><A HREF="#--biff-get-rest">--biff-get-rest</A></TT> is treated as if it were
preceded by <TT><A HREF="#--biff-get">--biff-get</A></TT>. Use this command to extract multiple
different files (or <TT><A HREF="#regexp">regexp</A></TT>s) at once.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--biff-get-list</TT></B><A NAME="--biff-get-list"></A><A NAME="@default130"></A> <TT>X</TT> <TT>Y</TT> ...</TD><TD VALIGN=top ALIGN=left>Every argument given on the
command line after <TT><A HREF="#--biff-get-rest">--biff-get-rest</A></TT> is treated as if it were
preceded by <TT><A HREF="#--biff-get">--biff-get</A></TT>, with the -list exception. Use this command to extract multiple
different files (or <TT><A HREF="#regexp">regexp</A></TT>s) at once.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--biff-str</TT></B><A NAME="--biff-str"></A><A NAME="@default131"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Search all game <TT><A HREF="#BIFF">BIFF</A></TT>s for files
containing <TT>X</TT> (<TT><A HREF="#regexp">regexp</A></TT> allowed).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--biff-value</TT></B><A NAME="--biff-value"></A><A NAME="@default132"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Search all game <TT><A HREF="#BIFFs">BIFFs</A></TT> for files
containing value <TT>X</TT> at offset <TT>ADDR</TT>. Must be used with
<TT><A HREF="#--biff-value-at">--biff-value-at</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--biff-value-at</TT></B><A NAME="--biff-value-at"></A><A NAME="@default133"></A> <TT>ADDR</TT></TD><TD VALIGN=top ALIGN=left>Gives the offset address for a
<TT><A HREF="#--biff-value">--biff-value</A></TT> search.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--biff-type</TT></B><A NAME="--biff-type"></A><A NAME="@default134"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Limit <TT><A HREF="#--biff-str">--biff-str</A></TT> or
<TT><A HREF="#--biff-value">--biff-value</A></TT> searches to
resources of type <TT>X</TT> (cumulative).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--biff-name</TT></B><A NAME="--biff-name"></A><A NAME="@default135"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	When a <TT><A HREF="#--biff-str">--biff-str</A></TT> or
<TT><A HREF="#--biff-value">--biff-value</A></TT> search finds a
matching file, assume it has a strref name at offset <TT>X</TT> and print that
name out as well.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--make-biff</TT></B><A NAME="--make-biff"></A><A NAME="@default136"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Create <TT>data/X.bif</TT> from all files in
folder <TT>X</TT> and destructively update <TT>CHITIN.KEY</TT>. <EM>Do not use this
feature. Use MAKE_BIFF instead.</EM></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--remove-biff</TT></B><A NAME="--remove-biff"></A><A NAME="@default137"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Remove references to <TT><A HREF="#BIFF">BIFF</A></TT> <TT>X</TT> and
all of its resources from <TT>CHITIN.KEY</TT>. <EM>Do not use this feature.</EM></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Comparison Options</FONT> (see <TT><A HREF="#--out">--out</A></TT>)</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--cmp-from</TT></B><A NAME="--cmp-from"></A><A NAME="@default138"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Emit <TT><A HREF="#WRITE_BYTE">WRITE_BYTE</A></TT>s to turn this file ...</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--cmp-to</TT></B><A NAME="--cmp-to"></A><A NAME="@default139"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	... into this one.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--dcmp-from</TT></B><A NAME="--dcmp-from"></A><A NAME="@default140"></A><TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Emit <TT><A HREF="#REPLACE">REPLACE</A></TT>s to turn this <TT><A HREF="#DLG">DLG</A></TT> file ...</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--dcmp-to</TT></B><A NAME="--dcmp-to"></A><A NAME="@default141"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	... into this one.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--tcmp-from</TT></B><A NAME="--tcmp-from"></A><A NAME="@default142"></A><TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Compare this <TT><A HREF="#TRA">TRA</A></TT> file (or directory of <TT><A HREF="#TRA ">TRA </A></TT>files)...</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--tcmp-to</TT></B><A NAME="--tcmp-to"></A><A NAME="@default143"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	... with this one (or this directory).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--tlkcmp-from</TT></B><A NAME="--tlkcmp-from"></A><A NAME="@default144"></A><TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Emit <TT><A HREF="#STRING_SET">STRING_SET</A></TT>s to convert this <TT><A HREF="#TLK">TLK</A></TT> file ...</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--tlkcmp-to</TT></B><A NAME="--tlkcmp-to"></A><A NAME="@default145"></A><TT>X</TT></TD><TD VALIGN=top ALIGN=left>	... into this one.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--tlkcmp-use-strings</TT></B><A NAME="--tlkcmp-use-strings"></A><A NAME="@default146"></A></TD><TD VALIGN=top ALIGN=left>When using <TT><A HREF="#--tlkcmp-from">--tlkcmp-from</A></TT>, emit
commands of the form <TT>STRING_SET "Hello" @1</TT> instead of <TT>STRING_SET #1
@1</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--bcmp-from</TT></B><A NAME="--bcmp-from"></A><A NAME="@default147"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Emit <TT><A HREF="#APPLY_BCS_PATCH">APPLY_BCS_PATCH</A></TT> to turn this
<TT><A HREF="#BCS">BCS</A></TT> file ...</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--bcmp-to</TT></B><A NAME="--bcmp-to"></A><A NAME="@default148"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>... into this one.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--bcmp-orig</TT></B><A NAME="--bcmp-orig"></A><A NAME="@default149"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Original file <TT>X</TT> to apply ...</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--bcmp-patch</TT></B><A NAME="--bcmp-patch"></A><A NAME="@default150"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>... this patch to.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Range Options</FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--min</TT></B><A NAME="--min"></A><A NAME="@default151"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Lower range for some commands. See
<TT><A HREF="#--traify-tlk">--traify-tlk</A></TT>, <TT><A HREF="#--tlkcmp-from">--tlkcmp-from</A></TT> and <TT><A HREF="#--string">--string</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--max</TT></B><A NAME="--max"></A><A NAME="@default152"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Upper range for some commands.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Automatic Module Packaging Options</FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--automate</TT></B><A NAME="--automate"></A><A NAME="@default153"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Automatically create a <TT><A HREF="#TP2">TP2</A></TT> file for resources in folder <TT>X</TT>. See <TT><A HREF="#--out">--out</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--automate-min</TT></B><A NAME="--automate-min"></A><A NAME="@default154"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Only <TT><A HREF="#--automate">--automate</A></TT> string references above <TT>X</TT>. If not specified, it is assumed as 62169 (that is, the number of strings in unmodded SoA).</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--extract-kits</TT></B><A NAME="--extract-kits"></A><A NAME="@default155"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>Extract all kits starting with kit #<TT>X</TT>
and create <TT><A HREF="#TP2">TP2</A></TT> actions to install those kits as part of a module.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Resource Exploration Options </FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--list-eff</TT></B><A NAME="--list-eff"></A><A NAME="@default156"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	List effects in resource <TT>X</TT>. See
<TT><A HREF="#--out">--out</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><TT>F.<A HREF="#ITM">ITM</A></TT> or 
<TT>F.<A HREF="#EFF">EFF</A></TT> or 
<TT>F.<A HREF="#SPL">SPL</A></TT></TD><TD VALIGN=top ALIGN=left>Equivalent to <TT><A HREF="#--list-eff">--list-eff</A></TT> <TT>F.EXT</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP>&nbsp;</TD></TR>
<TR><TD ALIGN=center NOWRAP COLSPAN=2> <FONT COLOR="red"> Logging Options </FONT></TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--log</TT></B><A NAME="--log"></A><A NAME="@default157"></A> <TT>X</TT></TD><TD VALIGN=top ALIGN=left>	Log output and details to <TT>X</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--autolog</TT></B><A NAME="--autolog"></A><A NAME="@default158"></A></TD><TD VALIGN=top ALIGN=left>	Log output and details to <TT>WSETUP.DEBUG</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=left NOWRAP><B><TT>--logapp</TT></B><A NAME="--logapp"></A><A NAME="@default159"></A></TD><TD VALIGN=top ALIGN=left>	Append to log file instead of overwriting it.</TD></TR>
</TABLE><P>Finally, note that WeiDU will <EM>not</EM> add duplicate strings to
<TT>DIALOG.<A HREF="#TLK">TLK</A></TT>. If you instruct WeiDU to make use of the string
&#X201C;Imoen&#X201D; (via <TT><A HREF="#SAY">SAY</A></TT> or <TT>--strapp</TT> or whatever) it will re-use any
existing definition of &#X201C;Imoen&#X201D; instead. Two strings are equivalent in
this sense only if they have the same text and the same associated sounds
(normally strings have no associated sounds).</P><!--TOC section Example Uses-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc6">6</A>&#XA0;&#XA0;Example Uses</H2><!--SEC END --><UL CLASS="itemize"><LI CLASS="li-itemize">Decompiling a <TT><A HREF="#DLG">DLG</A></TT> to a <TT><A HREF="#D">D</A></TT> <P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red">weidu bodhi.dlg</FONT> </TT>
</P><PRE CLASS="verbatim">  [C:\Program Files\Black Isle\BGII - SoA\chitin.key] 182 BIFFs, 41793 resources
  [C:\Program Files\Black Isle\BGII - SoA\DIALOG.TLK] 84458 string entries
  [C:\Program Files\Black Isle\BGII - SoA\data\Dialog.bif] 2729 file entries
  [BODHI.DLG] loaded
  [.\BODHI.D] created from [BODHI.DLG]
</PRE><P>This loads <TT>BODHI.<A HREF="#DLG">DLG</A></TT> from the standard search path (i.e., the
current directory, your override directory, then the game <TT><A HREF="#BIFF">BIFF</A></TT>s) and
creates <TT>BODHI.<A HREF="#D">D</A></TT> from it. </P></LI><LI CLASS="li-itemize">Decompiling a <TT><A HREF="#DLG">DLG</A></TT> file with translations<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red">weidu bodhi.dlg --trans</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  [.\BODHI.TRA] created as translation file
  [.\BODHI.D] created from [BODHI.DLG]
</PRE><P>This creates <TT>BODHI.<A HREF="#D">D</A></TT> as above and also the translation file
<TT>BODHI.<A HREF="#TRA">TRA</A></TT> (listing all of the strings in <TT>BODHI.<A HREF="#D">D</A></TT>
in an easy-to-translate or spell-check format). <TT>BODHI.<A HREF="#D">D</A></TT> will
be created with special references to those strings. </P><P>This is particularly useful if you are converting existing modifications
you may have created with another tool, such as IDU, into WeiDU format.
It allows you to both create the WeiDU <TT><A HREF="#D">D</A></TT> code and the
translation-friendly string labels at the same time.</P></LI><LI CLASS="li-itemize">Decompiling a <TT><A HREF="#DLG">DLG</A></TT> files with options<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --nofrom bodhi.dlg --out foozle.d --text</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  [.\foozle.d] created from [BODHI.DLG]
  </PRE><P>This creates <TT>foozle.d</TT> (instead of <TT>BODHI.D</TT>) and does not put any
<TT>"// from:"</TT> comments in <TT>foozle.d</TT>. It will include <TT><A HREF="#state">state</A></TT>s
with <TT><A HREF="#SAY">SAY</A></TT>s of the form 

<pre width="80"> <font color="#3159D1">SAY</font> <font color="#868626">~Hello~</font> <font color="#219121">/* #1 */</font> </pre>
instead of 

<pre width="80"> <font color="#3159D1">SAY</font> <font color="#0000FF">#1</font> <font color="#219121">/* ~Hello~ */</font> </pre>
</P></LI><LI CLASS="li-itemize">Decompiling multiple <TT><A HREF="#DLG">DLG</A></TT> files<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu bodhi.dlg jaheira.dlg --out test</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  [test\JAHEIRA.D] created from [JAHEIRA.DLG]
  [test\BODHI.D] created from [BODHI.DLG]
  </PRE><P>This loads <TT>BODHI.DLG</TT> and <TT>JAHEIRA.DLG</TT> and creates <TT>BODHI.D</TT> and
<TT>JAHEIRA.D</TT>. The optional
<TT>--out test</TT> argument instructs WeiDU to put the resulting <TT><A HREF="#D">D</A></TT>
files in the <TT>test</TT> directory. </P></LI><LI CLASS="li-itemize">Compiling a <TT><A HREF="#D">D</A></TT> file<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu bodhi.d</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  [bodhi.d] parsed
  [BODHI.DLG] saved       135 states, 259 trans, 16 strig, 66 ttrig, 54 actions
  </PRE><P>This loads and parses bodhi.d and then executed all instructions in it.
This <TT>bodhi.d</TT> file just defines <TT>BODHI.DLG</TT>, which is created. If
<TT>bodhi.d</TT> contains strings that do not occur in <TT>DIALOG.<A HREF="#TLK">TLK</A></TT>,
<TT>BODHI.DLG</TT> will be created with invalid string references. </P></LI><LI CLASS="li-itemize">Compiling a <TT><A HREF="#D">D</A></TT> file that includes new text<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu bodhi.d --tlkout new-DIALOG.</FONT><A HREF="#TLK"><FONT COLOR="red">TLK</FONT></A> </TT>
</P><PRE CLASS="verbatim">        ...
  [bodhi.d] parsed
  [BODHI.DLG] saved       135 states, 259 trans, 16 strig, 66 ttrig, 54 actions
  [new-DIALOG.TLK] created, 84459 string entries
  </PRE><P>This loads and parses <TT>bodhi.d</TT> and then executed all instructions in it.
This <TT>bodhi.d</TT> file just defines <TT>BODHI.DLG</TT>, which is created. If
there are any new strings a new version of <TT>DIALOG.<A HREF="#TLK">TLK</A></TT> is written to
<TT>new-DIALOG.<A HREF="#TLK">TLK</A></TT>.</P></LI><LI CLASS="li-itemize">Compiling multiple <TT><A HREF="#D">D</A></TT> files<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu ppworker.d bodhi.d --out test</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  [bodhi.d] parsed
  [ppworker.d] parsed
  [BODHI.DLG] saved       135 states, 259 trans, 16 strig, 66 ttrig, 54 actions
  [PPWORKER.DLG] saved    33 states, 81 trans, 4 strig, 12 ttrig, 10 actions
  </PRE><P>This creates <TT>test/BODHI.DLG</TT> and <TT>test/PPWORKER.DLG</TT> based on the
instructions in <TT>bodhi.d</TT> and <TT>ppworker.d</TT>. 
If these <TT><A HREF="#D">D</A></TT> files include new text, use <TT>--tlkout</TT> to make a new
<TT>DIALOG.<A HREF="#TLK">TLK</A></TT>. </P></LI><LI CLASS="li-itemize">Compiling a <TT><A HREF="#D">D</A></TT> file that defines many <TT><A HREF="#DLG">DLG</A></TT> files<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu examples/sola/solae1.d</FONT> </TT><BR>
OR<BR>
 <TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu examples\sola\solae1.d</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  [examples/sola/solae1.d] parsed
  [SOLA.DLG] loaded
  [SOLA.DLG] saved        336 states, 401 trans, 64 strig, 18 ttrig, 125 actions
  [SOLAE1.DLG] saved      36 states, 49 trans, 1 strig, 11 ttrig, 1 actions
  [SOLAE2.DLG] saved      3 states, 3 trans, 0 strig, 0 ttrig, 0 actions
  [SOLAE3.DLG] saved      2 states, 2 trans, 0 strig, 0 ttrig, 0 actions
  [SOLAE4.DLG] saved      3 states, 3 trans, 1 strig, 0 ttrig, 0 actions
  [SOLAE5.DLG] saved      2 states, 2 trans, 0 strig, 0 ttrig, 0 actions
  [SOLAE6.DLG] saved      4 states, 5 trans, 0 strig, 2 ttrig, 0 actions
  </PRE><P>It just so happens that <TT>solae1.d</TT> <TT><A HREF="#APPEND">APPEND</A></TT>s text to 
<TT>SOLA.DLG</TT> and
creates <TT>SOLAE1.DLG</TT>, <TT>SOLAE1.DLG</TT>, 
<TT>SOLAE3.DLG</TT>, ..., <TT>SOLAE6.DLG</TT>. You could
have put them all in the override directory with <TT>--out override</TT>. You
may use the forward slash (/) or the backslash (\) for
directories. Use <TT>--tlkout</TT> to make a new <TT>DIALOG.<A HREF="#TLK">TLK</A></TT> if these
contain new text. </P></LI><LI CLASS="li-itemize">Compiling a <TT><A HREF="#D">D</A></TT> file that uses a <TT><A HREF="#TRA">TRA</A></TT> file<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu examples/sola/solafoe.d --transin examples/sola/solafoe.tra</FONT> </TT><BR>
OR<BR>
 <TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu examples/sola/solafoe.d examples/sola/solafoe.tra</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  [examples/sola/solafoe.tra] parsed (15 translation strings)
  [examples/sola/solafoe.d] parsed
  [SOLA.DLG] loaded
  [SOLA.DLG] saved        336 states, 401 trans, 65 strig, 18 ttrig, 124 actions
  [SOLAFOE.DLG] saved     11 states, 14 trans, 1 strig, 2 ttrig, 1 actions
  </PRE><P>It happens that <TT>solafoe.d</TT> uses 15 strings from a translation file,
<TT><A HREF="#APPEND">APPEND</A></TT>s to <TT>SOLA.DLG</TT> and creates 
<TT>SOLAFOE.DLG</TT>. You may use <TT>--transin</TT> to
specify a translation file or (if it ends in <TT><A HREF="#TRA">TRA</A></TT>) just throw it
on the command line. If you include multiple <TT><A HREF="#TRA">TRA</A></TT> files, the last
one to define a particular string index wins for that string. They need
not all cover the same set. Use <TT>--tlkout</TT> if there is new text involved. </P></LI><LI CLASS="li-itemize">Displaying String References<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --string 123 --strfind understudy --strfind acid.*rows</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  [C:\Program Files\Black Isle\BGII - SoA\chitin.key] 182 BIFFs, 41793 resources
  [C:\Program Files\Black Isle\BGII - SoA\DIALOG.TLK] 84458 string entries
  String #123 is ~Haer' Dalis, all of you, stop them!~
  String #6763 is ~Acid Arrows~
  String #11662 is ~Biff The Understudy~
        ...
        </PRE><P>This displays string #123 and all strings that contain the string
"understudy" and all strings that match the regular expression
(<TT><A HREF="#regexp">regexp</A></TT>) "acid.*rows". Note that case does not matter. </P></LI><LI CLASS="li-itemize">Updating <TT>DIALOG.<A HREF="#TLK">TLK</A></TT> Manually<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --strapp ANewString --tlkout happy.tlk</FONT> </TT>
</P><PRE CLASS="verbatim">  [C:\Program Files\Black Isle\BGII - SoA\DIALOG.TLK] 84458 string entries
  [.\happy.tlk] created, 84459 string entries
  </PRE><P>Not much to say here. String reference #84459 in <TT>happy.tlk</TT> is now
&#X201C;<TT>ANewString</TT>&#X201D;. </P></LI><LI CLASS="li-itemize">Listing <TT><A HREF="#BIFF">BIFF</A></TT> Contents<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --biff data.bif</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  [data\Dialog.bif] contains    ABELA.DLG at index 0
  [data\Dialog.bif] contains    ACHEN.DLG at index 1
        ...
        </PRE><P>This shows all of the resources (e.g., <TT>ACHEN.DLG</TT> is a resource) that
are contained in <TT>data.bif</TT>.</P></LI><LI CLASS="li-itemize">Extracting <TT><A HREF="#BIFF">BIFF</A></TT> Contents<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --biff-get dragred.cre </FONT> </TT>
</P><PRE CLASS="verbatim">  [C:\Program Files\Black Isle\BGII - SoA\chitin.key] 182 BIFFs, 41793 resources
  [C:\Program Files\Black Isle\BGII - SoA\DIALOG.TLK] 84458 string entries
  [C:\Program Files\Black Isle\BGII - SoA\data\Creature.bif] 3194 file entries
  [.\dragred.cre] 1776 bytes, created from [C:\Program Files\Black Isle\BGII - SoA\data\Creature.bif]
  </PRE><P>This grabs Firkraag&#X2019;s dragon-form <TT><A HREF="#CRE">CRE</A></TT> creature file from the game
<TT><A HREF="#BIFF">BIFF</A></TT>s and saves it in the current directory.</P></LI><LI CLASS="li-itemize">Extracting <TT><A HREF="#BIFF">BIFF</A></TT> Contents with Regular Expressions<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red">weidu --biff-get sper.*itm</FONT> </TT>
</P><PRE CLASS="verbatim">  [.\chitin.key] loaded, 590551 bytes
  [.\chitin.key] 182 BIFFs, 41793 resources
  [.\DIALOG.TLK] loaded, 10154904 bytes
  [.\DIALOG.TLK] 77666 string entries
  [.\data\Items.bif] loaded, 659688 bytes
  [.\data\Items.bif] 1990 file entries
  [.\SPER01.ITM] 266 bytes, created from [.\data\Items.bif]
  [.\SPER02.ITM] 314 bytes, created from [.\data\Items.bif]
  [.\SPER03.ITM] 362 bytes, created from [.\data\Items.bif]
  [.\SPER04.ITM] 322 bytes, created from [.\data\Items.bif]
  [.\SPER05.ITM] 266 bytes, created from [.\data\Items.bif]
  [.\SPER06.ITM] 266 bytes, created from [.\data\Items.bif]
  [.\SPER07.ITM] 554 bytes, created from [.\data\Items.bif]
  [.\SPER08.ITM] 314 bytes, created from [.\data\Items.bif]
  [.\SPER09.ITM] 314 bytes, created from [.\data\Items.bif]
  [.\SPER10.ITM] 362 bytes, created from [.\data\Items.bif]
  [.\data\25Items.bif] loaded, 222370 bytes
  [.\data\25Items.bif] 479 file entries
  [.\SPER11.ITM] 314 bytes, created from [.\data\25Items.bif]
  [.\SPER12.ITM] 1610 bytes, created from [.\data\25Items.bif]
  [.\SPERMEL.ITM] 890 bytes, created from [.\data\25Items.bif]
  </PRE><P>This one assumes that the game is in the current directory and asks for
every spear item in the game. Note that <TT>--biff-get</TT> uses regular
expressions (<TT><A HREF="#regexp">regexp</A></TT>), not DOS-style wildcards. Note also that
<TT>--biff-get</TT> does not look in the override directory. Finally, if
you are using a Mac (or otherwise running unix) you&#X2019;ll want to put the
regular expression in double quotes, like so: 
<TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red">weidu --biff-get "sper.*itm"</FONT> </TT></P></LI><LI CLASS="li-itemize">Searching <TT><A HREF="#BIFF">BIFF</A></TT> Contents<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --biff-type CRE --biff-str SPWI911</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  LICH01.CRE in [data\Creature.bif] matches
  HLKANG.CRE in [data\Creature.bif] matches
        ...
        </PRE><P>This finds all <TT><A HREF="#CRE">CRE</A></TT> files that contain the string "SPWI911", which is
equivalent to finding all enemy mages that know the spell Meteor Swarm
(which has resource name "SPWI911"). You could also try something like:</P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --biff-type BCS --biff-str Terminsel</FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  AR0300.BCS in [data\Scripts.bif] matches
  AR0308.BCS in [data\Scripts.bif] matches
  JAHEIRA.BCS in [data\Scripts.bif] matches
        ...
        </PRE><P>to find all of the game scripts that include a variable that includes the
substring "Terminsel". As you would expect, Jaheira shows up. Note that
these searches are moderately time-consuming (e.g., searching all scripts
takes about 20 seconds). </P></LI><LI CLASS="li-itemize">Converting one <TT><A HREF="#TLK">TLK</A></TT> file to another<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --tlkcmp-from DIALOG.TLK --tlkcmp-to dialog-asc.tlk </FONT> </TT>
</P><PRE CLASS="verbatim">    ...
  [DIALOG.TLK] loaded, 8692747 bytes
  [DIALOG.TLK] 74107 string entries
  [dialog-asc.tlk] loaded, 10211578 bytes
  [dialog-asc.tlk] 82805 string entries
  WARNING: DIALOG.TLK has 74107 entries, dialog-asc.tlk has 82805 entries
          STRING_SET 70866 ~Babau~ []
          STRING_SET 70867 ~Babau~ []
          </PRE><P>This compares all strings in common between two <TT>DIALOG.<A HREF="#TLK">TLK</A></TT> files and
generates a list of <TT><A HREF="#STRING_SET">STRING_SET</A></TT> <TT><A HREF="#TP2">TP2</A></TT> entries to convert the
<TT><A HREF="#TLK">TLK</A></TT> file named in <TT>--tlkcomp-from</TT> into the <TT><A HREF="#TLK">TLK</A></TT> file named in
<TT>--tlkcomp-to</TT>. In this case, WeiDU indicates there are two differences in
the strings shared between a standard ToB <TT><A HREF="#TLK">TLK</A></TT> file and an Ascension
Classic <TT><A HREF="#TLK">TLK</A></TT> file: strings 70866 and 70867 were changed to "Babau".
Also note that the Ascension Classic <TT><A HREF="#TLK">TLK</A></TT> file has more entries (82805
compared to 74107). </P><P>If you have made a large number of manual changes to a <TT><A HREF="#TLK">TLK</A></TT> file
(such as grammar/spelling corrections, or other dialogue tweaks), this is a
handy way to generate install-ready scripting to apply those changes to an
end user&#X2019;s version of BG2.</P><P>Note that the use of <TT>--out</TT> will be helpful for a long list. </P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --tlkcmp-from DIALOG.TLK --tlkcmp-to dialog-asc.tlk --out mylist.txt </FONT> </TT></P><P>This will make a new <TT>file mylist.txt</TT> file that contains the
<TT><A HREF="#STRING_SET">STRING_SET</A></TT> parts of the output, which can then be put into a
<TT><A HREF="#TP2">TP2</A></TT> file. </P></LI><LI CLASS="li-itemize">Automating File Descriptions<P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red">weidu --automate MyMod/SomeFolder --append MyMod.tp2</FONT> </TT></P><P>WeiDU&#X2019;s <TT>--automate</TT> feature can save you oodles of time, so you probably
will want to learn how to use it. It&#X2019;s rather simple when you get the hang
of it (but everything is right?).</P><P>Suppose you have just created some items, some spells and some creatures
and some areas for you mod and you want to distribute them to others using
WeiDU. You could manually write out string patching code by hand for each
resource. Or you can get WeiDU to do it automatically. </P><P>WeiDU will scan every item, spell and creature inside the given folder (in
this example, the folder is <TT>MyMod/SomeFolder</TT>) and emit <TT><A HREF="#TP2">TP2</A></TT>
commands to <TT><A HREF="#COPY">COPY</A></TT> those resources from that folder into the
<TT>override</TT> folder. In addition, each resource&#X2019;s current strings (like
item descriptions and monster names) will be loaded from your <TT><A HREF="#TLK">TLK</A></TT>
file and used to patch that resource as it is copied. </P><P>For example, the output of <TT>--automate</TT> on a folder that contains a
potion of extra healing looks like this:</P><PRE CLASS="verbatim">COPY ~MyMod/SomeFolder/potn52.itm~  ~override/potn52.itm~         
  SAY NAME ~Potion~ 
  SAY NAME2 ~Potion of Extra Healing~ 
  SAY UNIDENTIFIED_DESC ~Potions are typically found in ceramic, crystal, glass,
    or metal flasks or vials.  Flasks or other containers generally contain 
    enough fluid to provide one person with one complete dose to achieve the 
    effects of the potion.~ 
  SAY DESC ~When wholly consumed, this potion restores 27 hit points to the 
    person. The effect is instantaneous and the potion is destroyed in the 
    process.~ 
  SAY 0xde ~Gulp!~ [GULP] 
</PRE><P>And there you have it, apparently there is a substitute for hard work.</P></LI><LI CLASS="li-itemize">Converting Between <TT><A HREF="#TLK">TLK</A></TT> and <TT><A HREF="#TRA">TRA</A></TT> Files<P>Some translators who are using WeiDU to translate non-WeiDU mods find it
handy to be able to convert between <TT><A HREF="#TLK">TLK</A></TT> and <TT><A HREF="#TRA">TRA</A></TT> files. </P><P>First, let&#X2019;s create a <TT><A HREF="#TRA">TRA</A></TT> file: </P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --traify-tlk --min 2000 --max 2002 </FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  @2000  = ~Indeed! It's been quite tasty so far. Listen, we're not here to
  devour everything. In fact, we'd like to help a little girl named
  Jaella.~
  @2001  = ~No, we haven't. We will devour you if you don't tell us what we
  need to know.~
  @2002  = ~Let us stop this charade. I'm only here to ask you a few
  questions.~
        ...
        </PRE><P>You may also extract only those strings matching a <TT><A HREF="#regexp">regexp</A></TT>: </P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --traify-tlk --strfind lawyer </FONT> </TT>
</P><PRE CLASS="verbatim">        ...
  @36568 = ~Honor-bound and honor-branded, then, is it?  Very well, lawyer,
  you have set me free and for that I thank you.~
        ...
  </PRE><P>Finally, you may redirect the output to a file using <TT>--out</TT> and
read from a different <TT><A HREF="#TLK">TLK</A></TT> file by adding it on the command line.</P><P>Once you have a <TT><A HREF="#TRA">TRA</A></TT> file with a few entries you can create a
<TT><A HREF="#TLK">TLK</A></TT> file from it: </P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --make-tlk my.tra --tlkout new.tlk </FONT> </TT>
</P><PRE CLASS="verbatim">  [c:\src\weidu\weidu.exe] WeiDU version 109
  [C:\Program Files\Black Isle\BGII - SoA/chitin.key] 182 BIFFs, 41793
  resources
  [C:\Program Files\Black Isle\BGII - SoA/dialog.tlk] 82405 string entries
  [my.tra] parsed
  [my.tra] has 100 translation strings
  New TLK will have 200 entries
  [new.tlk] created, 200 string entries
  </PRE><P>String <TT>@1</TT> in your <TT><A HREF="#TRA">TRA</A></TT> file will become string reference <TT>#1</TT> in the <TT><A HREF="#TLK">TLK</A></TT> file. If your <TT><A HREF="#TRA">TRA</A></TT> file has &#X201C;holes&#X201D; the new
<TT><A HREF="#TLK">TLK</A></TT> file will have blank entries. You may specify <TT>--make-tlk</TT>
multiple times: the last <TT><A HREF="#TRA">TRA</A></TT> file to define a translation string
determine that string reference. </P></LI><LI CLASS="li-itemize">Creating a <TT><A HREF="#BIFF">BIFF</A></TT> File<P>This tutorial was thoughtfully provided by Japheth. </P><P>Using <B><TT>--make-biff</TT></B><A NAME="@default160"></A> is dead easy. Here&#X2019;s a quick and dirty example:</P><P>Assuming WeiDU is in your BGII directory, grab a bunch of files from your
override folder and stick them into a folder inside your BGII directory.
We&#X2019;ll call the folder <TT>mybiff</TT> for this example.</P><P>Once the files are inside the folder, this is all you would have to do to
make WeiDU create a biff of the files:</P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --make-biff mybiff </FONT> </TT> 
</P><PRE CLASS="verbatim">  [c:\src\weidu\weidu.exe] WeiDU version 122
  [./chitin.key] 182 BIFFs, 41793 resources
  [./dialog.tlk] 82479 string entries
  [data\mybiff.bif] will contain 20 resources totalling 211096 bytes
  [data\mybiff.bif] incorporating [mybiff/udsola02.cre]
          ...
  [data\mybiff.bif] incorporating [mybiff/sola10.cre]
  KEY saved (183 biffs, 41813 resources)
  </PRE><P>WeiDU will add the files into the <TT><A HREF="#BIFF">BIFF</A></TT> <TT>mybiff.bif</TT> and stick
that file in your <TT>data</TT> directory. It will also update the 
<TT>CHITIN.<A HREF="#KEY">KEY</A></TT>.</P><P>Before using this feature, make sure you backup your
<TT>CHITIN.<A HREF="#KEY">KEY</A></TT>.</P></LI><LI CLASS="li-itemize">Removing a <TT><A HREF="#BIFF">BIFF</A></TT> File<P>You can use <B><TT>--remove-biff</TT></B><A NAME="@default161"></A> to remove a <TT><A HREF="#BIFF">BIFF</A></TT> file from
<TT>CHITIN.<A HREF="#KEY">KEY</A></TT> and destructively replace it with a new, smaller
<TT>CHITIN.<A HREF="#KEY">KEY</A></TT>. 
Before using this feature, make sure you backup your
<TT>CHITIN.<A HREF="#KEY">KEY</A></TT>.
Do not use this feature. Use MAKE_BIFF instead.</P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --make-biff mybiff data\25ArMisc.bif </FONT> </TT> 
</P><PRE CLASS="verbatim">  [c:\src\weidu\weidu.exe] WeiDU version 157
  [./chitin.key] 182 BIFFs, 41793 resources
  [./dialog.tlk] 83772 string entries
  Removing references to 16 resources in [data\25ArMisc.bif]
  KEY saved (181 biffs, 41777 resources)
  </PRE><P>Note that the specified <TT><A HREF="#BIFF">BIFF</A></TT> is not deleted from your computer&#X2019;s
file system, it is merely removed from <TT>CHITIN.<A HREF="#KEY">KEY</A></TT>. When
specifying the <TT><A HREF="#BIFF">BIFF</A></TT> case does not matter but the folder separator,
usually &#X201C;\&#X201D; or &#X201C;<TT>:</TT>&#X201D;, does. Use <TT>--list-biffs</TT> to get
the official list of possible <TT><A HREF="#BIFF">BIFF</A></TT>s to remove. Do not use this
feature. </P></LI><LI CLASS="li-itemize">Viewing Banter Offline with <B><TT>--transitive</TT></B><A NAME="@default162"></A><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --nocom --text --transitive banomen.dlg </FONT> </TT></P><P>The <TT>--transitive</TT> flag tells WeiDU to follow <TT><A HREF="#EXTERN">EXTERN</A></TT>
references when emitting <TT><A HREF="#D">D</A></TT> files. So the resulting <TT>BANOMEN.D</TT>
file has lines like this:</P><PRE CLASS="verbatim">IF WEIGHT #31 ~InParty("Edwin")
See("Edwin")
Gender("Edwin",FEMALE)
!StateCheck("Edwin",STATE_SLEEPING)
Global("BAnomen1","LOCALS",0)~ THEN BEGIN 10
  SAY ~Hey, Edwina!  I shall be your champion at the next tournament that
  we come to if only you give me a piece of your robe, uh, that is, dress
  to adorn my shield.~ [ANOMEN49] 
  IF ~~ THEN DO ~SetGlobal("BAnomen1","LOCALS",1)~ EXTERN ~BEDWIN~ 104
END

IF ~~ THEN BEGIN BEDWIN 104
  SAY ~(My condition draws fools like flies to honey).  Silence, you idiot!
  You've a death wish that is larger than your swollen head.~ [EDWINW39]
  IF ~~ THEN GOTO 11
END

IF ~~ THEN BEGIN 11
  SAY ~Fair Edwina, I am truly bereft by your non-acceptance.  It is tragic
  when a knight has no fair maiden to moon over.  Heh he he...~
  IF ~~ THEN EXIT
END
</PRE><P>Note that both lines from both Edwin and Anomen are presented. The
resulting &#X201C;D&#X201D; file is not valid in that it cannot be fed back to WeiDU
directly, but it should make it easier for you to read all of the jokes
offline. </P><P>Note that WeiDU may well go into an infinite loop when you use
<TT>--transitive</TT>. Sorry about that. </P></LI></UL><!--TOC section WeiDU Tutorials-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc7">7</A>&#XA0;&#XA0;WeiDU Tutorials</H2><!--SEC END --><P>This section includes tutorials on specific parts of WeiDU. Many of them
were contributed by users like you. </P><!--TOC subsection <TT>Multisay</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc8">7.1</A>&#XA0;&#XA0;<TT>Multisay</TT></H3><!--SEC END --><P>
<A NAME="Multisay"></A>
This tutorial was thoughtfully provided by Jason Compton. </P><P>Although a single <TT><A HREF="#SAY">SAY</A></TT> line can be of any length, for style purposes
(particularly in BG2) it is considered good form to break up very large
lines into smaller chunks.</P><P>One can easily create a series of simple <TT><A HREF="#SAY">SAY</A></TT> blocks, one doing
<TT><A HREF="#GOTO">GOTO</A></TT> to the next, but if there are no special conditions being
checked or actions being taken, you can very easily string several lines
together.</P><P>Let&#X2019;s say you have a scenery NPC teaching a lesson about the Bill of Rights
to the US Constitution.

<pre width="80"><font color="#3159D1">BEGIN</font> TEACHER

<font color="#3159D1">IF <font color="#868626">~NumTimesTalkedTo(0)~</font> THEN BEGIN</font> constitution_1
  <font color="#3159D1">SAY <font color="#868626">~On September 25, 1789, the First Congress of the United States
    therefore proposed to the state legislatures 12 amendments to the
    Constitution that met arguments most frequently advanced against it. The
    first two proposed amendments, which concerned the number of constituents
    for each Representative and the compensation of Congressmen, were not
    ratified. Articles 3 to 12, however, ratified by three- fourths of the
    state legislatures, constitute the first 10 amendments of the
    Constitution, known as the Bill of Rights.~</font>
  IF <font color="#868626">~~</font> THEN EXIT
END</font> </pre>
This is a perfectly valid block of dialogue, but it is extremely long, and
would likely scroll out of the text window for players with lower
resolution.</P><P>Rather than break each sentence up into a new explicit <TT><A HREF="#state">state</A></TT>, we
can use <TT><A HREF="#Multisay">Multisay</A></TT> and save a lot of typing. <TT><A HREF="#Multisay">Multisay</A></TT> is
invoked with the <TT>=</TT> (equals) sign, which tells WeiDU that, "the current
speaker should say another line here."</P><P>Here&#X2019;s how that <TT><A HREF="#D">D</A></TT> <TT><A HREF="#state">state</A></TT> would look with <TT><A HREF="#Multisay">Multisay</A></TT>:

<pre width="80"><font color="#3159D1">IF <font color="#868626">~NumTimesTalkedTo(0)~</font> THEN BEGIN</font> constitution_1
  <font color="#3159D1">SAY</font> <font color="#868626">~On September 25, 1789, the First Congress of the United States
  therefore proposed to the state legislatures 12 amendments to the
  Constitution that met arguments most frequently advanced against it.~</font>
      =
  <font color="#868626">~The first two proposed amendments, which concerned the number of
  constituents for each Representative and the compensation of Congressmen,
  were not ratified.~</font>
      =
  <font color="#868626">~Articles 3 to 12, however, ratified by three-fourths of the state
  legislatures, constitute the first 10 amendments of the Constitution,
  known as the Bill of Rights.~
  <font color="#3159D1">IF</font> ~~</font> <font color="#3159D1">THEN</font> <font color="#3159D1">EXIT</font>
<font color="#3159D1">END</font>
</pre>
This will create three dialogue <TT><A HREF="#state">state</A></TT>s, separated by simple "click
to continue" transitions.</P><P>And that&#X2019;s <TT><A HREF="#Multisay">Multisay</A></TT> in a nutshell. Note that (as always with WeiDU)
the line break and spacing before and after the <TT>=</TT> are totally optional,
and used here only for illustration. 

<pre width="80"><font color="#3159D1">SAY</font> <font color="#868626">~One~</font> = <font color="#868626">~Two~</font> = <font color="#868626">~Three~</font> </pre>
is perfectly valid as well.</P><P>You may <TT><A HREF="#Multisay">Multisay</A></TT> inside almost any <TT><A HREF="#state">state</A></TT>, so you may use it
within an <TT><A HREF="#APPEND">APPEND</A></TT> <TT><A HREF="#D Action">D Action</A></TT>. This is valid:

<pre><font color="#3159D1">APPEND</font> J#KLSYJ
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> Renal1_1
    <font color="#3159D1">SAY</font> <font color="#868626">~All right, CHARNAME. I can accept that... you are right, there
    are bigger issues to consider.~</font> 
      = 
    <font color="#868626">~But I hope you do understand why I said something, why it would be
    upsetting to have someone so close to me, in a role like that.~
    <font color="#3159D1">IF</font> ~~</font> <font color="#3159D1">THEN</font> <font color="#3159D1">EXIT</font>
  <font color="#3159D1">END</font>                            <font color="#219121">// end of state Renal1_1
<font color="#3159D1">END</font>                             // end of APPEND J#KLSYJ
</font></pre>
However, you <EM>cannot</EM> use Multisay inside <TT><A HREF="#REPLACE">REPLACE</A></TT>, because the
nature of <TT><A HREF="#REPLACE">REPLACE</A></TT> is to change (that is, replace) a <EM>single</EM>
<TT><A HREF="#state">state</A></TT>, while <TT><A HREF="#Multisay">Multisay</A></TT>&#X2019;s nature is to create 
multiple <TT><A HREF="#state">state</A></TT>s. </P><!--TOC subsection <TT>CHAIN</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc9">7.2</A>&#XA0;&#XA0;<TT><A HREF="#CHAIN">CHAIN</A></TT></H3><!--SEC END --><P>
This tutorial was thoughtfully provided by Jason Compton. </P><P><TT><A HREF="#CHAIN">CHAIN</A></TT> is an extension of the Multisay concept, simply with multiple
participants. If you have two NPCs bantering back and forth for a prolonged
period of time, and you do not need to do any special condition checks or
actions as they babble, it can get very tedious to set up a separate
<TT>IF</TT>/<TT>THEN</TT>/<TT>BEGIN</TT>/<TT><A HREF="#SAY">SAY</A></TT> block for each line.</P><P>Imagine a conversation like this:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Kelsey: Imoen, what do you like on your pizza?
</LI><LI CLASS="li-itemize">Imoen: Oregano.
</LI><LI CLASS="li-itemize">Imoen: Oh, and maybe with a little basil mixed in.
</LI><LI CLASS="li-itemize">Kelsey: Well, yeah, but anything else?
</LI><LI CLASS="li-itemize">Imoen: Sauce is good.
</LI><LI CLASS="li-itemize">Kelsey: (laughs) You&#X2019;re not being very helpful, Imoen.
</LI><LI CLASS="li-itemize">Imoen: Crust. I like crust on my pizza. Cooked crust is better.
</LI><LI CLASS="li-itemize">Kelsey: Do you want me to make you this pizza or not?
</LI><LI CLASS="li-itemize">Kelsey: It WAS your idea.
</LI><LI CLASS="li-itemize">Imoen: I can&#X2019;t decide. Never mind, I&#X2019;m just gonna have yogurt.
</LI><LI CLASS="li-itemize">Kelsey: (sigh)
</LI></UL><P>If you wanted to add this witty little banter to your game, you could do it
with 11 <TT><A HREF="#APPEND">APPEND</A></TT> blocks for each line, or save a little time doubling
up the back-to-back Imoen and Kelsey lines with <TT><A HREF="#Multisay">Multisay</A></TT> inside
their <TT><A HREF="#APPEND">APPEND</A></TT>s, so you&#X2019;d only need 9. In fact, you could get away
with 2 <TT><A HREF="#APPEND">APPEND</A></TT> blocks (remember that the states don&#X2019;t have to appear
in the order they are spoken, so you could mention all of Kelsey&#X2019;s lines
first and then all of Immy&#X2019;s as long as the labels thread up the
conversation correctly), one with 5 <TT><A HREF="#state">state</A></TT> declarations and one 4. But
there&#X2019;s an <EM>even better</EM> way, and that&#X2019;s to use <TT><A HREF="#CHAIN">CHAIN</A></TT>. It works
very much like <TT><A HREF="#Multisay">Multisay</A></TT>. You use <TT>=</TT> to indicate that the current
speaker should speak again, and <TT>==</TT> (that&#X2019;s two consecutive equal signs)
to indicate that a new speaker should take over.</P><P>Note that as of WeiDU 82, <TT><A HREF="#CHAIN">CHAIN</A></TT> can now define <TT><A HREF="#state">state</A></TT> triggers,
perform <TT><A HREF="#DO">DO</A></TT> actions, and end with an <TT><A HREF="#EXIT">EXIT</A></TT> or
<TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT>. This means that for most simple NPC/NPC banters, where
the PC does not have an opportunity to speak, you no longer need to use
anything else. </P><P>Watch and see how this dialogue works using a <TT><A HREF="#CHAIN">CHAIN</A></TT>.

<pre width="80"><font color="#3159D1">CHAIN
  IF <font color="#868626">~Global("KelseyImoenPizza","LOCALS",0)
      InParty("Imoen2")
      See("Imoen2")
      !StateCheck("Imoen2",STATE_SLEEPING)~</font> THEN</font> BJKLSY pizzachain
  <font color="#868626">~Imoen, what do you like on your pizza?~
<font color="#3159D1">DO</font> ~SetGlobal("KelseyImoenPizza","LOCALS",1)~</font>
  == IMOEN2J
  <font color="#868626">~Oregano.~</font>
  =
  <font color="#868626">~Oh, and maybe with a little basil mixed in.~</font>
  == BJKLSY
  <font color="#868626">~Well, yeah, but anything else?~</font>
  == IMOEN2J
  <font color="#868626">~Sauce is good.~</font>
  == BJKLSY
  <font color="#868626">~(laughs) You're not being very helpful, Imoen.~</font>
  == IMOEN2J
  <font color="#868626">~Crust. I like crust on my pizza. Cooked crust is better.~</font>
  == BJKLSY
  <font color="#868626">~Do you want me to make you this pizza or not?~</font>
  =
  <font color="#868626">~It WAS your idea.~</font>
  == IMOEN2J
  <font color="#868626">~I can't decide. Never mind, I'm just gonna have yogurt.~</font>
  == BJKLSY
  <font color="#868626">~(sigh)~</font>
<font color="#3159D1">EXIT</font> </pre>
Note how this dialogue works.</P><P>We use the <TT><A HREF="#CHAIN">CHAIN</A></TT> statement to define the state trigger (the
starting conditions that must be true) and assign it to BJKLSY.DLG. The
"pizzachain" label is mostly just for internal reference. Kelsey delivers
the first line, then we use <TT>==</TT> <TT>IMOEN2J</TT> to allow her to answer,
"Oregano." Then, we can use the single = to indicate that the current
speaker (Imoen) has two consecutive lines.</P><P>Then it&#X2019;s Kelsey&#X2019;s turn to speak, so we use <TT>== BJKLSY</TT> to tell WeiDU to
tell WeiDU to switch to the <EM>other</EM> speaker (which is Kelsey, since we
specified <TT>BJKLSY</TT>. They banter back and forth for a while, and then
when it is Kelsey&#X2019;s turn to have back-to-back lines <TT>Do you want me to
make you this pizza or not?</TT> and <TT>It WAS your idea.</TT>, we separate with a
single <TT>=</TT> to indicate that the current speaker (Kelsey) has two
consecutive lines.</P><P>After Kelsey&#X2019;s final, exasperated sigh, we use the <TT><A HREF="#EXIT">EXIT</A></TT> command to
terminate the <TT><A HREF="#CHAIN">CHAIN</A></TT>, and exit the dialogue.</P><P>And that&#X2019;s all you need to know to use <TT><A HREF="#CHAIN">CHAIN</A></TT>. It saves a <EM>tremendous</EM> amount of time over setting up individual <TT><A HREF="#APPEND">APPEND</A></TT>
blocks, even <TT><A HREF="#Multisay">Multisay</A></TT> blocks, for each NPC.</P><P>Advanced <TT><A HREF="#CHAIN">CHAIN</A></TT>ing:</P><P>You may include <TT><A HREF="#DO">DO</A></TT> actions and conditionals inside
<TT><A HREF="#chainText">chainText</A></TT>, as in: 

<pre width="80"><font color="#3159D1">CHAIN
  IF <font color="#868626">~Global("KelseyImoenPizza","LOCALS",0)
      InParty("Imoen2")
      See("Imoen2")
      !StateCheck("Imoen2",STATE_SLEEPING)~</font> THEN</font> BJKLSY pizzachain
  <font color="#868626">~Imoen, what do you like on your pizza?~
<font color="#3159D1">DO</font> ~SetGlobal("KelseyImoenPizza","LOCALS",1)~</font>
  == IMOEN2J
    <font color="#868626">~Oregano.~</font>
    =
    <font color="#868626">~Oh, and maybe with a little basil mixed in.~</font>

  == BJKLSY
    <font color="#868626">~Well, yeah, but anything else?~</font>

  == IMOEN2J
    <font color="#868626">~Sauce is good.~</font>

    == BJKLSY   <font color="#3159D1">IF <font color="#868626">~PartyHasItem("pepperoni")~</font> THEN</font>
      <font color="#868626">~Look, we HAVE pepperoni. Why don't I just use that? I'll eat it,
      anyway. If you don't like it, have yogurt instead.~</font>

    == IMOEN2J  <font color="#3159D1">IF <font color="#868626">~!PartyHasItem("pepperoni")~</font> THEN</font>
      <font color="#868626">~Crust. I like crust on my pizza. Cooked crust is better.~</font>
    == BJKLSY <font color="#3159D1">IF <font color="#868626">~!PartyHasItem("pepperoni")~</font> THEN</font>
      <font color="#868626">~Do you want me to make you this pizza or not?~</font>
      =
      <font color="#868626">~It WAS your idea.~</font>

    == IMOEN2J  <font color="#3159D1">IF <font color="#868626">~!PartyHasItem("pepperoni")~</font> THEN</font>
      <font color="#868626">~I can't decide. Never mind, I'm just gonna have yogurt.~</font>
    == BJKLSY <font color="#3159D1">IF <font color="#868626">~!PartyHasItem("pepperoni")~</font> THEN
      <font color="#868626">~(sigh)~</font>
EXIT</font></pre>
In this case, the dialogue changes if the party has the pepperoni item. If
it does, Kelsey says the <TT>we HAVE pepperoni</TT> and then <TT>(sigh)</TT> and then
the dialogue ends. If not, the dialogue works as before. The
<TT><A HREF="#chainText">chainText</A></TT> lines with <TT>IF</TT>s in them are only spoken if their
conditionals are true. </P><!--TOC subsection <TT>COPY_TRANS</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc10">7.3</A>&#XA0;&#XA0;<TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT></H3><!--SEC END --><P>This tutorial was thoughtfully provided by Jason Compton. </P><P>There are some complex branching dialogues in Infinity Engine games that
you, as a mod creator, may wish to add to. Consider Baldur&#X2019;s Gate 2 and the
"Arrival In Hell" dialogue. There is a brief internal dialogue as the
protagonist comes to terms with the fact that he/she is now in Hell, and
then all of the companions coded by Bioware have a chance to speak.
(<TT>PLAYER1.DLG</TT> state 25. It will help the rest of this explanation if you
go use WeiDU to decompile <TT>PLAYER1.DLG</TT> into <TT>PLAYER1.d</TT>, and/or open
up <TT>PLAYER1.DLG</TT> in Near Infinity and look at state 25.)</P><P>After the PC&#X2019;s internal voice says <TT>You doubt they will be pleased with
their present circumstance, when you don&#X2019;t even know why you are here
yourself.</TT>, every Bioware NPC has the opportunity to speak. If you are
creating a new NPC and want it to have that full, rich Bioware flavor, you
may wish to let your character speak here as well. For that, a simple
<TT><A HREF="#EXTEND_BOTTOM">EXTEND_BOTTOM</A></TT> will do the job.</P><P>Here&#X2019;s the example of how Weimer does this with Solaufein:

<pre width="80"><font color="#3159D1">EXTEND_BOTTOM</font> PLAYER1 <font color="#0000FF">25</font>
  <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialogue("Sola")
      Global("SolaWelcomeHell","GLOBAL",0)~</font> THEN
    DO <font color="#868626">~SetGlobal("SolaWelcomeHell","GLOBAL",1)~</font> EXTERN</font> SOLA inHell1
<font color="#3159D1">END</font></pre>
This puts a new transition at the bottom of <TT>PLAYER1 25</TT> that tells the
game to branch to Solaufein&#X2019;s observation about your arrival in Hell, if he
is present (<TT>IsValid</TT>) and if we have not already seen his comment once
before (the check for <TT>SolaWelcomeHell</TT>=0, then setting it to 1. This
ensures that this path can only happen once, which is important for a
reason I will explain later.) <TT>SOLA inHell1</TT>, which we will define later,
contains Solaufein&#X2019;s comment.</P><P>Once Solaufein makes his comment, it would be very thoughtful of us to
allow the other Bioware NPCs to have their say as well, as Bioware intended
and as the experienced players out there expect. You <EM>could</EM> simply use the
decompiled <TT>PLAYER1.D</TT> and copy and paste the transition list out. But
there are some good reasons not to do that. On a trivial level, it&#X2019;s a big
waste of space in your <TT><A HREF="#D">D</A></TT> file.</P><P>The most important reason is this: If <EM>another</EM> mod NPC has come along
and done their <EM>own</EM> <TT><A HREF="#EXTEND_BOTTOM">EXTEND_BOTTOM</A></TT>, you would have no way of
knowing that. By putting the Bioware stock transition list in, you would
ensure that <EM>only</EM> your mod NPC got to have their say. The rest would be
silent. So if you were the developer of Solaufein, and Solaufein were
installed after Kelsey and Tashia in a game, Kelsey and Tashia would be
skipped, because <EM>you</EM> only copied the Bioware transition list. That&#X2019;s a
heavy responsibility.</P><P>That&#X2019;s why <TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT> exists. <TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT> pulls the entire
transition list from a specified state and makes it the transition list for
<EM>your</EM> new state.</P><P>To illustrate, look at <TT>SOLA inHell1</TT> :

<pre><font color="#3159D1">APPEND</font> SOLA
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> inHell1
    <font color="#3159D1">SAY</font> @<font color="#0000FF">2</font> = @<font color="#0000FF">3</font>         <font color="#219121">// use strings @2 and @3 from translation file
</font>    <font color="#3159D1">COPY_TRANS</font> PLAYER1 <font color="#0000FF">25</font>
  <font color="#3159D1">END
END</font> </pre>
Instead of copying and pasting that huge list of <TT>IF "" THEN EXTERN</TT>
transitions from the <TT>PLAYER1.D</TT>, we let WeiDU do it for us.
<TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT> <TT>PLAYER1 25</TT> tells WeiDU to grab the current list of
<TT><A HREF="#transition">transition</A></TT>s from <TT>PLAYER1</TT> <TT><A HREF="#state">state</A></TT> 25, and use it as the
<TT><A HREF="#transition">transition</A></TT> list for <TT>SOLA inHell1</TT>. This ensures that Solaufein
will be able to properly branch out to Imoen, Aerie, Minsc, and the rest of
the gang, <EM>as well as</EM> grabbing the transitions that may have been
added by other NPCs such as Kelsey, Valen, or Tashia.</P><P><TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT> can form all of your new <TT><A HREF="#state">state</A></TT>&#X2019;s
<TT><A HREF="#transition">transition</A></TT> list, or only part of it. This would be valid, for
example:

<pre width="80"><font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> commentary
  <font color="#3159D1">SAY <font color="#868626">~Hey, I think I might like to run the transition list from TOLGER
    75... or I might want to do something else, if I'm in chapter six!~</font>
  COPY_TRANS</font> TOLGER <font color="#0000FF">75</font>
  <font color="#3159D1">IF <font color="#868626">~Global("Chapter","GLOBAL",6)~</font> THEN GOTO</font> chapter6commentary
<font color="#3159D1">END</font></pre>
This would make the <TT><A HREF="#GOTO">GOTO</A></TT> <TT>commentary2</TT> transition show up at the
bottom of the transition stack (below the list copied from <TT>TOLGER 75</TT>).
Remember that transition triggers are read <EM>bottom to top</EM>, so it would
be the first transition evaluated. If you want it to be evaluated <EM>after</EM> the list of transitions in the <TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT>, put it above.
Note, however, that Bioware usually structures its transition lists so that
the topmost trigger will always be true (in fact, sometimes it <EM>is</EM>
<TT>"True()"</TT>) so it is somewhat unlikely you would ever want to put a new
transition trigger <EM>above</EM> the <TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT>.</P><P>Now, that explanation for why the <TT>SolaWelcomeHell</TT> variable check is
important: if a user accidentally installs the same mod more than once, and
it employs <TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT>, the list the second time around will <EM>include</EM> our new trigger:

<pre><font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialogue("Sola")
      Global("SolaWelcomeHell","GLOBAL",0)~</font> THEN
    DO <font color="#868626">~SetGlobal("SolaWelcomeHell","GLOBAL",1)~</font> EXTERN</font> SOLA inHell1
</pre>
If there was no flag being set to ensure that the <TT><A HREF="#transition">transition</A></TT> could
only run once, the user would get stuck in a loop. This can and has
happened with mods in the wild. The end result would be Solaufein or Kelsey
or whomever constantly offering their commentary, over and over again.</P><P>Important note: The WeiDU <TT><A HREF="#D">D</A></TT> compiler runs <TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT> <EM>before</EM> other actions that you might take to affect a transition list
within the same <TT><A HREF="#D">D</A></TT> file (like <TT><A HREF="#EXTEND_TOP">EXTEND_TOP</A></TT> and
<TT><A HREF="#EXTEND_BOTTOM">EXTEND_BOTTOM</A></TT>). This is a good thing.</P><!--TOC subsection <TT>INTERJECT</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc11">7.4</A>&#XA0;&#XA0;<TT><A HREF="#INTERJECT">INTERJECT</A></TT></H3><!--SEC END --><P>
This tutorial was thoughtfully provided by Jason Compton. </P><P>Interjections, the little comments party members make, are a great way to
spice up a new NPC or a new quest you create. It shows that the characters
are paying attention to their game world, and that they have an opinion
about what goes on around them.</P><P>Through interjections, an NPC can advise a course of action, complain about
a decision, force your hand... fun things.</P><P>The traditional way to do an interjection is to find a state of a dialogue
where another NPC might comment, and use <TT><A HREF="#EXTEND_BOTTOM">EXTEND_BOTTOM</A></TT> and 
<TT><A HREF="#APPEND">APPEND</A></TT> in conjunction.</P><P>Here&#X2019;s an old-school example:

<pre width="80"><font color="#3159D1">EXTEND_BOTTOM</font> SAHPR4 <font color="#0000FF">7</font>
     <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialog("J#Kelsey")~</font> THEN EXTERN</font> J#KLSYJ KelseySAHPR4
<font color="#3159D1">END

APPEND</font> J#KLSYJ
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> KelseySAHPR4
    <font color="#3159D1">SAY <font color="#868626">~Urk. Who was the lucky donor?~</font>
    IF <font color="#868626">~~</font> THEN EXTERN</font> SAHPR2 <font color="#0000FF">10</font>
  <font color="#3159D1">END
END</font></pre>
This works, but it&#X2019;s also more work than it needs to be since the
introduction of <TT><A HREF="#INTERJECT">INTERJECT</A></TT>. (Incidentally, for you WeiDU historians out
there, there are two main reasons advanced functions have been added to
WeiDU since the first versions of Solaufein and the original <TT><A HREF="#CHAIN">CHAIN</A></TT>
command: Either Weimer needed them for his own modding goals, or a mod
project, usually Kelsey, requested it. <TT><A HREF="#INTERJECT">INTERJECT</A></TT> came about when
Westley finally decided that Solaufein and Valen should comment about
quests. On the other hand, <TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT> and 
<TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT> were my idea.)</P><P><TT><A HREF="#INTERJECT">INTERJECT</A></TT> simplifies this process considerably. To run an 
<TT><A HREF="#INTERJECT">INTERJECT</A></TT>, you
need to know the source state (the line after which you want one or more
NPCs to interject), and the destination state (where you want the dialogue
tree to go after the interjection.) Typically, but not necessarily, the
destination state will be wherever the dialogue was <EM>originally</EM>
planning to go, but if the NPC takes the conversation in a new direction,
that may change. We&#X2019;ll stick with the simpler cases for illustration.</P><P><TT><A HREF="#INTERJECT">INTERJECT</A></TT> is a specialized form of <TT><A HREF="#CHAIN">CHAIN</A></TT>.
So if you&#X2019;re familiar with <TT><A HREF="#CHAIN">CHAIN</A></TT>, this will look familiar.</P><P>Consider the dryads in the Irenicus start dungeon. Perhaps Minsc should say
something to them. <TT>IDRYAD1.DLG</TT> state 1 offers a good opportunity.

<pre><font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN <font color="#0000FF">1</font> <font color="#219121">// from:
</font>  SAY <font color="#0000FF">#11080</font> <font color="#219121">/* ~We are his possessions.~ */</font>
  IF <font color="#868626">~~</font> THEN EXTERN <font color="#868626">~IDRYAD2~</font> <font color="#0000FF">1</font>
END</font></pre>
Minsc is outraged. Here&#X2019;s how he can express it. The idea is that we want
Minsc to comment, but for the dialogue to continue just as it would have if
he was not there.

<pre><font color="#3159D1">INTERJECT</font> IDRYAD1 <font color="#0000FF">1</font> MinscDryad
  == MINSCJ <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialog("Minsc")~</font> THEN
    <font color="#868626">~Boo is outraged that the strange wizard would own these lovely ladies!
    Can Minsc and Boo help you nice girls?~</font>
END</font> IDRYAD2 <font color="#0000FF">1</font></pre>
Here&#X2019;s what&#X2019;s going on here.</P><P>Invoking <TT><A HREF="#INTERJECT">INTERJECT</A></TT> requires three arguments: the dialogue name and
state we&#X2019;re interjecting into, plus a unique global variable name. This
variable will be set from 0 to 1 after the <TT><A HREF="#INTERJECT">INTERJECT</A></TT> runs, to
ensure that it can only happen once. (This is important in case players
accidentally install your mod twice, as it could create a looping problem
similar to the one described in <TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT>.)</P><P>So <TT><A HREF="#INTERJECT">INTERJECT</A></TT> <TT>IDRYAD1 1 MinscDryad</TT> tells WeiDU "Put this
dialogue after <TT>IDRYAD1</TT> <TT><A HREF="#state">state</A></TT> <TT>1</TT>. This dialogue will run if
<TT>MinscDryad</TT> is 0. After it runs, we will set <TT>MinscDryad</TT> to 1."</P><P>Then we need to define who is speaking. == (that&#X2019;s two consecutive equal
signs) is <TT><A HREF="#CHAIN">CHAIN</A></TT>-style notation for a new speaker, and <TT>MINSCJ</TT> is
the proper dialogue to use for Minsc&#X2019;s "joined-party" commentary. If Minsc
is in the party and valid for dialogue, he will say his line. After that,
we transition to <TT>IDRYAD2</TT> state <TT>1</TT> (<TT>END IDRYAD2 1</TT>), which is
where the dialogue was heading in the first place. We can make this more
complicated and let the dryad reply to his interruption before proceeding.

<pre><font color="#3159D1">INTERJECT</font> IDRYAD1 <font color="#0000FF">1</font> MinscDryad
  == MINSCJ     <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialog("Minsc")~</font> THEN</font>
    <font color="#868626">~Boo is outraged that the strange wizard would own these lovely ladies!
    Can Minsc and Boo help you nice girls?~</font>
  == IDRYAD1    <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialog("Minsc")~</font> THEN
    <font color="#868626">~Large mortal, we are having a dramatic scene. Please do not
    interrupt.~</font>
END</font> IDRYAD2 <font color="#0000FF">1</font></pre>
Note that we repeat the 

<pre><font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialog("Minsc")~</font> THEN</font></pre>
check for <TT>IDRYAD1</TT>. That is to ensure that she only says that line if
Minsc is there, and by extension has already made his little comment. So
now, Minsc interrupts, Dryad #1 scolds him, and then we proceed to the
second dryad&#X2019;s line.</P><P>One general piece of advice: while it&#X2019;s not <EM>necessary</EM> to pick a state
that has only a single transition to another state, unless you&#X2019;re willing
to experiment (or you&#X2019;re intentionally trying to remove player choices from
the equation, by making the NPC say something that forces immediate action,
for instance), don&#X2019;t <TT><A HREF="#INTERJECT">INTERJECT</A></TT> into a state that has player options
(<TT><A HREF="#REPLY">REPLY</A></TT>s).</P><!--TOC subsection <TT><B>INTERJECT_COPY_TRANS</B></TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc12">7.5</A>&#XA0;&#XA0;<B><TT>INTERJECT_COPY_TRANS</TT></B><A NAME="INTERJECT_COPY_TRANS"></A><A NAME="@default163"></A></H3><!--SEC END --><P>
This tutorial was thoughtfully provided by Jason Compton. </P><P><TT><A HREF="#INTERJECT">INTERJECT</A></TT> is good for creating interjections where none already
exist. However, many of the really good opportunities for interjections in
game dialogue already <EM>have</EM> interjections in them. If you use standard
<TT><A HREF="#INTERJECT">INTERJECT</A></TT>, chances are you&#X2019;ll skip right over them.</P><P>Consider <TT>TOLGER.DLG</TT> <TT><A HREF="#state">state</A></TT> <TT>75</TT>. After Tolgerias lays down the
law by saying <TT>This is a sensitive matter, and I cannot tell all to every
curious soul. I must have your commitment that you agree to the task,</TT>
four NPCs (Edwin, Jaheira, Yoshimo, Korgan) will tell you what they think
of <EM>that</EM> rotten arrangement. What&#X2019;s more, Bioware structured the dialogue
transitions so that they <EM>all</EM> can get their comment in, if all four of
them are in the party.</P><P>However, using a standard <TT><A HREF="#INTERJECT">INTERJECT</A></TT> for a new NPC line would skip
over those four comments, which is rather impolite.
<TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT> works much like regular <TT><A HREF="#INTERJECT">INTERJECT</A></TT>, but
instead of defining a state to transition to after <TT>END</TT>, WeiDU will
<TT><A HREF="#COPY_TRANS">COPY_TRANS</A></TT> the transition list from the state you are
<TT><A HREF="#INTERJECT">INTERJECT</A></TT>ing into.</P><P>This is not as confusing as it sounds. Watch as hypothetical new NPC
Aqualung responds to Tolgerias&#X2019;s terms:

<pre width="80"><font color="#3159D1">INTERJECT_COPY_TRANS</font> TOLGER <font color="#0000FF">75</font> AquaTolger
  == AQUALUNJ   <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialogue("Aqualung")~</font> THEN</font>
    <font color="#868626">~Hey, that's a really crummy offer! Where did those little girls go? I
    could be sitting on a park bench, I don't need this aggravation! Who
    are you, anyway?~</font>
  == TOLGER     <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialogue("Aqualung")~</font> THEN
    <font color="#868626">~You poor old sod, you see it's only me. Now, did anyone else have a
    smart remark they wanted to make?~</font>
END</font></pre>
So, if Aqualung is around, we&#X2019;ll hear from him and then Tolgerias will
respond to him. <EM>After that</EM>, the game will look for the presence of
Edwin, Jaheira, Yoshimo, and Korgan and we&#X2019;ll get <EM>their</EM> responses to
Tolgerias as well.</P><P>Hint: <TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT> is fine to use even if there were no other
interjections in the source state, i.e. if there&#X2019;s just a single <TT>IF "" THEN
GOTO blah</TT>. That is, as long as you plan to proceed to the original
destination. It saves you the trouble of having to look up and input the
destination.</P><!--TOC subsection <TT><B>INTERJECT_COPY_TRANS2</B></TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc13">7.6</A>&#XA0;&#XA0;<B><TT>INTERJECT_COPY_TRANS2</TT></B><A NAME="INTERJECT_COPY_TRANS2"></A><A NAME="@default164"></A></H3><!--SEC END --><P>
This tutorial was thoughtfully provided by Rastor. </P><P>There seems to be a great deal of confusion among the members of the modding
community regarding the purpose and overall function of
<TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT>. Allow me to take a moment to dispel the rumors
that you may have heard.</P><P><TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT> is not intended as a replacement for
<TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT>. <TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT> is a great function
but it has a flaw in certain special cases. That&#X2019;s what
<TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT> is intended to remedy. This difference between
the two is best illustrated with an example.</P><P>Let us suppose that you want to add an NPC response to <TT>PPSAEM2</TT> 8. Here is
some of what that state looks like before any mods have been applied: </P><PRE CLASS="verbatim">IF ~~ THEN BEGIN 8 // from: 7.0
  SAY #44931 /* ~Blah blah blah~ */
  IF ~!IsValidForPartyDialog("Jaheira")
!IsValidForPartyDialog("Anomen")
!IsValidForPartyDialog("Edwin")
IsValidForPartyDialog("Viconia")~ THEN DO ~SetGlobal("WackoArmy","GLOBAL",1)
OpenDoor("DOOR12")
EscapeArea()~ UNSOLVED_JOURNAL #7045 EXTERN ~VICONIJ~ 129
END
</PRE><P>Note that the <TT><A HREF="#DO">DO</A></TT> actions include <TT>EscapeArea()</TT>. If you use
<TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT> to add an interjection here, the <TT><A HREF="#DO">DO</A></TT>
actions will be performed by your interjector (usually a party member). The
result is that after encountering this dialogue in the game the party member
will leave the area (and Saemon will stay where he is!) promptly after
performing the interjection. Instead, we want to keep the <TT><A HREF="#DO">DO</A></TT> action
associated with Saemon. </P><P><TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT> allows modders to remedy this problem.
<TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT> does exactly the same thing as
<TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT> except that DO actions will be kept with their
original actor and not transferred to the interjector. </P><P>To code your interjection using <TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT>, you would do
this:</P><PRE CLASS="verbatim">INTERJECT_COPY_TRANS2 PPSAEM2 8
  ~Blah blah blah~
END
</PRE><P>The dialogue state that WeiDU will create from this
<TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT> statement looks something like:</P><PRE CLASS="verbatim">IF ~~ THEN BEGIN 133 // from:
  SAY #78199 /* ~Blah blah blah~ */
  IF ~!IsValidForPartyDialog("Jaheira")
!IsValidForPartyDialog("Anomen")
!IsValidForPartyDialog("Edwin")
IsValidForPartyDialog("Viconia")~ THEN UNSOLVED_JOURNAL #7045 EXTERN ~VICONIJ~ 129
END
</PRE><P>Note that <TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT> is not intended as a universal
replacement for <TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT>. This is most obvious when using
the command to interject into a state that starts a cutscene. Here is an
example of an interjection into <TT>PPIRENI2</TT> 27.</P><P>The original, unmodded state:</P><PRE CLASS="verbatim">IF ~~ THEN BEGIN 27 // from: 28.0 26.0
  SAY #44869 /* ~I bid you farewell, child of Bhaal. We shall not meet again.~
[IRENIC52] */
  IF ~~ THEN DO ~EraseJournalEntry(7252)
EraseJournalEntry(7253)
EraseJournalEntry(22952)
EraseJournalEntry(23306)
SetGlobal("AsylumPlot","GLOBAL",40)
StartCutSceneMode()
StartCutScene("Cut41j")~ SOLVED_JOURNAL #7255 EXIT
END
</PRE><P>Using <TT><A HREF="#INTERJECT_COPY_TRANS2">INTERJECT_COPY_TRANS2</A></TT> to code your interjection into this state
will cause the game to crash when your interjection plays (because the special
<TT>StartCutSceneMode()</TT> action cannot occur in the middle of a dialogue,
loosely). <TT><A HREF="#INTERJECT_COPY_TRANS">INTERJECT_COPY_TRANS</A></TT> will work properly, however.</P><!--TOC subsection <TT>state WEIGHTs</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc14">7.7</A>&#XA0;&#XA0;<TT><A HREF="#state">state</A></TT> <TT><A HREF="#WEIGHT">WEIGHT</A></TT>s</H3><!--SEC END --><P><TT><A HREF="#stateTriggerString">stateTriggerString</A></TT>s, the conditions that determine what
<TT><A HREF="#state">state</A></TT> should be used for the beginning of a dialogue, may have
<TT><A HREF="#WEIGHT">WEIGHT</A></TT>s. These <TT><A HREF="#WEIGHT">WEIGHT</A></TT>s are used by the Infinity Engine to
choose which state to pick if multiple state triggers evaluate to "true". [
In reality, the <TT><A HREF="#WEIGHT">WEIGHT</A></TT>s are just the offsets within the state
trigger table in the <TT>DLG</TT> file, but this detail is not important unless
you are writing your own tool. ] <TT><A HREF="#WEIGHT">WEIGHT</A></TT>s only make sense for
<TT><A HREF="#stateTriggerString">stateTriggerString</A></TT>s that are not empty. </P><P>If multiple <TT><A HREF="#stateTriggerString">stateTriggerString</A></TT>s evaluate to true, the Infinity
Engine will pick the <TT><A HREF="#state">state</A></TT> with the <EM>lowest</EM> <TT><A HREF="#WEIGHT">WEIGHT</A></TT>.
Usually the weighting follows the order of state declaration in the
<TT><A HREF="#D">D</A></TT> file. That is, the first <TT><A HREF="#state">state</A></TT> mentioned has the lowest
weight (i.e., will be picked first in case of a tie) and the last state
mentioned has the highest weight (i.e., will be picked last in case of a
tie). However, you may include an explicit <TT><A HREF="#WEIGHT">WEIGHT</A></TT> directive to
change things around. For example, consider this <TT><A HREF="#D">D</A></TT> file:

<pre width="80"><font color="#3159D1">BEGIN</font> foozle
  <font color="#3159D1">IF <font color="#868626">~True()~</font> THEN BEGIN</font> a <font color="#3159D1">SAY <font color="#868626">~Jason~</font> END
  IF <font color="#868626">~True()~</font> THEN BEGIN</font> b <font color="#3159D1">SAY <font color="#868626">~yada~</font> END
  IF <font color="#868626">~True()~</font> THEN BEGIN</font> c <font color="#3159D1">SAY <font color="#868626">~Compton~</font> END
  IF <font color="#868626">~True()~</font> THEN BEGIN</font> d <font color="#3159D1">SAY <font color="#868626">~kelsey~</font> END</font></pre>
If you talk to <TT>foozle</TT>, it will always say <TT>Jason</TT>. However, you may
explicitly alter the weights so that the third state is picked first, as
in: 

<pre><font color="#3159D1">BEGIN</font> foozle
  <font color="#3159D1">IF WEIGHT <font color="#0000FF">#10</font> <font color="#868626">~True()~</font> THEN BEGIN</font> a <font color="#3159D1">SAY <font color="#868626">~Jason~</font> END
  IF            <font color="#868626">~True()~</font> THEN BEGIN</font> b <font color="#3159D1">SAY <font color="#868626">~yada~</font> END
  IF WEIGHT <font color="#0000FF">#2</font>  <font color="#868626">~True()~</font> THEN BEGIN</font> c <font color="#3159D1">SAY <font color="#868626">~Compton~</font> END
  IF            <font color="#868626">~True()~</font> THEN BEGIN</font> d <font color="#3159D1">SAY <font color="#868626">~kelsey~</font> END</font></pre>
With this <TT><A HREF="#D">D</A></TT> file, foozle will always say <TT>Compton</TT>. All
<TT><A HREF="#state">state</A></TT>s with <TT><A HREF="#WEIGHT">WEIGHT</A></TT> directives come before all states
without them. States without <TT><A HREF="#WEIGHT">WEIGHT</A></TT> directives are ranked in order
of appearance. So the state order for <TT>foozle.<A HREF="#DLG">DLG</A></TT> is <TT>c-a-b-d</TT>. Yes, this is
complicated. </P><P><EM>Strong Style Suggestion</EM>: do <EM>not</EM> use the <TT><A HREF="#WEIGHT">WEIGHT</A></TT>
directive in your hand-made <TT><A HREF="#D">D</A></TT> files. Just use the implicit ordering. </P><P>The <TT><A HREF="#WEIGHT">WEIGHT</A></TT> directive was introduced to facilitate handling of
Bioware-created <TT><A HREF="#DLG">DLG</A></TT> files (e.g., <TT>BJAHEIR.DLG</TT>) that include
tricky weighting. Only states with non-empty triggers are given implicit
weights. If you create a <TT><A HREF="#D">D</A></TT> file from a <TT><A HREF="#DLG">DLG</A></TT> that features
non-trivial weighting, WeiDU will emit comments like this: 

<pre><font color="#3159D1">IF WEIGHT <font color="#0000FF">#8</font> <font color="#219121">/* Triggers after states #: 11 12 24 25 26 36 58 even though
                they appear after this state */</font>
  <font color="#868626">~True()~</font> THEN BEGIN <font color="#0000FF">10</font> <font color="#219121">// from:
</font>    SAY <font color="#0000FF">#52190</font> <font color="#219121">/* ~Please do not interrupt our thoughts. We must prepare
      carefully if we are to see a weakness in the illithid web. ~ */</font>
    IF <font color="#868626">~~</font> THEN EXIT
END</font></pre>
to remind you that the order is not what you think. </P><P>All non-empty state triggers in <TT><A HREF="#DLG">DLG</A></TT> files are given weights
counting up from 0 to the maximum number of state triggers in the
<TT><A HREF="#DLG">DLG</A></TT> file. You may use any number you like (even a negative one):
WeiDU will simply sort them. <TT><A HREF="#ADD_STATE_TRIGGER">ADD_STATE_TRIGGER</A></TT>does not change the
weight associated with that trigger. <TT><A HREF="#APPEND">APPEND</A></TT> can be used to give a
non-trivial weight to a state, as in:

<pre><font color="#3159D1">APPEND</font> BJAHEIR
  <font color="#3159D1">IF WEIGHT <font color="#0000FF">#-999</font> <font color="#868626">~MyCondition()~</font> THEN BEGIN</font> mystate <font color="#3159D1">SAY <font color="#868626">~My Stuff~</font> END
END</font></pre>
Since <TT>BJAHEIR</TT> will have implicit <TT><A HREF="#WEIGHT">WEIGHT</A></TT>s in the range from #0 to
about #50, this causes <TT>mystate</TT> to have priority over all states that
already exist in <TT>BJAHEIR</TT>. Without such drastic action, 
<TT><A HREF="#APPEND">APPEND</A></TT>ed states will
have use the implicit ordering, and will thus have the lowest priority
(because they appear at the end of the file). <TT><A HREF="#Multisay">Multisay</A></TT> and 
<TT><A HREF="#CHAIN">CHAIN</A></TT> also
append states, but since they always append states with empty 
<TT><A HREF="#stateTriggerString">stateTriggerString</A></TT>s, <TT><A HREF="#WEIGHT">WEIGHT</A></TT>s are not relevant. </P><P>Consider the following example:

<pre><font color="#3159D1">BEGIN</font> foozle
  <font color="#3159D1">IF WEIGHT <font color="#0000FF">#10</font> <font color="#868626">~True()~</font> THEN BEGIN</font> a <font color="#3159D1">SAY <font color="#868626">~Jason~</font> END
  IF            <font color="#868626">~~</font> THEN BEGIN</font> b <font color="#3159D1">SAY <font color="#868626">~yada~</font> END
  IF WEIGHT <font color="#0000FF">#2</font>  <font color="#868626">~True()~</font> THEN BEGIN</font> c <font color="#3159D1">SAY <font color="#868626">~Compton~</font> END
  IF            <font color="#868626">~True()~</font> THEN BEGIN</font> d <font color="#3159D1">SAY <font color="#868626">~kelsey~</font> END
  ADD_STATE_TRIGGER</font> foozle <font color="#0000FF">1</font> <font color="#219121">/* state b */</font> <font color="#868626">~MyCondition()~</font></pre>
The resulting <TT>foozle</TT> dialogue will still have the <TT>c-a-b-d</TT> weighting
order. </P><P>Here&#X2019;s another example:

<pre><font color="#3159D1">BEGIN</font> foozle
  <font color="#3159D1">IF            <font color="#868626">~True()~</font> THEN BEGIN</font> a <font color="#3159D1">SAY <font color="#868626">~Jason~</font> END
  IF            <font color="#868626">~~</font> THEN BEGIN</font> b <font color="#3159D1">SAY <font color="#868626">~yada~</font> END
  IF            <font color="#868626">~True()~</font> THEN BEGIN</font> c <font color="#3159D1">SAY <font color="#868626">~Compton~</font> END
  IF            <font color="#868626">~True()~</font> THEN BEGIN</font> d <font color="#3159D1">SAY <font color="#868626">~kelsey~</font> END
  ADD_STATE_TRIGGER</font> foozle <font color="#0000FF">1</font> <font color="#219121">/* state b */</font> <font color="#868626">~MyCondition()~</font></pre>
The resulting <TT>foozle</TT> dialogue will have the (expected) <TT>a-b-c-d</TT>
ordering.</P><P><EM>However</EM>, consider this evil example: 

<pre>  <font color="#219121">//////
  // foozle.DLG contents, assume it has already been created and is
  // sitting on your hard drive somewhere
  // IF            ~True()~ THEN BEGIN a SAY ~Jason~ END
  // IF            ~~ THEN BEGIN b SAY ~yada~ END
  // IF            ~True()~ THEN BEGIN c SAY ~Compton~ END
  // IF            ~True()~ THEN BEGIN d SAY ~kelsey~ END
  //////

  // new D file
</font>  <font color="#3159D1">ADD_STATE_TRIGGER</font> foozle <font color="#0000FF">1</font> <font color="#219121">/* state b */</font> <font color="#868626">~MyCondition()~</font></pre>
This will update <TT>foozle</TT> and the resulting order will be <TT>a-c-d-b</TT>
(because when <TT>foozle.<A HREF="#DLG">DLG</A></TT> was loaded from the disk, <TT>a</TT> <TT>c</TT>
and <TT>d</TT> were given weights but <TT>b</TT> was not (because it had an empty
trigger)). Thus, you should avoid using <TT><A HREF="#ADD_STATE_TRIGGER">ADD_STATE_TRIGGER</A></TT> on
states with empty triggers unless you know what you are doing. </P><!--TOC subsection <TT><B>TRA</B></TT> Translation Files-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc15">7.8</A>&#XA0;&#XA0;<B><TT>TRA</TT></B><A NAME="TRA"></A><A NAME="@default165"></A> Translation Files</H3><!--SEC END --><P>If you are writing a mod and you would like to make it easier to translate
it into another language you can use "translation files" (much like BGII
itself uses <TT>DIALOG.<A HREF="#TLK">TLK</A></TT>) to separate your dialogue structure and content. A
translation file basically lists the string texts in order. For example,</P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red">WeiDU --trans SCSARLES.DLG</FONT> </TT></P><P>This creates <TT>scsarles</TT>.<TT><A HREF="#D">D</A></TT> and <TT>scsarles.tra</TT>.
<TT>scsarles.<A HREF="#D">D</A></TT> now contains:

<pre width="80"><font color="#3159D1">IF <font color="#868626">~NumTimesTalkedTo(0)~</font> THEN BEGIN <font color="#0000FF">0</font> <font color="#219121">// from:
</font>  SAY</font> @<font color="#0000FF">1</font> <font color="#219121">/* ~Who is it? Might I ask why you have disturbed my meditations?
    My creative muse must be gently awakened, and your stomping about is
    simply not conducive to this.~ [SARLES02] #28655 */</font>
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN REPLY</font> @<font color="#0000FF">2
    <font color="#219121">/* ~My apologies. I will leave you to your thinking.~ #28656 */</font> <font color="#3159D1">GOTO</font> 1</font>
  <font color="#3159D1">IF</font> <font color="#868626">~~</font> <font color="#3159D1">THEN</font> <font color="#3159D1">REPLY</font> @<font color="#0000FF">3 <font color="#219121">/* ~I apologize, but I have come to request your
  talent on a commissioned artwork.~ #28657 */</font>
    <font color="#3159D1">DO <font color="#868626">~SetGlobal("TalkedToSarles","GLOBAL",1)~</font> GOTO</font> 2</font>
<font color="#3159D1">END</font> </pre>
Note that all of the strings have been replaced by <TT>@number</TT> and the texts
have been put in comments. </P><P>The translation file <TT>scsarles.tra</TT> contains all of those strings: 

<pre><font color="#219121">// SCSARLES translation file
</font>@<font color="#0000FF">1</font>   = <font color="#868626">~Who is it? Might I ask why you have disturbed my meditations?
My creative muse must be gently awakened, and your stomping 
about is simply not conducive to this.~</font> [SARLES02]
@<font color="#0000FF">2</font>   = <font color="#868626">~My apologies. I will leave you to your thinking.~</font>
@<font color="#0000FF">3</font>   = <font color="#868626">~I apologize, but I have come to request your talent on a commissioned artwork.~</font> </pre>
You may then ask someone who speaks another language to write a new
translation file by translating every string in <TT>scsarles.tra</TT>. This
prevents the string text and the structure from getting out of sync
and simplifies translation; non-technical players can translate raw text
files easily. </P><P>When compiling a <TT><A HREF="#D">D</A></TT> file that contains <TT>@number</TT> translation
references you must supply (at least) one translation file. For example,
you might say:</P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red">WeiDU SCSARLES.D italian.tra</FONT> </TT></P><P>You may specify multiple translation files. The last one to define a string
wins. This is useful if one language is more up to date than the others. In
this example:</P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red">WeiDU SCSARLES.D english.tra italian.tra</FONT> </TT></P><P>Strings will be taken from the italian translation whenever possible, but
if they are not available it will fall back on the english versions.</P><P>You may use WeiDU to check and make sure that translations are up to date.
WeiDU will automatically generate a text file listing all of the strings
that are present in one translation (usually your native one) that are
missing in another. You can then send this file to your translators so that
they know what to do. This example command compares all of the <TT><A HREF="#TRA">TRA</A></TT>
files in the <TT>american</TT> and <TT>french</TT> directories and creates a file
called <TT>MISSING</TT>. </P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red">weidu --tcmp-from american --tcmp-to french --out MISSING</FONT> </TT></P><!--TOC subsection Converting a &#X201C;hard-coded&#X201D; <TT>D to a D/TRA pair (Last Update: v200)</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc16">7.9</A>&#XA0;&#XA0;Converting a &#X201C;hard-coded&#X201D; <TT><A HREF="#D">D</A></TT> to a <TT><A HREF="#D">D</A></TT>/<TT><A HREF="#TRA">TRA</A></TT> pair (Last Update: v200)</H3><!--SEC END --><P>This tutorial was thoughtfully provided by Jason Compton. </P><P><TT><A HREF="#D">D</A></TT> and <TT><A HREF="#TP2">TP2</A></TT> files allow programmers to describe text either
literally:

<pre width="80"><font color="#219121">// Greeting.d
</font><font color="#3159D1">SAY</font> <font color="#868626">~Hello.~</font>
</pre>
or with a companion <TT><A HREF="#TRA">TRA</A></TT> (translation) file that supports multiple
languages:

<pre width="80"><font color="#219121">// Greeting.d
</font><font color="#3159D1">SAY</font> @<font color="#0000FF">1</font>

<font color="#219121">// Greeting.tra
</font>@<font color="#0000FF">1</font> = <font color="#868626">~Hello.~</font>
</pre>
The idea being that one can make a French version of <TT>Greeting.tra</TT> which
contains

<pre width=80><font color="#219121">// French-Greeting.tra
</font>@<font color="#0000FF">1</font> = <font color="#868626">~Bonjour.~</font>
</pre>
However, some WeiDU users, for reasons of convenience or simply never
anticipating the opportunity to translate, may have originally chosen the
"hard-coded" approach but now regret that decision. <TT>--traify</TT> will break
out all the text in <TT><A HREF="#SAY">SAY</A></TT>, <TT><A HREF="#REPLY">REPLY</A></TT>, and <TT><A HREF="#JOURNAL">JOURNAL</A></TT> entries
into translation-ready format. <TT>--traify</TT> may also be used on <TT><A HREF="#TP2">TP2</A></TT>
files. </P><P>To turn the hard-coded <TT><A HREF="#D">D</A></TT> file <TT>FWKI.d</TT> into a new
<TT><A HREF="#D">D</A></TT>/<TT><A HREF="#TRA">TRA</A></TT> combo, use
<TT>--traify</TT> and <TT>--out</TT> to specify the input and output filenames,
respectively:</P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --traify fwki.d --out fwki-new.d</FONT> </TT></P><P>After a brief pause, <TT>fwki-new.d</TT> and <TT>fwki-new.tra</TT> will be created.</P><P>The <TT>--traify</TT> process turns <TT>fwki.d</TT>&#X2019;s

<pre width="80"><font color="#3159D1">APPEND</font> J#KLSYJ
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> KelseySAHPR4
    <font color="#3159D1">SAY <font color="#868626">~Urk. Who was the lucky donor?~</font>
    IF <font color="#868626">~~</font> THEN EXTERN</font> SAHPR2 <font color="#0000FF">10</font>
  <font color="#3159D1">END
END</font> </pre>
into <TT>fwki-new.d</TT>&#X2019;s

<pre width="80"><font color="#3159D1">APPEND</font> J#KLSYJ
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> KelseySAHPR4
    <font color="#3159D1">SAY</font> @<font color="#0000FF">0</font>
    <font color="#3159D1">IF <font color="#868626">~~</font> THEN EXTERN</font> SAHPR2 <font color="#0000FF">10</font>
  <font color="#3159D1">END
END</font> </pre>
and in the newly created <TT>fwki-new.tra</TT>, you will find

<pre>@<font color="#0000FF">0</font>    = <font color="#868626">~Urk. Who was the lucky donor?~</font></pre>
and this dialogue file is now ready for translation.</P><P><TT>--traify</TT> works from the top of the <TT><A HREF="#D">D</A></TT> down, starting at <TT>@0</TT>. It
will NOT skip over any existing <TT>@x</TT> translation references it finds, so if
your <TT><A HREF="#D">D</A></TT> contains any translation support at all, it is best to use <TT>--traify-old-tra</TT> as well.</P><P>Because standard <TT>--traify</TT> starts at <TT>@0</TT> and is unaware of any any existing
<TT>@x</TT> entries in the <TT><A HREF="#D">D</A></TT>, if you have begun to convert a <TT><A HREF="#D">D</A></TT> to a
<TT><A HREF="#D">D</A></TT>/<TT><A HREF="#TRA">TRA</A></TT> pair by hand, you may have <TT>@x</TT> entries that clash with
<TT>--traify</TT>&#X2019;s results.</P><P>In other words, if you already have a state that says

<pre width="80"><font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> blah
  <font color="#3159D1">SAY</font> @<font color="#0000FF">0</font>
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN EXIT
END</font></pre>
<TT>--traify</TT> will not skip <TT>@0</TT> automatically, you will have two locations where
<TT>@0</TT> is used but you intended to use two different strings, and this will be
bad.</P><P>To avoid this problem, add the <TT>--traify-old-tra</TT> argument to specify the file
containing the already traified strings:</P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --traify fwki.d --traify-old-tra fwki.tra --out fwki-new</FONT> </TT></P><P>will put the existing and new ones <TT>@x</TT> references in <TT>fwki-new.tra</TT>.</P><P>Finally, note that <TT>--traify</TT> works for <TT><A HREF="#BAF">BAF</A></TT> files as well.</P><P>Note: We were previously suggesting to use <TT>--traify#</TT> here. Unless you want
for some reason to have new references starting at a given number, you should
use <TT><A HREF="#--traify-old-tra">--traify-old-tra</A></TT> instead.</P><P>In all cases, you might also find it beneficial to put the
<TT><A HREF="#--traify-comment">--traify-comment</A></TT> argument in your command line, so that you&#X2019;ll also have
the content of the @references in your file (which will make it easier to edit it later):</P><P><TT>C:\Program Files\Black Isle\BGII - SoA\&gt;  <FONT COLOR="red"> weidu --traify fwki.d --traify-old-tra fwki.tra --out fwki-new --traify-comment</FONT> </TT></P><P>In particular, using <TT><A HREF="#--traify-comment">--traify-comment</A></TT> and <TT><A HREF="#--traify-old-tra">--traify-old-tra</A></TT> together
will add the missing comments without doubling the existing ones.</P><!--TOC subsection <TT>REPLACE_ACTION_TEXT</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc17">7.10</A>&#XA0;&#XA0;<TT><A HREF="#REPLACE_ACTION_TEXT">REPLACE_ACTION_TEXT</A></TT></H3><!--SEC END --><P> 
This tutorial was thoughtfully provided by Japheth. </P><P><TT><A HREF="#REPLACE_ACTION_TEXT">REPLACE_ACTION_TEXT</A></TT> can be used with regular expressions
(<TT><A HREF="#regexp">regexp</A></TT>). So, some actions such as
<TT>CreateCreature("blah",[0.0],1)</TT> won&#X2019;t be matched by WeiDU because when
you say <TT>[0.0]</TT> it is looking for a character set.</P><P>Here&#X2019;s one dialogue that I&#X2019;m fixing and how to do it correctly.</P><P><TT>Arghai.dlg</TT> has this action trigger before
<TT><A HREF="#REPLACE_ACTION_TEXT">REPLACE_ACTION_TEXT</A></TT>ing it.</P><PRE CLASS="verbatim">CreateCreature("OGREHA",[1351.1078])}
</PRE><P>There&#X2019;s no point given, which makes WeiDU and NI angry. To fix it using
<TT><A HREF="#REPLACE_ACTION_TEXT">REPLACE_ACTION_TEXT</A></TT> this is what you have to do:</P><PRE CLASS="verbatim">REPLACE_ACTION_TEXT arghai
~CreateCreature("OGREHA",\[1351.1078\])~
~CreateCreature("OGREHA",[1351.1078],0)~
</PRE><P>So, all you have to remember to do is escape the square brackets with a
backslash so WeiDU doesn&#X2019;t confuse them with a regular expression.</P><!--TOC subsection <TT><B>ALTER_TRANS</B></TT> (Last Update: 204.)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc18">7.11</A>&#XA0;&#XA0;<B><TT>ALTER_TRANS</TT></B><A NAME="ALTER_TRANS"></A><A NAME="@default166"></A> (Last Update: 204.)</H3><!--SEC END --><P>
This tutorial was thoughtfully provided by CamDawg.</P><P>ALTER_TRANS is a more compatibility-friendly way of changing transitions in an existing dialogue state. This is best illustrated with an example; let&#X2019;s use state 9 from doghma.dlg in BG2:</P><PRE CLASS="verbatim">IF ~~ THEN BEGIN 9 SAY #45751
  IF ~~ THEN REPLY #45752 GOTO 2
  IF ~GlobalLT("chapter","GLOBAL",4)~ THEN REPLY #45753 GOTO 5
  IF ~~ THEN REPLY #45754 GOTO 4
  IF ~Global("RevealUmar","GLOBAL",1)
      PartyHasItem("miscbl")
      PartyHasItem("miscbm")
      PartyHasItem("miscbn")
      PartyHasItem("miscbo")~ THEN REPLY #57922 GOTO 10
  IF ~~ THEN REPLY #45755 GOTO 1
END
</PRE><P>The problem lies in transition 3, which should have an OR(4) before those four PartyHasItem checks. Before ALTER_TRANS, the least destructive way to fix it would be</P><PRE CLASS="verbatim">ADD_TRANS_TRIGGER DOGHMA 9 ~False()~ DO 3
EXTEND_BOTTOM DOGHMA 9
IF ~Global("RevealUmar","GLOBAL",1)
OR(4)
PartyHasItem("miscbl")
PartyHasItem("miscbm")
PartyHasItem("miscbn")
PartyHasItem("miscbo")~ THEN REPLY #57922 GOTO 10
END
</PRE><P>This presents some compatibility issues though. If another mod has altered this transition (for example, a new action via ADD_TRANS_ACTION) then those changes are lost via this method. It also reorders the replies as they&#X2019;re displayed on-screen--not a big issue for transitions involving replies, but it is a big issue for non-reply transitions where they&#X2019;re evaluated from the bottom-up. It&#X2019;s also an issue for other mods that target this transition, as the False() essentially eliminates it. Enter ALTER_TRANS:</P><PRE CLASS="verbatim">ALTER_TRANS DOGHMA // file name
BEGIN 9 END // state number (can be more than one)
BEGIN 3 END // transition number (can be more than one)
BEGIN // list of changes, see below for flags
  "TRIGGER" ~Global("RevealUmar","GLOBAL",1)
           OR(4)
             PartyHasItem("miscbl")
             PartyHasItem("miscbm")
             PartyHasItem("miscbn")
             PartyHasItem("miscbo")~
END
</PRE><P>There are eight flags you can use in the list of changes. If you do not use a particular flag, the previous value of the transition will be retained (i.e. not specifying an ACTION flag will preserve the current action of the transition).</P><UL CLASS="itemize"><LI CLASS="li-itemize">
TRIGGER: The trigger condition for the transition.
i.e <CODE>"TRIGGER" ~Global("foo","GLOBAL",0)~</CODE></LI><LI CLASS="li-itemize">ACTION: The action performed if the transition is selected.
i.e. <CODE>"ACTION" ~SetGlobal("foo","GLOBAL",1)~</CODE></LI><LI CLASS="li-itemize">REPLY: The player&#X2019;s reply, if any.
i.e. <CODE>"REPLY" ~#57922~</CODE></LI><LI CLASS="li-itemize">JOURNAL: Can add or change the journal entry.
i.e. <CODE>"JOURNAL" ~@100~</CODE></LI><LI CLASS="li-itemize">SOLVED_JOURNAL: Same as JOURNAL, except for entries into the solved section of the journal.</LI><LI CLASS="li-itemize">UNSOLVED_JOURNAL: Same as JOURNAL, except for entries into the unsolved section of the journal.</LI><LI CLASS="li-itemize">EPILOGUE: Specifies where the transition leads to (GOTO, EXTERN, or EXIT)
i.e. <CODE>EPILOGUE" ~EXTERN BVICONI 0~</CODE></LI><LI CLASS="li-itemize">FLAGS: Used to set transition flags manually, though I can&#X2019;t imagine why one would do this.
</LI></UL><P>Let&#X2019;s try one last example. This is bviconi.dlg, state 103:</P><PRE CLASS="verbatim">IF WEIGHT #22 ~Global("LoveTalk","LOCALS",46)~ THEN BEGIN 103 SAY #10537
  IF ~~ THEN REPLY #10538 GOTO 367
  IF ~~ THEN REPLY #10539 EXTERN ~~ 0
END
</PRE><P>As you can see the transition destination for the second transition is broken. In the olden days this would be fixed with</P><PRE CLASS="verbatim">ADD_TRANS_TRIGGER BVICONI 103 ~False()~ DO 1
EXTEND_BOTTOM BVICONI 103
IF ~~ THEN REPLY #10539 GOTO 368
END
</PRE><P>With ALTER_TRANS, it becomes much easier:</P><PRE CLASS="verbatim">ALTER_TRANS BVICONI BEGIN 103 END BEGIN 1 END BEGIN "EPILOGUE" ~GOTO 368~ END
</PRE><P>Addendum: please note that it&#X2019;s important to wrap the target (for example, REPLY or EPILOGUE)
in quotes, tildas, or percentage signs.</P><P>Further addendum: REPLY, JOURNAL and friends will remove the feature (rather than add an empty
journal line or whatever) if the associated string is empty.</P><!--TOC section Module Packaging: <TT><B>TP2</B></TT> Files-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc19">8</A>&#XA0;&#XA0;Module Packaging: <B><TT>TP2</TT></B><A NAME="TP2"></A><A NAME="@default167"></A> Files</H2><!--SEC END --><P>
<A NAME="TP"></A></P><P>At some point you will be done with your mod (a collection of <TT>CRE</TT>,
<TT>ITM</TT>, <TT><A HREF="#D">D</A></TT>, etc., files) and you will want to package it up so that
other users can install it (and then perhaps uninstall it later) easily.
WeiDU can handle this task for you (and you may freely distribute <TT>WeiDU.exe</TT>
with your module).</P><P>A <TT><A HREF="#TP2">TP2</A></TT> describes how to install components of your module. WeiDU
will read the file, ask the user questions, and then perform the
installation. Uninstallation and upgrading are also handled. </P><P>See the file <TT>examples/mymod.tp2</TT> for a commented example of how this all
works.</P><P>Here is the context-free grammar syntax for the <TT><A HREF="#TP2">TP2</A></TT> file format:</P><TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1><TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>TP2 File</TT></B><A NAME="TP2 File"></A><A NAME="@default168"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left> A <TT><A HREF="#TP2 File">TP2 File</A></TT> is a text file that contains a number of
mod <TT><A HREF="#Component">Component</A></TT>s. <TT><A HREF="#TP2 File">TP2 File</A></TT>s tell WeiDU how to install
various parts of your mod on an end-user&#X2019;s computer.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
is</TD><TD VALIGN=top ALIGN=left><B><TT>BACKUP</TT></B><A NAME="BACKUP"></A><A NAME="@default169"></A> directoryName<P><B><TT>AUTHOR</TT></B><A NAME="AUTHOR"></A><A NAME="@default170"></A> emailAddress</P><P><TT><A HREF="#TP2 Flag">TP2 Flag</A></TT> <FONT COLOR="red"> list </FONT></P><P><TT><A HREF="#Language">Language</A></TT> <FONT COLOR="red"> list </FONT></P><P><TT><A HREF="#Component">Component</A></TT> <FONT COLOR="red"> list </FONT></P></TD><TD VALIGN=top ALIGN=left>
A <TT><A HREF="#TP2 File">TP2 File</A></TT> is basically a prologue and then a list of
<TT><A HREF="#Component">Component</A></TT>s. The <TT><A HREF="#BACKUP">BACKUP</A></TT> declaration tells WeiDU where
to put backed-up versions of files that would be overwritten so that
they can be uninstalled later. This directory will be created
automatically if it is missing. The <TT><A HREF="#AUTHOR">AUTHOR</A></TT> directive gives an
email address for users to send bugs to if there are problems during
the installation. The <B><TT>TP2_AUTHOR</TT></B><A NAME="TP2_AUTHOR"></A><A NAME="@default171"></A> <TT><A HREF="#variable">variable</A></TT> is set to
the &#X201C;emailAddress&#X201D; value. The <B><TT>TP2_FILE_NAME</TT></B><A NAME="TP2_FILE_NAME"></A><A NAME="@default172"></A> <TT><A HREF="#variable">variable</A></TT>
	 is set to the name of the tp2 file.
<TT><A HREF="#TP2 Flag">TP2 Flag</A></TT>s set global options.
<TT><A HREF="#Language">Language</A></TT>s are
the various languages in which your mod is available. The
Finally, the <TT><A HREF="#Component">Component</A></TT>s make up the actual meat of
your mod. Different <TT><A HREF="#Component">Component</A></TT>s can be installed or
uninstalled separately, but all of the parts within a
<TT><A HREF="#Component">Component</A></TT> are treated as a unit.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>TP2 Flag</TT></B><A NAME="TP2 Flag"></A><A NAME="@default173"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>A <TT><A HREF="#TP2 Flag">TP2 Flag</A></TT> declaration tells WeiDU to apply some
global option to your <TT><A HREF="#TP2">TP2</A></TT> file.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> is</TD><TD VALIGN=top ALIGN=left><B><TT>AUTO_TRA</TT></B><A NAME="AUTO_TRA"></A><A NAME="@default174"></A> path</TD><TD VALIGN=top ALIGN=left> The <TT><A HREF="#AUTO_TRA">AUTO_TRA</A></TT> flag is used
with the <TT><A HREF="#COMPILE">COMPILE</A></TT> <TT><A HREF="#TP2 Action">TP2 Action</A></TT>. It automatically loads
<TT><A HREF="#TRA">TRA</A></TT> files that match your <TT><A HREF="#D">D</A></TT> files.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ALLOW_MISSING</TT></B><A NAME="ALLOW_MISSING"></A><A NAME="@default175"></A> file <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> <TT><A HREF="#ALLOW_MISSING">ALLOW_MISSING</A></TT> directive allows you to specify files that can
be missing (when you try to copy them or reference them from
<TT><A HREF="#D">D</A></TT> files). Empty versions of those files will be created on
demand. Try to use <TT><A HREF="#ACTION_IF">ACTION_IF</A></TT> instead of this.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ASK_EVERY_COMPONENT</TT></B><A NAME="ASK_EVERY_COMPONENT"></A><A NAME="@default176"></A></TD><TD VALIGN=top ALIGN=left> This flag instructs WeiDU to ask about installing every component in
this <TT><A HREF="#TP2">TP2</A></TT> file individually, rather than asking questions
like "Would you like to install them all?"</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ALWAYS</TT></B><A NAME="ALWAYS"></A><A NAME="@default177"></A> <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> This flag specified a <TT><A HREF="#TP2 Action">TP2 Action</A></TT> that is executed at the beginning
of each <TT><A HREF="#Component">Component</A></TT>, before the component-specific <TT><A HREF="#TP2 Action">TP2 Action</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>README</TT></B><A NAME="README"></A><A NAME="@default178"></A> file <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> The given file is displayed to the user after choosing the language, but
before installing any component. If more than one file name is provided,
they are checked for existence in the order they&#X2019;re provided, and the first available
one will be opened. If you wish to open multiple readme files, use multiple README
statements.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>UNINSTALL_ORDER</TT></B><A NAME="@default179"></A> String <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left>		Don&#X2019;t use without a real reason.
		
		Specifies the order in which uninstallation operations are handled.
		The operations are STRSET (uninstall STRSET and ALTER_TLK), MOVE
		(uninstall MOVE), AT (perform AT_UNINSTALL and AT_INTERACTIVE_UNINSTALL) and
		COPY (uninstall all various file operations).
		
		If not specified, the order is MOVE - STRSET - COPY - AT.
		
		If this is specified, then ALL operations must be specified
		(if any isn&#X2019;t, a warning is printed). Please note that this means that
		your mod might start printing warnings three years down the line if
		a new uninstall action is coded.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>MODDER</TT></B><A NAME="@default180"></A> String <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Enable additional debug info. By default, these messages are verbose but do
not halt the installation. Some options are configurable, see the <TT><A HREF="#MODDER">MODDER</A></TT>
in-depth description.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>VERSION</TT></B><A NAME="VERSION"></A><A NAME="@default181"></A> String</TD><TD VALIGN=top ALIGN=left> 		"String" (variables evaluated) will be appended to every component&#X2019;s name in the
		weidu.log file.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>SCRIPT_STYLE</TT></B><A NAME="SCRIPT_STYLE"></A><A NAME="@default182"></A> style</TD><TD VALIGN=top ALIGN=left> This flag determines how WeiDU will read in <TT><A HREF="#BAF">BAF</A></TT> and
<TT><A HREF="#BCS">BCS</A></TT> files and
write out <TT><A HREF="#BAF">BAF</A></TT> and <TT><A HREF="#BCS">BCS</A></TT> files. Possible options for
&#X201C;style&#X201D; include <TT>BG</TT> (the default), <TT>IWD1</TT>, <TT>IWD2</TT>, and <TT>PST</TT>. 
See <A HREF="#sec-scripting-styles">the Scripting Styles tutorial</A>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>NO_IF_EVAL_BUG</TT></B><A NAME="NO_IF_EVAL_BUG"></A><A NAME="@default183"></A></TD><TD VALIGN=top ALIGN=left>this action solves a long-standing bug with
the IF_EVAL action. Since solving it is not directly possible without
damaging backwards compatibility, you have to use this action (preferably
in an ALWAYS statement) to solve the bug for yourself. IF_EVAL will not
work with this action in the TP2 - use <TT><A HREF="#PATCH_IF">PATCH_IF</A></TT> and
<TT><A HREF="#BUT_ONLY_IF_IT_CHANGES">BUT_ONLY_IF_IT_CHANGES</A></TT> instead.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>QUICK_MENU</TT></B><A NAME="@default184"></A> lots of parameters</TD><TD VALIGN=top ALIGN=left> Used to specify one or more groups of components that can be installed in
a single step. See the <TT><A HREF="#QUICK_MENU">QUICK_MENU</A></TT> tutorial for synthax, usage
instructions, and caveats.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>Language</TT></B><A NAME="Language"></A><A NAME="@default185"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left> A <TT><A HREF="#Language">Language</A></TT> declaration tells WeiDU where to find <TT><A HREF="#TRA">TRA</A></TT>
files.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
is</TD><TD VALIGN=top ALIGN=left><B><TT>LANGUAGE</TT></B><A NAME="LANGUAGE"></A><A NAME="@default186"></A> languageName
languageDirectory
defaultLanguageTRA <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> The languageName is the name of the language as it is presented to
the user. "American English" and "Italiano" are
examples. The languageDirectory is the name of the subdirectory in
which you have stored the <TT><A HREF="#TRA">TRA</A></TT> files for that language.
Examples include "american" and "spanish". The <TT><A HREF="#variable">variable</A></TT>
named <TT>LANGUAGE</TT> is set to languageDirectory if the user selects
this language.. Finally, all of the <TT><A HREF="#TRA">TRA</A></TT> files in the
defaultLanguageTRA list are loaded as soon as the user selects a
language.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>Component</TT></B><A NAME="Component"></A><A NAME="@default187"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left> A <TT><A HREF="#Component">Component</A></TT> is a contiguous group of files and actions that a
user can install, uninstall or upgrade.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
is</TD><TD VALIGN=top ALIGN=left><B><TT>BEGIN</TT></B><A NAME="@default188"></A> componentName 
<TT><A HREF="#Component Flag">Component Flag</A></TT> <FONT COLOR="red"> list </FONT><TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Basically, if componentName is "Foo", the user will be asked: "Do you
want to install Foo?". If so, all of the associated <TT><A HREF="#TP2 Action">TP2 Action</A></TT>s 
are performed. If not, they are skipped.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>Component Flag</TT></B><A NAME="Component Flag"></A><A NAME="@default189"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left> A <TT><A HREF="#Component Flag">Component Flag</A></TT> determines how WeiDU treats a component.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
is</TD><TD VALIGN=top ALIGN=left><B><TT>DEPRECATED</TT></B><A NAME="DEPRECATED"></A><A NAME="@default190"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> Mark the given component as deprecated. If it is currently installed,
it will be uninstalled and the given <TT><A HREF="#String">String</A></TT> will be
displayed. The user will never be asked to install the given
component -- it will be silently skipped in all listings. However, it
will still take up a &#X201C;component number&#X201D;.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REQUIRE_COMPONENT</TT></B><A NAME="REQUIRE_COMPONENT"></A><A NAME="@default191"></A> modToUninstall modComponent
<TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> Make this component so that it can only be installed if another
component is installed. If that other component is not installed, the
<TT><A HREF="#String">String</A></TT> will be displayed and the user will not get a chance
to install this component. This is in some sense the opposite of the
<TT><A HREF="#UNINSTALL">UNINSTALL</A></TT> <TT><A HREF="#TP2 Action">TP2 Action</A></TT>. For example,
<TT>REQUIRE_COMPONENT "setup-ease.tp2" "0" "You must have infinite
stacking installed!"</TT> prevents a component from being installed
unless the infinite stacking part of the Ease-of-Use mod is
installed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>FORBID_COMPONENT</TT></B><A NAME="FORBID_COMPONENT"></A><A NAME="@default192"></A> modToUninstall modComponent
<TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> Make this component so that it can only be installed if another
component is <EM>not</EM> installed. This does the opposite of
<TT><A HREF="#REQUIRE_COMPONENT">REQUIRE_COMPONENT</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REQUIRE_PREDICATE</TT></B><A NAME="REQUIRE_PREDICATE"></A><A NAME="@default193"></A> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> This component can only be installed if the <TT><A HREF="#value">value</A></TT>
evaluates to true (non-zero).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>SUBCOMPONENT</TT></B><A NAME="@default194"></A> <TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> At most one component of the given subcomponent group can be
installed at any time. All subcomponents of the same group are
listed together for the user. See the <TT><A HREF="#SUBCOMPONENT">SUBCOMPONENT</A></TT>
tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>FORCED_SUBCOMPONENT</TT></B><A NAME="FORCED_SUBCOMPONENT"></A><A NAME="@default195"></A> <TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> See the <TT><A HREF="#SUBCOMPONENT">SUBCOMPONENT</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> 
or</TD><TD VALIGN=top ALIGN=left><B><TT>GROUP</TT></B><A NAME="@default196"></A> <TT><A HREF="#String">String</A></TT><FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left>Used for grouping components; the user
will be asked to display these or not. See the <TT><A HREF="#GROUP">GROUP</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INSTALL_BY_DEFAULT</TT></B><A NAME="INSTALL_BY_DEFAULT"></A><A NAME="@default197"></A></TD><TD VALIGN=top ALIGN=left> If WeiDU would ask the user whether to install this component or not,
and this component is not already installed, WeiDU will instead
install it by default (without asking the user). If there is an error
or the component is already installed, WeiDU will ask the user. The
<TT><A HREF="#--uninstall">--uninstall</A></TT> command-line argument overrides this. See also
<TT><A HREF="#REQUIRE_COMPONENT">REQUIRE_COMPONENT</A></TT> and <TT><A HREF="#ALWAYS">ALWAYS</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>DESIGNATED</TT></B><A NAME="DESIGNATED"></A><A NAME="@default198"></A> forcedNumber</TD><TD VALIGN=top ALIGN=left> Normally module components are numbered based on their order in the
<TT><A HREF="#TP2">TP2</A></TT> file (starting from 0). This flag sets the current
component number to forcedNumber. The next component (if it lacks a
<TT><A HREF="#DESIGNATED">DESIGNATED</A></TT> flag) will be forcedNumber+1. You can easily shoot
yourself in the foot by setting forcedNumber too low (e.g., so that
multiple components have the same number).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>NO_LOG_RECORD</TT></B><A NAME="NO_LOG_RECORD"></A><A NAME="@default199"></A></TD><TD VALIGN=top ALIGN=left> Normally all module components are recorded in <TT>WeiDU.log</TT> and can
be uninstalled later. This component flag prevents this component
from writing a log record when it is successfully installed. As a
result it is &#X201C;invisible&#X201D; to WeiDU, can be installed multiple times,
and cannot be uninstalled with WeiDU. <EM>Do not use this flag without
	 a real reason.</EM></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>LABEL</TT></B><A NAME="LABEL"></A><A NAME="@default200"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> Defines this&#X2019;s module LABEL, or unique textual identifier. Any component
	 can have zero or more LABEL. Will print a warning if two components in
the same tp2 share a LABEL. <EM>Do not alter a component&#X2019;s LABEL once
	 you publish that mod</EM>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>TP2 Action</TT></B><A NAME="TP2 Action"></A><A NAME="@default201"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left> A <TT><A HREF="#TP2 Action">TP2 Action</A></TT> tells WeiDU how to install a component. This usually
involves copying files and writing in new string references.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
is</TD><TD VALIGN=top ALIGN=left><B><TT>COPY</TT></B><A NAME="COPY"></A><A NAME="@default202"></A> <TT><A HREF="#optNoBackup">optNoBackup</A></TT> 
<TT><A HREF="#optGlob">optGlob</A></TT> fromFile toFile ...
<TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT><A HREF="#when">when</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> You may specify as many fromFile-toFile pairs as you like. Each
fromFile is copied to its associated toFile. If there are any WeiDU
variables inside explicit <TT>%</TT>s in toFile or fromFile, they are
replaced by their values. All of the
<TT><A HREF="#patch">patch</A></TT>es are applied. If there are any <TT><A HREF="#when">when</A></TT>
conditions and any of them are false, the copy does not happen. 
A typical example is <TT>COPY "mymod/sword.itm"
"override/m#sword.itm"</TT>.<P><TT><A HREF="#COPY">COPY</A></TT> commands set the user-defined <B><TT>SOURCE_DIRECTORY</TT></B><A NAME="SOURCE_DIRECTORY"></A><A NAME="@default203"></A>,
<B><TT>SOURCE_FILESPEC</TT></B><A NAME="SOURCE_FILESPEC"></A><A NAME="@default204"></A>, <B><TT>SOURCE_FILE</TT></B><A NAME="SOURCE_FILE"></A><A NAME="@default205"></A>,
<B><TT>SOURCE_RES</TT></B><A NAME="SOURCE_RES"></A><A NAME="@default206"></A>, <B><TT>SOURCE_EXT</TT></B><A NAME="SOURCE_EXT"></A><A NAME="@default207"></A>,
<B><TT>DEST_DIRECTORY</TT></B><A NAME="DEST_DIRECTORY"></A><A NAME="@default208"></A>, <B><TT>DEST_FILESPEC</TT></B><A NAME="DEST_FILESPEC"></A><A NAME="@default209"></A>,
<B><TT>DEST_FILE</TT></B><A NAME="DEST_FILE"></A><A NAME="@default210"></A>,<B><TT>DEST_RES</TT></B><A NAME="DEST_RES"></A><A NAME="@default211"></A> and <B><TT>DEST_EXT</TT></B><A NAME="DEST_EXT"></A><A NAME="@default212"></A>
<TT><A HREF="#variable">variable</A></TT>s based on fromFile and toFile as follows. If
fromFile is <TT>mymod/cre/bigboss.cre</TT>, then
<TT><A HREF="#SOURCE_DIRECTORY">SOURCE_DIRECTORY</A></TT> is <TT>mymod/cre</TT>,
<TT><A HREF="#SOURCE_FILESPEC">SOURCE_FILESPEC</A></TT> is <TT>mymod/cre/bigboss.cre</TT>,
<TT><A HREF="#SOURCE_FILE">SOURCE_FILE</A></TT> is <TT>bigboss.cre</TT>,
<TT><A HREF="#SOURCE_RES">SOURCE_RES</A></TT> is <TT>bigboss</TT> and <TT><A HREF="#SOURCE_EXT">SOURCE_EXT</A></TT> is <TT>cre</TT>.
The <TT>DEST_</TT> variables
are similarly based on toFile. In addition, <B><TT>SOURCE_SIZE</TT></B><A NAME="SOURCE_SIZE"></A><A NAME="@default213"></A> is
set to the size (in bytes) of the source file.</P><P>This is generally only useful if you have enabled globbing. Any
user-defined <TT><A HREF="#variables">variables</A></TT> in toFile are replaced with their
values. You may also reference these <TT><A HREF="#variables">variables</A></TT> in
<TT><A HREF="#patch">patch</A></TT>es.</P><P>See the <TT><A HREF="#Module Distribution">Module Distribution</A></TT> section for information about
finding a good unique prefix for your mod-created resources.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>COPY_EXISTING</TT></B><A NAME="COPY_EXISTING"></A><A NAME="@default214"></A> <TT><A HREF="#optNoBackup">optNoBackup</A></TT> fromFile toFile ...</TD><TD VALIGN=top ALIGN=left> Behaves like <TT><A HREF="#COPY">COPY</A></TT> except that the fromFiles are drawn from
the game <TT><A HREF="#BIFF">BIFF</A></TT>s or <TT>override</TT> directory. This is useful for
making changes to files that other mods may have changed as well.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>COPY_EXISTING_REGEXP</TT></B><A NAME="COPY_EXISTING_REGEXP"></A><A NAME="@default215"></A> <TT><A HREF="#optNoBackup">optNoBackup</A></TT> <TT><A HREF="#optGlob">optGlob</A></TT> fromFileRegexp toDir ...
<TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT><A HREF="#when">when</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Behaves like <TT><A HREF="#COPY_EXISTING">COPY_EXISTING</A></TT> except that fromFileRegexp may
contain regular expressions (<TT><A HREF="#regexp">regexp</A></TT>s). All matching files in
the game <TT><A HREF="#BIFF">BIFF</A></TT>s will be copied to the directory specified by
toDir.<P>If <TT><A HREF="#GLOB">GLOB</A></TT> is specified, matching files in <TT>override</TT> will
also be patched and copied. If a file appears in both the
<TT><A HREF="#BIFF">BIFF</A></TT>s and the <TT>override</TT> folder, it will only be copied
once. For example, if <TT>HARM.ITM</TT> is in the <TT><A HREF="#BIFF">BIFF</A></TT>s and
<TT>HARM2.ITM</TT> is in <TT>override</TT>, this code will copy and patch them
both:</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP GLOB ~HARM.*.ITM~ ~override~
  SAY // ... whatever
</PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>COPY_LARGE</TT></B><A NAME="COPY_LARGE"></A><A NAME="@default216"></A> <TT><A HREF="#optNoBackup">optNoBackup</A></TT> <TT><A HREF="#optGlob">optGlob</A></TT> fromFile toFile ...</TD><TD VALIGN=top ALIGN=left> Behaves like <TT><A HREF="#COPY">COPY</A></TT> except that the fromFiles can be of arbitrary
size (the limit should be over a Gigabyte), but on the other side of 
the coin you can&#X2019;t apply patches to the copying.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>COPY_RANDOM</TT></B><A NAME="COPY_RANDOM"></A><A NAME="@default217"></A> <TT>(</TT> file1 <FONT COLOR="red"> list </FONT><TT>)</TT>
<FONT COLOR="red"> [ </FONT><TT>(</TT> fileN <FONT COLOR="red"> list </FONT><TT>)</TT> <FONT COLOR="red"> list  ] </FONT><TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT><A HREF="#when">when</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> This command works like <TT><A HREF="#COPY_EXISTING">COPY_EXISTING</A></TT> but the destination
for any given source file in the file1-list is some other different
file in the file1-list. Similarly, the destination for any file in
the fileN-list is some other file in the fileN-list. This allows you
to randomly shuffle categories of game resources.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>COPY_ALL_GAM_FILES</TT></B><A NAME="COPY_ALL_GAM_FILES"></A><A NAME="@default218"></A>
<TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT><A HREF="#when">when</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Copies Default.gam from the biff and the ones in the save/ and mpsave/ saved
games, applying the list of patches. If there are any <TT><A HREF="#when">when</A></TT> conditions
and any of them are false, the copy does not happen. <EM>NO BACKUP is applied
to files in the save/ and mpsave/ directories. The savegame from the biffs is
backuped as usual.</EM></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>MOVE</TT></B><A NAME="MOVE"></A><A NAME="@default219"></A> fromFile toFile ... <CODE>(</CODE> <TT><A HREF="#directory-file-regexp">directory-file-regexp</A></TT> <CODE>)</CODE> toFile ...</TD><TD VALIGN=top ALIGN=left> You may specify as many fromFile-toFile pairs as you like. Each
fromFile is moved to its associated toFile.
	 
	 If fromFile is a file, toFile can be a file or a directory; if fromFile is a
	 directory, toFile must be a directory; if fromFile doesn&#X2019;t exist, an error is
	 raised.<P>	 <CODE>MOVE</CODE> also supports the <TT><A HREF="#directory-file-regexp">directory-file-regexp</A></TT> construct
	 in place of fromFile; in this form, it must be wrapped in parenthesis,
	 toFile must be a directory, and no error is raised if no file is matched. Examples:
	 </P><PRE CLASS="verbatim">MOVE ~sourceFile~ ~destinationFile~
MOVE ~sourceFile~ ~destinationDirectory~
MOVE ~sourceDirectory~ ~destinationDirectory~
MOVE (~sourceDirectory~ ~^[A-M].*\.itm$~) ~destinationDirectory~
    </PRE><P>Safety notes: when uninstalling, MOVE is restored first,
then all generic actions are restored, then AT_*!UNINSTALL is handled.
As such, do your AT_NOW, then do your COPY, then do your MOVEs
(exception: if you MOVE for biffing purposes, it is safe to call
MAKE_BIFF after MOVE. Do not use the --make-biff command-line argument).</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>DISABLE_FROM_KEY</TT></B><A NAME="DISABLE_FROM_KEY"></A><A NAME="@default220"></A> file ...</TD><TD VALIGN=top ALIGN=left>		Removes one or more files from the chitin.key, while leaving the
		containing bif file itself untouched.
		
		Don&#X2019;t use without a real reason.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> 
or</TD><TD VALIGN=top ALIGN=left><B><TT>COMPILE</TT></B><A NAME="COMPILE"></A><A NAME="@default221"></A> <FONT COLOR="red"> [ </FONT>EVALUATE_BUFFER <FONT COLOR="red"> ] </FONT>sourceFile <FONT COLOR="red"> list  [ </FONT><TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list  ]  [ </FONT><B><TT>USING</TT></B><A NAME="USING"></A><A NAME="@default222"></A> traFile <FONT COLOR="red"> list  ] </FONT></TD><TD VALIGN=top ALIGN=left> This command compiles <TT><A HREF="#D">D</A></TT> and <TT><A HREF="#BAF">BAF</A></TT> source files. If
sourceFile is a directory, all <TT><A HREF="#D">D</A></TT> and <TT><A HREF="#BAF">BAF</A></TT> files within
that directory are processed individually. If there is EVALUATE_BUFFER,
all <CODE>%variables%</CODE> in the files are substituted with their values.<P>After the special EVALUATE_BUFFER is executed, all other patches are executed.</P><P>First, this loads all of the traFiles presented. If any of their
paths contain <TT>%s</TT>, the <TT>%s</TT> is replaced with the
languageDirectory of from the <TT><A HREF="#Language">Language</A></TT> the user selected.
If you specified <TT><A HREF="#AUTO_TRA">AUTO_TRA</A></TT> <TT>mymod/%s</TT> above, WeiDU will
also attempt to load <TT>mymod/languageDirectory/sourceFile.tra</TT> for
every sourceFile in the list. Once all of the <TT><A HREF="#TRA">TRA</A></TT> files are
loaded, the <TT><A HREF="#D">D</A></TT> and <TT><A HREF="#BAF">BAF</A></TT> files are compiled. Any
<TT><A HREF="#DLG">DLG</A></TT>s or <TT><A HREF="#BCS">BCS</A></TT>s they create or modify are placed in the
<TT>override</TT> directory.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>CLEAR_MEMORY</TT></B><A NAME="CLEAR_MEMORY"></A><A NAME="@default223"></A></TD><TD VALIGN=top ALIGN=left>removes all variables from the memory, then
reloads the automatic ones (TP2_AUTHOR, TP2_FILE_NAME, LANGUAGE, WEIDU_ARCH,
WEIDU_OS, COMPONENT_NUMBER, all numeric constants such as NAME1, the soundsets, or
SCRIPT_OVERRIDE). INTERACTIVE is automatically set when you call the
next component. Don&#X2019;t use this feature without a real reason.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>CLEAR_ARRAYS</TT></B><A NAME="CLEAR_ARRAYS"></A><A NAME="@default224"></A></TD><TD VALIGN=top ALIGN=left>removes the names and contents of all arrays
from the memory (while still keeping their values).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>CLEAR_CODES</TT></B><A NAME="CLEAR_CODES"></A><A NAME="@default225"></A></TD><TD VALIGN=top ALIGN=left>Removes all loaded functions and macros from the
memory.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>CLEAR_INLINED</TT></B><A NAME="CLEAR_INLINED"></A><A NAME="@default226"></A></TD><TD VALIGN=top ALIGN=left>Removes all inlined files from the memory.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>CLEAR_EVERYTHING</TT></B><A NAME="CLEAR_EVERYTHING"></A><A NAME="@default227"></A></TD><TD VALIGN=top ALIGN=left>Runs CLEAR_MEMORY, CLEAR_ARRAY, CLEAR_CODES and
CLEAR_INLINED.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>CLEAR_IDS_MAP</TT></B><A NAME="CLEAR_IDS_MAP"></A><A NAME="@default228"></A></TD><TD VALIGN=top ALIGN=left>force WeiDU to remove all loaded IDSes in memory
(otherwise, if you compile a script, append to an IDS and compile another script, WeiDU
will not handle the new IDS entry).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_CLEAR_ARRAY</TT></B><A NAME="ACTION_CLEAR_ARRAY"></A><A NAME="@default229"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> &#X2018;Forgets&#X2019; that the array <TT>string</TT> exists until its values are recalled.
The actual variables&#X2019; values are kept, the only effect is that <TT>*PHP_EACH</TT>
will not consider old values.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>SILENT</TT></B><A NAME="SILENT"></A><A NAME="@default230"></A></TD><TD VALIGN=top ALIGN=left>makes WeiDU skip all messages; it&#X2019;s reenabled once a component
is installed (or fails to), or a PRINT, PATCH_PRINT, VERBOSE or PATCH_VERBOSE is found.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>VERBOSE</TT></B><A NAME="VERBOSE"></A><A NAME="@default231"></A></TD><TD VALIGN=top ALIGN=left>undoes the latest SILENT command.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>MKDIR</TT></B><A NAME="MKDIR"></A><A NAME="@default232"></A> dirName <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Instructs WeiDU to create all of the directories in the list.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>RANDOM_SEED</TT></B><A NAME="RANDOM_SEED"></A><A NAME="@default233"></A> someInteger</TD><TD VALIGN=top ALIGN=left> Sets the random number generator seed to someInteger. This allows you
to get reproducible results when using random functions. If you
specify a string that is not a valid integer the system initializes
itself (e.g., by using the current time).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_READLN</TT></B><A NAME="ACTION_READLN"></A><A NAME="@default234"></A> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> Waits for the user to provided an enter-terminated string and store it in
variable. Said string will be stored and re-used at reinstall time. See the
<TT><A HREF="#READLN">READLN</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>APPEND</TT></B><A NAME="@default235"></A> <TT><A HREF="#optNoBackup">optNoBackup</A></TT> filename newText <TT><A HREF="#when">when</A></TT> <FONT COLOR="red"> list  [ </FONT><TT>KEEP_CRLF</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> If there are no <TT><A HREF="#when">when</A></TT> conditions or they are all true, the
ASCII text newText is appended to the existing file filename (which
is read from the game <TT><A HREF="#BIFF">BIFF</A></TT>s or the <TT>override</TT> folder).
Any variables in newText are replaced by their values.<P>If <TT>KEEP_CRLF</TT> is not present, double newlines in the file
(but not in newText) will be removed; otherwise, they&#X2019;re kept.</P><P>In any event, if the file ends with CRLF only newText and an ending
CRLF will be written; otherwise, if the file does not end with CRLF,
it will be written before newText.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>APPEND_OUTER</TT></B><A NAME="APPEND_OUTER"></A><A NAME="@default236"></A> <TT><A HREF="#optNoBackup">optNoBackup</A></TT> filename newText <TT><A HREF="#when">when</A></TT> <FONT COLOR="red"> list  [ </FONT><TT>KEEP_CRLF</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> If there are no <TT><A HREF="#when">when</A></TT> conditions or they are all true, the
ASCII text newText is appended to the existing file filename (which
is treated as a path to a file).
Any variables in newText are replaced by their values.<P>If <TT>KEEP_CRLF</TT> is not present, double newlines in the file
(but not in newText) will be removed; otherwise, they&#X2019;re kept.</P><P>In any event, if the file ends with CRLF only newText and an ending
CRLF will be written; otherwise, if the file does not end with CRLF,
it will be written before newText.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>APPEND_COL</TT></B><A NAME="APPEND_COL"></A><A NAME="@default237"></A> <TT><A HREF="#optNoBackup">optNoBackup</A></TT> filename newText <FONT COLOR="red"> [ </FONT>prepend <FONT COLOR="red"> ] </FONT><TT><A HREF="#when">when</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> If there are no <TT><A HREF="#when">when</A></TT> conditions or they are all true, the
string newText is appended column-wise to the existing file filename (which
is read from the game <TT><A HREF="#BIFF">BIFF</A></TT>s or the <TT>override</TT> folder).
If filename was:
<br>
A B C <br>
D E F <br>
X Y Z <br>
P Q R <br>
      and newText was <TT>"0 1 2 3"</TT>, the result would be:
<br>
A B C 0 <br>
D E F 1 <br>
X Y Z 2 <br>
P Q R 3 <br>
      You must have the same number of whitespace-separated words in
newText as there are columns in filename. Prepend empty cells are 
	 assumed to be at the beginning of newText. A cell containing exactly
	 <CODE>$</CODE> is printed as empty.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>APPEND_COL_OUTER</TT></B><A NAME="APPEND_COL_OUTER"></A><A NAME="@default238"></A> <TT><A HREF="#optNoBackup">optNoBackup</A></TT> filename newText <FONT COLOR="red"> [ </FONT>prepend <FONT COLOR="red"> ] </FONT><TT><A HREF="#when">when</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> If there are no <TT><A HREF="#when">when</A></TT> conditions or they are all true, the
string newText is appended column-wise to the existing file filename (which
is treated as a path to a file).
If filename was:
<br>
A B C <br>
D E F <br>
X Y Z <br>
P Q R <br>
      and newText was <TT>"0 1 2 3"</TT>, the result would be:
<br>
A B C 0 <br>
D E F 1 <br>
X Y Z 2 <br>
P Q R 3 <br>
      You must have the same number of whitespace-separated words in
newText as there are columns in filename. Prepend empty cells are 
	 assumed to be at the beginning of newText. A cell containing exactly
	 <CODE>$</CODE> is printed as empty.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>EXTEND_TOP</TT></B><A NAME="@default239"></A> existingBCS newFile <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Loads existingFile (which may be <TT><A HREF="#BAF">BAF</A></TT> or <TT><A HREF="#BCS">BCS</A></TT>), prepends
all of newBCS to the top of it, applies all of the <TT><A HREF="#patch">patch</A></TT>es, and
then copies it to the <TT>override</TT> folder. User variables in
the filenames existingFile and newFile are replaced by their values.
Use <TT><A HREF="#EVALUATE_BUFFER">EVALUATE_BUFFER</A></TT> if you want to evaluate variables inside
the body of newFile before parsing it.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>EXTEND_BOTTOM</TT></B><A NAME="@default240"></A> existingBCS newFile <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#EXTEND_TOP">EXTEND_TOP</A></TT>, but the newFile file is put at the bottom of the
existingBCS file. User variables in the filenames existingFile and
newFile are replaced by their values.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>EXTEND_TOP_REGEXP</TT></B><A NAME="EXTEND_TOP_REGEXP"></A><A NAME="@default241"></A> existingBCSregexp newFile <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#EXTEND_TOP">EXTEND_TOP</A></TT>, but the newFile file is put at the bottom of the
every <TT><A HREF="#BCS">BCS</A></TT> file that matches the <TT><A HREF="#regexp">regexp</A></TT>
existingBCSregexp.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>EXTEND_BOTTOM_REGEXP</TT></B><A NAME="EXTEND_BOTTOM_REGEXP"></A><A NAME="@default242"></A> existingBCSregexp newFile <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> See <TT><A HREF="#EXTEND_TOP_REGEXP">EXTEND_TOP_REGEXP</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_IF</TT></B><A NAME="ACTION_IF"></A><A NAME="@default243"></A> <TT><A HREF="#value">value</A></TT> <TT>THEN BEGIN</TT>
<TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT>
<FONT COLOR="red"> [ </FONT><TT>ELSE BEGIN</TT> <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> If <TT><A HREF="#value">value</A></TT> evaluates to true (non-zero), the <TT><A HREF="#TP2 Action">TP2 Action</A></TT>s
in the <TT>THEN</TT>-branch are executed. Otherwise, if an <TT>ELSE</TT>-branch
is present, its commands are executed. Otherwise nothing happens.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_MATCH</TT></B><A NAME="ACTION_MATCH"></A><A NAME="@default244"></A> <TT><A HREF="#value">value</A></TT> WITH <FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> ...
<FONT COLOR="red"> [ </FONT>WHEN <TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT>BEGIN <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT>END <FONT COLOR="red"> ] </FONT>...
DEFAULT <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT>END</TD><TD VALIGN=top ALIGN=left> See the <TT><A HREF="#MATCH and TRY">MATCH and TRY</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_TRY</TT></B><A NAME="ACTION_TRY"></A><A NAME="@default245"></A> <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT>WITH <FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> ...
<FONT COLOR="red"> [ </FONT>WHEN <TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT>BEGIN <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT>END <FONT COLOR="red"> ] </FONT>...
DEFAULT <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT>END</TD><TD VALIGN=top ALIGN=left> See the <TT><A HREF="#MATCH and TRY">MATCH and TRY</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_RERAISE</TT></B><A NAME="ACTION_RERAISE"></A><A NAME="@default246"></A></TD><TD VALIGN=top ALIGN=left>See the <TT><A HREF="#MATCH and TRY">MATCH and TRY</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>AT_EXIT</TT></B><A NAME="AT_EXIT"></A><A NAME="@default247"></A> commandToRun <FONT COLOR="red"> [ </FONT><TT>EXACT</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> Whenever this <TT><A HREF="#component">component</A></TT> attempts to be installed, commandToRun
is executed. Variables (e.g., <TT>%LANGUAGE%</TT>) in the string
commandToRun are replaced by their values. Note that the command is
executed even if the component does not install correctly, so
<TT><A HREF="#AT_EXIT">AT_EXIT</A></TT> should probably be the last command in a component. 
<UL CLASS="itemize"><LI CLASS="li-itemize">
If commandToRun consists of a single <TT><A HREF="#TP2">TP2</A></TT> filename, WeiDU will
enqueue that <TT><A HREF="#TP2">TP2</A></TT> file and run it when the current one is done
(asking the user all the standard questions about languages and which
components to install). 
</LI><LI CLASS="li-itemize">If commandToRun consists of the word <TT>VIEW</TT> followed by a file, a
system-specific viewer will be used to present the file to the user.
For example, on Windows systems <TT>notepad</TT> will be used to view
<TT>txt</TT> files and a web browser will be used to view <TT>html</TT> files.
Note: also NOTEPAD and EXPLORER work like this, but use of those are
reserved to differently able modders.
</LI><LI CLASS="li-itemize">Otherwise, commandToRun is executed by the underlying operating system
(and is thus system dependant). If you want to do something that
WeiDU doesn&#X2019;t handle, like extracting WAVs from an MP3, make a batch
file and run it from here. 
</LI></UL>
Slashes and backslashes will be converted appropriately for the
underlying operating system. If <CODE>EXACT</CODE> is specified, <CODE>/</CODE>
and <CODE>\</CODE> will instead be preserved as they are. The most common usage is:
<PRE CLASS="verbatim">AT_INTERACTIVE_EXIT ~VIEW mymod\README.txt~
</PRE>This causes your README file to be displayed using a system appropriate
viewer. Here&#X2019;s a more complicated example that pulls up a
language-specific README if one is available: 
<PRE CLASS="verbatim">ACTION_IF FILE_EXISTS ~mymod\README.%LANGUAGE%.txt~ THEN BEGIN
  AT_INTERACTIVE_EXIT ~VIEW mymod\README.%LANGUAGE%.txt~
END ELSE BEGIN
  AT_INTERACTIVE_EXIT ~VIEW mymod\README.txt~
END
</PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>AT_INTERACTIVE_EXIT</TT></B><A NAME="AT_INTERACTIVE_EXIT"></A><A NAME="@default248"></A> commandToRun <FONT COLOR="red"> [ </FONT><TT>EXACT</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#AT_EXIT">AT_EXIT</A></TT>, but the command is only executed if the user
specifically asked for the <TT><A HREF="#component">component</A></TT> to be installed or
upgraded.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>AT_UNINSTALL</TT></B><A NAME="AT_UNINSTALL"></A><A NAME="@default249"></A> commandToRun <FONT COLOR="red"> [ </FONT><TT>EXACT</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#AT_EXIT">AT_EXIT</A></TT>, but when this <TT><A HREF="#component">component</A></TT> is removed,
commandToRun is executed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>AT_INTERACTIVE_UNINSTALL</TT></B><A NAME="AT_INTERACTIVE_UNINSTALL"></A><A NAME="@default250"></A> commandToRun <FONT COLOR="red"> [ </FONT><TT>EXACT</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#AT_EXIT">AT_EXIT</A></TT>, but whenever the user specifically asks for this
<TT><A HREF="#component">component</A></TT> to be removed, commandToRun is executed.
Only the <TT>%LANGUAGE%</TT> variable is guaranteed to be
replaced, so do not count on any others.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>AT_UNINSTALL_EXIT</TT></B><A NAME="AT_UNINSTALL_EXIT"></A><A NAME="@default251"></A> commandToRun <FONT COLOR="red"> [ </FONT><TT>EXACT</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#AT_UNINSTALL">AT_UNINSTALL</A></TT>, but executed at the end of the WeiDU run (after
	printing &#X2019;SUCCESFULLY INSTALLED xyz&#X2019;).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>AT_INTERACTIVE_UNINSTALL_EXIT</TT></B><A NAME="AT_INTERACTIVE_UNINSTALL_EXIT"></A><A NAME="@default252"></A> commandToRun <FONT COLOR="red"> [ </FONT><TT>EXACT</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#AT_UNINSTALL_EXIT">AT_UNINSTALL_EXIT</A></TT>, but only whenever the user specifically asks for this
<TT><A HREF="#component">component</A></TT> to be removed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>AT_NOW</TT></B><A NAME="AT_NOW"></A><A NAME="@default253"></A> commandToRun <FONT COLOR="red"> [ </FONT><TT>EXACT</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#AT_EXIT">AT_EXIT</A></TT>, but commandToRun is executed when found, rather than
at the end of the installation. Use with oggdec, tisunpack, wav2acm...
but not with readmes (you&#X2019;ll create dozens of windows), nor with --make-biff
(you&#X2019;ll crash the installation).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>AT_INTERACTIVE_NOW</TT></B><A NAME="AT_INTERACTIVE_NOW"></A><A NAME="@default254"></A> commandToRun <FONT COLOR="red"> [ </FONT><TT>EXACT</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#AT_NOW">AT_NOW</A></TT>, but commandToRun is executed only if the installation is
run interactively.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>MAKE_BIFF</TT></B><A NAME="MAKE_BIFF"></A><A NAME="@default255"></A> name-of-biff <TT>BEGIN</TT> <TT><A HREF="#directory-file-regexp">directory-file-regexp</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Create a biff <TT>Data/name-of-biff.bif</TT> from the files that can be matched by
directory-file-regexp. The chitin.key file is restored as a normal file, and 
reloaded whenever the component is installed or uninstalled (which means that its 
contents will be available exactly when the biff exists), while the .bif file
itself is deleted or on uninstall as usual.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>LOAD_TRA</TT></B><A NAME="LOAD_TRA"></A><A NAME="@default256"></A> traName <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Loads all traName files (variable substitution is done, the file cannot be inlined)
to be used in the following tp2 actions, as if you had declared them in <TT><A HREF="#LANGUAGE">LANGUAGE</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>UNINSTALL</TT></B><A NAME="UNINSTALL"></A><A NAME="@default257"></A> modToUninstall modComponent</TD><TD VALIGN=top ALIGN=left> If the given component of the given mod is currently installed,
uninstall it before proceeding. <EM>Do not use this action without
	a real reason.</EM> This
should only be used if you release a new version of a component under a
new name. For example, many Tactics Mod components replace old
Solaufein mod components. In order to prevent such a component from
being installed twice, the Tactics version uninstalls the Solaufein
version.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>COPY_KIT</TT></B><A NAME="COPY_KIT"></A><A NAME="@default258"></A> oldKit newKit <CODE>(</CODE> diffName diffValue <FONT COLOR="red"> list </FONT><CODE>)</CODE></TD><TD VALIGN=top ALIGN=left> Copies a copy of the oldKit kit called newKit. This copy is non-player
selectable, while all other fields can be edited by setting diffName to
the field to be changed and diffValue to the new value. Valid values for
diffName are:
<PRE CLASS="verbatim">clasweap
weapprof
abclasrq
abclsmod
abdcdsrq
abdcscrq
dualclas
alignmnt
clab
lower
mixed
help
luabbr
25stweap
unusabilities
    </PRE>Currently, lower, mixed and help can only be numbers referring to a TLK
string. Unusabilities requires to be both kit and class unusables, there
isn&#X2019;t a way to BAND or BOR them.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_KIT</TT></B><A NAME="ADD_KIT"></A><A NAME="@default259"></A> internalKitName manyComplexArguments</TD><TD VALIGN=top ALIGN=left> This command allows you to add new kits to the BGII. 
See the example file <TT>mymod.tp2</TT> or the tutorial at
<TT><A HREF="http://forums.gibberlings3.net/index.php?showtopic=584">http://forums.gibberlings3.net/index.php?showtopic=584</A></TT>
for information on how to do this.
	
	The game cannot handle more than 255 kits installed (if you try to
	check <CODE>Kit(Somebody,kit256)</CODE> or <CODE>AddKit(kit256)</CODE>, the game
	crashes to desktop). As such, WeiDU will currently refuse to install a
	256th kit. This limitation will be removed if/when EXE patches will be made
	to remove this engine limitation.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_MUSIC</TT></B><A NAME="ADD_MUSIC"></A><A NAME="@default260"></A> internalMusicName newMUSFile</TD><TD VALIGN=top ALIGN=left> No documentation yet!</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_SCHOOL</TT></B><A NAME="ADD_SCHOOL"></A><A NAME="@default261"></A> schoolName removalString</TD><TD VALIGN=top ALIGN=left>	Creates a new (guaranteed-unique) spell school (as per mschool.2da),
	associate removalString (can be a tra reference) to its removal,
	and sets the schoolName variable to the school identifier.
	
	
	
	If mschool.2da already contains schoolName, the variable is set to
	the school&#X2019;s current identifier and no other operation is performed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_SECTYPE</TT></B><A NAME="ADD_SECTYPE"></A><A NAME="@default262"></A> sectypeName removalString</TD><TD VALIGN=top ALIGN=left>	Creates a new (guaranteed-unique) spell secondary type
	(as per msectype.2da), associate removalString (can be a tra reference)
	to its removal, and sets the sectypeName variable to the sectype
	identifier.
	
	
	
	If msectype.2da already contains sectypeName, the variable is set to
	the sectype&#X2019;s current identifier and no other operation is performed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_AREA_TYPE</TT></B><A NAME="ADD_AREA_TYPE"></A><A NAME="@default263"></A> areaTypeName</TD><TD VALIGN=top ALIGN=left>	Adds a new (guaranteed-unique) area type to areatype.ids, and sets
the areaTypeName variable to the index of the bit the type is associated
with: the type can be set with 
<CODE>WRITE_SHORT 0x48 THIS | (1 &lt;&lt; areaTypeName)</CODE>.
	
	
	
	If areatype.ids already contains areaTypeName, the variable is set to
	the type&#X2019;s current identifier and no other operation is performed.<P>Also note that only 8 area types can be added to an unmodded installation
of BG2; as such, don&#X2019;t add a new area type type unless you really need it
(most likely, another modder is already using a type with a similar name,
and you can share the type between your mods without issue).</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> 
or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_PROJECTILE</TT></B><A NAME="ADD_PROJECTILE"></A><A NAME="@default264"></A> modpath/PROName.PRO</TD><TD VALIGN=top ALIGN=left> Appends an entry for PROName to <TT>PROJECTL.IDS</TT> and assigns it the next
available ProRef number. Then copies the file <TT>modpath/PROName.PRO</TT>
to the <TT>override</TT> folder. The new ProRef number can be accessed
through the variable <TT>%PROName%</TT> and used to updated the
<TT>Projectile type</TT> field of an ITM or SPL file&#X2019;s <TT>Item Ability</TT> or
<TT>Spell Ability</TT> sub-structures. (The hexadecimal offsets for these
fields can be found using NearInfinity.) In the following example, a
new PRO file and an ITM file that will use it are added to the game:
<PRE CLASS="verbatim">        ADD_PROJECTILE      ~MyMod/MYDXP.PRO~
        COPY ~MyMod/MYDART.ITM~ ~override/MYDART.ITM~
            WRITE_SHORT   0x09c ~%MYDXP%~
    </PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_SPELL</TT></B><A NAME="ADD_SPELL"></A><A NAME="@default265"></A> newSPLfile type level idsName <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list  [ </FONT>IF_EXISTING <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT>END <FONT COLOR="red"> ] 		 [ </FONT>ON_DISABLE <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT>END <FONT COLOR="red"> ] </FONT>	</TD><TD VALIGN=top ALIGN=left> adds newSPLfile as a spell of type and level into the game (IE, SPPR102 or
whatnot), in the first empty slot possible, appends the idsName to
spell.ids, and sets <CODE>%idsName%</CODE>
to the 4-digit code associated with idsName in Spell.ids. While you copy
newSPLfile to the override, you also apply the patches listed.<P>	
	
	If Spell.ids already contains a spell named idsName, of the same type and
	level than the one you&#X2019;re adding, then that spell is overwritten (rather
	than adding a duplicate version). If you have the <CODE>IF_EXISTING</CODE>
	section, its patches are applied to the current version instead.</P><P>	
	If Spell.ids already contains a spell named idsName, but of of different
	type and/or level than the one you&#X2019;re adding, then the current reference
	is removed from spell.ids, and then the action proceeds as usual. In this
	case, if there is the <CODE>ON_DISABLE</CODE> section, the patches declared
	there will be applied to the older spell.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>STRING_SET</TT></B><A NAME="STRING_SET"></A><A NAME="@default266"></A> indexOrString newValue <FONT COLOR="red"> list  [ </FONT><TT>USING</TT> traFile <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> This command replaces each given string in the user&#X2019;s <TT><A HREF="#TLK">TLK</A></TT> file
with the associated newValue. If a
traFile is given, that file is is read once before all of the
replacements take place and its contents are forgotten after.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>STRING_SET_EVALUATE</TT></B><A NAME="STRING_SET_EVALUATE"></A><A NAME="@default267"></A> <TT><A HREF="#value">value</A></TT> newValue <FONT COLOR="red"> list  [ </FONT><TT>USING</TT> traFile <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> This command replaces the string at index value in the user&#X2019;s <TT><A HREF="#TLK">TLK</A></TT> file
with the associated newValue. If a
traFile is given, that file is is read once before all of the
replacements take place and its contents are forgotten after.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>STRING_SET_RANGE</TT></B><A NAME="STRING_SET_RANGE"></A><A NAME="@default268"></A> #min #max <TT>USING</TT> traFile</TD><TD VALIGN=top ALIGN=left> For every integer i between min and max (inclusive) we do
<TT>STRING_SET i @i USING traFile</TT> (except that this command should be
executed more rapidly). The command will fail if @i is not defined
(either by traFile or by some other tra file in scope) for some i
between min and max.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
	or</TD><TD VALIGN=top ALIGN=left><B><TT>ALTER_TLK_RANGE</TT></B><A NAME="ALTER_TLK_RANGE"></A><A NAME="@default269"></A> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#value">value</A></TT> <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left>		Executes the given patch list on all the strings *currently* in dialog.tlk between the
		two given values (both inclusive).
		This means that strings added in the current mod installation will not
		be patched, and strings already altered via <TT><A HREF="#ALTER_TLK">ALTER_TLK</A></TT>* and/or <TT><A HREF="#STRING_SET">STRING_SET</A></TT>*
		will be patched from the pre-patch condition.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ALTER_TLK_LIST</TT></B><A NAME="ALTER_TLK_LIST"></A><A NAME="@default270"></A> <TT>BEGIN</TT> <TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT> <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left>		Executes the given patch list on all the strings *currently* in dialog.tlk from the given list.
		This means that strings added in the current mod installation will not
		be patched, and strings already altered via <TT><A HREF="#ALTER_TLK">ALTER_TLK</A></TT>* and/or <TT><A HREF="#STRING_SET">STRING_SET</A></TT>*
		will be patched from the pre-patch condition.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
	or</TD><TD VALIGN=top ALIGN=left><B><TT>ALTER_TLK</TT></B><A NAME="ALTER_TLK"></A><A NAME="@default271"></A> <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left>		Executes the given patch list on all the strings *currently* in dialog.tlk.
		This means that strings added in the current mod installation will not
		be patched, and strings already altered via <TT><A HREF="#ALTER_TLK">ALTER_TLK</A></TT>* and/or <TT><A HREF="#STRING_SET">STRING_SET</A></TT>*
		will be patched from the pre-patch condition. Consider using
		<TT><A HREF="#ALTER_TLK_RANGE">ALTER_TLK_RANGE</A></TT> with the base game&#X2019;s boundaries instead.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REQUIRE_FILE</TT></B><A NAME="REQUIRE_FILE"></A><A NAME="@default272"></A> filename warningString</TD><TD VALIGN=top ALIGN=left> If filename does not exist (or the bif file is not referenced inside
the chitin.key), warningString is displayed and this
<TT><A HREF="#component">component</A></TT> cannot be installed. This is checked before any
actions are executed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>FORBID_FILE</TT></B><A NAME="FORBID_FILE"></A><A NAME="@default273"></A> filename warningString</TD><TD VALIGN=top ALIGN=left> If filename does exist (or the bif file is referenced inside
the chitin.key), warningString is displayed and this
<TT><A HREF="#component">component</A></TT> cannot be installed. This is checked before any
actions are executed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>FAIL</TT></B><A NAME="FAIL"></A><A NAME="@default274"></A> warningString</TD><TD VALIGN=top ALIGN=left> If this <TT><A HREF="#TP2 Action">TP2 Action</A></TT> is executed, warningString is displayed and
the <TT><A HREF="#component">component</A></TT> fails to install.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>WARN</TT></B><A NAME="WARN"></A><A NAME="@default275"></A> displayString</TD><TD VALIGN=top ALIGN=left> The string DisplayString is echoed to the user. Useful for debugging or
status reports. If displayString contains <TT>%<A HREF="#variable">variable</A>%</TT>
references, their values will be displayed. Additionally, INSTALLED WITH
WARNINGS is printed at the end of the install.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>PRINT</TT></B><A NAME="PRINT"></A><A NAME="@default276"></A> displayString</TD><TD VALIGN=top ALIGN=left> The string DisplayString is echoed to the user. Useful for debugging or
status reports. If displayString contains <TT>%<A HREF="#variable">variable</A>%</TT>
references, their values will be displayed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>LOG</TT></B><A NAME="LOG"></A><A NAME="@default277"></A> displayString</TD><TD VALIGN=top ALIGN=left> The string DisplayString is echoed to setup-mymod.debug.
If displayString contains <TT>%<A HREF="#variable">variable</A>%</TT>
references, their values will be displayed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>OUTER_TEXT_SPRINT</TT></B><A NAME="OUTER_TEXT_SPRINT"></A><A NAME="@default278"></A> <TT><A HREF="#variable">variable</A></TT> stringWithVars</TD><TD VALIGN=top ALIGN=left> Any WeiDU variables (enclosed in <TT>%</TT>s) inside stringWithVars are
replaced by their values and the resulting string (constructed at
mod-installation time!) is assigned to the variable <TT>variable</TT>. 
This works somewhat like <TT>sprintf()</TT> but it not as cool.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>OUTER_SPRINT</TT></B><A NAME="OUTER_SPRINT"></A><A NAME="@default279"></A> <TT><A HREF="#variable">variable</A></TT> stringWithVars</TD><TD VALIGN=top ALIGN=left> Like OUTER_TEXT_SPRINT, but stringWithVars can be an @reference, and will
break --traify. Use OUTER_TEXT_SPRINT instead.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>OUTER_SET</TT></B><A NAME="OUTER_SET"></A><A NAME="@default280"></A> <TT><A HREF="#variable">variable</A></TT> <TT>=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Update <TT><A HREF="#variable">variable</A></TT> so that it is equal to <TT><A HREF="#value">value</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#OUTER_SET">OUTER_SET</A></TT> <TT><A HREF="#variable">variable</A></TT> <TT>+=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>OUTER_SET variable = variable + value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#OUTER_SET">OUTER_SET</A></TT> <TT><A HREF="#variable">variable</A></TT> <TT>-=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>OUTER_SET variable = variable - value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#OUTER_SET">OUTER_SET</A></TT> <TT><A HREF="#variable">variable</A></TT> <TT>*=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>OUTER_SET variable = variable * value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#OUTER_SET">OUTER_SET</A></TT> <TT><A HREF="#variable">variable</A></TT> <TT>/=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>OUTER_SET variable = variable / value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#OUTER_SET">OUTER_SET</A></TT> <TT><A HREF="#variable">variable</A></TT> <TT>&amp;=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>OUTER_SET variable = variable BAND value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#OUTER_SET">OUTER_SET</A></TT> <TT><A HREF="#variable">variable</A></TT> <TT>|=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>OUTER_SET variable = variable BOR value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#OUTER_SET">OUTER_SET</A></TT> <TT><A HREF="#variable">variable</A></TT> <TT>&lt;&lt;=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>OUTER_SET variable = variable BLSL value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#OUTER_SET">OUTER_SET</A></TT> <TT><A HREF="#variable">variable</A></TT> <TT>&gt;&gt;=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>OUTER_SET variable = variable BLSR value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>OUTER_INNER_PATCH</TT></B><A NAME="OUTER_INNER_PATCH"></A><A NAME="@default281"></A> buffString <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Any WeiDU variables inside <TT>%</TT>s within buffString are replaced by
their values. All of the <TT><A HREF="#patch">patch</A></TT>es given are evaluated as if the
contents of the current file were buffString. Any modifications to
buffString are thrown away. This is considered an action, not a patch.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>OUTER_PATCH</TT></B><A NAME="OUTER_PATCH"></A><A NAME="@default282"></A> buffString <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Equal to <TT><A HREF="#OUTER_INNER_PATCH">OUTER_INNER_PATCH</A></TT>, if you feel that OUTER_INNER sounds wrong.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>OUTER_INNER_PATCH_SAVE</TT></B><A NAME="OUTER_INNER_PATCH_SAVE"></A><A NAME="@default283"></A> savevar buffString <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> As with <TT><A HREF="#OUTER_INNER_PATCH">OUTER_INNER_PATCH</A></TT>, except that any modifications to buffString are stored inside
savevar.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>OUTER_PATCH_SAVE</TT></B><A NAME="OUTER_PATCH_SAVE"></A><A NAME="@default284"></A> savevar buffString <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Equal to <TT><A HREF="#OUTER_INNER_PATCH_SAVE">OUTER_INNER_PATCH_SAVE</A></TT>, if you feel that OUTER_INNER sounds wrong.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>OUTER_WHILE</TT></B><A NAME="OUTER_WHILE"></A><A NAME="@default285"></A> <TT><A HREF="#value">value</A></TT> <TT>BEGIN</TT> 
<TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> If <TT><A HREF="#value">value</A></TT> is non-zero, execute the given <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT>and
then repeat, re-evaluating the <TT><A HREF="#value">value</A></TT>. 
<EM>Be very careful when using this command. </EM> You can easily describe
an infinite loop. See the <TT><A HREF="#WHILE">WHILE</A></TT> loop tutorial for more
information.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>OUTER_FOR</TT></B><A NAME="OUTER_FOR"></A><A NAME="@default286"></A> <TT>(</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>;</TT>
<TT><A HREF="#value">value</A></TT> <TT>;</TT>
<TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>)</TT>
<TT>BEGIN</TT> <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> The <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <TT>OUTER_FOR (init;pred;inc) BEGIN body END</TT> is equivalent to
<TT>init WHILE pred BEGIN INNER_ACTION BEGIN body END inc END</TT>, except that
it&#X2019;s considered an action. Note that the predicate <TT><A HREF="#value">value</A></TT> cannot be empty.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_BASH_FOR</TT></B><A NAME="ACTION_BASH_FOR"></A><A NAME="@default287"></A> <TT><A HREF="#directory-file-regexp">directory-file-regexp</A></TT> <TT>BEGIN</TT> <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> for all files that match <TT><A HREF="#directory-file-regexp">directory-file-regexp</A></TT>, sets a bunch of variables
and executes the actions for each file found. Assuming the file being copied
is somedir/yourfile.cre, the following variables will be set:
<PRE CLASS="verbatim">"%BASH_FOR_DIRECTORY%" = "somedir"
"%BASH_FOR_FILESPEC%" = "somedir/yourfile.cre"
"%BASH_FOR_FILE%" = "yourfile.cre"
"%BASH_FOR_RES%" = "yourfile"
"%BASH_FOR_EXT%" = "cre"
"%BASH_FOR_SIZE%" = &lt;size of somedir/yourfile.cre&gt;
</PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_DEFINE_ARRAY</TT></B><A NAME="ACTION_DEFINE_ARRAY"></A><A NAME="@default288"></A> <TT><A HREF="#String">String</A>1 BEGIN <A HREF="#String">String</A>2</TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left>	Sets the array <CODE>$string1(0)</CODE>,<CODE>$string1(1)</CODE> etc. to the various elements in string2.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>GET_FILE_ARRAY</TT></B><A NAME="GET_FILE_ARRAY"></A><A NAME="@default289"></A> <TT><A HREF="#String">String</A></TT> path <TT><A HREF="#regexp">regexp</A></TT></TD><TD VALIGN=top ALIGN=left> The array <CODE>$string(0)</CODE>, <CODE>$string{1}</CODE> etc is set to the file names, including path, that match regexp in path. The path is relative to the installation directory (e.g. save/000000000-Auto-Save).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>GET_DIRECTORY_ARRAY</TT></B><A NAME="GET_DIRECTORY_ARRAY"></A><A NAME="@default290"></A> <TT><A HREF="#String">String</A></TT> path <TT><A HREF="#regexp">regexp</A></TT></TD><TD VALIGN=top ALIGN=left> Like <TT><A HREF="#GET_FILE_ARRAY">GET_FILE_ARRAY</A></TT> except regexp is matched against directories instead of files.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_DEFINE_ASSOCIATIVE_ARRAY</TT></B><A NAME="ACTION_DEFINE_ASSOCIATIVE_ARRAY"></A><A NAME="@default291"></A> <TT><A HREF="#String">String</A> BEGIN key1 <FONT COLOR="red"> [ </FONT>, key2 ... <FONT COLOR="red"> ] </FONT>=&gt; result1</TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Sets the array <CODE>$string</CODE>, indexed by the keys, to the corresponding results. The results can either be <TT><A HREF="#String">String</A></TT>s or <TT><A HREF="#value">value</A></TT>s.
Example:
<PRE CLASS="verbatim">ACTION_DEFINE_ASSOCIATIVE_ARRAY mix_with_blue BEGIN
  red =&gt; purple
  yellow =&gt; green
END
  </PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_FOR_EACH</TT></B><A NAME="ACTION_FOR_EACH"></A><A NAME="@default292"></A> <TT><A HREF="#String">String</A>1 IN <A HREF="#String">String</A></TT> <FONT COLOR="red"> list </FONT><TT>BEGIN</TT> <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> will set the string1 variable to each value in string list and process each action.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_PHP_EACH</TT></B><A NAME="ACTION_PHP_EACH"></A><A NAME="@default293"></A> <TT><A HREF="#String">String</A>1 AS <A HREF="#String">String</A>2 =&gt; <A HREF="#String">String</A>3</TT> <FONT COLOR="red"> list </FONT><TT>BEGIN</TT> <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> For every value of the string1 array that has been created or read, sets
<CODE>string2_0</CODE> to the first array parameter, <CODE>string2_1</CODE> to the second array
parameter, etc. and string3 to the result of the array. <CODE>string2</CODE> will also contain
		the first array parameter (as a synonym of <CODE>string2_0</CODE>). then executes the
actions listed. More exhaustive documentation will be provided by SConrad.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INCLUDE</TT></B><A NAME="INCLUDE"></A><A NAME="@default294"></A> <TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> loads the file string as if it were a list of tp2 actions and executes it (as if
		it had been typed inside your tp2).
These files have by convenience tph as an extension, due to no reason other than
randomness (you can use .tp1 or .xyzsucks if you&#X2019;re so oriented).
		Please note that, to speed up inclusions, tph files are stored in memory,
	 rather than re-read each time from the hard-disk. If you need automorphing code
		(IE, you want to edit your tph file), you can use <TT><A HREF="#REINCLUDE">REINCLUDE</A></TT> instead.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_INCLUDE</TT></B><A NAME="ACTION_INCLUDE"></A><A NAME="@default295"></A> <TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> A synonym of <TT><A HREF="#INCLUDE">INCLUDE</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REINCLUDE</TT></B><A NAME="REINCLUDE"></A><A NAME="@default296"></A> <TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Works like <TT><A HREF="#INCLUDE">INCLUDE</A></TT>, but loads each time the tph file from the hard disk.
This is slower, but required if you want to edit your tph file between an
inclusion and another.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_REINCLUDE</TT></B><A NAME="ACTION_REINCLUDE"></A><A NAME="@default297"></A> <TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> A synonym of <TT><A HREF="#INCLUDE">INCLUDE</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><TT>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</TT> fileName fileBody <TT>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</TT></TD><TD VALIGN=top ALIGN=left> (That&#X2019;s eight (8) angle brackets on each side.)
For the purposes of copying and compiling files, WeiDU will pretend
that fileName is a real file with contents fileBody. This allows you to
define <B><TT>inlined</TT></B><A NAME="inlined"></A><A NAME="@default298"></A> files inside your TP2 file. Such definitions
must be executed before the <TT><A HREF="#inlined">inlined</A></TT> file is used. Other operations
on fileName (such as <TT><A HREF="#FILE_EXISTS">FILE_EXISTS</A></TT>, <TT><A HREF="#FILE_MD5">FILE_MD5</A></TT> or
<TT><A HREF="#FILE_SIZE">FILE_SIZE</A></TT>) are undefined. Inlined files will be skipped by
<TT><A HREF="#COPY_EXISTING_REGEXP">COPY_EXISTING_REGEXP</A></TT> and other &#X201C;wildcard&#X201D; approaches: you
must name them directly. Unlike most other WeiDU things,
spacing matters here. After the initial <TT>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</TT> there can be
any number of spaces. The first non-space character after the
<TT>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</TT> is the first character of fileName. All other
characters up to and excluding the newline on that line are part of
fileName (and thus fileName cannot start with a space or contain a
newline). All user variables (e.g., <TT>%foo%</TT>) in fileName will be
replaced by their values.
The fileBody contains all characters after that newline up to
and excluding the <TT>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</TT>. Note that a single inlined filename
namespace is shared by WeiDU for all <TT><A HREF="#TP2">TP2</A></TT> files it reads (it
might read other <TT><A HREF="#TP2">TP2</A></TT> files in the process of installing yours
in order to uninstall or reinstall another mod&#X2019;s components), so it is
<EM>critically</EM> important that you use some sort of unique prefix.
I also suggest that you avoid using your mod&#X2019;s actual directory
structure (if any) in order to avoid confusion with real files.
Consider using <TT>.../yourmod-inlined/fileName</TT>. Here is a concrete
working example:
<PRE CLASS="verbatim">BEGIN ~MyMod Component 1~

&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; .../mymod-inlined/myfile.baf
IF
  True()
THEN
  RESPONSE #100
    Kill("Anomen")
END
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

COMPILE ~.../mymod-inlined/myfile.baf~
</PRE>This inclusion method is eight-bit clean, so if you are very careful you
can <TT><A HREF="#inline">inline</A></TT> a binary file (e.g., a <TT><A HREF="#CRE">CRE</A></TT> or <TT><A HREF="#BAM">BAM</A></TT>) with
this method. Be careful to shave off the newline before the <TT>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</TT>
in such cases. Finally, note that <TT><A HREF="#inline">inline</A></TT>d files have the same
maximum size as other (non-BIFF) WeiDU files and strings (usually about
16 megs).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_TO_UPPER</TT></B><A NAME="ACTION_TO_UPPER"></A><A NAME="@default299"></A> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> Turns to upper-case the contents of <CODE>%variable%</CODE> and store the
results in variable.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_TO_LOWER</TT></B><A NAME="ACTION_TO_LOWER"></A><A NAME="@default300"></A> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> Turns to lower-case the contents of <CODE>%variable%</CODE> and store the
results in variable.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>ACTION_GET_STRREF</TT></B><A NAME="ACTION_GET_STRREF"></A><A NAME="@default301"></A> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> The string reference value is looked up in <TT>DIALOG.TLK</TT> and the (male) string
(without any quotes) is stored in the <TT><A HREF="#variable">variable</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>optNoBackup</TT></B><A NAME="optNoBackup"></A><A NAME="@default302"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left> A <TT><A HREF="#COPY">COPY</A></TT> command normally makes a backup copy of its target (if one
exists) so that the mod can be uninstalled later by restoring the backup.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
is</TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>If you don&#X2019;t say anything here, WeiDU <EM>will</EM> make a backup
copy of the file and the <TT><A HREF="#COPY">COPY</A></TT> will be undone if the mod
is uninstalled.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><TT>+</TT></TD><TD VALIGN=top ALIGN=left>If you put a <TT>+</TT> here, WeiDU will <EM>not</EM> make a backup
copy of the file and the <TT><A HREF="#COPY">COPY</A></TT> will <EM>not</EM> be
undone if the mod is uninstalled. <EM>Do not use this feature without
			a real reason.</EM></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><TT>-</TT></TD><TD VALIGN=top ALIGN=left>If you put a <TT>-</TT> here, WeiDU will <EM>not</EM> copy the file,
but only store it as an inlined file (so you can patch a file and
then use it for <TT><A HREF="#EXTEND_BOTTOM">EXTEND_BOTTOM</A></TT> or whatever.
This option is not available for <TT><A HREF="#COPY_LARGE">COPY_LARGE</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>directory-file-regexp</TT></B><A NAME="directory-file-regexp"></A><A NAME="@default303"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>This is a directory path and a <TT><A HREF="#regexp">regexp</A></TT> string.
It&#X2019;s used by <TT><A HREF="#MAKE_BIFF">MAKE_BIFF</A></TT>, <TT><A HREF="#ACTION_BASH_FOR">ACTION_BASH_FOR</A></TT> and <TT><A HREF="#PATCH_BASH_FOR">PATCH_BASH_FOR</A></TT>
for listing patterns to be matched. Please note that
the directory / filename distinction must be enforced.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left>directory <TT><A HREF="#regexp">regexp</A></TT></TD><TD VALIGN=top ALIGN=left>get a list of all files in directory that match <TT><A HREF="#regexp">regexp</A></TT>.
Case doesn&#X2019;t matter.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left>directory <TT>EVALUATE_REGEXP</TT> <TT><A HREF="#regexp">regexp</A></TT></TD><TD VALIGN=top ALIGN=left>get a list of all files in directory that match <TT><A HREF="#regexp">regexp</A></TT>.
Case doesn&#X2019;t matter. This is the same as the above item.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left>directory <TT>EXACT_MATCH</TT> name</TD><TD VALIGN=top ALIGN=left>get the file directory/name. Please note that
the directory / filename distinction must be enforced.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP><B><TT>optGlob</TT></B><A NAME="optGlob"></A><A NAME="@default304"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left> A <TT><A HREF="#COPY">COPY</A></TT> command may use <EM>globbing</EM> to expand filename 
wildcards with respect to files <EM>on the host filesystem</EM>. Unlike
<TT><A HREF="#COPY_EXISTING_REGEXP">COPY_EXISTING_REGEXP</A></TT>, glob wildcards do not range over game
resources. Instead, they range over physical files actually on the disk.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> is</TD><TD VALIGN=top ALIGN=left><B><TT>GLOB</TT></B><A NAME="GLOB"></A><A NAME="@default305"></A></TD><TD VALIGN=top ALIGN=left>Use local filesystem globbing. Globbing is
generally architecture specific!<P>Here is a concrete example. Imagine that <TT>CHITIN.KEY</TT> contains 
two files: C1.ITM and C2.ITM. The <TT>override</TT> contains C2.ITM and
C_MOD.ITM.
</P><PRE CLASS="verbatim">  COPY_EXISTING_REGEXP "C.*.ITM" "override" 
    // catches C1.ITM, C2.ITM

  COPY_EXISTING_REGEXP GLOB "C.*.ITM" "override" 
    // catches C1.ITM, C2.ITM, C_MOD.ITM

  COPY "override" "override" 
    // catches C2.ITM, C_MOD.ITM
  </PRE><P>To put it another way: if you do not specify <TT><A HREF="#GLOB">GLOB</A></TT> with
<TT><A HREF="#COPY_EXISTING">COPY_EXISTING</A></TT>, WeiDU pretends that the <TT>override</TT> directory
contains 0 files that are not in <TT>CHITIN.KEY</TT>. Finally, GLOB has no
effect on wildcards in the "destination" part of the <TT><A HREF="#COPY">COPY</A></TT>:
</P><PRE CLASS="verbatim">  COPY GLOB "mymod/foo" "music/*"  
    // this is illegal: DO NOT DO THIS
  </PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>NOGLOB</TT></B><A NAME="NOGLOB"></A><A NAME="@default306"></A></TD><TD VALIGN=top ALIGN=left>Never use local file system globbing.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>Use sane defaults: enable globbing with COPY_EXISTING_REGEXP, disable
it with COPY.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>optcase</TT></B><A NAME="optcase"></A><A NAME="@default307"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>Allows you to decide whether regexp matching is case-sensitive
or not.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>Uses the WeiDU default (which is undocumented and varies with the action).
Please specify case-sensitiveness manually.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>CASE_SENSITIVE</TT></B><A NAME="CASE_SENSITIVE"></A><A NAME="@default308"></A></TD><TD VALIGN=top ALIGN=left>matching is case-sensitive.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>CASE_INSENSITIVE</TT></B><A NAME="CASE_INSENSITIVE"></A><A NAME="@default309"></A></TD><TD VALIGN=top ALIGN=left>matching is case-insensitive.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>optexact</TT></B><A NAME="optexact"></A><A NAME="@default310"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>Allows you to decide whether regexp matching is exact.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>Uses the WeiDU default (which is undocumented and varies with the action).
Please specify matching policy manually.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>EXACT_MATCH</TT></B><A NAME="EXACT_MATCH"></A><A NAME="@default311"></A></TD><TD VALIGN=top ALIGN=left>only the given string is searched for.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>EVALUATE_REGEXP</TT></B><A NAME="EVALUATE_REGEXP"></A><A NAME="@default312"></A></TD><TD VALIGN=top ALIGN=left>matching is evaluated following the usual regexp
conventions.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>patch</TT></B><A NAME="patch"></A><A NAME="@default313"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>A <TT><A HREF="#patch">patch</A></TT> tells WeiDU how to modify a file.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><B><TT>SAY</TT></B><A NAME="@default314"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> The string-ref associated with <TT><A HREF="#String">String</A></TT> is written at
<TT><A HREF="#offset">offset</A></TT>. This is commonly used to change the name or
description of a spell or item.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_FAIL</TT></B><A NAME="PATCH_FAIL"></A><A NAME="@default315"></A> warningString</TD><TD VALIGN=top ALIGN=left> If this <TT><A HREF="#TP2 Action">TP2 Action</A></TT> is execution, warningString is displayed and
the <TT><A HREF="#component">component</A></TT> fails to install.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_WARN</TT></B><A NAME="PATCH_WARN"></A><A NAME="@default316"></A> displayString</TD><TD VALIGN=top ALIGN=left> The string DisplayString is echoed to the user. Useful for debugging or
status reports. If displayString contains <TT>%<A HREF="#variable">variable</A>%</TT>
references, their values will be displayed. Additionally, INSTALLED WITH
WARNINGS is printed at the end of the install.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_PRINT</TT></B><A NAME="PATCH_PRINT"></A><A NAME="@default317"></A> displayString</TD><TD VALIGN=top ALIGN=left> The string DisplayString is echoed to the user. Useful for debugging or
status reports. If displayString contains <TT>%<A HREF="#variable">variable</A>%</TT>
references, their values will be displayed. See also <TT><A HREF="#PRINT">PRINT</A></TT>.
Example: 
<PRE CLASS="verbatim">    COPY_EXISTING_REGEXP ~.*\.CRE~ ~override~
      READ_BYTE 0x272 race
      READ_BYTE 0x273 class
      PATCH_IF class = 3 THEN BEGIN
        PATCH_PRINT
          ~%SOURCE_FILE% is a cleric with race = %race%.~
      END 
  </PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_LOG</TT></B><A NAME="PATCH_LOG"></A><A NAME="@default318"></A> displayString</TD><TD VALIGN=top ALIGN=left> The string DisplayString is echoed to setup-mymod.debug.
If displayString contains <TT>%<A HREF="#variable">variable</A>%</TT>
references, their values will be displayed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SAY_EVALUATED</TT></B><A NAME="SAY_EVALUATED"></A><A NAME="@default319"></A> <TT><A HREF="#offset">offset</A></TT> stringWithVars</TD><TD VALIGN=top ALIGN=left> Any WeiDU variables (enclosed in <TT>%</TT>s) inside stringWithVars are
replaced by their values and the resulting string (constructed at
mod-installation time!) is added to <TT>DIALOG.TLK</TT> and its string
reference it written to the <TT><A HREF="#offset">offset</A></TT>. Example:
<PRE CLASS="verbatim">    COPY_EXISTING_REGEXP ~RING.*.ITM~ ~override~
      READ_LONG 0x38 cost 
      SAY_EVALUATED IDENTIFIED_DESC
        ~I Am %SOURCE_RES%, I Cost %cost%~
  </PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>TO_UPPER</TT></B><A NAME="TO_UPPER"></A><A NAME="@default320"></A> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> Turns to upper-case the contents of <CODE>%variable%</CODE> and store the
results in variable.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>TO_LOWER</TT></B><A NAME="TO_LOWER"></A><A NAME="@default321"></A> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> Turns to lower-case the contents of <CODE>%variable%</CODE> and store the
results in variable.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>TEXT_SPRINT</TT></B><A NAME="TEXT_SPRINT"></A><A NAME="@default322"></A> <TT><A HREF="#variable">variable</A></TT> stringWithVars</TD><TD VALIGN=top ALIGN=left> Any WeiDU variables (enclosed in <TT>%</TT>s) inside stringWithVars are
replaced by their values and the resulting string (constructed at
mod-installation time!) is assigned to the variable <TT>variable</TT>.
This works somewhat like <TT>sprintf()</TT> but it not as cool. Currently this
is the only way to assign a string value to a variable.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SPRINT</TT></B><A NAME="SPRINT"></A><A NAME="@default323"></A> <TT><A HREF="#variable">variable</A></TT> stringWithVars</TD><TD VALIGN=top ALIGN=left> Like TEXT_SPRINT, but stringWithVars can be an @reference, and will
break --traify. Use TEXT_SPRINT instead.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>SNPRINT</TT></B><A NAME="SNPRINT"></A><A NAME="@default324"></A> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#variable">variable</A></TT> stringWithVars</TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#SPRINT">SPRINT</A></TT>, but only the first <TT>N</TT> characters are stored in
the <TT><A HREF="#variable">variable</A></TT>, where <TT>N</TT> is the result of evaluating the
<TT><A HREF="#value">value</A></TT>. This works somewhat like <TT>snprintf()</TT>. Thus:
<PRE CLASS="verbatim">  SPRINT "author" "Jason"
  SNPRINT 3 "myvar" "1:%author%"
  </PRE>... assigns <TT>1:J</TT> to <TT>myvar</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SOURCE_BIFF</TT></B><A NAME="SOURCE_BIFF"></A><A NAME="@default325"></A> <TT><A HREF="#variable">variable</A></TT> filename</TD><TD VALIGN=top ALIGN=left> If filename is in a biff (whether it is also in the override or not), sets
variable to the name of the containing biff (the name is printed as E.G.
<CODE>data/items.bif</CODE>).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SPACES</TT></B><A NAME="SPACES"></A><A NAME="@default326"></A> <TT><A HREF="#variable">variable</A></TT> stringWithVars</TD><TD VALIGN=top ALIGN=left> <CODE>%variable%</CODE> will be inited to a string the same length as stringWithVars,
but made entirely of spaces. <CODE>SPACES var ~123~</CODE> will create <CODE>%var% = "   "</CODE>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>QUOTE</TT></B><A NAME="QUOTE"></A><A NAME="@default327"></A> <TT><A HREF="#variable">variable</A></TT> stringWithVars</TD><TD VALIGN=top ALIGN=left> <CODE>%variable%</CODE> will be inited to a string that will match exactly stringWithVars.
<CODE>QUOTE var ~some\thing^~</CODE> will create <CODE>%var% = "some\\thing\^"</CODE>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE</TT></B><A NAME="@default328"></A> <TT><A HREF="#optcase">optcase</A></TT> <TT><A HREF="#optexact">optexact</A></TT> <TT><A HREF="#regexp">regexp</A></TT> <TT><A HREF="#text">text</A></TT></TD><TD VALIGN=top ALIGN=left> All occurrences of <TT><A HREF="#regexp">regexp</A></TT> in the file are replaced with the ASCII
printing of the string reference for <TT><A HREF="#text">text</A></TT>. So if <TT><A HREF="#regexp">regexp</A></TT>
is "FRED" and the <TT><A HREF="#text">text</A></TT> ends up being strref #1234, "FRED" will
be replaced with "1234". This is usually used to replace string
references in <TT><A HREF="#BCS">BCS</A></TT> files (where they are stored textually). Put a
command like <TT>DisplayString(Myself,99999)</TT> in your <TT><A HREF="#BCS">BCS</A></TT> file
and use something like <TT>REPLACE 99999 "Hello, World"</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_TEXTUALLY</TT></B><A NAME="REPLACE_TEXTUALLY"></A><A NAME="@default329"></A> <TT><A HREF="#optcase">optcase</A></TT> <TT><A HREF="#optexact">optexact</A></TT>
<TT><A HREF="#regexp">regexp</A></TT> string <FONT COLOR="red"> [ </FONT><TT>(</TT> <TT>sizeValue</TT> <TT>)</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> All occurrences of the given <TT><A HREF="#regexp">regexp</A></TT> in the file are replaced with
the given string.
<TT><A HREF="#variable">variable</A></TT> 
substitution (e.g., kit and music names) is performed on both the 
string and the regexp. 
If you use the sizeValue field, optexact is automatically set to true (IE 
without regexp patterns). The regexp and the string are padded by zeros to 
be long exactly sizeValue bytes.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>EVALUATE_BUFFER_SPECIAL</TT></B><A NAME="EVALUATE_BUFFER_SPECIAL"></A><A NAME="@default330"></A> string</TD><TD VALIGN=top ALIGN=left> String must be one character long. Any WeiDU variables (like <TT>XmyvarX</TT>)
	inside the current file are replaced by their values, where X is to be intended
	as string. Example:
<PRE CLASS="verbatim">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; .../script.baf
IF
  See($myvar$)
THEN
  RESPONSE #100
    Kill(%myvar%)
END
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
EXTEND_TOP ~sola.bcs~ ~.../script.baf~
  SPRINT myvar = ~"Anomen"~
  EVALUATE_BUFFER_SPECIAL ~$~
</PRE>	<I><TT>myvar</TT></I> will be substituted with Anomen, but <TT>%myvar%</TT> will be not.
	
	Do not use this without a real reason.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>EVALUATE_BUFFER</TT></B><A NAME="EVALUATE_BUFFER"></A><A NAME="@default331"></A></TD><TD VALIGN=top ALIGN=left> Any WeiDU variables (like <TT>%myvar%</TT>) inside the current file (which
should probably be a plain text file in order for this to make much sense)
are replaced by their values. Example:
<PRE CLASS="verbatim">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; .../script.baf
IF
  See(%myvar%)
THEN
  RESPONSE #100
    Kill(%myvar%)
END
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
EXTEND_TOP ~sola.bcs~ ~.../script.baf~
  SPRINT myvar = ~"Anomen"~
  EVALUATE_BUFFER
</PRE>Those two actions extend the top of <TT>sola.bcs</TT> with the script
block <TT>IF See("Anomen") THEN RESPONSE #100 Kill("Anomen") END</TT>.
You can also use <TT><A HREF="#EVALUATE_BUFFER">EVALUATE_BUFFER</A></TT> in <TT><A HREF="#COMPILE">COMPILE</A></TT> actions
or before strings in <TT><A HREF="#value">value</A></TT>s.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>APPLY_BCS_PATCH</TT></B><A NAME="APPLY_BCS_PATCH"></A><A NAME="@default332"></A> patchFile</TD><TD VALIGN=top ALIGN=left> Applies patchFile to the current file. See <TT><A HREF="#--bcmp-from">--bcmp-from</A></TT> and similar
command-line arguments for constructing these patches.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>APPLY_BCS_PATCH_OR_COPY</TT></B><A NAME="APPLY_BCS_PATCH_OR_COPY"></A><A NAME="@default333"></A> patchFile copyFile</TD><TD VALIGN=top ALIGN=left> Applies patchFile to the current file, as <TT><A HREF="#APPLY_BCS_PATCH">APPLY_BCS_PATCH</A></TT>.
However, if the patching fails the current file is replaced with copyFile
instead.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>WRITE_BYTE</TT></B><A NAME="WRITE_BYTE"></A><A NAME="@default334"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> The first argument is the offset at which the second argument (an 8-bit
byte value) is written. Performs <CODE>READ_BYTE offset THIS</CODE> and
<CODE>READ_SBYTE offset STHIS</CODE> automatically (you can now write
<CODE>WRITE_BYTE 100 THIS </CODE> 2).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>WRITE_SHORT</TT></B><A NAME="WRITE_SHORT"></A><A NAME="@default335"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> The first argument is the offset at which the second argument (a 16-bit
short value) is written. Performs <CODE>READ_SHORT offset THIS</CODE> and
<CODE>READ_SSHORT offset STHIS</CODE> automatically.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>WRITE_LONG</TT></B><A NAME="WRITE_LONG"></A><A NAME="@default336"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> The first argument is the offset at which the second argument (a 32-bit
long word value) is written. Performs <CODE>READ_LONG offset THIS</CODE> and
<CODE>READ_SLONG offset STHIS</CODE> automatically.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>WRITE_ASCII</TT></B><A NAME="WRITE_ASCII"></A><A NAME="@default337"></A> <TT><A HREF="#offset">offset</A></TT> ascString
<FONT COLOR="red"> [ </FONT><TT>#requiredSize</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> The ASCII ascString is written to the file starting at offset. 
If you specify a <TT>requiredSize</TT> then exactly that many bytes are
written (if ascString is smaller, it is padded with <TT>NUL</TT>s; if
ascString is larger, it is truncated). If you do not specify a requiredSize,
the terminating <TT>NUL</TT> is not written.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>WRITE_ASCII_LIST</TT></B><A NAME="WRITE_ASCII_LIST"></A><A NAME="@default338"></A> <TT><A HREF="#offset">offset</A></TT> ascString <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> The given ASCII strings are written at offset, offset + 8, offset + 16...
Automatically evaluates variables.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>WRITE_ASCII_TERMINATE</TT></B><A NAME="WRITE_ASCII_TERMINATE"></A><A NAME="@default339"></A> <TT><A HREF="#offset">offset</A></TT> ascString</TD><TD VALIGN=top ALIGN=left> The ASCII ascString is written to the file starting at offset.
The terminating <TT>NUL</TT> <EM>is</EM> written. You may use 
<TT>WRITE_ASCIIT</TT> as a synonym.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>WRITE_EVALUATED_ASCII</TT></B><A NAME="WRITE_EVALUATED_ASCII"></A><A NAME="@default340"></A> <TT><A HREF="#offset">offset</A></TT> ascString
<FONT COLOR="red"> [ </FONT><TT>#requiredSize</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> The ASCII ascString is evaluated (so <TT>%variable%</TT> is replaced by its
value) and written to the file starting at offset (as in
<TT><A HREF="#WRITE_ASCII">WRITE_ASCII</A></TT>). You may use <TT>WRITE_ASCIIE</TT> as a synonym.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>WRITE_FILE</TT></B><A NAME="WRITE_FILE"></A><A NAME="@default341"></A> <TT><A HREF="#offset">offset</A></TT> filename</TD><TD VALIGN=top ALIGN=left> The entire contents of &#X201C;filename&#X201D; (which may contain variables) are
loaded and copied over the current file starting at offset
<TT><A HREF="#offset">offset</A></TT>. &#X201C;filename&#X201D; must be a literal filename like
<TT>mymod/data/file.bam</TT>. If there is not enough room between
<TT><A HREF="#offset">offset</A></TT> and the end of the file for the contents of &#X201C;filename&#X201D;
the <TT><A HREF="#patch">patch</A></TT> will fail with an error message.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>INSERT_FILE</TT></B><A NAME="INSERT_FILE"></A><A NAME="@default342"></A> <TT><A HREF="#offset">offset</A></TT> filename</TD><TD VALIGN=top ALIGN=left> Just like <TT><A HREF="#WRITE_FILE">WRITE_FILE</A></TT> except that the entire contents of
&#X201C;filename&#X201D; are inserted at <TT><A HREF="#offset">offset</A></TT>, just as if you had done an
<TT><A HREF="#INSERT_BYTES">INSERT_BYTES</A></TT> with the size of &#X201C;filename&#X201D; to that <TT><A HREF="#offset">offset</A></TT>
followed by a <TT><A HREF="#WRITE_FILE">WRITE_FILE</A></TT> to that <TT><A HREF="#offset">offset</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>APPEND_FILE</TT></B><A NAME="APPEND_FILE"></A><A NAME="@default343"></A> filename</TD><TD VALIGN=top ALIGN=left> Just like <TT><A HREF="#INSERT_FILE">INSERT_FILE</A></TT> except that the entire contents of
&#X201C;filename&#X201D; are appended to the end of the current file.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>APPEND_FILE_EVALUATE</TT></B><A NAME="APPEND_FILE_EVALUATE"></A><A NAME="@default344"></A> filename</TD><TD VALIGN=top ALIGN=left> Just like <TT><A HREF="#APPEND_FILE">APPEND_FILE</A></TT> except that <CODE>%variables%</CODE> in the contents of
&#X201C;filename&#X201D; are evaluated before the appending.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_BCS_BLOCK</TT></B><A NAME="REPLACE_BCS_BLOCK"></A><A NAME="@default345"></A> oldFile newFile <FONT COLOR="red"> [ </FONT>ON_MISMATCH <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT>END <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> If the current file is a <TT><A HREF="#BCS">BCS</A></TT> file, the segment of it
corresponding to oldFile is replaced with the contents of newFile. 
oldFile and newFile may be <TT><A HREF="#BCS">BCS</A></TT> or <TT><A HREF="#BAF">BAF</A></TT> files. If they
are <TT><A HREF="#BAF">BAF</A></TT> files they will not get the benefit of <TT><A HREF="#AUTO_TRA">AUTO_TRA</A></TT>.<P>If the segment corresponding to oldFile is not found and the ON_MISMATCH section
is present, those patches are run; if oldFile is not found and ON_MISMATCH is not
present, a warning message is printed.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>INSERT_BYTES</TT></B><A NAME="INSERT_BYTES"></A><A NAME="@default346"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> The first argument is the offset, the second argument is the count. 
The file will be expanded at the given offset with count bytes worth of
zeroes.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>DELETE_BYTES</TT></B><A NAME="DELETE_BYTES"></A><A NAME="@default347"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> The first argument is the offset, the second argument is the count. 
The file will shrink as count bytes are deleted starting at the given
offset.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_BYTE</TT></B><A NAME="READ_BYTE"></A><A NAME="@default348"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#variable">variable</A></TT> <FONT COLOR="red"> [ </FONT><TT>ELSE</TT>
<TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> An 8-bit value is read from the file at the given <TT><A HREF="#offset">offset</A></TT> and is stored
in the given <TT><A HREF="#variable">variable</A></TT>. If <TT><A HREF="#offset">offset</A></TT> is out-of-bounds and the
<TT>ELSE</TT> is present, the <TT>ELSE</TT>-<TT><A HREF="#value">value</A></TT> is assigned to
<TT><A HREF="#variable">variable</A></TT>. If <TT><A HREF="#offset">offset</A></TT> is out-of-bounds and the <TT>ELSE</TT> is
not present, the <TT><A HREF="#patch">patch</A></TT> fails with a visible error.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_SBYTE</TT></B><A NAME="READ_SBYTE"></A><A NAME="@default349"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#variable">variable</A></TT> <FONT COLOR="red"> [ </FONT><TT>ELSE</TT>
<TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#READ_BYTE">READ_BYTE</A></TT>, but the value is interpreted as signed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_SHORT</TT></B><A NAME="READ_SHORT"></A><A NAME="@default350"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#variable">variable</A></TT> <FONT COLOR="red"> [ </FONT><TT>ELSE</TT>
<TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> A 16-bit value is read from the file at the given <TT><A HREF="#offset">offset</A></TT> and is
stored in the given <TT><A HREF="#variable">variable</A></TT>. See <TT><A HREF="#READ_BYTE">READ_BYTE</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_SSHORT</TT></B><A NAME="READ_SSHORT"></A><A NAME="@default351"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#variable">variable</A></TT> <FONT COLOR="red"> [ </FONT><TT>ELSE</TT>
<TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#READ_SHORT">READ_SHORT</A></TT>, but the value is interpreted as signed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_LONG</TT></B><A NAME="READ_LONG"></A><A NAME="@default352"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#variable">variable</A></TT> <FONT COLOR="red"> [ </FONT><TT>ELSE</TT>
<TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> A signed 32-bit value is read from the file at the given <TT><A HREF="#offset">offset</A></TT>
and is stored in the given <TT><A HREF="#variable">variable</A></TT>. See <TT><A HREF="#READ_BYTE">READ_BYTE</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_SLONG</TT></B><A NAME="READ_SLONG"></A><A NAME="@default353"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#variable">variable</A></TT> <FONT COLOR="red"> [ </FONT><TT>ELSE</TT>
<TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> As <TT><A HREF="#READ_SLONG">READ_SLONG</A></TT>, but the value is interpreted as signed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_ASCII</TT></B><A NAME="READ_ASCII"></A><A NAME="@default354"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#variable">variable</A></TT> <FONT COLOR="red"> [ </FONT><TT>ELSE</TT>
<TT>string</TT> <FONT COLOR="red"> ]  [ </FONT><TT>(</TT> <TT><A HREF="#value">value</A></TT> <TT>)</TT> <FONT COLOR="red"> [ </FONT><TT>NULL</TT> <FONT COLOR="red"> ]  ] </FONT></TD><TD VALIGN=top ALIGN=left> A nul-terminated string is read from the file at
the given <TT><A HREF="#offset">offset</A></TT> and is stored in the given <TT><A HREF="#variable">variable</A></TT>.
The terminating nul is not stored. The default read size is 8 bytes.
If an explicit size <TT><A HREF="#value">value</A></TT> is specified then that many bytes are read
into the <TT><A HREF="#variable">variable</A></TT>, even if some of them are nuls, except if <TT>NULL</TT>
is present, in which case a nul-terminated string is read, without storing
the terminating null. See
<TT><A HREF="#READ_BYTE">READ_BYTE</A></TT>. If the <TT><A HREF="#offset">offset</A></TT> is out-of-bounds and the
<TT>ELSE</TT> clause is present, the <TT>string</TT> is evaluated as in
<TT>WRITE_EVALUATED_ASCII</TT> and then assigned into <TT><A HREF="#variable">variable</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_STRREF</TT></B><A NAME="READ_STRREF"></A><A NAME="@default355"></A> <TT><A HREF="#offset">offset</A></TT> <TT><A HREF="#variable">variable</A></TT> <FONT COLOR="red"> [ </FONT><TT>ELSE</TT>
<TT>string</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> A 32-bit Infinity Engine <TT>DIALOG.TLK</TT> string reference is read from the
file at the given <TT><A HREF="#offset">offset</A></TT>. The string reference is looked up in
<TT>DIALOG.TLK</TT> and the (male) string value for it (without any quotes) is
stored in the <TT><A HREF="#variable">variable</A></TT>. In some sense this is the opposite of
<TT><A HREF="#SAY_EVALUATED">SAY_EVALUATED</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>GET_OFFSET_ARRAY</TT></B><A NAME="GET_OFFSET_ARRAY"></A><A NAME="@default356"></A> <TT><A HREF="#String">String</A></TT> <TT>seven <A HREF="#value">value</A>s</TT></TD><TD VALIGN=top ALIGN=left> The seven values are:
<PRE CLASS="verbatim">1. Offset
2. Read length of "Offset"
3. Iterations
4. Read length of "Iterations"
5. Index
6. Read length of "Index"
7. Length between iterations.
</PRE><P>WeiDU comes with a number of pre-defined sets of values for GET_OFFSET_ARRAY. These sets are:
</P><PRE CLASS="verbatim">ITM_V10_HEADERS (0x64 4 0x68 2 0 0 0x38)
ITM_V10_GEN_EFFECTS (0x6a 4 0x70 2 0x6e 2 0x30)
WMP_AREAS (0x34 4 0x30 4 0 0 0xf0)
WMP_LINKS (0x38 4 0x3c 4 0 0 0xd8)
</PRE><P>GET_OFFSET_ARRAY performs "Iterations" number of reads and sets the array <CODE>$string(0)</CODE>, <CODE>$string(1)</CODE> etc to the result of these reads. A more detailed explanation can be had in the <TT><A HREF="#GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2">GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2</A></TT> tutorial.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>GET_OFFSET_ARRAY2</TT></B><A NAME="GET_OFFSET_ARRAY2"></A><A NAME="@default357"></A> <TT><A HREF="#String">String</A></TT> <TT>eight <A HREF="#value">value</A>s</TT></TD><TD VALIGN=top ALIGN=left> The eight values are:
<PRE CLASS="verbatim">1. Offset2
2. Offset
3. Read length of "Offset"
4. Iterations
5. Read length of "Iterations"
6. Index
7. Read length of "Index"
8. Length between iterations
</PRE><P>WeiDU comes with a pre-defined set of values for GET_OFFSET_ARRAY2. This set is:
</P><PRE CLASS="verbatim">ITM_V10_HEAD_EFFECTS (0x6a 4 0x1e 2 0x20 2 0x30)
</PRE><P>As you can see, the value for Offset2 isn&#X2019;t included in the set, since it varies.</P><P>"Offset2" corresponds to the result from <TT><A HREF="#GET_OFFSET_ARRAY">GET_OFFSET_ARRAY</A></TT>. "Offset" is read from the start of the file. "Iterations" and "Index" are read from Offset2 + value. Apart from that GET_OFFSET_ARRAY2 functions like <TT><A HREF="#GET_OFFSET_ARRAY">GET_OFFSET_ARRAY</A></TT>. A more detailed explanation can be had in the <TT><A HREF="#GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2">GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2</A></TT> tutorial.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> 
or</TD><TD VALIGN=top ALIGN=left><B><TT>DEFINE_ASSOCIATIVE_ARRAY</TT></B><A NAME="DEFINE_ASSOCIATIVE_ARRAY"></A><A NAME="@default358"></A> <TT><A HREF="#String">String</A> BEGIN key1 <FONT COLOR="red"> [ </FONT>, key2 ... <FONT COLOR="red"> ] </FONT>=&gt; result1</TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Sets the array <CODE>$string</CODE>, indexed by the keys, to the corresponding results. The results can either be <TT><A HREF="#String">String</A></TT>s or <TT><A HREF="#value">value</A></TT>s.
Example:
<PRE CLASS="verbatim">DEFINE_ASSOCIATIVE_ARRAY mix_with_blue BEGIN
  red =&gt; purple
  yellow =&gt; green
END
  </PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>GET_STRREF</TT></B><A NAME="GET_STRREF"></A><A NAME="@default359"></A> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> The string reference value is looked up in <TT>DIALOG.TLK</TT> and the (male) string
(without any quotes) is stored in the <TT><A HREF="#variable">variable</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SET</TT></B><A NAME="SET"></A><A NAME="@default360"></A> <TT><A HREF="#variable">variable</A></TT> <TT>=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Update <TT><A HREF="#variable">variable</A></TT> so that it is equal to <TT><A HREF="#value">value</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#variable">variable</A></TT> <TT>=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Update <TT><A HREF="#variable">variable</A></TT> so that it is equal to <TT><A HREF="#value">value</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><FONT COLOR="red"> [ </FONT><TT><A HREF="#SET">SET</A></TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#variable">variable</A></TT> <TT>+=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>SET variable = variable + value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><FONT COLOR="red"> [ </FONT><TT><A HREF="#SET">SET</A></TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#variable">variable</A></TT> <TT>-=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>SET variable = variable - value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><FONT COLOR="red"> [ </FONT><TT><A HREF="#SET">SET</A></TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#variable">variable</A></TT> <TT>*=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>SET variable = variable * value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><FONT COLOR="red"> [ </FONT><TT><A HREF="#SET">SET</A></TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#variable">variable</A></TT> <TT>/=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>SET variable = variable / value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><FONT COLOR="red"> [ </FONT><TT><A HREF="#SET">SET</A></TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#variable">variable</A></TT> <TT>&amp;=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>SET variable = variable BAND value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><FONT COLOR="red"> [ </FONT><TT><A HREF="#SET">SET</A></TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#variable">variable</A></TT> <TT>|=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>SET variable = variable BOR value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><FONT COLOR="red"> [ </FONT><TT><A HREF="#SET">SET</A></TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#variable">variable</A></TT> <TT>&lt;&lt;=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>SET variable = variable BLSL value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><FONT COLOR="red"> [ </FONT><TT><A HREF="#SET">SET</A></TT> <FONT COLOR="red"> ] </FONT><TT><A HREF="#variable">variable</A></TT> <TT>&gt;&gt;=</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Equivalent to <TT>SET variable = variable BLSR value</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>WHILE</TT></B><A NAME="@default361"></A> <TT><A HREF="#value">value</A></TT> <TT>BEGIN</TT> 
<TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> If <TT><A HREF="#value">value</A></TT> is non-zero, execute the given <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT>and
then repeat, re-evaluating the <TT><A HREF="#value">value</A></TT>. 
<EM>Be very careful when using this command. </EM> You can easily describe
an infinite loop. See the <TT><A HREF="#WHILE">WHILE</A></TT> loop tutorial for more
information.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>FOR</TT></B><A NAME="FOR"></A><A NAME="@default362"></A> <TT>(</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>;</TT>
<TT><A HREF="#value">value</A></TT> <TT>;</TT>
<TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>)</TT> 
<TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> The <TT><A HREF="#patch">patch</A></TT> <TT>FOR (init;pred;inc) BEGIN body END</TT> is equivalent to
<TT>init WHILE pred BEGIN body inc END</TT>. Note that the predicate
<TT><A HREF="#value">value</A></TT> cannot be empty.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_BASH_FOR</TT></B><A NAME="PATCH_BASH_FOR"></A><A NAME="@default363"></A> <TT><A HREF="#directory-file-regexp">directory-file-regexp</A></TT> <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> for all files that match <TT><A HREF="#directory-file-regexp">directory-file-regexp</A></TT>, sets a bunch of variables
and executes the patches for each file found. Assuming the file being copied
is somedir/yourfile.cre, the following variables will be set:
<PRE CLASS="verbatim">"%BASH_FOR_DIRECTORY%" = "somedir"
"%BASH_FOR_FILESPEC%" = "somedir/yourfile.cre"
"%BASH_FOR_FILE%" = "yourfile.cre"
"%BASH_FOR_RES%" = "yourfile"
"%BASH_FOR_EXT%" = "cre"
"%BASH_FOR_SIZE%" = &lt;size of somedir/yourfile.cre&gt;
</PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>DEFINE_ARRAY</TT></B><A NAME="DEFINE_ARRAY"></A><A NAME="@default364"></A> <TT><A HREF="#String">String</A>1 BEGIN <A HREF="#String">String</A>2</TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left>	Sets the array <CODE>$string1(0)</CODE>,<CODE>$string1(1)</CODE> etc. to the various elements in string2.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_DEFINE_ARRAY</TT></B><A NAME="PATCH_DEFINE_ARRAY"></A><A NAME="@default365"></A> <TT><A HREF="#String">String</A>1 BEGIN <A HREF="#String">String</A>2 <FONT COLOR="red"> list </FONT>END</TT></TD><TD VALIGN=top ALIGN=left>	Same as <TT><A HREF="#DEFINE_ARRAY">DEFINE_ARRAY</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_FOR_EACH</TT></B><A NAME="PATCH_FOR_EACH"></A><A NAME="@default366"></A> <TT><A HREF="#String">String</A>1 IN <A HREF="#String">String</A></TT> <FONT COLOR="red"> list </FONT><TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> will set the string1 variable to each value in string list and process each patch.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>PHP_EACH</TT></B><A NAME="PHP_EACH"></A><A NAME="@default367"></A> <TT><A HREF="#String">String</A>1 AS <A HREF="#String">String</A>2 =&gt; <A HREF="#String">String</A>3</TT> <FONT COLOR="red"> list </FONT><TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> For every value of the string1 array that has been created or read, sets
string2_0 to the first array parameter, string2_1 to the second array
parameter, etc. and string3 to the result of the array. <CODE>string2</CODE> will also contain
		the first array parameter (as a synonym of <CODE>string2_0</CODE>). then executes the
patches listed. More exhaustive documentation will be provided by SConrad.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_PHP_EACH</TT></B><A NAME="PATCH_PHP_EACH"></A><A NAME="@default368"></A> <TT><A HREF="#String">String</A>1 AS <A HREF="#String">String</A>2 =&gt; <A HREF="#String">String</A>3</TT> <FONT COLOR="red"> list </FONT><TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> A synonym of <TT><A HREF="#PHP_EACH">PHP_EACH</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>CLEAR_ARRAY</TT></B><A NAME="CLEAR_ARRAY"></A><A NAME="@default369"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> &#X2018;Forgets&#X2019; that the array <TT>string</TT> exists until its values are recalled.
The actual variables&#X2019; values are kept, the only effect is that <TT>*PHP_EACH</TT>
will not consider old values.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_CLEAR_ARRAY</TT></B><A NAME="PATCH_CLEAR_ARRAY"></A><A NAME="@default370"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> A synonym of <TT><A HREF="#CLEAR_ARRAY">CLEAR_ARRAY</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_IF</TT></B><A NAME="PATCH_IF"></A><A NAME="@default371"></A> <TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> [ </FONT><TT>THEN</TT> <FONT COLOR="red"> ] </FONT><TT>BEGIN</TT>
<TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT> 
<FONT COLOR="red"> [ </FONT><TT>ELSE</TT> <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> If <TT><A HREF="#value">value</A></TT> is non-zero, execute the first <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT>once. Otherwise, execute the second <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT>(if any). As a
convenient shorthand, you may omit the <TT>BEGIN</TT>-<TT>END</TT> in the <TT>ELSE</TT>
branch if the <TT>ELSE</TT> branch contains exactly one <TT>patch</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_MATCH</TT></B><A NAME="PATCH_MATCH"></A><A NAME="@default372"></A><FONT COLOR="red"> list </FONT>WITH <FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> ...
<FONT COLOR="red"> [ </FONT>WHEN <TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT>BEGIN <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT>END <FONT COLOR="red"> ] </FONT>... DEFAULT <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT>END</TD><TD VALIGN=top ALIGN=left> See the <TT><A HREF="#MATCH and TRY">MATCH and TRY</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_TRY</TT></B><A NAME="PATCH_TRY"></A><A NAME="@default373"></A> <TT><A HREF="#patch">patch</A></TT><FONT COLOR="red"> list </FONT>WITH <FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> ...
<FONT COLOR="red"> [ </FONT>WHEN <TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT>BEGIN <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT>END <FONT COLOR="red"> ] </FONT>... DEFAULT <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT>END</TD><TD VALIGN=top ALIGN=left> See the <TT><A HREF="#MATCH and TRY">MATCH and TRY</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_RERAISE</TT></B><A NAME="PATCH_RERAISE"></A><A NAME="@default374"></A></TD><TD VALIGN=top ALIGN=left>See the <TT><A HREF="#MATCH and TRY">MATCH and TRY</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_INCLUDE</TT></B><A NAME="PATCH_INCLUDE"></A><A NAME="@default375"></A> <TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> loads the file string as if it were a list of tp2 patches and executes it (as if
		it had been typed inside your tp2).
These files have by convention tpp as an extension, due to no reason other than
randomness (you can use .tp1 or .xyzsucks if you&#X2019;re so oriented).
		Please note that, to speed up inclusions, tpp files are stored in memory,
	 rather than re-read each time from the hard-disk. If you need automorphing code
		(IE, you want to edit your tpp file), you can use <TT><A HREF="#PATCH_REINCLUDE">PATCH_REINCLUDE</A></TT> instead.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_REINCLUDE</TT></B><A NAME="PATCH_REINCLUDE"></A><A NAME="@default376"></A> <TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Works like <TT><A HREF="#PATCH_INCLUDE">PATCH_INCLUDE</A></TT>, but loads each time the tph file from the hard disk.
This is slower, but required if you want to edit your tpp file between an
inclusion and another.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SET_2DA_ENTRY</TT></B><A NAME="@default377"></A> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#value">value</A></TT>
<TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> The first <TT><A HREF="#value">value</A></TT> is the row, the second is the column and the
third is the <EM>required column count</EM>. The entry on the given column
of the given row is set to the fourth <TT><A HREF="#value">value</A></TT>, but only rows with
at least as many columns as the required column count are considered. 
The fourth <TT><A HREF="#value">value</A></TT>, the new entry, is evaluated specially: if it
can be evaluated like a value (e.g., <TT>&#X2018;&#X2018;3+4&#X2019;&#X2019;</TT>) it will be evaluated
and its integer result will be written as an ASCII string. Otherwise if
it is a single string (that is not a variable in scope) that string will
be written at the new value.
See
the <TT><A HREF="#SET_2DA_ENTRY">SET_2DA_ENTRY</A></TT> tutorial for more information.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SET_2DA_ENTRY_LATER</TT></B><A NAME="@default378"></A> string <TT><A HREF="#value">value</A></TT> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Similar to <TT>SET_2DA_ENTRY</TT>, memorizes the 2da changes in the RAM without
flushing them to the file. See the <TT><A HREF="#SET_2DA_ENTRY_LATER">SET_2DA_ENTRY_LATER</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SET_2DA_ENTRIES_NOW</TT></B><A NAME="@default379"></A> string <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>To be used with
<TT>SET_2DA_ENTRY_LATER</TT>: flushes the file changes in one go. See the
<TT><A HREF="#SET_2DA_ENTRIES_NOW">SET_2DA_ENTRIES_NOW</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>PRETTY_PRINT_2DA</TT></B><A NAME="PRETTY_PRINT_2DA"></A><A NAME="@default380"></A></TD><TD VALIGN=top ALIGN=left>Indents the 3rd line in the current file (which
should be a 2da file).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>PRETTY_PRINT_2DA</TT></B><A NAME="@default381"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Indents the value&#X2019;th line
(counting from 0) in the current file (which should be a 2da file).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>INSERT_2DA_ROW</TT></B><A NAME="INSERT_2DA_ROW"></A><A NAME="@default382"></A> <TT><A HREF="#value">value</A>1 <A HREF="#value">value</A>2 <A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> String (after variable substitution) will be inserted as a new line in the table.
Value1 is the row count, value2 is the <EM>required column count</EM>. If row count is
the same as the number of long enough lines in the file, then the line will be inserted
at the end; if row count is lesser than the number of lines, it will be inserted just before
the nth line in the original file (starting count from 0); finally, if row count is greater
than the number of lines, the component will fail to install.
<PRE CLASS="verbatim">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; 2dafile
asd foo
a b c
d e f
g h i
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
COPY ~2dafile~ ~2dafile~
INSERT_2DA_ROW 3 3 ~4 4 4~
INSERT_2DA_ROW 2 3 ~3 3 3~
INSERT_2DA_ROW 1 3 ~2 2 2~
INSERT_2DA_ROW 0 3 ~1 1 1~
</PRE>will result in
<PRE CLASS="verbatim">asd foo
1 1 1
a b c
2 2 2
d e f
3 3 3
g h i
4 4 4
</PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REMOVE_2DA_ROW</TT></B><A NAME="REMOVE_2DA_ROW"></A><A NAME="@default383"></A> <TT><A HREF="#value">value</A>1 <A HREF="#value">value</A>2</TT></TD><TD VALIGN=top ALIGN=left> the Value1-th row from the 2da file containing at least value2 items will be removed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_READLN</TT></B><A NAME="PATCH_READLN"></A><A NAME="@default384"></A> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> Waits for the user to provided an enter-terminated string and store it in
variable. Said string will be stored and re-used at reinstall time. See the
<TT><A HREF="#READLN">READLN</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_RANDOM_SEED</TT></B><A NAME="PATCH_RANDOM_SEED"></A><A NAME="@default385"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> See <TT><A HREF="#RANDOM_SEED">RANDOM_SEED</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_STORE_ITEM</TT></B><A NAME="@default386"></A> <FONT COLOR="red"> [ </FONT><TT>+</TT> <FONT COLOR="red"> ] </FONT>itemName <FONT COLOR="red"> [ </FONT>position <FONT COLOR="red"> ] </FONT>numCharges ext2 ext3 itemFlag maxInStack <FONT COLOR="red"> [ </FONT>unlimited <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> See the <TT><A HREF="#ADD_STORE_ITEM">ADD_STORE_ITEM</A></TT> tutorial for more information.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REMOVE_STORE_ITEM</TT></B><A NAME="REMOVE_STORE_ITEM"></A><A NAME="@default387"></A> itmName <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Remove the listed items from the current store. Does nothing if an item is not for sale.
	Multiple instances are removed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_2DA_ENTRY</TT></B><A NAME="READ_2DA_ENTRY"></A><A NAME="@default388"></A> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#value">value</A></TT>
<TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> The first <TT><A HREF="#value">value</A></TT> is the row, the second is the column and the
third is the <EM>required column count</EM>. The variable specified is set
to the entry on the given column of the given row, but only column
with at least as many columns as the required column count are
considered. This is the reverse of <TT><A HREF="#SET_2DA_ENTRY">SET_2DA_ENTRY</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_2DA_ENTRIES_NOW</TT></B><A NAME="@default389"></A> string <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> Reads in one go all the 2da in the RAM for <TT><A HREF="#READ_2DA_ENTRY_FORMER">READ_2DA_ENTRY_FORMER</A></TT>. See the
<TT><A HREF="#READ_2DA_ENTRIES_NOW">READ_2DA_ENTRIES_NOW</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>READ_2DA_ENTRY_FORMER</TT></B><A NAME="@default390"></A> string <TT><A HREF="#value">value</A></TT> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left>Similar to <TT><A HREF="#READ_2DA_ENTRY">READ_2DA_ENTRY</A></TT>, but reads from a prepared
<TT><A HREF="#READ_2DA_ENTRIES_NOW">READ_2DA_ENTRIES_NOW</A></TT> command rather than from the file.
See the <TT><A HREF="#READ_2DA_ENTRY_FORMER">READ_2DA_ENTRY_FORMER</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>COUNT_2DA_ROWS</TT></B><A NAME="COUNT_2DA_ROWS"></A><A NAME="@default391"></A> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> The first <TT><A HREF="#value">value</A></TT> is the required column count. This command
counts the number of rows in the current file (which should be a
<TT><A HREF="#2DA">2DA</A></TT> file) that have at least as many columns as the required
column count and stores the result in the variable.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>COUNT_2DA_COLS</TT></B><A NAME="COUNT_2DA_COLS"></A><A NAME="@default392"></A> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> This command counts the number of columns in the current file (which should be a
<TT><A HREF="#2DA">2DA</A></TT> file) and stores the result in the variable.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>COUNT_REGEXP_INSTANCES</TT></B><A NAME="COUNT_REGEXP_INSTANCES"></A><A NAME="@default393"></A> <TT><A HREF="#optcase">optcase</A></TT> <TT><A HREF="#optexact">optexact</A></TT> <TT><A HREF="#regexp">regexp</A></TT>
<TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> This command counts the number of times regexp appears in the current file
and stores the result in the variable. Variable substitution is performed
on regexp prior to regexp handling (EG, if <CODE>%var% = ~abc~</CODE>,
<CODE>~[%var%]~</CODE> is evaluated as <CODE>~[abc]~</CODE>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>LOOKUP_IDS_SYMBOL_OF_INT</TT></B><A NAME="LOOKUP_IDS_SYMBOL_OF_INT"></A><A NAME="@default394"></A> variable idsFile <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left> The symbolic constant associated with <TT><A HREF="#value">value</A></TT> in idsFile (which may
contain user variables) is stored
in variable. If that doesn&#X2019;t work, <TT><A HREF="#value">value</A></TT> is stored in variable.
Example:
<PRE CLASS="verbatim">    LOOKUP_IDS_SYMBOL_OF_INT foo ~spell~ 1101
    SPRINT myfile "SPELL" 
    LOOKUP_IDS_SYMBOL_OF_INT bar ~%myfile%~ (0x44c + 1)
    LOOKUP_IDS_SYMBOL_OF_INT baz ~spell~ 77777
  </PRE>Both <TT>foo</TT> and <TT>bar</TT> are <TT>CLERIC_BLESS</TT> while <TT>baz</TT> is
<TT>777777</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>COMPILE_BAF_TO_BCS</TT></B><A NAME="COMPILE_BAF_TO_BCS"></A><A NAME="@default395"></A></TD><TD VALIGN=top ALIGN=left> The current file, which must be a valid <TT><A HREF="#BAF">BAF</A></TT> script, is compiled
to a <TT><A HREF="#BCS">BCS</A></TT>. In general you should use the <TT><A HREF="#COMPILE">COMPILE</A></TT>
<TT><A HREF="#TP2 Action">TP2 Action</A></TT> instead, unless you are using other <TT>patch</TT> commands
to modify the file under consideration.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>DECOMPILE_BCS_TO_BAF</TT></B><A NAME="DECOMPILE_BCS_TO_BAF"></A><A NAME="@default396"></A></TD><TD VALIGN=top ALIGN=left> The current file, which must be a valid <TT><A HREF="#BCS">BCS</A></TT> script, is decompiled
to a <TT><A HREF="#BAF">BAF</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>DECOMPILE_DLG_TO_D</TT></B><A NAME="DECOMPILE_DLG_TO_D"></A><A NAME="@default397"></A></TD><TD VALIGN=top ALIGN=left> The current file, which must be a valid <TT><A HREF="#DLG">DLG</A></TT> file, is decompile
to a textual <TT><A HREF="#D">D</A></TT> file (with string refs and no comments). Once you
have a <TT><A HREF="#D">D</A></TT> file you can use other <TT>patch</TT> commands to change the
actions and triggers around. You should use <TT><A HREF="#D">D</A></TT> actions (like
<TT><A HREF="#REPLACE_ACTION_TEXT">REPLACE_ACTION_TEXT</A></TT> instead whenever possible.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>COMPILE_D_TO_DLG</TT></B><A NAME="COMPILE_D_TO_DLG"></A><A NAME="@default398"></A></TD><TD VALIGN=top ALIGN=left> The current file, which must be a valid <TT><A HREF="#D">D</A></TT> file that defines
a single <TT><A HREF="#DLG">DLG</A></TT> file (via an obvious <TT><A HREF="#BEGIN">BEGIN</A></TT> action) is
compiled to a <TT><A HREF="#DLG">DLG</A></TT>. Typically this is only used after a
<TT><A HREF="#DECOMPILE_DLG_TO_D">DECOMPILE_DLG_TO_D</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>DECOMPILE_AND_PATCH</TT></B><A NAME="DECOMPILE_AND_PATCH"></A><A NAME="@default399"></A> BEGIN <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><CODE>END</CODE></TD><TD VALIGN=top ALIGN=left> Acts like
<PRE CLASS="verbatim">    DECOMPILE_BCS_TO_BAF // or DLG_TO_D
    patch list
    COMPILE_BAF_TO_BCS // or D_TO_DLG
  </PRE>except it enforces that the DECOMPILE is followed by the compile,
can indiscriminately patch BCS and DLG files, and is guaranteed not to leave
a decompiled file in the override (if decompiling, patching or recompiling
fails, a warning is printed and the original version of the file is left in
the override).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REFACTOR_TRIGGER</TT></B><A NAME="REFACTOR_TRIGGER"></A><A NAME="@default400"></A> <TT><A HREF="#optcase">optcase</A></TT> <TT><A HREF="#optexact">optexact</A></TT> String String</TD><TD VALIGN=top ALIGN=left> Works like <TT><A HREF="#REPLACE_TEXTUALLY">REPLACE_TEXTUALLY</A></TT>, except that it only works on triggers
(for both D and BAF files)
and applies Boolean Algebra to ensure that the structure of the trigger is not
broken (like REPLACE_TEXTUALLY would do if you are substituting one trigger with
several and the matching trigger is inside an OR() block and/or negated).<P>Caveats:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
this command is very slow, so you should use <TT><A HREF="#REPLACE_TEXTUALLY">REPLACE_TEXTUALLY</A></TT> if
you are substituting a trigger with another, as well as using <TT><A HREF="#IF">IF</A></TT> to
	avoid calling this patch on script files that do not contain the trigger
	you are looking for.
</LI><LI CLASS="li-itemize">the resulting file will have messed up whitespace, so remember that if
you plan on using REPLACE_TEXTUALLY later (the file will work correctly
	in-game). Applying another (empty) <TT><A HREF="#DECOMPILE_AND_PATCH">DECOMPILE_AND_PATCH</A></TT>
will fix this issue.
</LI><LI CLASS="li-itemize">the searching regexp must match exactly against a single trigger
(so <CODE>REFACTOR_TRIGGER ~A() B()~ ~C()~</CODE> or
	<CODE>REFACTOR_TRIGGER ~A(~ ~C() A(~</CODE> will not work). The substituting
	string can contain multiple triggers.
</LI></UL></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REFACTOR_BAF_TRIGGER</TT></B><A NAME="REFACTOR_BAF_TRIGGER"></A><A NAME="@default401"></A> <TT><A HREF="#optcase">optcase</A></TT> <TT><A HREF="#optexact">optexact</A></TT> String String</TD><TD VALIGN=top ALIGN=left> Synonim of <TT><A HREF="#REFACTOR_TRIGGER">REFACTOR_TRIGGER</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REFACTOR_D_TRIGGER</TT></B><A NAME="REFACTOR_D_TRIGGER"></A><A NAME="@default402"></A> <TT><A HREF="#optcase">optcase</A></TT> <TT><A HREF="#optexact">optexact</A></TT> String String</TD><TD VALIGN=top ALIGN=left> Synonim of <TT><A HREF="#REFACTOR_TRIGGER">REFACTOR_TRIGGER</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_EVALUATE</TT></B><A NAME="REPLACE_EVALUATE"></A><A NAME="@default403"></A> <TT><A HREF="#optcase">optcase</A></TT> findRegexp <TT>BEGIN</TT>
<TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT> replaceRegexp</TD><TD VALIGN=top ALIGN=left> For every instance of the <TT><A HREF="#regexp">regexp</A></TT> findRegexp found, the
<TT><A HREF="#patch">patch</A></TT> list is evaluated (with the variable <TT>MATCH</TT><I>i</I> set to
the <I>i</I>th matched group in findRegexp), variable substitute is performed
on replaceRegexp, and then findRegexp is replaced by replaceRegexp. Any
writes done by the <TT><A HREF="#patch">patch</A></TT> list (e.g., <TT><A HREF="#SAY">SAY</A></TT> or
<TT><A HREF="#WRITE_ASCII">WRITE_ASCII</A></TT>) are ignored: <TT><A HREF="#SET">SET</A></TT> should be the main
component of the <TT><A HREF="#patch">patch</A></TT> list. For example:
<PRE CLASS="verbatim">    COPY ~nice.baf~ ~mean.baf~
      REPLACE_EVALUATE
        ~Give(\([0-9]+\),\([0-9]+\))~
        BEGIN
          SET "RESULT" = ("%MATCH1%" + "%MATCH2%") / 2
        END
        ~Take(%RESULT%)~
  </PRE>This <TT><A HREF="#COPY">COPY</A></TT> <TT><A HREF="#TP2 Action">TP2 Action</A></TT> would replace <TT>Give(10,20)</TT> with
<TT>Take(15)</TT>.
optcase allows you to decide if the matching is case-sensitive or not.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_GAM_NPC</TT></B><A NAME="@default404"></A> npcCRE npcARE xCoord yCoord</TD><TD VALIGN=top ALIGN=left> See the <TT><A HREF="#ADD_GAM_NPC">ADD_GAM_NPC</A></TT> tutorial for more information about this
action, which is used when adding NPCs to Baldur&#X2019;s Gate 1. BG2 mods
should not use this command.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_MAP_NOTE</TT></B><A NAME="ADD_MAP_NOTE"></A><A NAME="@default405"></A> xCoord yCoord color <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> If the file currently being patched is an <TT><A HREF="#ARE">ARE</A></TT> area file, this
patch command adds a map note to it. Valid colors include: gray,
violent, green, orange, red, blue, darkblue, lightgray.
Example:
<PRE CLASS="verbatim">COPY_EXISTING ~ar0202.are~ ~override/ar0202.are~
  ADD_MAP_NOTE #123 #777 ~violet~
  ~This is my new map note!  Yippee!~
</PRE>Special thanks to Japh for coding this feature.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_KNOWN_SPELL</TT></B><A NAME="ADD_KNOWN_SPELL"></A><A NAME="@default406"></A> splName spellLevel spellType</TD><TD VALIGN=top ALIGN=left> When applied to a CRE file, this <TT><A HREF="#patch">patch</A></TT> causes the given spell to
be known. Note that spellLevel counts from 0 (e.g., you should say
<TT>#2</TT> for a third-level Fireball). Possible values for spellType are
<TT>priest</TT>, <TT>innate</TT> and <TT>wizard</TT>. Example:
<PRE CLASS="verbatim">    COPY_EXISTING ~some.cre~ ~override/some.cre~
      ADD_KNOWN_SPELL ~SPPR314~ #2 ~priest~
      // Unholy Blight is now known as a 3rd level priest spell
</PRE>Special thanks to Japh for coding this feature.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_MEMORIZED_SPELL</TT></B><A NAME="ADD_MEMORIZED_SPELL"></A><A NAME="@default407"></A> splName spellLevel spellType
<FONT COLOR="red"> [ </FONT><TT>(</TT> <TT><A HREF="#value">value</A></TT> <TT>)</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> When applied to a CRE file, this <TT><A HREF="#patch">patch</A></TT> causes the given spell to
be memorized one more time (or value times if specified).
Note that spellLevel counts from 0 (e.g., you
should say <TT>#2</TT> for a third-level Fireball). Possible values for spellType
are <TT>priest</TT>, <TT>innate</TT> and <TT>wizard</TT>. Example:
<PRE CLASS="verbatim">    COPY_EXISTING ~some.cre~ ~override/some.cre~
      ADD_MEMORIZED_SPELL ~SPPR314~ #2 ~priest~ ( 5 )
      // Unholy Blight is now memorized five times as 3rd priest
</PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REMOVE_KNOWN_SPELL</TT></B><A NAME="REMOVE_KNOWN_SPELL"></A><A NAME="@default408"></A> splName <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> When applied to a CRE file, this <TT><A HREF="#patch">patch</A></TT> causes all of the
listed spells to be removed. Example:
<PRE CLASS="verbatim">    COPY_EXISTING ~aerie.cre~ ~override/aerie.cre~
      REMOVE_KNOWN_SPELL ~sppr101~ ~sppr102~
</PRE>Special thanks to Japh for coding this feature.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REMOVE_MEMORIZED_SPELL</TT></B><A NAME="REMOVE_MEMORIZED_SPELL"></A><A NAME="@default409"></A> splName <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> When applied to a CRE file, this <TT><A HREF="#patch">patch</A></TT> causes all of the
listed spells to be removed from their memory. Example:
<PRE CLASS="verbatim">    COPY_EXISTING ~aerie.cre~ ~override/aerie.cre~
      REMOVE_MEMORIZED_SPELL ~sppr101~ ~sppr102~
</PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>SET_BG2_PROFICIENCY</TT></B><A NAME="SET_BG2_PROFICIENCY"></A><A NAME="@default410"></A> String <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>	Removes all effects from the current CRE file that alter the proficiency specified by
	String (relative to Stats.ids). After that, if value is different from zero, add an effect
	to set said proficiency to value.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ADD_CRE_ITEM</TT></B><A NAME="@default411"></A> itmName #charge1 #charge2 #charge3 flags slot <FONT COLOR="red"> [ </FONT><TT>EQUIP</TT> <FONT COLOR="red"> ]  [ </FONT><TT>TWOHANDED</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> See the <TT><A HREF="#ADD_CRE_ITEM">ADD_CRE_ITEM</A></TT> tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REPLACE_CRE_ITEM</TT></B><A NAME="REPLACE_CRE_ITEM"></A><A NAME="@default412"></A> itmName #charge1 #charge2 #charge3 flags slot <FONT COLOR="red"> [ </FONT><TT>EQUIP</TT> <FONT COLOR="red"> ]  [ </FONT><TT>TWOHANDED</TT> <FONT COLOR="red"> ] </FONT></TD><TD VALIGN=top ALIGN=left> If there&#X2019;s an item in the slot position, replace it; otherwise, process <TT><A HREF="#ADD_CRE_ITEM">ADD_CRE_ITEM</A></TT></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REMOVE_CRE_ITEM</TT></B><A NAME="REMOVE_CRE_ITEM"></A><A NAME="@default413"></A> itmName <FONT COLOR="red"> list </FONT></TD><TD VALIGN=top ALIGN=left> Remove the listed items from the current creature. Does nothing if an item is not possessed.
	Multiple instances are removed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>REMOVE_CRE_ITEMS</TT></B><A NAME="REMOVE_CRE_ITEMS"></A><A NAME="@default414"></A></TD><TD VALIGN=top ALIGN=left> Remove all items from the current creature.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REMOVE_CRE_EFFECTS</TT></B><A NAME="REMOVE_CRE_EFFECTS"></A><A NAME="@default415"></A></TD><TD VALIGN=top ALIGN=left> Remove all effects from the current creature.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REMOVE_KNOWN_SPELLS</TT></B><A NAME="REMOVE_KNOWN_SPELLS"></A><A NAME="@default416"></A></TD><TD VALIGN=top ALIGN=left> Remove all known spells from the current creature.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>REMOVE_MEMORIZED_SPELLS</TT></B><A NAME="REMOVE_MEMORIZED_SPELLS"></A><A NAME="@default417"></A></TD><TD VALIGN=top ALIGN=left> Remove all memorized spells from the current creature.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_SILENT</TT></B><A NAME="PATCH_SILENT"></A><A NAME="@default418"></A></TD><TD VALIGN=top ALIGN=left>makes WeiDU skip all messages; it&#X2019;s reenabled once a component
is installed (or fails to), or a <TT><A HREF="#PRINT">PRINT</A></TT>, <TT><A HREF="#PATCH_PRINT">PATCH_PRINT</A></TT>,
<TT><A HREF="#VERBOSE">VERBOSE</A></TT> or <TT><A HREF="#PATCH_VERBOSE">PATCH_VERBOSE</A></TT> is found.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>PATCH_VERBOSE</TT></B><A NAME="PATCH_VERBOSE"></A><A NAME="@default419"></A></TD><TD VALIGN=top ALIGN=left>undoes the latest <TT><A HREF="#SILENT">SILENT</A></TT> or <TT><A HREF="#PATCH_SILENT">PATCH_SILENT</A></TT> command.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INNER_PATCH</TT></B><A NAME="INNER_PATCH"></A><A NAME="@default420"></A> buffString <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Any WeiDU variables inside <TT>%</TT>s within buffString are replaced by
their values. All of the <TT><A HREF="#patch">patch</A></TT>es given are evaluated as if the
contents of the current file were buffString. Any modifications to
buffString are thrown away (making this mostly useful for reads).
Example:
<PRE CLASS="verbatim">  INNER_PATCH "ABC" BEGIN
    READ_BYTE 0x2 "myvar"
  END 
  PATCH_PRINT "myvar is %myvar%" 
  </PRE>This sequence will always print <TT>myvar is 67</TT> (since 67 is the ASCII
code for <TT>C</TT>).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INNER_PATCH_SAVE</TT></B><A NAME="INNER_PATCH_SAVE"></A><A NAME="@default421"></A> savevar buffString <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> As with <TT><A HREF="#INNER_PATCH">INNER_PATCH</A></TT>, except that any modifications to buffString are stored inside
savevar.
Example:
<PRE CLASS="verbatim">  SPRINT foo "ABC"
  INNER_PATCH_SAVE bar "%foo%" BEGIN
    WRITE_BYTE 0x2 65
  END
  PATCH_PRINT "foo is %foo%, bar is %bar%"
  </PRE>This sequence will always print <TT>foo is ABC, bar is ABA </TT> (since 65 is the ASCII
code for <TT>A</TT>).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>INNER_PATCH_FILE</TT></B><A NAME="INNER_PATCH_FILE"></A><A NAME="@default422"></A> resource <TT>BEGIN</TT> <TT><A HREF="#patch">patch</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> Any WeiDU variables inside <TT>%</TT>s within resource are replaced by
their values. If the resulting resource is present in the game or in the
override folder, the <TT><A HREF="#patch">patch</A></TT>es given are evaluated as if the
current file were that resource. If not, nothing happens. Any
modifications to that resource are thrown away (making this mostly useful
for reads).
Example:
<PRE CLASS="verbatim">  INNER_PATCH_FILE "SW1H01.ITM" BEGIN
    READ_BYTE 0x1 "myvar"
  END 
  PATCH_PRINT "myvar is %myvar%" 
  </PRE>This sequence will always print <TT>myvar is 84</TT> (since 84 is the ASCII
code for <TT>T</TT> and <TT><A HREF="#SW1H01.ITM">SW1H01.ITM</A></TT> starts with <TT>ITM</TT>).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INNER_ACTION</TT></B><A NAME="@default423"></A> <TT>BEGIN</TT> <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <FONT COLOR="red"> list </FONT><TT>END</TT></TD><TD VALIGN=top ALIGN=left> See the <TT><A HREF="#INNER_ACTION">INNER_ACTION</A></TT> tutorial, but loosely the current
<TT><A HREF="#COPY">COPY</A></TT> is paused, the given <TT><A HREF="#TP2 Actions">TP2 Actions</A></TT> are executed, and
then the current <TT><A HREF="#COPY">COPY</A></TT> is resumed. <EM>Note that an
<TT><A HREF="#INNER_ACTION">INNER_ACTION</A></TT> should never modify a file that is being modified by
the current action. For example, never put <TT>APPEND &#XA0;foo.2da&#XA0;</TT> inside of
<TT>COPY_EXISTING &#XA0;foo.2da&#XA0;</TT>. More formally, if the inner action and the
outer action both modify the same file, the results are undefined.</EM></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>DECOMPRESS_REPLACE_FILE</TT></B><A NAME="DECOMPRESS_REPLACE_FILE"></A><A NAME="@default424"></A> start length uncompressedlength</TD><TD VALIGN=top ALIGN=left>	Decompress (ZLIB) the <CODE>start...start+length-1</CODE> portion of the current
	file (requires to specify the uncompressed length as well). The result overwrites
	the current file. It&#X2019;s a synonym for
	<CODE>DECOMPRESS_INTO_FILE start length uncompressedlength 0 BUFFER_LENGTH</CODE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>DECOMPRESS_INTO_FILE</TT></B><A NAME="DECOMPRESS_INTO_FILE"></A><A NAME="@default425"></A> start length uncompressedlength overwritefrom
overwriteto</TD><TD VALIGN=top ALIGN=left>	Decompress (ZLIB) the <CODE>start...start+length-1</CODE> portion of the current
	file (requires to specify the uncompressed length as well). The result overwrites
	the overwritefrom...overwriteto-1 portion of the current file.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>DECOMPRESS_INTO_VAR</TT></B><A NAME="DECOMPRESS_INTO_VAR"></A><A NAME="@default426"></A> start length uncompressedlength varName</TD><TD VALIGN=top ALIGN=left>	Decompress (ZLIB) the <CODE>start...start+length-1</CODE> portion of the current
	file (requires to specify the uncompressed length as well). The result is stored
	into varName.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>COMPRESS_REPLACE_FILE</TT></B><A NAME="COMPRESS_REPLACE_FILE"></A><A NAME="@default427"></A> start length level</TD><TD VALIGN=top ALIGN=left>	Compress (ZLIB) the <CODE>start...start+length-1</CODE> portion of the current
	file (level is 0 to 9; 0 means don&#X2019;t compress, 1 is fastest compression, 9 is best
	compression). The result overwrites
	the current file. It&#X2019;s a synonym for
	<CODE>DECOMPRESS_INTO_FILE start length uncompressedlength 0 BUFFER_LENGTH</CODE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>COMPRESS_INTO_FILE</TT></B><A NAME="COMPRESS_INTO_FILE"></A><A NAME="@default428"></A> start length level overwritefrom
overwriteto</TD><TD VALIGN=top ALIGN=left>	Compress (ZLIB) the <CODE>start...start+length-1</CODE> portion of the current
	file (level is 0 to 9; 0 means don&#X2019;t compress, 1 is fastest compression, 9 is best
	compression). The result overwrites
	the overwritefrom...overwriteto-1 portion of the current file.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>COMPRESS_INTO_VAR</TT></B><A NAME="COMPRESS_INTO_VAR"></A><A NAME="@default429"></A> start length level varName</TD><TD VALIGN=top ALIGN=left>	Compress (ZLIB) the <CODE>start...start+length-1</CODE> portion of the current
	file (level is 0 to 9; 0 means don&#X2019;t compress, 1 is fastest compression, 9 is best
	compression). The result is stored into varName.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>when</TT></B><A NAME="when"></A><A NAME="@default430"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>A <TT><A HREF="#when">when</A></TT> clause gives you local control over when a 
<TT><A HREF="#COPY">COPY</A></TT>, <TT><A HREF="#COPY_EXISTING">COPY_EXISTING</A></TT> or <TT><A HREF="#APPEND_COL">APPEND_COL</A></TT> happens. If the
<TT><A HREF="#COPY">COPY</A></TT> or <TT><A HREF="#COPY_EXISTING">COPY_EXISTING</A></TT> contains multiple files, each one
is checked against the <TT><A HREF="#when">when</A></TT> clauses separately.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left><B><TT>IF_SIZE_IS</TT></B><A NAME="IF_SIZE_IS"></A><A NAME="@default431"></A> fileSize</TD><TD VALIGN=top ALIGN=left>True if the input file size is
fileSize.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>IF</TT></B><A NAME="IF"></A><A NAME="@default432"></A> <TT><A HREF="#regexp">regexp</A></TT></TD><TD VALIGN=top ALIGN=left>True if the input file contains
<TT><A HREF="#regexp">regexp</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>UNLESS</TT></B><A NAME="UNLESS"></A><A NAME="@default433"></A> <TT><A HREF="#regexp">regexp</A></TT></TD><TD VALIGN=top ALIGN=left>False if the input file contains
<TT><A HREF="#regexp">regexp</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>BUT_ONLY_IF_IT_CHANGES</TT></B><A NAME="BUT_ONLY_IF_IT_CHANGES"></A><A NAME="@default434"></A></TD><TD VALIGN=top ALIGN=left>True only if the file is actually
changed by patching actions. Unlike all other <TT><A HREF="#when">when</A></TT> clauses, this
one is evaluated just before the result would be written out to the disk.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>offset</TT></B><A NAME="offset"></A><A NAME="@default435"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>A <TT><A HREF="#offset">offset</A></TT> is a normal <TT><A HREF="#value">value</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> <B><TT>value</TT></B><A NAME="value"></A><A NAME="@default436"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>An expression that evaluates to an integer. See
<TT><A HREF="#--debug-value">--debug-value</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left>integer</TD><TD VALIGN=top ALIGN=left>An absolute location or amount. You may format your numbers
in decimal, hex, octal or binary. Use 0x for hex, 0o for octal and 0b for
binary.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>(</TT> <TT><A HREF="#value">value</A></TT> <TT>)</TT></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <TT>+</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Addition.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <TT>-</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Subtraction.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <TT>*</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Multiplication.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <TT>/</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Division. Division by zero yields
the value zero. Briefly, fractions are dropped and the result is an integer
(so 11 / 6 = 1). More technically, &#X201C;this division rounds the real quotient
of its arguments towards zero&#X201D; -- see
<TT><A HREF="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html">http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html</A></TT>
for more information.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>BYTE_AT</TT></B><A NAME="BYTE_AT"></A><A NAME="@default437"></A> <TT><A HREF="#offset">offset</A></TT></TD><TD VALIGN=top ALIGN=left> The 8-bit value from the file at the given <TT><A HREF="#offset">offset</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SBYTE_AT</TT></B><A NAME="SBYTE_AT"></A><A NAME="@default438"></A> <TT><A HREF="#offset">offset</A></TT></TD><TD VALIGN=top ALIGN=left> The 8-bit signed value from the file at the given <TT><A HREF="#offset">offset</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SHORT_AT</TT></B><A NAME="SHORT_AT"></A><A NAME="@default439"></A> <TT><A HREF="#offset">offset</A></TT></TD><TD VALIGN=top ALIGN=left> The 16-bit value from the file at the given <TT><A HREF="#offset">offset</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SSHORT_AT</TT></B><A NAME="SSHORT_AT"></A><A NAME="@default440"></A> <TT><A HREF="#offset">offset</A></TT></TD><TD VALIGN=top ALIGN=left> The 16-bit signed value from the file at the given <TT><A HREF="#offset">offset</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>LONG_AT</TT></B><A NAME="LONG_AT"></A><A NAME="@default441"></A> <TT><A HREF="#offset">offset</A></TT></TD><TD VALIGN=top ALIGN=left> The 32-bit value from the file at the given <TT><A HREF="#offset">offset</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>SLONG_AT</TT></B><A NAME="SLONG_AT"></A><A NAME="@default442"></A> <TT><A HREF="#offset">offset</A></TT></TD><TD VALIGN=top ALIGN=left> The 32-bit signed value from the file at the given <TT><A HREF="#offset">offset</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>**</TT></B><A NAME="**"></A><A NAME="@default443"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Exponentiation. The first
value is raised to the power of the second. This is done by converting both
to floating point numbers, calculating the exponent, and converting the
answer back to a 32-bit integer. If anything goes wrong the value zero is
returned or the result is undefined.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>**</TT></B><A NAME="@default444"></A> <TT>(</TT> <TT><A HREF="#value">value</A></TT> <TT><A HREF="#value">value</A></TT> <TT>)</TT></TD><TD VALIGN=top ALIGN=left> Fractional exponentiation. <TT>a ** (b c)</TT> yields <TT>a</TT> raised to the 
power of <TT>(b/c)</TT>. All of the internal operations are done in floating
point. If anything goes wrong, zero is returned or the result is
undefined. Example: 
<PRE CLASS="verbatim">    SET x = 100 ** 2            
    SET y = 100 ** (1 2) // square root of 100 = 10
    SET z = 100 ** (1 3) // cube root of 100 = 4.64 
    PATCH_PRINT "w = %w%, x = %x%, y = %y%, z = %z%"
  </PRE>yields <TT>x = 10000, y = 10, z = 4</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>=</TT></B><A NAME="="></A><A NAME="@default445"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left><EM>Integer</EM> Equality. If the two
values evaluate to equal integers, the result is 1. Otherwise, the result
is 0. See <TT><A HREF="#STRING_COMPARE">STRING_COMPARE</A></TT> for comparing <TT><A HREF="#String">String</A></TT>s. Synonym:
<B><TT>==</TT></B><A NAME="@default446"></A>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>NOT</TT></B><A NAME="NOT"></A><A NAME="@default447"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Negation. If the value is 0, the result is 1.
Otherwise the result is 0.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>ABS</TT></B><A NAME="ABS"></A><A NAME="@default448"></A> <TT><A HREF="#Value">Value</A></TT></TD><TD VALIGN=top ALIGN=left>Absolute value. If the value is &gt;= 0, the result
is x. Otherwise the result is -x.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>!=</TT></B><A NAME="!="></A><A NAME="@default449"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left><EM>Integer</EM> Inequality. If
the two values evaluate to equal integers, the result is 0. Otherwise the
result is 1. See <TT><A HREF="#STRING_COMPARE">STRING_COMPARE</A></TT> for comparing <TT><A HREF="#String">String</A></TT>s.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>OR</TT></B><A NAME="OR"></A><A NAME="@default450"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Disjunction. If either value is
non-zero, the result is 1. Otherwise, the result is 0. Synonym: <B><TT>||</TT></B><A NAME="@default451"></A>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>AND</TT></B><A NAME="AND"></A><A NAME="@default452"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Conjunction. If both values are
non-zero, the result is 1. Otherwise, the result is 0. Synonym: <B><TT>&amp;&amp;</TT></B><A NAME="@default453"></A>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>BAND</TT></B><A NAME="BAND"></A><A NAME="@default454"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Bitwise And.
<TT>0b101 BAND 0b110 = 0b100</TT>. Synonym: <B><TT>&amp;</TT></B><A NAME="@default455"></A>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>BOR</TT></B><A NAME="BOR"></A><A NAME="@default456"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Bitwise Or. 
<TT>0b101 BOR 0b110 = 0b111</TT>. Synonym: <B><TT>|</TT></B><A NAME="@default457"></A>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>BXOR</TT></B><A NAME="BXOR"></A><A NAME="@default458"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Bitwise Exclusive Or. 
<TT>0b101 BXOR 0b110 = 0b011</TT>. Synonym: <B><TT>^^</TT></B><A NAME="@default459"></A>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>BNOT</TT></B><A NAME="BNOT"></A><A NAME="@default460"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Bitwise Not. 
<TT>BNOT 0b111 = 0b1111111111111111111111111111000</TT>. Synonym: <B><TT><CODE>`</CODE></TT></B><A NAME="@default461"></A>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>BLSL</TT></B><A NAME="BLSL"></A><A NAME="@default462"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Bitwise Logical Shift Left. 
<TT>0b101 BLSL 2 = 0b10100</TT>. Synonym: <B><TT>&lt;&lt;</TT></B><A NAME="@default463"></A>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>BLSR</TT></B><A NAME="BLSR"></A><A NAME="@default464"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Bitwise Logical Shift Right. 
<TT>0b101 BLSR 2 = 0b1</TT>. Synonym: <B><TT>&gt;&gt;</TT></B><A NAME="@default465"></A>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>BASR</TT></B><A NAME="BASR"></A><A NAME="@default466"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>Bitwise Arithmetic Shift Right. 
This is an arithmetic shift: the sign bit of the first value is replicated
and inserted in the vacated bits. <TT>0b101 BASR 2 = 0b1</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>&gt;</TT></B><A NAME="@default467"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>If the first value is
greater than the second, the result is 1. Otherwise, the result is 0.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>&gt;=</TT></B><A NAME="@default468"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>If the first value is
greater than or equal to the second, the result is 1. Otherwise, the result
is 0.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>&lt;</TT></B><A NAME="@default469"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>If the first value is
less than the second, the result is 1. Otherwise, the result
is 0.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>&lt;=</TT></B><A NAME="@default470"></A> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>If the first value is
less than or equal to the second, the result is 1. Otherwise, the result
is 0.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#value">value</A></TT> <B><TT>?</TT></B><A NAME="@default471"></A> <TT><A HREF="#value">value</A></TT> <TT>:</TT> <TT><A HREF="#value">value</A></TT></TD><TD VALIGN=top ALIGN=left>An expression-valued conditional. If the first value is not 0 then the
second value is evaluated and returned, otherwise the third value is
evaluated and returned.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#String">String</A></TT> <B><TT>STRING_COMPARE</TT></B><A NAME="STRING_COMPARE"></A><A NAME="@default472"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>This is legacy syntax for <TT><A HREF="#STRING_EQUAL">STRING_EQUAL</A></TT>:
This expression evaluates to 0 if and only if its two string arguments are
equal (have the same length and the same contents). Otherwise it will evaluate
to a negative or positive integer, depending on whether the first string argument
would sort lexicographically before or after the second string argument.
<TT><A HREF="#variable">variable</A></TT>s within the strings (e.g., &#X201C;<TT>%mykit%</TT>&#X201D;) are replaced by
their values. Note that variables that you want expanded <EM>must</EM> be put in %&#X2019;s,
otherwise the raw text will be used.
You may use <B><TT>STR_CMP</TT></B><A NAME="STR_CMP"></A><A NAME="@default473"></A> as a synonym for <TT><A HREF="#STRING_COMPARE">STRING_COMPARE</A></TT>. This
function works just like C&#X2019;s <TT>strcmp</TT>.
Note also that <TT><A HREF="#STRING_EQUAL">STRING_EQUAL</A></TT> and <TT><A HREF="#STRING_COMPARE">STRING_COMPARE</A></TT> are similar,
but <TT><A HREF="#STRING_EQUAL">STRING_EQUAL</A></TT> has more intuitive return values.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#String">String</A></TT> <B><TT>STRING_COMPARE_CASE</TT></B><A NAME="STRING_COMPARE_CASE"></A><A NAME="@default474"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>This is legacy syntax for <TT><A HREF="#STRING_EQUAL_CASE">STRING_EQUAL_CASE</A></TT>:
As <TT><A HREF="#STRING_COMPARE">STRING_COMPARE</A></TT>, but the comparison ignores case. That is,
<TT>"ANOMEN"</TT> and <TT>"aNoMeN"</TT> are considered equal.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#String">String</A></TT> <B><TT>STRING_EQUAL</TT></B><A NAME="STRING_EQUAL"></A><A NAME="@default475"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>This expression evaluates to 1 if and only if its two string arguments are
equal (have the same length and the same contents), otherwise it values to 0.
<TT><A HREF="#variable">variable</A></TT>s within the strings (e.g., &#X201C;<TT>%mykit%</TT>&#X201D;) are replaced
by their values.
Note that variables that you want expanded <EM>must</EM> be put in %&#X2019;s,
otherwise the raw text will be used.
Note also that <TT><A HREF="#STRING_EQUAL">STRING_EQUAL</A></TT> and <TT><A HREF="#STRING_COMPARE">STRING_COMPARE</A></TT> are similar, 
but <TT><A HREF="#STRING_EQUAL">STRING_EQUAL</A></TT> has more intuitive return values.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#String">String</A></TT> <B><TT>STRING_EQUAL_CASE</TT></B><A NAME="STRING_EQUAL_CASE"></A><A NAME="@default476"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>As <TT><A HREF="#STRING_EQUAL">STRING_EQUAL</A></TT>, but the comparison ignores case. That is,
<TT>"ANOMEN"</TT> and <TT>"aNoMeN"</TT> are considered equal.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#String">String</A></TT> <B><TT>STRING_MATCHES_REGEXP</TT></B><A NAME="STRING_MATCHES_REGEXP"></A><A NAME="@default477"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>As <TT><A HREF="#STRING_COMPARE_CASE">STRING_COMPARE_CASE</A></TT>, but the second string is treated as a
<TT><A HREF="#regexp">regexp</A></TT>. Thus <TT>"AR1005" STRING_MATCHES_REGEXP "AR[0-9]+"</TT>
evaluates to 0 (&#X201C;no difference&#X201D;). You may use
<B><TT>STRING_COMPARE_REGEXP</TT></B><A NAME="STRING_COMPARE_REGEXP"></A><A NAME="@default478"></A> as a synonym.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#String">String</A></TT> <B><TT>STRING_CONTAINS_REGEXP</TT></B><A NAME="STRING_CONTAINS_REGEXP"></A><A NAME="@default479"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>As <TT><A HREF="#STRING_MATCHES_REGEXP">STRING_MATCHES_REGEXP</A></TT>, but it evaluates to 0 if the first string
contains the second <TT><A HREF="#regexp">regexp</A></TT>. Thus <TT>"AR1005" STRING_CONTAINS_REGEXP
"[w-z]"</TT> evaluates to 1 (&#X201C;mismatch&#X201D;).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>GAME_IS</TT></B><A NAME="GAME_IS"></A><A NAME="@default480"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>Returns true if the IE game variant
is one of the entries in String, otherwise it returns false. String is a list of
whitespace-separated entries, chosen from (case doesn&#X2019;t matter)
<CODE>bg2=soa, tob, iwd2, pst, bg1, totsc, iwd=iwd1, how, tolm=totlm, tutu, tutu_totsc, bgt, ca, iwd_in_bg2</CODE>.
In the list, <CODE>bg2=soa</CODE> means that <CODE>bg2</CODE> and <CODE>soa</CODE> are synonyms,
and you can use whichever one you like. Please note that the items in the list are
defined to be mutually exclusive (except <CODE>tob</CODE> will detect both plain ToB
and ToB with BGT installed, for legacy purposes), so <CODE>bg2</CODE> will detect a
SoA-only game, without either ToB or Tutu installed. As such, a mod which is
usable with any flavor of BG2 and any flavor of Tutu would contain
<CODE>REQUIRE_PREDICATE GAME_IS ~bg2 tob tutu tutu_totsc~</CODE> .</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ENGINE_IS</TT></B><A NAME="ENGINE_IS"></A><A NAME="@default481"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>Functions like <TT><A HREF="#GAME_IS">GAME_IS</A></TT> 
except <CODE>bg2=soa</CODE> will detect SoA-based Tutu games in addition to SoA games,
and <CODE>tob</CODE> will detect ToB-based Tutu games in addition to ToB and BGT games.
As such, a mod that requires Throne of Bhaal&#X2019;s engine enhancements could use
<CODE>REQUIRE_PREDICATE ENGINE_IS ~tob~</CODE> .</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>IDS_OF_SYMBOL</TT></B><A NAME="IDS_OF_SYMBOL"></A><A NAME="@default482"></A> (File <TT><A HREF="#String">String</A></TT>)</TD><TD VALIGN=top ALIGN=left>Will return the number associated with String in File.ids,
or -1 if String is not associated in File.ids.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>VARIABLE_IS_SET</TT></B><A NAME="VARIABLE_IS_SET"></A><A NAME="@default483"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>Returns true if the variable String is set (there&#X2019;s a variable called either
<CODE>String</CODE> or <CODE>%String%</CODE>, regardless of whether it is a string or an
integer).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>IS_AN_INT</TT></B><A NAME="@default484"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>Returns true if the variable String is set to an integer (there&#X2019;s a variable called either
<CODE>String</CODE> or <CODE>%String%</CODE> with integer value).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>TRA_ENTRY_EXISTS</TT></B><A NAME="TRA_ENTRY_EXISTS"></A><A NAME="@default485"></A> ( <TT><A HREF="#String">String</A></TT> <TT><A HREF="#String">String</A></TT> <FONT COLOR="red"> list </FONT>)</TD><TD VALIGN=top ALIGN=left>	returns true if the variable String maps to a valid TRA entry.
	If the <TT><A HREF="#String">String</A></TT> list is empty the tra entry is looked for into the loaded TRAs,
	otherwise it&#X2019;s looked for into the listed TRA files.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>IS_SILENT</TT></B><A NAME="@default486"></A></TD><TD VALIGN=top ALIGN=left>Returns true if the output is currently silenced, false otherwise.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>MOD_IS_INSTALLED</TT></B><A NAME="MOD_IS_INSTALLED"></A><A NAME="@default487"></A> modTp2Name modComponent</TD><TD VALIGN=top ALIGN=left>Returns true if the modComponent of modTp2Name is installed. The syntax
is the same as with <TT><A HREF="#REQUIRE_COMPONENT">REQUIRE_COMPONENT</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INSTALL_ORDER</TT></B><A NAME="INSTALL_ORDER"></A><A NAME="@default488"></A> modTp2Name1 modComponent1 AFTER modTp2Name2 modComponent2</TD><TD VALIGN=top ALIGN=left>Returns true if the modComponent1 of modTp2Name1 is installed after the modComponent2
of modTp2Name2 (and both components are installed). The syntax
is the same as with <TT><A HREF="#REQUIRE_COMPONENT">REQUIRE_COMPONENT</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INSTALL_ORDER</TT></B><A NAME="@default489"></A> modTp2Name1 modComponent1 BEFORE modTp2Name2 modComponent2</TD><TD VALIGN=top ALIGN=left>Returns true if the modComponent1 of modTp2Name1 is installed before the modComponent2
of modTp2Name2 (and both components are installed). The syntax
is the same as with <TT><A HREF="#REQUIRE_COMPONENT">REQUIRE_COMPONENT</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>ID_OF_LABEL</TT></B><A NAME="ID_OF_LABEL"></A><A NAME="@default490"></A> modTp2Name String</TD><TD VALIGN=top ALIGN=left> Returns the numerical identifier of the component in modTp2Name which has
the given <TT><A HREF="#LABEL">LABEL</A></TT>. Returns min_int (usually -2^30) if no such tp2
exists, said tp2 has no component with that <TT><A HREF="#LABEL">LABEL</A></TT>, or two or more
components have that <TT><A HREF="#LABEL">LABEL</A></TT>. In the last two cases will print a
WARNING.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>STATE_WHICH_SAYS</TT></B><A NAME="STATE_WHICH_SAYS"></A><A NAME="@default491"></A> <TT><A HREF="#text">text</A></TT> <TT>FROM</TT> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left> String must be an in-game or in-override .dlg file. Returns:
<OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Fails the installation if it can&#X2019;t evaluate the text (an <TT>@x</TT> reference out of bounds)
</LI><LI CLASS="li-enumerate">-3 if the text is not currently in the tlk or in the list of strings to add
</LI><LI CLASS="li-enumerate">-2 if the text is spoken (= <CODE>SAY ~Foo~</CODE>) at least twice in the file String
</LI><LI CLASS="li-enumerate">-1 if the text is never spoken in the file String
</LI></OL>
Otherwise it returns the number of the state in which text is spoken in the file String.
<TT>@x</TT> references are taken from the loaded TRA files (the ones defined in the 
<TT><A HREF="#Language">Language</A></TT> part).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>STATE_WHICH_SAYS</TT></B><A NAME="@default492"></A> <TT><A HREF="#value">value</A> IN <A HREF="#String">String</A>1 FROM <A HREF="#String">String</A>2</TT></TD><TD VALIGN=top ALIGN=left> As above, except that <TT>@x</TT> references are taken from
the String1 tra file. In particular, one <CODE>%s</CODE> in String1 is expanded to the list 
of directories; for example (as of Sola v102), <CODE>solarom/%s/epilogue.tra</CODE> would match
<PRE CLASS="verbatim">    solarom/american/epilogue.tra
    solarom/french/epilogue.tra
    solarom/german/epilogue.tra
    solarom/italian/epilogue.tra
    solarom/polski/epilogue.tra
    solarom/portuguese/epilogue.tra
    solarom/russian/epilogue.tra
</PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>RESOLVE_STR_REF</TT></B><A NAME="RESOLVE_STR_REF"></A><A NAME="@default493"></A> ( <TT><A HREF="#text">text</A></TT> )</TD><TD VALIGN=top ALIGN=left>Resolves the given text (adding it to the tlk), and returns its TLK index
(so you can pass the result of this command to a function which then uses
<TT><A HREF="#WRITE_LONG">WRITE_LONG</A></TT> rather than <TT><A HREF="#SAY">SAY</A></TT>).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>RANDOM</TT></B><A NAME="RANDOM"></A><A NAME="@default494"></A> ( <TT><A HREF="#value">value</A></TT> <TT><A HREF="#value">value</A></TT> )</TD><TD VALIGN=top ALIGN=left>A random-number generator. The first <TT><A HREF="#value">value</A></TT> is the lower bound, the
second value is the upper bound. A random integer between the lower bound
and the upper bound (inclusive) is returned. Thus <TT>RANDOM(3 5)</TT> can
return 3, 4 or 5. If the lower bound is greater than the upper bound, zero
is returned. See also <TT><A HREF="#RANDOM_SEED">RANDOM_SEED</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>BUFFER_LENGTH</TT></B><A NAME="BUFFER_LENGTH"></A><A NAME="@default495"></A></TD><TD VALIGN=top ALIGN=left>Returns the length of the string currently being patched, or 0 if outside of
a patch expression.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INDEX</TT></B><A NAME="INDEX"></A><A NAME="@default496"></A> ( <TT><A HREF="#optcase">optcase</A></TT> <TT><A HREF="#optexact">optexact</A></TT> <TT><A HREF="#string">string</A></TT>1
<TT><A HREF="#string">string</A></TT>2 <FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT>)</TD><TD VALIGN=top ALIGN=left>Returns the index of the first regexp match of string1 inside string2, or
-1 if not found. If provided, value specifies from what point of string2
the searching should begin (instead of 0).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>RINDEX</TT></B><A NAME="RINDEX"></A><A NAME="@default497"></A> ( <TT><A HREF="#optcase">optcase</A></TT> <TT><A HREF="#optexact">optexact</A></TT> <TT><A HREF="#string">string</A></TT>1
<TT><A HREF="#string">string</A></TT>2 <FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT>)</TD><TD VALIGN=top ALIGN=left>Returns the index of the last regexp match of string1 inside string2, or
-1 if not found. If provided, value specifies from what point of string2
the searching should begin (instead of STRING_LENGTH string2).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>INDEX_BUFFER</TT></B><A NAME="INDEX_BUFFER"></A><A NAME="@default498"></A> ( <TT><A HREF="#optcase">optcase</A></TT> <TT><A HREF="#optexact">optexact</A></TT> <TT><A HREF="#string">string</A></TT>
<FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT>)</TD><TD VALIGN=top ALIGN=left>Returns the index of the first regexp match of string inside the current string, or
-1 if not found. If provided, value specifies from what point of the string
the searching should begin (instead of 0).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>RINDEX_BUFFER</TT></B><A NAME="RINDEX_BUFFER"></A><A NAME="@default499"></A> ( <TT><A HREF="#optcase">optcase</A></TT> <TT><A HREF="#optexact">optexact</A></TT> <TT><A HREF="#string">string</A></TT>
<FONT COLOR="red"> [ </FONT><TT><A HREF="#value">value</A></TT> <FONT COLOR="red"> ] </FONT>)</TD><TD VALIGN=top ALIGN=left>Returns the index of the last regexp match of string inside the current string, or
-1 if not found. If provided, value specifies from what point of the string
the searching should begin (instead of BUFFER_LENGTH).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP> or</TD><TD VALIGN=top ALIGN=left><B><TT>STRING_LENGTH</TT></B><A NAME="STRING_LENGTH"></A><A NAME="@default500"></A> <TT><A HREF="#String">String</A></TT></TD><TD VALIGN=top ALIGN=left>Returns the length of the argument <TT><A HREF="#String">String</A></TT> (after variable evaluation).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>FILE_CONTAINS</TT></B><A NAME="FILE_CONTAINS"></A><A NAME="@default501"></A> fileName <TT><A HREF="#regexp">regexp</A></TT></TD><TD VALIGN=top ALIGN=left>Evaluates to 1 if
the file <TT>fileName</TT> contains the regular expression <TT><A HREF="#regexp">regexp</A></TT>
and 0 otherwise. Case is ignored.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>FILE_CONTAINS_EVALUATED</TT></B><A NAME="FILE_CONTAINS_EVALUATED"></A><A NAME="@default502"></A> ( fileName varsRegexp )</TD><TD VALIGN=top ALIGN=left> First, all WeiDU variables enclosed in <TT>%</TT>s in <TT>varsRegexp</TT> and
<TT>fileName</TT> are
substituted. The expression is 1 if the resulting <TT><A HREF="#regexp">regexp</A></TT> occurs
in <TT>fileName</TT> and 0 otherwise. If <TT>fileName</TT> does not exist or has
size 0, the result is 0. The comparison ignores case. See also
<TT><A HREF="#FILE_CONTAINS">FILE_CONTAINS</A></TT>. Example:
<PRE CLASS="verbatim">COPY_EXISTING_REGEXP ~.*\.CRE~ ~override~
  READ_BYTE   0x273 class
  READ_ASCII  0x280 deathvar
  PATCH_IF (class = 14) AND // class 14 = CLERIC_MAGE
           (NOT FILE_CONTAINS_EVALUATED(~pdialog.2da~
                                        ~%deathvar%~))
    THEN BEGIN
      ADD_CRE_ITEM ~POTN08~ #10 #10 #10 ~IDENTIFIED~ ~INV15~
    END
  BUT_ONLY_IF_IT_CHANGES
</PRE>The example gives ten healing potions to all cleric-mages who cannot join
the party. Notably it excludes Aerie
since she has the death variable <TT>Aerie</TT> and <TT>pdialog.2da</TT> contains
<TT>AERIE</TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
is</TD><TD VALIGN=top ALIGN=left><B><TT>FILE_EXISTS</TT></B><A NAME="FILE_EXISTS"></A><A NAME="@default503"></A> fileName</TD><TD VALIGN=top ALIGN=left>Evaluates to 1 if the file exists in the
filesystem and has non-zero size (or the bif file is referenced inside
the chitin.key) and evaluates to 0 otherwise.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>FILE_EXISTS_IN_GAME</TT></B><A NAME="FILE_EXISTS_IN_GAME"></A><A NAME="@default504"></A> fileName</TD><TD VALIGN=top ALIGN=left>Evaluates to 1 if the file
exists as a game resource and has non-zero size. Evaluates to 0 otherwise.
<TT><A HREF="#BIFF">BIFF</A></TT>s and the <TT>override</TT> directory are searched in the standard
manner. Evaluates to 0 for a file that does not exist but has been
<TT><A HREF="#ALLOW_MISSING">ALLOW_MISSING</A></TT>&#X2019;d.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>FILE_MD5</TT></B><A NAME="FILE_MD5"></A><A NAME="@default505"></A> fileName md5sum</TD><TD VALIGN=top ALIGN=left>Evaluates to 1 if the file exists
and has the given MD5 checksum. Evaluates to 0 otherwise. Two different
files are exceptionally unlikely to have the same MD5 checksum. In any
event, the discovered checksum is printed to the log. If the file does not
exist, it evaluates to 0.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>FILE_IS_IN_COMPRESSED_BIFF</TT></B><A NAME="FILE_IS_IN_COMPRESSED_BIFF"></A><A NAME="@default506"></A> fileName</TD><TD VALIGN=top ALIGN=left>Evaluates to 1 if the file
is stored in a compressed biff (ignoring copies in the override). Evaluates to
0 otherwise (the file is not in a biff, or it is in an uncompressed biff).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>BIFF_IS_COMPRESSED</TT></B><A NAME="BIFF_IS_COMPRESSED"></A><A NAME="@default507"></A> fileName</TD><TD VALIGN=top ALIGN=left>Evaluates to 1 if the file
is a compressed biff. Evaluates to 0 otherwise.<P>FileName must match against the contents of what is stored in chitin.key
(similar to how command-line arguments that touch bif files work). For
example, <CODE>data/AREA000A.bif</CODE>. Notably, <TT><A HREF="#SOURCE_BIFF">SOURCE_BIFF</A></TT> outputs
file names compatible with this command.</P></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><B><TT>FILE_SIZE</TT></B><A NAME="FILE_SIZE"></A><A NAME="@default508"></A> fileName fileSize</TD><TD VALIGN=top ALIGN=left>Evaluates to 1 if the
size of the file <TT>fileName</TT> is exactly <TT>fileSize</TT>. Evaluates to 0
otherwise.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>%<A HREF="#variable">variable</A>%</TT></TD><TD VALIGN=top ALIGN=left> The value of the <TT><A HREF="#variable">variable</A></TT> is used.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><B><TT>EVALUATE_BUFFER</TT></B><A NAME="@default509"></A> <TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> User variables inside the given string are evaluated one additional
time. You may prepend <TT><A HREF="#EVALUATE_BUFFER">EVALUATE_BUFFER</A></TT> when a <TT><A HREF="#value">value</A></TT> is
called for and you would normally use a string. You may also use it for
<TT><A HREF="#SET">SET</A></TT> and <TT><A HREF="#SPRINT">SPRINT</A></TT> statements. Example:
<PRE CLASS="verbatim">    SPRINT x ~y~
    SET y = 5
    SPRINT z EVALUATE_BUFFER ~tricky %%x%%~
    SET EVALUATE_BUFFER "%x%" += 77
    PATCH_PRINT "y is %y% ; z is %z%"
</PRE>This prints out <TT>y is 82 ; z is tricky 5</TT>. You may also do hackery like
<TT>FILE_SIZE "myfile" "%%indirection%%"</TT>. Be very careful with this
feature.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><CODE>$array(index list)</CODE></TD><TD VALIGN=top ALIGN=left> The so-called <TT><A HREF="#array construct">array construct</A></TT>. See the tutorial.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>%<B>WEIDU_ARCH</B></TT><A NAME="WEIDU_ARCH"></A><A NAME="@default510"></A><TT>%</TT></TD><TD VALIGN=top ALIGN=left>The special variable <TT>WEIDU_ARCH</TT>
is set to either <TT>"x86"</TT> or <TT>"mac"</TT> at WeiDU startup and can be used to
determine the underlying system architecture.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>%<B>WEIDU_OS</B></TT><A NAME="WEIDU_OS"></A><A NAME="@default511"></A><TT>%</TT></TD><TD VALIGN=top ALIGN=left>The special variable <TT>WEIDU_OS</TT> is set to either
<TT>"win32"</TT> or <TT>"osx"</TT> or <TT>"unix"</TT> at WeiDU startup and can be used to
determine the underlying operating system.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>%<B>COMPONENT_NUMBER</B></TT><A NAME="COMPONENT_NUMBER"></A><A NAME="@default512"></A><TT>%</TT></TD><TD VALIGN=top ALIGN=left>The special variable <TT>COMPONENT_NUMBER</TT>
is set to the number of the component being installed.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>%<B>INTERACTIVE</B></TT><A NAME="INTERACTIVE"></A><A NAME="@default513"></A><TT>%</TT></TD><TD VALIGN=top ALIGN=left>The special variable <TT>INTERACTIVE</TT>
is set to 1 if the install is being done interactively (IE you launched setup-mymod.exe and you&#X2019;re
installing mymod), or is set to 0 if the install is being done non-interactively (IE you launched
setup-mymod.exe and now weidu is reinstalling othermod due to the domino uninstall and reinstall).</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT><A HREF="#variable">variable</A></TT></TD><TD VALIGN=top ALIGN=left> The value of the <TT><A HREF="#variable">variable</A></TT> is used.
In a <TT><A HREF="#patch">patch</A></TT> <TT><A HREF="#value">value</A></TT>, you may use either <TT>%myvar%</TT> or
<TT>myvar</TT> to get the value of a variable, provided that your variable&#X2019;s
name is not the same as a WeiDU syntactic keyword or known
<TT><A HREF="#constant">constant</A></TT>. Also note that while it is common to &#X201C;call out&#X201D;
variables by putting quotation marks around them, this is not necessary
if the variable is unambiguous. Thus the following three <TT><A HREF="#patch">patch</A></TT>es
are all equivalent:
<PRE CLASS="verbatim">  SET "x" = "%y%" + "%z%"       // these all
  SET "x" = "y" + "z"           //    do the
  SET x = y + z                 //  same thing
</PRE></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
or</TD><TD VALIGN=top ALIGN=left><TT>NAME1</TT></TD><TD VALIGN=top ALIGN=left>The offset within an infinity engine resource where the unidentified general name (e.g., "Battle Axe") is stored.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>NAME2</TT></TD><TD VALIGN=top ALIGN=left>The offset within an infinity engine resource where the identified general name (e.g., "K&#X2019;logarath +4") is stored.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>UNIDENTIFIED_DESC</TT></TD><TD VALIGN=top ALIGN=left>The offset within an infinity engine resource where the unidentified description (e.g., "The hand axe or throwing axe is also known as a hatchet ...") is stored.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>IDENTIFIED_DESC</TT></TD><TD VALIGN=top ALIGN=left>As above ... ("Clans have gone to war to possess K&#X2019;log...")</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left><TT>BIO</TT></TD><TD VALIGN=top ALIGN=left>As above ... NPC Biography</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>or</TD><TD VALIGN=top ALIGN=left>...</TD><TD VALIGN=top ALIGN=left>Almost everything in <TT>SNDSLOT.IDS</TT> or <TT>SOUNDOFF.IDS</TT>
works as well.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>&nbsp;</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>
<B><TT>variable</TT></B><A NAME="variable"></A><A NAME="@default514"></A></TD><TD VALIGN=top ALIGN=left>&nbsp;</TD><TD VALIGN=top ALIGN=left>A variable is a textual name that holds a
<TT><A HREF="#value">value</A></TT>. Variables are usually set with <TT><A HREF="#READ_BYTE">READ_BYTE</A></TT>,
<TT><A HREF="#SET">SET</A></TT> or <TT><A HREF="#SPRINT">SPRINT</A></TT>.</TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>is</TD><TD VALIGN=top ALIGN=left>string</TD><TD VALIGN=top ALIGN=left>You may name the variable whatever you like, but stay
away from the special characters used in <TT><A HREF="#regexp">regexp</A></TT>s. When you want to
obtain the value of a variable, enclose it in <TT>%</TT>s.<P>Example: If a file contains the two binary integers 33 and 77, then after
executing:</P><PRE CLASS="verbatim">READ_LONG   0 ~myvar~
WRITE_LONG  4 ( ~%myvar%~ + 11 )
</PRE><P>The file will contain the two binary integers 33 and 44.</P></TD></TR>
</TABLE><!--TOC section WeiDU <TT>TP2 Tutorials</TT>-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc20">9</A>&#XA0;&#XA0;WeiDU <TT><A HREF="#TP2">TP2</A></TT> Tutorials</H2><!--SEC END --><P>
<A NAME="TP Tutorials"></A></P><P>Note: it&#X2019;s advised to read these tutorials in the order they were written,
as often a tutorial depends on contents explained in the tutorials before
it. If the tutorial-writer is kind enough, they&#X2019;ll state dependencies while
introducing the subject.</P><!--TOC subsection <TT>COPY_EXISTING_REGEXP</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc21">9.1</A>&#XA0;&#XA0;<TT><A HREF="#COPY_EXISTING_REGEXP">COPY_EXISTING_REGEXP</A></TT></H3><!--SEC END --><P> 
This tutorial was thoughtfully provided by Japheth.</P><P>The purpose of <TT><A HREF="#COPY_EXISTING">COPY_EXISTING</A></TT> and <TT><A HREF="#COPY_EXISTING_REGEXP">COPY_EXISTING_REGEXP</A></TT> is to
patch a file for patching. It will grab the file out of the <TT><A HREF="#BIFF">BIFF</A></TT>s,
or if an <TT>override</TT> version exists, it will grab it out of the override
folder.</P><P><TT><A HREF="#COPY_EXISTING_REGEXP">COPY_EXISTING_REGEXP</A></TT>, <TT><A HREF="#EXTEND_BOTTOM_REGEXP">EXTEND_BOTTOM_REGEXP</A></TT> and
<TT><A HREF="#EXTEND_TOP_REGEXP">EXTEND_TOP_REGEXP</A></TT> can be potentially powerful actions if you need
to make some changes to a certain set of files all in one shot.</P><P>Consider this example for <TT><A HREF="#COPY_EXISTING_REGEXP">COPY_EXISTING_REGEXP</A></TT>:</P><P>In my mod I want to make it so that all 1-handed swords only do D6 damage,
rather than the varying damages they do in SOA. To do this with the
"normal" <TT><A HREF="#COPY_EXISTING">COPY_EXISTING</A></TT>, I would have to write out all the one
handed swords like this:</P><PRE CLASS="verbatim">COPY_EXISTING ~sw1h01.itm~ ~override/sw1h01.itm~
              ~sw1h02.itm~ ~override/sw1h02.itm~
              etc...
</PRE><P>That could take a lot of time to do. Using <TT><A HREF="#COPY_EXISTING_REGEXP">COPY_EXISTING_REGEXP</A></TT> I
can minimize writing 70+ lines of code into 3 lines of code. Take a look
at this:</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP ~sw1h..[^abc].*itm~ ~override~
  WRITE_LONG 0x88 "6"
  WRITE_LONG 0x8a "1" 
</PRE><P>I&#X2019;ll explain how the <TT><A HREF="#regexp">regexp</A></TT> wildcards in the above example work:
I want to avoid copying over the files sw1h54a.itm, sw1h54b.itm and
sw1h54c.itm because they are the three components that make up the
Equalizer, and because of that, the offsets of 0x88 and 0x8a won&#X2019;t work
because they don&#X2019;t exist in those items.</P><P>To find which offset to <TT><A HREF="#WRITE_LONG">WRITE_LONG</A></TT> at I opened up Near Infinity,
(found at <TT><A HREF="http://www.idi.ntnu.no/~joh/ni/">http://www.idi.ntnu.no/~joh/ni/</A></TT>)
and looked up the offset with
it. Fortunately for us, the offset is the same in all items, so we can
make the changes in one shot. <TT><A HREF="#WRITE_LONG">WRITE_LONG</A> 0x88 "6"</TT> is telling
WeiDU to write the value of 6 at offset 88 hex. Similarly, <TT><A HREF="#WRITE_LONG">WRITE_LONG</A> 0x8a "1"</TT> is telling WeiDU to write the value 1 at
offset 8a hex.</P><P>The 6 is the dice size and the 1 is the number of dice.</P><!--TOC subsection <TT>EXTEND_TOP_REGEXP</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc22">9.2</A>&#XA0;&#XA0;<TT><A HREF="#EXTEND_TOP_REGEXP">EXTEND_TOP_REGEXP</A></TT></H3><!--SEC END --><P> 
This tutorial was thoughtfully provided by Japheth.</P><P>Let&#X2019;s take this situation that I was in:</P><P>I am making a Hirelings mod, and in order to get non party NPC&#X2019;s to
transition from area to area, I needed to make use of a combination of
MakeGlobal(), InMyArea(O:Object*) and MoveGlobalObject(O:Object*,O:Target*). </P><P>I originally put the script that moves them from area to area into
baldur.bcs (this script is constantly running in the game), but for some
strange reason, the cre&#X2019;s wouldn&#X2019;t move to smaller areas, only the large
"main" areas. (Like The Docks, Temple District, Slums, etc.) So I
figured, "Huh, guess I&#X2019;m going to have to put the script in every area
script". (Area scripts are scripts that are assigned to areas that are ran
while you are in the area. Pretty obvious right?)</P><P>Now, writing the code to <TT><A HREF="#EXTEND_TOP">EXTEND_TOP</A></TT> this little script into every area
script would of taken quite a while, and well, rather than do that, I
humbly requested Wes to implement the <TT><A HREF="#regexp">regexp</A></TT> feature of 
<TT><A HREF="#EXTEND_TOP">EXTEND_TOP</A></TT> and <TT><A HREF="#EXTEND_BOTTOM">EXTEND_BOTTOM</A></TT>, and he obliged. (My penance
for that request is writing the docs you are reading right now.)</P><P>So now with Wes&#X2019; help, I could <TT><A HREF="#EXTEND_TOP">EXTEND_TOP</A></TT> to every area in 1 fell
swoop. If you were to open up NI and expand the <TT><A HREF="#BCS">BCS</A></TT> tree, you
would see a whole crapload of scripts that begin with the prefix AR. These
are the area scripts I mentioned before. They go from
AR0014 to AR6400. So now, using <TT><A HREF="#regexp">regexp</A></TT>, here is how you would
extend the script to the top of every area script:</P><PRE CLASS="verbatim">EXTEND_TOP_REGEXP ~ar[0-6].*bcs~ ~pathtoscript/patch.bcs~
</PRE><P>So there we are, instead of 100+ lines of code, I minimized it to 1 lines.
Now, if you are understanding regexp at all, you probably are going &#X201C;Hey
wait, why didn&#X2019;t you just go <TT><A HREF="#EXTEND_TOP_REGEXP">EXTEND_TOP_REGEXP</A> "ar.*bcs"
"pathtoscript/patch.bcs"</TT> ?&#X201D; Well, in fact, I did do that at first, but I
forgot to account that there are other &#X201C;normal&#X201D; scripts that begin with AR.
So, I had to write it so that the <TT><A HREF="#regexp">regexp</A></TT> had the number after the
initial AR so that WeiDU would know only to patch the script to area files.</P><!--TOC subsection <TT>READ_BYTE and PATCH_IF (Last update: v189)</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc23">9.3</A>&#XA0;&#XA0;<TT><A HREF="#READ_BYTE">READ_BYTE</A></TT> and <TT><A HREF="#PATCH_IF">PATCH_IF</A></TT> (Last update: v189)</H3><!--SEC END --><P>This tutorial was thoughtfully provided by Japheth, and shamelessly edited
by Bigg to use PATCH_IF rather than IF_EVAL.</P><P><TT><A HREF="#READ_BYTE">READ_BYTE</A></TT>, <TT><A HREF="#READ_SHORT">READ_SHORT</A></TT> and <TT><A HREF="#READ_LONG">READ_LONG</A></TT> can be
potentially powerful functions when used in conjunction with
<TT><A HREF="#PATCH_IF">PATCH_IF</A></TT>.</P><P>Here&#X2019;s a brief demonstration.</P><P>The scenario: I want to make all longswords in the game do 1D6 damage,
rather than their normal 1D8. To do that manually would be a pain, so why
not use the great feature of <TT><A HREF="#READ_BYTE">READ_BYTE</A></TT>/LONG/SHORT?</P><P>Here&#X2019;s how it&#X2019;s done.</P><P>First of all, we need to copy all the items so they are ready to be patched. 
Here&#X2019;s how we do that:</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
</PRE><P>All this does is copy all files with a .itm extension to the override folder.</P><P>Next, we read the item category offset into a variable. We&#X2019;ll use the variable 
name "type".</P><PRE CLASS="verbatim">READ_BYTE "0x1c" "type"
</PRE><P>I found the offset by looking at an item file in Near Infinity. The
variable "type" can really be anything, it&#X2019;s just what I&#X2019;ve chosen.</P><P>We should edit the item only if the item is really a longsword:</P><PRE CLASS="verbatim">PATCH_IF ("%type%" = "0x14") BEGIN
</PRE><P>So, to call back our variable, you just wrap it with % signs. 0x14 is just
the value for longsword. If you look at the Category offset in Near
Infinity (which is 0x1c), and scroll down in the box below, you&#X2019;ll see
Longsword (20). The 20 just represents the decimal value. 0x14 is just 20
in hexadecimal.</P><P>Now that we&#X2019;re done reading that into a variable and doing the checks, we can now
<TT><A HREF="#WRITE_SHORT">WRITE_SHORT</A></TT> the values we want to give our new longswords. Namely,
6 for damage and 1 for dice size. (Or, 1D6 for simplicity sake.)</P><PRE CLASS="verbatim">WRITE_SHORT 0x88 6
WRITE_SHORT 0x8a 1
</PRE><P>0x88 is the offset for dicesize and 0x8a is the offset for the number of
dice. Again, I found these offsets using Near Infinity beforehand.</P><PRE CLASS="verbatim">END
BUT_ONLY_IF_IT_CHANGES
</PRE><P>Finally, we close the BEGIN that was after PATCH_IF and tell WeiDU not to copy
the item if it didn&#X2019;t change (IE, if it wasn&#X2019;t a long sword).</P><P>So, to loop through the logic again, this is what we&#X2019;re saying:</P><P>If the category is longsword, make the dice size 6 and the dice damage 1. If 
there are no changes, ignore the file and don&#X2019;t copy it over.</P><P>And that&#X2019;s it. Now all items with the category Longsword will have 1D6 as their 
dice damage. Pretty neat eh? Obviously you can do many, many other types of 
thing with these functions. So go ahead and experiment.</P><P>Here&#X2019;s the full code:</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
  READ_BYTE     "0x1c" "type"

  PATCH_IF ("%type%" = "0x14") BEGIN
    WRITE_SHORT   0x88 6
    WRITE_SHORT   0x8a 1

  END
BUT_ONLY_IF_IT_CHANGES
</PRE><P>Oh yeah, and if you&#X2019;re going "But I don&#X2019;t know when to <TT><A HREF="#READ_SHORT">READ_SHORT</A></TT>
or <TT><A HREF="#WRITE_LONG">WRITE_LONG</A></TT>. It&#X2019;s so confusing," don&#X2019;t worry, cause
it kind of is if you&#X2019;ve never worked with bytes before. Here&#X2019;s a very brief
synopsis.</P><P>Use READ/WRITE_SHORT for anything that is two bytes. You can determine this
easily by looking at the field you want to change in NI and subtracting the
next listed field&#X2019;s offset from the offset of the field you want to change.</P><P>For example, if I wanted to change Bodhi&#X2019;s Max HP here&#X2019;s what I would do.
First look at her creature file in NI. (She has many, but for the sake of
argument, we&#X2019;ll use bodhi.cre). If you look at the Max HP field, it says
it&#X2019;s offset is 26h. The next field in the creature file is Animation ID,
which is 28h. So, subtracting 28h from 26h gives you 2h. The perfect
<TT><A HREF="#WRITE_SHORT">WRITE_SHORT</A></TT> size.</P><P>Use READ/WRITE_LONG for anything that is 4 bytes. Use the above example to
figure this out as well.</P><P>Use READ/WRITE_BYTE for anything that is one byte. Again, use the
above example to figure this out.</P><P>Use <TT><A HREF="#WRITE_ASCII">WRITE_ASCII</A></TT> for things like death variable, dialogues, scripts,
etc. Note, that if you&#X2019;re <TT><A HREF="#WRITE_ASCII">WRITE_ASCII</A></TT>ing to say, the death
variable, and the previous death variable entry is longer than the one
you&#X2019;re writing, then you&#X2019;ll have spillover after <TT><A HREF="#WRITE_ASCII">WRITE_ASCII</A></TT>. To
avoid this, embed a null character at the end of your string. So, if I have 
</P><PRE CLASS="verbatim">WRITE_ASCII 0x280 ~Guy~
</PRE><P>I would want to put a null character right after the y in Guy. You can do
this by using a hex editor and inserting 00 after the y.</P><P>These are by no means "hard and fast" rules, but generally they ring true.
However, there could be times when you need to <TT><A HREF="#WRITE_LONG">WRITE_LONG</A></TT> twice if
the field is 8 bytes long, etc.</P><P>Also, if you tried to run the template, you&#X2019;d have noticed that it didn&#X2019;t work
correctly. That&#X2019;s because there are some corrupt files in the key (that is,
files of size 0). To avoid that, WeiDU gives us the <CODE>%SOURCE_SIZE%</CODE> variable,
which is set to the original file size. We can simply check that the file is
large enough (using either NI or the IESDP, we see that a basic itm file must
have at least 0x72 bytes long, so we can check that before doing anything:</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
  PATCH_IF ("%SOURCE_SIZE%" &gt; "0x71") BEGIN
    READ_BYTE     "0x1c" "type"
  
    PATCH_IF ("%type%" = "0x14") BEGIN
      WRITE_SHORT   0x88 6
      WRITE_SHORT   0x8a 1
  
    END
  END
BUT_ONLY_IF_IT_CHANGES
</PRE><P>Again, we instruct WeiDU to not do a thing if the file is not large enough.</P><P>And that, as they say, is that.</P><!--TOC subsection <TT>values and expressions (Last update: v189)</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc24">9.4</A>&#XA0;&#XA0;<TT><A HREF="#value">value</A></TT>s and expressions (Last update: v189)</H3><!--SEC END --><P>
This tutorial was thoughtfully provided by Japheth, and shamelessly edited
by Bigg to use PATCH_IF rather than IF_EVAL.</P><P>Using expressions with WeiDU can get quite complex, however the power they
give you is more than worth the effort in learning how to use them.</P><P>Say, for instance, that you want to give a creature file a shield that
doesn&#X2019;t have one originally. The old way to do this would be to add the
item to the creature file using Near Infinity or ShadowKeeper and then copy
that creature file over upon installation of your mod. However, now that
INSERT/DELETE_BYTES and READ/WRITE_BYTE/LONG/SHORT take expressions, we can
do this "on the fly" when installing your mod.</P><P>The benefits of doing it this way should be obvious. Now you no longer
have to overwrite someone else&#X2019;s modifications to that creature file. You
can simply add your shield and leave their modifications intact. (Unless
of course *they* also decided to give the exact same creature a shield.
And if that&#X2019;s the case, the shield you specify won&#X2019;t be used because of our
<TT><A HREF="#PATCH_IF">PATCH_IF</A></TT> statement.)</P><P>Anyways, on to the example. I&#X2019;ll use acolyte1.cre as my example creature.</P><P>The first thing we want to do is copy the creature over so it&#X2019;s ready for 
patching, and ensure it isn&#X2019;t corrupt. That&#X2019;s easy to do using a simple <TT><A HREF="#COPY_EXISTING">COPY_EXISTING</A></TT>
statement:</P><PRE CLASS="verbatim">COPY_EXISTING ~acolyte1.cre~ ~override/acolyte1.cre~
PATCH_IF ("%SOURCE_SIZE%" &gt; "0x2d3") BEGIN
</PRE><P>Next, we need to read in the offsets so we know where to insert our bytes and 
where to update our number of items. I figured out these offsets by simply 
viewing the creature file in Near Infinity.</P><P>The offsets we need to read in are the item slots offset, the items offset and 
the number of items. This is how we do it:</P><PRE CLASS="verbatim">READ_LONG "0x2bc" "itemsoffset"
READ_LONG "0x2b8" "itemslot"
READ_LONG "0x2c0" "#items"
</PRE><P>"itemsoffset", "itemslot" and "#items" can be anything you choose, but I
would name them something that&#X2019;s easy to remember because we&#X2019;ll be using
them later.</P><P>Next, we&#X2019;re going to read in the shield slot to make sure that it&#X2019;s empty.
We do this by taking the "itemslot" variable and adding 0x04 to it which we
know is always going to be the shield slot. (You can verify this by
looking at a creature file in NI. If you look at the offset 0x2b8 it will
have the offset for item slots. If you add 0x04 to that number, it should
equal the offset for the shield slot.)</P><P>This is done like so:</P><PRE CLASS="verbatim">READ_SHORT ("%itemslot%" + 0x04) "shield"
</PRE><P>Note: To access your variables after they&#X2019;ve been read, you always have to
wrap them in percent signs.</P><P>We want to tell WeiDU only to do this if the shield slot is
*empty*. This is where <TT><A HREF="#PATCH_IF">PATCH_IF</A></TT> comes in handy. The way a creature
file is setup is that if a slot is set to -1, it means it&#X2019;s empty. WeiDU</P><P>doesn&#X2019;t read unsigned bytes, so if the value is indeed -1, it will come out
as 65535 as the value. So, this is the statement we use to tell WeiDU only
to execute all of the above code if "%shield%" is -1:</P><PRE CLASS="verbatim">PATCH_IF ("%shield%" = "65535") BEGIN
</PRE><P>Now, we have to update the shield slot to reflect that it&#X2019;s the newest item
out of all the items the creature has equipped. This is a bit misleading
because in the slots part of the creature file, they count from 0. So, all
we need to do is take the value of 0x2c0 (The number of items the creature
has.) and use that as our value to write.</P><P>To do that, this is what we do:</P><PRE CLASS="verbatim">WRITE_SHORT ("%itemslot%" + 0x04) "%#items%"
</PRE><P>Now we have to update the itemslot offset value to reflect the fact that
we&#X2019;ve added a new item to the creature. An item is *always* 0x14 bytes.
We already know the offset of the itemslot offset and we&#X2019;ve already read
it&#X2019;s value, so all we need to do is add 0x14 to it</P><PRE CLASS="verbatim">WRITE_LONG 0x2b8 ("%itemslot%" + 0x14)
</PRE><P>The last step before inserting our bytes is to increase the #items by 1 to
reflect the fact that we&#X2019;ve added an item to the creature. We&#X2019;ve already
read in the number of items into "%#items%" so this is dead easy:</P><PRE CLASS="verbatim">WRITE_LONG 0x2c0 ("%#items%" + 1)
</PRE><P>Now we can actually insert out bytes. To do this we have to take the
number of items that the creature has multiplied by 0x14 and add that to
the itemsoffset. (The reason we can&#X2019;t just insert it right at
"%itemsoffset%" is because it would mess up the order of the items in game.
If we inserted the shield at the beginning, then the creature would more
than likely have some items equipped in some weird places in the game.)</P><P>This is done like so:</P><PRE CLASS="verbatim">INSERT_BYTES ("%itemsoffset%" + "%#items%" * 0x14) 0x14
</PRE><P>Now we can actually write our information for our item. You don&#X2019;t need the
.itm extension at all, just everything before the .itm. And again, since
the item entry is always the first entry in an item field on a creature
file, we just need to use the same formula as above because we&#X2019;ll be
writing at the same offset that we inserted our bytes at:</P><PRE CLASS="verbatim">WRITE_ASCII ("%itemsoffset%" + "%#items%" * 0x14) ~shld01~
</PRE><P>If you wanted to add a magical shield to the creature file and wanted it to
be already identified in the slot, then you would simply have to add 0x10
bytes to the previous expression and <TT><A HREF="#WRITE_LONG">WRITE_LONG</A></TT> the value of 1.
Like this:</P><PRE CLASS="verbatim">WRITE_LONG ("%itemsoffset%" + ("%#items%" * 0x14) + 0x10) 1
</PRE><P>Finally, we close the PATCH_IF statements and add BUT_ONLY_IF_CHANGES.</P><PRE CLASS="verbatim">    END
  END
BUT_ONLY_IF_IT_CHANGES
</PRE><P>Here&#X2019;s the full code:</P><PRE CLASS="verbatim">COPY_EXISTING ~acolyte1.cre~ ~override/acolyte1.cre~
  PATCH_IF ("%SOURCE_SIZE%" &gt; "0x2d3") BEGIN
    READ_LONG "0x2bc" "itemsoffset"
    READ_LONG "0x2b8" "itemslot"
    READ_LONG "0x2c0" "#items"
    READ_SHORT ("%itemslot%" + 0x04) "shield"
    
    PATCH_IF ("%shield%" = "65535") BEGIN

      WRITE_SHORT ("%itemslot%" + 0x04) "%#items%"
      WRITE_LONG 0x2b8 ("%itemslot%" + 0x14)
      WRITE_LONG 0x2c0 ("%#items%" + 1)
      
      INSERT_BYTES ("%itemsoffset%" + "%#items%" * 0x14) 0x14
      
      WRITE_ASCII ("%itemsoffset%" + "%#items%" * 0x14) ~shld01~
    END
  END
BUT_ONLY_IF_IT_CHANGES
</PRE><P>Note that you can use the <TT><A HREF="#PRINT">PRINT</A></TT> action in a <TT><A HREF="#tp2">tp2</A></TT> to debug
your code as well. Like this:</P><PRE CLASS="verbatim">COPY_EXISTING ~acolyte1.cre~ ~override/acolyte1.cre~
  PATCH_IF ("%SOURCE_SIZE%" &gt; "0x2d3") BEGIN
    READ_LONG "0x2bc" "itemsoffset"
    READ_LONG "0x2b8" "itemslot"
    READ_LONG "0x2c0" "#items"
    READ_SHORT ("%itemslot%" + 0x04) "shield"
    
    PATCH_IF ("%shield%" = "65535") BEGIN

      WRITE_SHORT ("%itemslot%" + 0x04) "%#items%"
      WRITE_LONG 0x2b8 ("%itemslot%" + 0x14)
      WRITE_LONG 0x2c0 ("%#items%" + 1)
      
      INSERT_BYTES ("%itemsoffset%" + "%#items%" * 0x14) 0x14
      
      WRITE_ASCII ("%itemsoffset%" + "%#items%" * 0x14) ~shld01~
    END
  END
BUT_ONLY_IF_IT_CHANGES

PRINT ~The value of the items offset is %itemsoffset%~
</PRE><P>I should also mention that the above code for adding an item to a creature
file is "portable" in a sense. You would only have to change a couple
things. The changes that would have to be made are as follows:</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Change acolyte1.cre to the actual creature that you want to modify
</LI><LI CLASS="li-enumerate">You&#X2019;ll have to change ("%itemslot%" + 0x04) to something else if you
are adding anything else but a shield. You can figure this out by
subtracting the slot offset of the slot you want to modify from the item
slots offset.
</LI><LI CLASS="li-enumerate">You would need to change &#XA0;shld01&#XA0; to the item you are going to add.
</LI><LI CLASS="li-enumerate">You&#X2019;d have to add your own flags if they need adding (i.e.
Identified, Not Stealable, etc.).
</LI></OL><P>And that&#X2019;s the end of it. All this can be a bit tricky, but as I mentioned 
above, it can be quite powerful as well.</P><!--TOC subsection <TT><B>ADD_STORE_ITEM</B></TT> (Last Update: v211)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc25">9.5</A>&#XA0;&#XA0;<B><TT>ADD_STORE_ITEM</TT></B><A NAME="ADD_STORE_ITEM"></A><A NAME="@default515"></A> (Last Update: v211)</H3><!--SEC END --><P>
This tutorial and this feature were thoughtfully provided by Japheth. </P><P>Using ADD_STORE_ITEM is a relatively painless procedure. Consider this
example: I want to add a new item to <TT>ribald.sto</TT> in BGII. There were
two ways of doing this before.</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
I could add the item to the store beforehand and then simply copy over
the new store file upon installing my mod.</LI><LI CLASS="li-enumerate">I could use WeiDU&#X2019;s <TT><A HREF="#READ_BYTE">READ_BYTE</A></TT> and <TT><A HREF="#WRITE_BYTE">WRITE_BYTE</A></TT> patch
expressions to patch the item into the store while installing.
</LI></OL><P>Now we can do #2 rather easily thanks to ADD_STORE_ITEM.</P><P>First off copy over the store file to set it up for patching as you
normally would.</P><PRE CLASS="verbatim">  COPY_EXISTING ~ribald.sto~ ~override/ribald.sto~
</PRE><P>Next we issue the ADD_STORE_ITEM patch expression with the following
arguments:</P><PRE CLASS="verbatim">  ADD_STORE_ITEM "myitem" #10 #0 #0 ~IDENTIFIED~ #5
</PRE><P>&#X201C;myitem&#X201D; is the name of the item file that we will want to appear in the
store without it&#X2019;s .itm extension.
#10 is the first extension headers number of charges
The two #0s that follow are the second and third extension headers number
of charges.
&#XA0;IDENTIFED&#XA0; is the flag that we want on the item. Here are the flags
that you can use:</P><PRE CLASS="verbatim">  IDENTIFIED
  UNSTEALABLE
  STOLEN
  IDENTIFIED&amp;STOLEN
  IDENTIFIED&amp;UNSTEALABLE
</PRE><P>#5 is the number of items that will be in stock.</P><P>Pretty easy stuff right?</P><P>You can also add an optional + after ADD_STORE_ITEM if you want to
overwrite an item that already exists in the store.</P><P>So, if we wanted to replace HAMM05.ITM in ribald.sto this is what we&#X2019;d
do:</P><PRE CLASS="verbatim">  ADD_STORE_ITEM + ~hamm05~ #10 #0 #0 ~IDENTIFIED~ #5
</PRE><P>One final note: remember to copy over your new item because
ADD_STORE_ITEM doesn&#X2019;t do that part for you.</P><P>So, a complete set of actions that would patch a store file and copy over
the new item would look like this:</P><PRE CLASS="verbatim">  COPY_EXISTING ~ribald.sto~ ~override/ribald.sto~
  ADD_STORE_ITEM ~myitem~ #10 #0 #0 ~IDENTIFIED~ #5

  COPY ~mymod/myitem.itm~ ~override/myitem.itm~
</PRE><P>Note that you can also add a final optional string argument if you want
the store to have unlimited copies of that item:</P><PRE CLASS="verbatim">  ADD_STORE_ITEM ~myitem~ #10 #0 #0 ~IDENTIFIED~ #1 ~UNLIMITED~
</PRE><P>That&#X2019;s about all there is to it.</P><P>Note that as of v188 you can specify the position of the item being added:
</P><PRE CLASS="verbatim">  COPY_EXISTING ~ribald.sto~ ~override/ribald.sto~
    ADD_STORE_ITEM ~myitem~   AFTER  ~olditem~ #10 #0 #0 ~IDENTIFIED~ #5
    ADD_STORE_ITEM ~otheritm~ BEFORE ~olditem~ #10 #0 #0 ~IDENTIFIED~ #5
</PRE><P>Valid options for position are:</P><P><TT>FIRST</TT> will add the item at the top of the stack.
This is the default, equivalent to putting nothing there.</P><P><TT>LAST</TT> will add the item to the bottom of the stack.</P><P><TT>BEFORE &#XA0;olditem&#XA0;</TT> will add the item exactly before olditem,
or to the top of the stack if olditem is missing.</P><P><TT>AFTER &#XA0;olditem&#XA0;</TT> will add the item exactly after olditem,
or to the bottom of the stack if olditem is missing.</P><P>As of 192, if there&#X2019;s a list of items in BEFORE|AFTER olditem (IE <CODE>~item1 item2 item3</CODE>), 
we add the new item BEFORE or AFTER the first item that is present in the list.</P><P>As of 211, you can specify a (zero-based) hardcoded position via <CODE>AT position</CODE>.</P><!--TOC subsection <TT><B>ADD_GAM_NPC</B></TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc26">9.6</A>&#XA0;&#XA0;<B><TT>ADD_GAM_NPC</TT></B><A NAME="ADD_GAM_NPC"></A><A NAME="@default516"></A></H3><!--SEC END --><P>
This tutorial and this feature were thoughtfully provided by Japheth. </P><P>In BGII, the game engine was refined so that when any NPC joined your party
they would be added to the baldur.gam file, regardless of the fact if they
were in there already or not.</P><P>Sadly, in BG1 this is not the case. If you were to simply CreateCreature
any old NPC and add them to your party, as soon as you moved to another
area the game would crash and die.</P><P>This is where ADD_GAM_NPC comes in handy for all you BG1 modders out there.</P><P>By using ADD_GAM_NPC you can patch your NPC into all the <TT>baldur.gam</TT>
files on an end users install. This includes the default <TT><A HREF="#GAM">GAM</A></TT> file
that&#X2019;s loaded up when you start a new game as well as all the <TT><A HREF="#GAM">GAM</A></TT>
files in the <TT>save</TT> and <TT>mpsave</TT> directories.</P><P>Note: However, there really is no foolproof way to back up all the save
games, so you may want to warn the end user in a readme to manually back
them up themselves beforehand.</P><P>Anyways, I digress.</P><P>To use ADD_GAM_NPC you have to first copy over the <TT><A HREF="#CRE">CRE</A></TT> file that
you will want to appear in the <TT><A HREF="#GAM">GAM</A></TT> file. I&#X2019;m pretty sure we all
know how to do this, but for completeness, here it is:</P><PRE CLASS="verbatim">COPY ~mymod/mynpc.cre~ ~override/mynpc.cre~
</PRE><P>After the <TT><A HREF="#COPY">COPY</A></TT> statement, make sure you do all your <TT><A HREF="#SAY">SAY</A></TT>s
and any other type of patching that you&#X2019;ll want to do for your .cre file.
You will <EM>always</EM> want to use ADD_GAM_NPC last since you want the
updates to your cre file to be reflected in the <TT><A HREF="#GAM">GAM</A></TT> file as well.</P><P>Here&#X2019;s a typical patch statement for most NPC mods:</P><PRE CLASS="verbatim">COPY ~mymod/mynpc.cre~ ~override/mynpc.cre~
SAY NAME1 ~Japh~
SAY NAME2 ~Japh~
</PRE><P>So, after doing all that, we would issue ADD_GAM_NPC with the following
arguments:</P><PRE CLASS="verbatim">ADD_GAM_NPC "mynpc" "ar2600" #123 #456
</PRE><P>&#X201C;mynpc&#X201D; is the name of your NPCs cre file that you&#X2019;re copying over without
the .cre extension.</P><P>&#X201C;ar2600&#X201D; is the area that you want him/her placed in. In this case we&#X2019;re
placing the NPC in Candlekeep.</P><P>#123 is the x co-ordinate on the map.</P><P>#456 is the y co-ordinate on the map.</P><P>That&#X2019;s all there is to it. Just to recap, here&#X2019;s the full set of
expressions we would use:</P><PRE CLASS="verbatim">COPY ~mymod/mynpc.cre~ ~override/mynpc.cre~
SAY NAME1 ~Japh~
SAY NAME2 ~Japh~
// Do any other patching stuff here
ADD_GAM_NPC ~mynpc~ ~ar2600~ #123 #456
</PRE><P>Note: Again, I have to stress the importance of warning the end users to
backup their save and mpsave directories beforehand. There really is no
elegant way to do this via WeiDU (well, maybe there is, but I can&#X2019;t think
of a way) so I&#X2019;d just warn them.</P><!--TOC subsection <TT><B>SET_2DA_ENTRY</B></TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc27">9.7</A>&#XA0;&#XA0;<B><TT>SET_2DA_ENTRY</TT></B><A NAME="SET_2DA_ENTRY"></A><A NAME="@default517"></A></H3><!--SEC END --><P>This tutorial was thoughtfully provided by Idobek.</P><P>There have been some queries about <TT><A HREF="#SET_2DA_ENTRY">SET_2DA_ENTRY</A></TT> in the WeiDU
forum recently. This is a consolidation of my posts on the subject.
The command takes this form:</P><PRE CLASS="verbatim">SET_2DA_ENTRY value value value newEntry
</PRE><P>The first value is the row, the second is the column and the third is the
required column count. The entry on the given column of the given row is
set to <TT>newEntry</TT>, but only rows with at least as many columns as the
required column count are considered. The upper-left entry is 0,0. For
example, given the following 2DA file:</P><PRE CLASS="verbatim">2DA V1.0
*
     ROWNAME        LOWER MIXED HELP
0    RESERVE        *     *     *
1    BERSERKER      25179 25151 25201
2    WIZARD_SLAYER  25180 25152 25203
3    KENSAI         25181 25153 25204
4    CAVALIER       25182 25154 25206
</PRE><P>Then the patch: </P><PRE CLASS="verbatim">SET_2DA_ENTRY 3 1 5 ~SAMURAI~ 
</PRE><P>would result in:</P><PRE CLASS="verbatim">2DA V1.0
*
     ROWNAME        LOWER MIXED HELP
0    RESERVE        *     *     *
1    BERSERKER      25179 25151 25201
2    WIZARD_SLAYER  25180 25152 25203
3    SAMURAI        25181 25153 25204
4    CAVALIER       25182 25154 25206
</PRE><P>So the columns and rows you want WeiDU to consider are:</P><PRE CLASS="verbatim">      Column0 Column1       Column2 Column3 Column4

              ROWNAME       LOWER   MIXED   HELP
Row0: 0       RESERVE       *       *       *
Row1: 1       BERSERKER     25179   25151   25201
Row2: 2       WIZARD_SLAYER 25180   25152   25203
Row3: 3       KENSAI        25181   25153   25204
Row4: 4       CAVALIER      25182   25154   25206
</PRE><P>The total number of columns is five. If, however, you put 1 as your
required column count then you tell WeiDU you want to consider all rows
with at least 1 column. So your row numbers change:</P><PRE CLASS="verbatim">Row0: 2DA V1.0
Row1: *
Row2:      ROWNAME        LOWER MIXED HELP
Row3: 0    RESERVE        *     *     *
Row4: 1    BERSERKER      25179 25151 25201
Row5: 2    WIZARD_SLAYER  25180 25152 25203
Row6: 3    KENSAI         25181 25153 25204
Row7: 4    CAVALIER       25182 25154 25206
</PRE><P>So the required column count is what you use to tell WeiDU which row you
want to use as row0. So using the code 
</P><PRE CLASS="verbatim">SET_2DA_ENTRY 3 1 1 ~SAMURAI~
</PRE><P>would result in:</P><PRE CLASS="verbatim">2DA V1.0
*
     ROWNAME        LOWER MIXED HELP
0    SAMURAI        *     *     *
1    BERSERKER      25179 25151 25201
2    WIZARD_SLAYER  25180 25152 25203
3    KENSAI         25181 25153 25204
4    CAVALIER       25182 25154 25206
</PRE><P>Hopefully, that explains the required column count a little better.</P><P>Finally, if <TT>newEntry</TT> is a string that contains any
<TT>%WeiDU_Variables%</TT> they are replaced by their values.
That&#X2019;s the end of this tutorial.</P><!--TOC subsection <TT><B>WHILE</B></TT> Loops (Last update: v189)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc28">9.8</A>&#XA0;&#XA0;<B><TT>WHILE</TT></B><A NAME="WHILE"></A><A NAME="@default518"></A> Loops (Last update: v189)</H3><!--SEC END --><P>This tutorial was thoughtfully provided by Idobek, and shamelessly edited
by Bigg to use PATCH_IF rather than IF_EVAL, and PATCH_IF rather than WHILE.</P><P>So what is a <TT>WHILE</TT> loop? Well very simply put it is a way of
applying the same patch to a file multiple times under a different
condition each time. Or it is a way of applying different patches depending
upon the conditions. This example will show both of these methods. Keeping
in theme we are going to modify the damage done by axes. Now, some axes
have both a melee <EM>and</EM> a ranged ability. We are going to want to
change both of these abilities but give different damage to ranged and
melee.</P><P>First, as always, we need to copy the files ready for patching, and throw
in the usual sanity check:
</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
PATCH_IF ("%SOURCE_SIZE%" &gt; "0x71") BEGIN
</PRE><P>We only want to modify axes so let&#X2019;s find out what the item is:
</P><PRE CLASS="verbatim">READ_BYTE 0x1c "category"
</PRE><P>Once we are done with our patching we will use <TT><A HREF="#PATCH_IF">PATCH_IF</A></TT> to tell
WeiDU to only patch axes:</P><PRE CLASS="verbatim">PATCH_IF ("%category%" = 25) BEGIN
</PRE><P>Now, we need to find out how many abilities there are and where they are
located:
</P><PRE CLASS="verbatim">READ_LONG 0x64 "abilitiesoffset"
READ_SHORT 0x68 "#abilities"
</PRE><P>So far, so good. Here&#X2019;s where the fun begins. We want to patch examine
every ability in the item. We need to use a <TT>WHILE</TT> loop to patch the
abilities one by one. We open the loop like so:
</P><PRE CLASS="verbatim">WHILE ("%#abilities%" &gt; 0) BEGIN
</PRE><P>For the <TT>WHILE</TT> loop to progress and close we need to modify the
"#abilities" variable. We use the <TT><A HREF="#SET">SET</A></TT> command to do this:</P><PRE CLASS="verbatim">SET "#abilities" = ("%#abilities%" - 1)
END
</PRE><P>These lines are placed at the end of the <TT>WHILE</TT> loop. WeiDU will
process the abilities from last to first and reduce the "#abilities"
variable by one each time. Once the "#abilities" variable hits zero the
<TT>WHILE</TT> loop will stop.</P><P>OK, now we need to find out what type of ability we are looking at. Within
an item an ability is 0x38 bytes, abilities also count from 0 within items
so we must take this into account:
</P><PRE CLASS="verbatim">READ_BYTE ("%abilitiesoffset%" + ("%#abilities%" - 1) * 0x38) "abilitytype"
</PRE><P>Now we get to the meat of the patch. This patch is conditional on the
ability type we have just read. First we will deal with the melee damage
patch. We are going to be using a <TT><A HREF="#PATCH_IF">PATCH_IF</A></TT> command to do this</P><PRE CLASS="verbatim">PATCHING ("%abilitytype%" = 1) BEGIN
</PRE><P>So we are patching when the ability type is 1 (melee). Time for the actual patch:
</P><PRE CLASS="verbatim">WRITE_SHORT ("%abilitiesoffset%" + ("%#abilities%" - 1) * 0x38 + 0x16) 6
WRITE_SHORT ("%abilitiesoffset%" + ("%#abilities%" - 1) * 0x38 + 0x18) 2
</PRE><P>Time to close the PATCH_IF statement.
</P><PRE CLASS="verbatim">END
</PRE><P>We use exactly the same method for ranged abilities:
</P><PRE CLASS="verbatim">
PATCH_IF ("%abilitytype%" = 2) BEGIN
   WRITE_SHORT ("%abilitiesoffset%" + ("%#abilities%" - 1) * 0x38 + 0x16) 12
   WRITE_SHORT ("%abilitiesoffset%" + ("%#abilities%" - 1) * 0x38 + 0x18) 1
END
</PRE><P>We can now close the main loop (using the aforementioned method):
</P><PRE CLASS="verbatim">SET "#abilities" = ("%#abilities%" - 1)
END
</PRE><P>We are done with our patches so we can add our usual END and BUT_ONLY.
</P><PRE CLASS="verbatim">END
END
BUT_ONLY_IF_IT_CHANGES
</PRE><P>The full code is:
</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
  PATCH_IF ("%SOURCE_SIZE%" &gt; "0x71") BEGIN
    READ_BYTE 0x1c "category"
    PATCH_IF ("%category%" = 25) BEGIN
      READ_LONG 0x64 "abilitiesoffset"
      READ_SHORT 0x68 "#abilities"
      WHILE ("%#abilities%" &gt; 0) BEGIN
        READ_BYTE ("%abilitiesoffset%" + ("%#abilities%" - 1) * 0x38) "abilitytype"
        PATCH_IF ("%abilitytype%" = 1) BEGIN
          WRITE_SHORT ("%abilitiesoffset%" + ("%#abilities%" - 1) * 0x38 + 0x16) 6
          WRITE_SHORT ("%abilitiesoffset%" + ("%#abilities%" - 1) * 0x38 + 0x18) 2
        END
        PATCH_IF ("%abilitytype%" = 2) BEGIN
          WRITE_SHORT ("%abilitiesoffset%" + ("%#abilities%" - 1) * 0x38 + 0x16) 12
          WRITE_SHORT ("%abilitiesoffset%" + ("%#abilities%" - 1) * 0x38 + 0x18) 1
        END
        SET "#abilities" = ("%#abilities%" - 1)
      END
    END
  END
BUT_ONLY_IF_IT_CHANGES
</PRE><P>So what have we done? Let&#X2019;s list the steps involved:
</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
First off we copied all the item files ready for patching.
</LI><LI CLASS="li-enumerate">Then we the read in the item category.
</LI><LI CLASS="li-enumerate">We also read in the number of abilities and the file location of those abilities.
</LI><LI CLASS="li-enumerate">We open a <TT>WHILE</TT> loop based upon the number of abilities.
</LI><LI CLASS="li-enumerate">Within the <TT>WHILE</TT> loop, we read in the ability type.
</LI><LI CLASS="li-enumerate">Next we defined a new variable to indicate that we had not yet patched any melee type abilities.
</LI><LI CLASS="li-enumerate">We opened <TT><A HREF="#PATCH_IF">PATCH_IF</A></TT> statement.
</LI><LI CLASS="li-enumerate">We patched melee abilities to do 2D6 damage.
</LI><LI CLASS="li-enumerate">We closed this <TT><A HREF="#PATCH_IF">PATCH_IF</A></TT> loop.
</LI><LI CLASS="li-enumerate">We repeated steps 6-9 to give the ranged abilities 1D12 damage.
</LI><LI CLASS="li-enumerate">We closed our main <TT>WHILE</TT> loop by reducing the number of abilities by 1 and indicating that it should stop if the number of abilities reached 0.
</LI><LI CLASS="li-enumerate">We used an <TT><A HREF="#IF_EVAL">IF_EVAL</A></TT> statement to ensure the patch is only applied to axes.
</LI></OL><P>That&#X2019;s the end of this tutorial.</P><!--TOC subsection Bitwise Operators (Last update: v189)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc29">9.9</A>&#XA0;&#XA0;Bitwise Operators (Last update: v189)</H3><!--SEC END --><P>This tutorial was thoughtfully provided by CamDawg, and shamelessly edited
by Bigg to use PATCH_IF rather than IF_EVAL.</P><P>This was a topic that I struggled with while trying to convert some kits
with unusual item restrictions. Thanks to WeiDU&#X2019;s new bitwise operators,
this is a process that can done dynamically and non-destructively and
affect all items of a particular type, even if added or altered by another
mod (assuming yours is installed after others of course ). The basic idea
is to construct a function in WeiDU that:</P><OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Searches through all item files in the game
</LI><LI CLASS="li-enumerate">Reads selected data from an item (type, usability, etc)
</LI><LI CLASS="li-enumerate">Alters specific data on an item without changing anything else
</LI></OL><P>This tutorial is basically an expansion on Japheth&#X2019;s excellent
READ/BYTE/LONG/SHORT tutorial and I suggest you take a look at that before
going further.</P><P>My initial problem came about when trying to make specific items usable or
unusable by a particular class/race/kit. If you look at the item file
structure at IESDP, you see that all of the unusability flags of an item
are controlled by the individual bits of bytes 0x1E, 0x1F, 0x20 and 0x21
for class/race alignment restrictions and 0x29, 0x2B, 0x2D and 0x2F for the
individual kit restrictions. (Near Infinity combines and displays the four
bytes of class/race restrictions as a single chunk of data.)</P><P>A quick aside about notation before I proceed. Numbers in binary (the
strings of bits) are preceded with 0b and hexadecimal numbers (typically
the bytes) are preceded with 0x. Eight bits make a byte and bits read
right-to-left. So if the second bit is 1 and the rest 0, then the bit would
be written as 0b00000010.</P><P>If you were trying to alter the usability of a specific class or race,
simply using a <TT><A HREF="#WRITE_BYTE">WRITE_BYTE</A></TT> command on any of these particular bytes
would result in changing the usability of an item by all the classes in the
particular byte. The new bitwise operators provide an easier solution.</P><P>First we need to look at what the new operators <TT><A HREF="#BAND">BAND</A></TT> and
<TT><A HREF="#BOR">BOR</A></TT> do with bits. They are both ways of combining two bytes, based
on different rules. Both <TT><A HREF="#BAND">BAND</A></TT> and <TT><A HREF="#BOR">BOR</A></TT> compare the
individual bits (bit 0 vs bit 0, bit 1 vs bit 1, etc. all the way through
bit 7 vs bit 7) of two bytes. For each individual bit, the following tables
are used to determine the value:</P><PRE CLASS="verbatim">0 BAND 0 = 0
0 BAND 1 = 0
1 BAND 0 = 0
1 BAND 1 = 1

0 BOR 0 = 0
0 BOR 1 = 1
1 BOR 0 = 1
1 BOR 1 = 1
</PRE><P>So if byte 0x23 is 0b00110101 and byte 0x24 is 0b10010001, then 0x23 BAND
0x24 is 0b00010001 whereas 0x23 BOR 0x24 is 0b10110101.</P><P>Back to relating this to unusability in items. For an item to be flagged as
unusable, the corresponding bit must be set to 1. A 0 means a particular
item is usable by the class/race. Let&#X2019;s look at the example of changing
mage robes usable by bards. This would go into your TP2 file.</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP GLOB ~.*\.itm~ ~override~ //copies all item files
  PATCH_IF ("%SOURCE_SIZE%" &gt; "0x71") BEGIN // avoid crashing on empty items
    READ_BYTE    "0x20" "mage" //reads the byte containing the mage usability flag
    PATCH_IF (("%mage%" BAND "0b00000100") = "0b00000000") BEGIN // if it is usable by mages
      READ_BYTE    "0x1E" "bard" //reads the byte containing bard usability flag
      READ_SHORT    "0x1C" "type" //reads the byte containing item type
      PATCH_IF ("%type%" = "67") OR ("%type%" = "2") BEGIN // if it is a robe or armor
        WRITE_BYTE    "0x1E" ("%bard%" BAND "0b10111111")  // makes usable by bards
      END
    END
  END
BUT_ONLY_IF_IT_CHANGES
</PRE><P>This is the same basic idea in Japheth&#X2019;s BYTE tutorial , except now we&#X2019;re
utilizing the bitwise operators in the writing and evaluation commands. The
mage usability flag is the bit 2 in byte 0x20 (IESDP). By checking "%mage%"
BAND 0b00000100, the values of any of the 7 other bits (0-1,3-7) are set to
0, whereas bit 2 is equal to 0 if and only if it is 0 to begin with.
Therefore the statement will only be true if the item is usable by mages
(bit 2 = 0). If that is true and the item is a robe or armor, then we write
("%bard%" BAND "0b10111111") into the bard usability byte, 0x1E. By using 1
in bits 0-5 and 7, this ensures that the original value of the flag is
preserved, and using 0 in bit 6 ensures that bit 6 is set to 0 regardless
of its previous value--making it usable by bards whether it was before or
not.</P><P>Just as an aside, you could read the entire usability block with a
<TT><A HREF="#READ_LONG">READ_LONG</A></TT> at 0x1E. However, it becomes a pain because then you need
to start writing out all 32 bits when doing the bitwise operations.</P><P>Let&#X2019;s try another example. Let&#X2019;s try making large weapons such as
two-handed swords and halberds unusable by short folks--gnomes, halflings,
and dwarves.</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP GLOB ~.*\.itm~ ~override~ //copies all item files
  PATCH_IF ("%SOURCE_SIZE%" &gt; "0x71") BEGIN // avoid crashing on empty items
    READ_BYTE    "0x21" "race" //reads the byte containing race usability flags we're interested in
    READ_BYTE    "0x31" "prof" //reads the byte containing item type
    PATCH_IF ("%prof%" = "93") OR    // two-handed sword
             ("%prof%" = "99") BEGIN // or halberd
      WRITE_BYTE    "0x21" ("%race%" BOR "0b00010101")  // makes unusable by dwarves, halflings, and gnomes
    END
  END
BUT_ONLY_IF_IT_CHANGES

</PRE><P>In this case, rather than reading the &#X2019;type&#X2019; byte of the item, I&#X2019;ve opted
for the &#X2019;proficiency&#X2019; byte. Many two-handed swords in BG2 are classed as
long swords for some reason so in this case proficiency is a better
indicator if it is a two-handed sword IMHO.</P><P>The unusability flags for dwarves, halflings and gnomes are all in byte
0x2F at bits 0, 2, and 4 respectively (thanks again IESDP). By writing
"%race%" BOR "0b00010101" to byte 0x2F we&#X2019;re preserving the values of bits
1,3, and 5-7 while setting the 0, 2, and 4 bits to 1 (unusable) regardless
of their previous values.</P><P>Thanks especially to Smoketest for helping me with this, Japheth for the
tutorial that inspired this and the help given, and the IESDP team.</P><!--TOC subsection Scripting Styles-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc30">9.10</A>&#XA0;&#XA0;Scripting Styles</H3><!--SEC END --><P><A NAME="sec-scripting-styles"></A>
</P><P>While the <TT><A HREF="#BCS">BCS</A></TT> and <TT><A HREF="#BAF">BAF</A></TT> script formats are common to all
Infinity Engine games, there are three main variants. The variations deal
largely with how &#X201C;object parameters&#X201D; are expressed. The style used by
Baldur&#X2019;s Gate, Baldur&#X2019;s Gate 2, and Icewind Dale is considered to be the
default. This document will not explain Infinity Engine scripting -- look
for a tutorial elsewhere. </P><TABLE BORDER=1 CELLSPACING=0 CELLPADDING=1><TR><TD VALIGN=top ALIGN=center NOWRAP>BG BAF Object</TD><TD VALIGN=top ALIGN=left><TT>EA.GENERAL.RACE.CLASS.SPECIFIC.GENDER.ALIGN</TT></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>PST BAF Object</TD><TD VALIGN=top ALIGN=left><TT>EA.FACTION.TEAM.GENERAL.RACE.CLASS.SPECIFIC.GENDER.ALIGN</TT></TD></TR>
<TR><TD VALIGN=top ALIGN=center NOWRAP>IWD2 BAF Object</TD><TD VALIGN=top ALIGN=left><TT>EA.GENERAL.RACE.SUBRACE.CLASS.SPECIFIC.GENDER.ALIGNMNT</TT></TD></TR>
</TABLE><P>If <TT>SUBRACE.IDS</TT> is present in <TT>CHITIN.<A HREF="#KEY">KEY</A></TT>, the scripting
style is autodetected as IWD2. Otherwise, if <TT>FACTION.IDS</TT> is present,
the scripting style is autodetected as PST. Otherwise the scripting style
is set to BG. The <TT>--script-style</TT> command-line argument and the
<TT><A HREF="#SCRIPT_STYLE">SCRIPT_STYLE</A></TT> <TT><A HREF="#TP2">TP2</A></TT> flag both override this default.
You should not need to use <TT>--script-style</TT> explicitly if the
<TT>--game</TT> is set correctly.</P><P>Also, <TT>IWD1</TT> and <TT>IWD2</TT> have different rules for parsing certain IDS files,
which contain spaces and/or commas in the tokens.</P><!--TOC subsection TP2 <TT><B>SUBCOMPONENT</B></TT> Groups (Last Update: v192)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc31">9.11</A>&#XA0;&#XA0;TP2 <B><TT>SUBCOMPONENT</TT></B><A NAME="SUBCOMPONENT"></A><A NAME="@default519"></A> Groups (Last Update: v192)</H3><!--SEC END --><P>This tutorial was thoughtfully provided by CamDawg, and edited by the Bigg
to account for FORCED_SUBCOMPONENT.</P><P><TT>SUBCOMPONENT</TT>s allow to group together a set of mutually exclusive mod
components into a single menu-style selection. The primary purpose of
<TT>SUBCOMPONENT</TT>s is to streamline mod installation and to make life easier for
end users. For example, <TT>SUBCOMPONENT</TT>s are ideal if you wish to provide
multiple portrait selections for an NPC mod, have several kits available to
one NPC, or for changes that conflict with one another (i.e. raising an XP
cap to 10 million or raising it to 20 million). We&#X2019;ll use the first
one (multiple portrait options) as an example.</P><P>Without <TT>SUBCOMPONENT</TT>s, the install dialogue would look something like this:</P><PRE CLASS="verbatim">Install Component [Delainy Portrait 1 by Bob]?
[I]nstall, [N]ot Install, or [Q]uit

Install Component [Delainy Portrait 2 by Fred]?
[I]nstall, [N]ot Install, or [Q]uit

Install Component [Delainy Portrait 3 by Wilhelmus]?
[I]nstall, [N]ot Install, or [Q]uit
</PRE><P>The end user would need to click through the options each time. Worse,
conflicting components could be installed. These problems can be limited
somewhat by judicious use of predicates, but taking advantage of the
<TT>SUBCOMPONENT</TT> feature yields far superior results:</P><PRE CLASS="verbatim">Install Component [Delainy Portrait]?
[N]o, [Q]uit, or choose one:
 1] Portrait 1 by Bob
 2] Portrait 2 by Fred
 3] Portrait 3 by Wilhelmus
</PRE><P>Only one of these options can be installed at any time; re-installing
and selecting a different <TT>SUBCOMPONENT</TT> will automatically uninstall the
previously installed one. Setting this up is dead simple:</P><PRE CLASS="verbatim">BEGIN ~Portrait 1 by Bob~ 
/* The string above is displayed in the subcomponent listing, i.e. the list
with 1] 2] 3] etc. You can, of course, use TRA references instead for this
and the SUBCOMPONENT string below. */
SUBCOMPONENT ~ Delainy Portrait~
/* The string above is displayed as the component listing and must be the
same for each SUBCOMPONENT. The tp2 code that follows is only executed if
this SUBCOMPONENT is selected. */
COPY ~Delainy/portraits/opt1G.bmp~ ~override/CDDELAIG.bmp~
COPY ~Delainy/portraits/opt1M.bmp~ ~override/CDDELAIM.bmp~ 
COPY ~Delainy/portraits/opt1S.bmp~ ~override/CDDELAIS.bmp~

BEGIN ~Portrait 2 by Fred~ 
SUBCOMPONENT ~ Delainy Portrait~
COPY ~Delainy/portraits/opt2G.bmp~ ~override/CDDELAIG.bmp~
COPY ~Delainy/portraits/opt2M.bmp~ ~override/CDDELAIM.bmp~ 
COPY ~Delainy/portraits/opt2S.bmp~ ~override/CDDELAIS.bmp~

BEGIN ~Portrait 3 by Wilhelmus~ 
SUBCOMPONENT ~ Delainy Portrait~
COPY ~Delainy/portraits/opt3G.bmp~ ~override/CDDELAIG.bmp~
COPY ~Delainy/portraits/opt3M.bmp~ ~override/CDDELAIM.bmp~ 
COPY ~Delainy/portraits/opt3S.bmp~ ~override/CDDELAIS.bmp~
</PRE><P>Any <TT><A HREF="#REQUIRE_FILE">REQUIRE_FILE</A></TT>s or other module requirements for the whole group
should be put with the first subcomponent. If such a requirement fails,
none of the subcomponents can be installed. In addition, each individual
subcomponent can be guarded by its own predicate. If that predicate fails,
that particular subcomponent cannot be installed. Example:</P><PRE CLASS="verbatim">BEGIN ~Imoen: Turnip-Mage~
SUBCOMPONENT ~Imoen Mage Kit~ (FILE_EXISTS_IN_GAME ~turnip.spl~)
  // This particular subcomponent will only be displayed if TURNIP.SPL
  // exists. If it does not, you can still install other subcomponents.
</PRE><P>One note about <TT>SUBCOMPONENT</TT>s and mod ordering: WeiDU will display
<TT>SUBCOMPONENT</TT>s in a single grouping no matter if they fall consecutively
in the <TT><A HREF="#TP2">TP2</A></TT>. However, the component number (the one that gets placed in
<TT>weidu.log</TT> and the one you check for in <TT><A HREF="#REQUIRE_COMPONENT">REQUIRE_COMPONENT</A></TT> et al.) is
still based on their <TT><A HREF="#TP2">TP2</A></TT> order.</P><P>As of v192, if all subcomponents fail their requirement, then we don&#X2019;t ask about
the specific group; moreover, if at least one of the subcomponents is defined with
<TT>FORCED_SUBCOMPONENT</TT> rather than <TT>SUBCOMPONENT</TT>, then the user is forced to
install one of them. This could be useful if you want to ask the user if he wants
biffing of wav files or not (as you need different actions for either choice). </P><!--TOC subsection <TT><B>ADD_CRE_ITEM</B></TT> (Last Update: v213)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc32">9.12</A>&#XA0;&#XA0;<B><TT>ADD_CRE_ITEM</TT></B><A NAME="ADD_CRE_ITEM"></A><A NAME="@default520"></A> (Last Update: v213)</H3><!--SEC END --><P>
This tutorial was thoughtfully provided by Japheth.</P><P>This command is a little bit more complex. First I&#X2019;ll list all the valid
flags and inventory slots.</P><P>Flags:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
none
</LI><LI CLASS="li-itemize">identified
</LI><LI CLASS="li-itemize">unstealable
</LI><LI CLASS="li-itemize">stolen
</LI><LI CLASS="li-itemize">undroppable
</LI><LI CLASS="li-itemize">identified&amp;stolen
</LI><LI CLASS="li-itemize">identified&amp;unstealable
</LI><LI CLASS="li-itemize">identified&amp;undroppable
</LI><LI CLASS="li-itemize">unstealable&amp;undroppable
</LI><LI CLASS="li-itemize">stolen&amp;undroppable
</LI><LI CLASS="li-itemize">identified&amp;stolen&amp;undroppable
</LI><LI CLASS="li-itemize">identified&amp;unstealable&amp;undroppable
</LI></UL><P>Inventory Slots:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
helmet
</LI><LI CLASS="li-itemize">armor
</LI><LI CLASS="li-itemize">shield
</LI><LI CLASS="li-itemize">gloves
</LI><LI CLASS="li-itemize">lring
</LI><LI CLASS="li-itemize">rring
</LI><LI CLASS="li-itemize">amulet
</LI><LI CLASS="li-itemize">belt
</LI><LI CLASS="li-itemize">boots
</LI><LI CLASS="li-itemize">weapon1
</LI><LI CLASS="li-itemize">weapon2
</LI><LI CLASS="li-itemize">weapon3
</LI><LI CLASS="li-itemize">weapon4
</LI><LI CLASS="li-itemize">quiver1
</LI><LI CLASS="li-itemize">quiver2
</LI><LI CLASS="li-itemize">quiver3
</LI><LI CLASS="li-itemize">quiver4
</LI><LI CLASS="li-itemize">cloak
</LI><LI CLASS="li-itemize">qitem1
</LI><LI CLASS="li-itemize">qitem2
</LI><LI CLASS="li-itemize">qitem3
</LI><LI CLASS="li-itemize">inv1
</LI><LI CLASS="li-itemize">inv2
</LI><LI CLASS="li-itemize">inv3
</LI><LI CLASS="li-itemize">inv4
</LI><LI CLASS="li-itemize">inv5
</LI><LI CLASS="li-itemize">inv6
</LI><LI CLASS="li-itemize">inv7
</LI><LI CLASS="li-itemize">inv8
</LI><LI CLASS="li-itemize">inv9
</LI><LI CLASS="li-itemize">inv10
</LI><LI CLASS="li-itemize">inv11
</LI><LI CLASS="li-itemize">inv12
</LI><LI CLASS="li-itemize">inv13
</LI><LI CLASS="li-itemize">inv14
</LI><LI CLASS="li-itemize">inv15
</LI><LI CLASS="li-itemize">inv16
</LI></UL><P>Now here is the syntax:</P><PRE CLASS="verbatim">COPY_EXISTING ~alynar.cre~ ~override/alynar.cre~
  ADD_CRE_ITEM ~itemname~ #charge1 #charge2 #charge3 ~Flags~ ~Inventory Slots~ [EQUIP] [TWOHANDED]
</PRE><P><TT>EQUIP</TT> and <TT>TWOHANDED</TT> are optional and are only needed when dealing
with weapons. I&#X2019;ll give some examples now.</P><P>Example #1:</P><P>If I want to add a Ring of Protection to Sir Alynar, here&#X2019;s what I&#X2019;d do:</P><PRE CLASS="verbatim">COPY_EXISTING ~alynar.cre~ ~override/alynar.cre~
  ADD_CRE_ITEM ~ring06~ #0 #0 #0 ~IDENTIFIED~ ~RRING LRING~
</PRE><P>This will add the item to his right ring slot. If that slot is full, it
will be added to the left ring slot. If both are full, we move the current
right ring (the first slot in the list) to an an empty inventory slot so
that the Ring of Protection is still put in it&#X2019;s appropriate slot.</P><P>Example #2:</P><P>If I want to add a +2 Longsword to his second weapon slot, but <EM>don&#X2019;t</EM>
want to equip it, here&#X2019;s what I&#X2019;d do:</P><PRE CLASS="verbatim">COPY_EXISTING ~alynar.cre~ ~override/alynar.cre~
  ADD_CRE_ITEM ~sw1h06~ #0 #0 #0 ~IDENTIFIED~ ~WEAPON2~
</PRE><P>Again, if there happens to be a weapon in his second weapon slot already,
then we simply move that weapon to an empty inventory slot.</P><P>Example #3:</P><P>Same deal as example #2 except now I want to equip the sword.</P><PRE CLASS="verbatim">COPY_EXISTING ~alynar.cre~ ~override/alynar.cre~
  ADD_CRE_ITEM ~sw1h06~ #0 #0 #0 ~IDENTIFIED~ ~WEAPON2~ EQUIP
</PRE><P>This will put the sword in his second weapon slot and equip it. And again,
if there&#X2019;s already a weapon in that slot, it will be moved to an empty
inventory slot.</P><P>Example #4:</P><P>If you want to add a two-handed weapon <EM>and</EM> equip it, here&#X2019;s what you do:</P><PRE CLASS="verbatim">COPY_EXISTING ~alynar.cre~ ~override/alynar.cre~
  ADD_CRE_ITEM ~sw2h01~ #0 #0 #0 ~NONE~ ~WEAPON2~ EQUIP TWOHANDED
</PRE><P>This will place the item in the second weapon slot (and again, if there&#X2019;s
already a weapon there it&#X2019;s moved to inventory), remove anything that&#X2019;s in
the shield slot and put it in an empty inventory slot and finally it will
equip the weapon.</P><P>If you just want to add a two-handed weapon to a cre but don&#X2019;t need it
equipped, then you don&#X2019;t have to worry about specifying <TT>EQUIP</TT> or 
<TT>TWOHANDED</TT>.</P><P>Finally, it is worth noting that any WeiDU variables inside <TT>%</TT>s in the 
<TT>itemname</TT> will be replaced by their values. </P><P>Phew, that&#X2019;s it.</P><P>Note: starting from v189, you can use INV, QITEM, QUIVER, WEAPON and RING as
shortcuts respectively
to INV1 INV2 ... INV15 INV16, QITEM1 QITEM2 QITEM3, QUIVER1 QUIVER2 QUIVER3,
WEAPON1...WEAPON4, RRING LRING.</P><P>In IWD2, INV unfolds to INV1..INV24, SHIELD to SHIELD1..4.</P><P>In PST, INV unfolds to INV1..20, TATTOO to TATTOO1..3, EARRING to EARING1..2,
QITEM to QITEM1..5, QUIVER1..5. PST also supports HAND, but loses SHIELD and
HELMET.</P><!--TOC subsection <TT><B>Prompt Customization</B></TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc33">9.13</A>&#XA0;&#XA0;<B><TT>Prompt Customization</TT></B><A NAME="Prompt Customization"></A><A NAME="@default521"></A></H3><!--SEC END --><P>
This tutorial was thoughtfully provided by Rastor.</P><P>A customized installer can make your mod look more unique to your end user,
giving a feel that &#X201C;This isn&#X2019;t your basic, cookie-cutter mod.&#X201D; WeiDU
actually allows for a great deal of customization of the mod installer
program (ie. the <TT>setup-mymod.exe</TT> file). For the most part, just about
every line of text can be changed to suit your needs. This tutorial will
show you how.</P><P><B>Understanding the Installer</B>. 
WeiDU, like most computer programs, draws every line of text that it
displays from a series of strings. In a default installer (simply a
renamed weidu.exe and the appropriate .tp2), all of the strings that WeiDU
displays are programmed into WeiDU&#X2019;s source code. Fortunately, weidu
allows you to overwrite these strings with ones of your own choosing.</P><P><B>prompts.tra</B>. 
In the WeiDU download package (from http://www.weidu.org), you will find a
file in the <TT>examples</TT> folder called <B><TT>prompts.tra</TT></B><A NAME="prompts.tra"></A><A NAME="@default522"></A>. This is the
file that you modify to customize your installer. Go look at it now. </P><P>Upon loading, weidu always looks to see if a <TT>prompts.tra</TT> file exists in
the folder that corresponds to the language that the user selects. If so,
then weidu automatically loads the file and uses it to display your strings
instead of the ones that are normally coded into it. In order to change
what the setup-mymod.exe file displays to the user, you need to edit this
file and then place it into the relevant language folder. Your translators
should then translate this into whatever language and include it in that
language folder.</P><P><B>An Example</B>. 
Let us assume for a minute that you want the question asking if users want
to install to read:
</P><PRE CLASS="verbatim">You are a big stupid moron if you do not install the [Component Name].
Install?
[Y]es you idiot or [N]o, bonehead or [Q]uit
</PRE><P>For obvious reasons, you would never want your mod&#X2019;s installer to
actually say that but it will serve as a good working example.</P><P>To change the install component text, find the section of prompts.tra that
corresponds with the text that you wish to change. In this case, we want
to change <TT>@-1006</TT> and <TT>@-1008</TT>. If you look at these lines, you will
see a strange<BR>
n that does not actually appear when the installer is
running. This is a carriage return (or &#X201C;new line&#X201D;) character. It simply
indicates that you want any text following it to be inserted below the text
that precedes the carriage return.</P><P>The name of the component in your mod is always inserted immediately
following <TT>@-1006</TT> without any spaces. This means that you are going to
want to include a space or a bracket or some other distinguishing character
at the end of your new text, otherwise the installer&#X2019;s text will look
quite strange. The name of the component also is always followed (with no
spaces) by either line <TT>@-1007</TT> or <TT>@-1008</TT> depending on whether the
component is already installed or not.</P><P>If you want to include more text in your custom line before the <TT>[I]nstall or
[N]ot Install</TT> stuff, then simply place it before the<BR>
n character.</P><P>To generate the custom text that I presented above, change the lines in
your prompts.tra file to read:
</P><PRE CLASS="verbatim">@-1006= "You are a big stupid moron if you do not install the ["
@-1008= "].  Install?\n[Y]es you idiot or [N]o, bonehead or [Q]uit"
</PRE><P>After making these changes, place <TT>prompts.tra</TT> into the TRA folder.</P><P>If you are familiar with the default text in the installer, then you will
recognize the all of the lines that are listed in <TT>prompts.tra</TT>. You may
change any of the text, but simply remember the meaning of the carriage
return. The WeiDU installer will not word wrap, meaning that if you insert
a very large line that is not broken up by<BR>
n, the user will not be able
to see all of it. You should do some experimentation to determine the
optimal length for each line (it&#X2019;s roughly 72 characters).</P><P><B>What you cannot change</B>.
Although WeiDU does allow for a large degree of customization, there are a
few things that you cannot change. You cannot change the input keys used to
collect the player&#X2019;s response. You cannot change the <TT>Copying one file</TT>
and <TT>Compiling dialogues</TT> (and the similar) text.</P><!--TOC subsection <TT><B>INNER_ACTION</B></TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc34">9.14</A>&#XA0;&#XA0;<B><TT>INNER_ACTION</TT></B><A NAME="INNER_ACTION"></A><A NAME="@default523"></A></H3><!--SEC END --><P>Normally I would start off with <EM>don&#X2019;t use this feature</EM>, but since
this <TT><A HREF="#patch">patch</A></TT> can basically only be used to do really obscure things,
you&#X2019;re probably already a master if you&#X2019;re considering it.</P><P>We&#X2019;ll use <TT><A HREF="#INNER_ACTION">INNER_ACTION</A></TT> in the context of a hypothetical mod
that causes all monsters to drop special &#X201C;skins&#X201D; that can be worn by the
PCs, granting the PCs all of the &#X201C;natural talents&#X201D; (e.g., fire
resistance, seeing through invisibility, animation avatar) of that monster.</P><P>First, we will specially prepare a &#X201C;template&#X201D; object -- a special blank
&#X201C;skin&#X201D; item that has slots equipped effects like &#X201C;fire resistance bonus
+0&#X201D; and &#X201C;natural armor class 10&#X201D; and &#X201C;change creature animation&#X201D;. Each
creature &#X201C;skin&#X201D; will be a specialized copy of this template.</P><P>Then we&#X2019;ll consider each monster in turn. We&#X2019;ll read the fire resistance
value from the monster and write that value into a copy of the &#X201C;skin&#X201D;
item. Then we&#X2019;ll repeat the process for &#X201C;armor class&#X201D;, &#X201C;cold
resistance&#X201D;, etc. We&#X2019;ll also copy over any &#X201C;CRE effects&#X201D; the creature
might have (e.g., &#X201C;can see invisible&#X201D;) and make them additional equipped
effects of the &#X201C;skin&#X201D; item. Finally we&#X2019;ll add that personalized &#X201C;skin&#X201D;
item to the monster&#X2019;s inventory. If the monster is <TT>C6BODHI.CRE</TT>, we&#X2019;ll
call the skin <TT>C6BODHI.ITM</TT>.</P><P>We&#X2019;ll give the code in pieces. First, we want to go over every existing
creature and make sure that <TT>CREATURE.ITM</TT> doesn&#X2019;t already exist in the
game. If it does we won&#X2019;t make a &#X201C;skin&#X201D; for that monster. We&#X2019;ll also
include a little size sanity check to make sure that we&#X2019;re not ready any
degenerate 0-byte files.</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP GLOB ~.*\.cre~ ~override~
  PATCH_IF
    (SOURCE_SIZE &gt; 0x2c8) AND
    (NOT FILE_CONTAINS_EVALUATED("%SOURCE_RES%.ITM" "ITM"))
  THEN BEGIN // %SOURCE_RES%.ITM does not exist.
</PRE><P>See <TT>SOURCE_RES</TT>. Using <TT>"ITM"</TT> as the
second argument makes <TT><A HREF="#FILE_CONTAINS_EVALUATED">FILE_CONTAINS_EVALUATED</A></TT> behave like
<TT>FILE_EXISTS_EVALUATED</TT>, since any real item contains <TT>ITM</TT> as part of
its header.</P><P>Now we&#X2019;re going to read the animation, armor class, resistances, and
creature effects. We&#X2019;ll also equip this creature with its special skin,
even through we haven&#X2019;t made that skin yet.</P><PRE CLASS="verbatim">    READ_SHORT 0x28    anim_id
    READ_SHORT 0x46    natural_ac
    READ_ASCII 0x59    resists (11) // read 11 bytes (even 0's)
    READ_LONG  0x2c4   eff_off
    READ_LONG  0x2c8   num_eff
    READ_ASCII eff_off effects (num_eff * 264)
    ADD_CRE_ITEM ~%SOURCE_RES%~ #0 #0 #0 ~IDENTIFIED~ ~INV10~
</PRE><P>Since there are 11 resistances (e.g., fire, cold, magic fire, ...) we are
just leaving them in a string as an array of bytes rather than making up
individual variables for each one. Now we want to go about creating our
special skin item. We&#X2019;ll use the mysterious <TT><A HREF="#INNER_ACTION">INNER_ACTION</A></TT> to do so.</P><PRE CLASS="verbatim">    INNER_ACTION BEGIN
      COPY ~foo/footemp.itm~ ~override/%SOURCE_RES%.ITM~
        WRITE_SHORT 0x76 anim_id
        WRITE_SHORT 0xa6 natural_ac
</PRE><P>Using <TT><A HREF="#SOURCE_RES">SOURCE_RES</A></TT> as part of a computed <TT><A HREF="#COPY">COPY</A></TT> destination is
normally somewhat dangerous because it is reset every time you enter a
<TT><A HREF="#COPY">COPY</A></TT> -- but we&#X2019;re OK here.</P><P>Our template <TT>footemp.itm</TT> item has a number of pre-made equipped
abilities (e.g., no dispel, bypass resistance, apply 100% of the time to
the wearer, last while equipped) that are just lacking concrete values.
Here we fill in the animation and armor class. Next we&#X2019;ll do the
resistances:</P><PRE CLASS="verbatim">        // copy over all resistances
        FOR (i=0; i&lt;11 ; i=i+1) BEGIN
          INNER_PATCH "%resists%" BEGIN
            READ_BYTE i resist_i
          END
          foo_resist_off = 0xd6 + (i * (0x102 - 0xd2))
          WRITE_LONG foo_resist_off resist_i
        END
</PRE><P>For each of the 11 resistances we remember its value from the creature by
using <TT><A HREF="#INNER_PATCH">INNER_PATCH</A></TT> to get it out of our <TT>resists</TT> &#X201C;array&#X201D;. The
resistance effects in <TT>footemp.itm</TT> are stored in the same order as the
creature resistances are in a <TT><A HREF="#CRE">CRE</A></TT> file.</P><P>Having handled the standard resistances we now turn to creature effects.
We don&#X2019;t know in advance how many creature effects there will be, so for
each one we will make a new effect structure and insert it into our skin
item. We&#X2019;ll get the new effect structure by copying one of the ones that
was already there (called <TT>dummy_eff</TT> in the code below).</P><P>Unfortunately, creature effects are not stored in quite the same way as item
effects, so we can&#X2019;t copy them over directly. Instead, from each creature
effect we&#X2019;ll extract the opcode, value and resource fields. We end up with
a three step process: (1) insert some bytes into the skin file to hold the new
effect, (2) copy over the <TT>dummy_eff</TT> effect structure as a framework,
and (3) fill in the appropriate values from the creature effect. Here it
is:</P><PRE CLASS="verbatim">        // copy all CRE effects
        PATCH_IF num_eff &gt; 0 THEN BEGIN
          READ_ASCII 0x72 dummy_eff (0x30)
          FOR (i=0; i&lt;num_eff; i=i+1) BEGIN
            INNER_PATCH "%effects%" BEGIN
              READ_ASCII ((i * 264) +  8) "cre_eff_opcode" (0x4)
              READ_ASCII ((i * 264) + 20) "cre_eff_value"  (0x8)
              READ_ASCII ((i * 264) + 40) "cre_eff_res"    (0x8)
            END
            INSERT_BYTES 0x72 0x30                        // step 1
            WRITE_EVALUATED_ASCII 0x72 "%dummy_eff%"      // step 2
            WRITE_EVALUATED_ASCII 0x72 "%cre_eff_opcode%" // step 3
            WRITE_EVALUATED_ASCII 0x76 "%cre_eff_value%"  // step 3
            WRITE_EVALUATED_ASCII 0x86 "%cre_eff_res%"    // step 3
          END
          READ_SHORT  0x70 num_global_itm_eff
          WRITE_SHORT 0x70 (num_global_itm_eff + num_eff)
        END
    END
</PRE><P>Huzzah. Notice our use of variables to &#X201C;pass information&#X201D; between the
main copying action and the <TT><A HREF="#INNER_ACTION">INNER_ACTION</A></TT>. Yes, I hate WeiDU syntax
as well. Why do you ask? Anyway, after that we update the item header to
take into account the new global effects.</P><PRE CLASS="verbatim">  END
  BUT_ONLY_IF_IT_CHANGES
</PRE><P>Finally we close off our sanity-checks and throw in the ever-popular
<TT><A HREF="#BUT_ONLY_IF_IT_CHANGES">BUT_ONLY_IF_IT_CHANGES</A></TT>. It would be &#X201C;easy&#X201D; (read: annoying and
time-consuming but possible) to extend this hackery so that it also stole
all of the effects from undroppable items held by creature (e.g., most
&#X201C;undead&#X201D; immunities are actually stored in <TT>RING95.ITM</TT> and not as
creature effects) by nesting yet-another <TT><A HREF="#INNER_ACTION">INNER_ACTION</A></TT>. You could
even be selective and avoid copying over effects like &#X201C;minimum hit
points&#X201D;. Then you could perhaps create an on-the-fly description for the
&#X201C;skin&#X201D; item using <TT><A HREF="#SAY_EVALUATED">SAY_EVALUATED</A></TT>.</P><P>Bonus points if you actually understood this code. Additional bonus points
if you find a real use for <TT><A HREF="#INNER_ACTION">INNER_ACTION</A></TT> in your mod. As a closing
warning, do not try to re-invent the WeiMorph wheel using a <TT><A HREF="#TP2">TP2</A></TT>
script -- email Japheth instead.</P><!--TOC subsection <TT><B>SET_2DA_ENTRY_LATER</B></TT> and <TT><B>SET_2DA_ENTRIES_NOW</B></TT> (Last Update: v188)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc35">9.15</A>&#XA0;&#XA0;<B><TT>SET_2DA_ENTRY_LATER</TT></B><A NAME="SET_2DA_ENTRY_LATER"></A><A NAME="@default524"></A> and <B><TT>SET_2DA_ENTRIES_NOW</TT></B><A NAME="SET_2DA_ENTRIES_NOW"></A><A NAME="@default525"></A> (Last Update: v188)</H3><!--SEC END --><P><TT><A HREF="#SET_2DA_ENTRY_LATER">SET_2DA_ENTRY_LATER</A></TT> and <TT><A HREF="#SET_2DA_ENTRIES_NOW">SET_2DA_ENTRIES_NOW</A></TT> are an extension
of the <TT><A HREF="#SET_2DA_ENTRY">SET_2DA_ENTRY</A></TT> patch, so you are encouraged to study the
<TT><A HREF="#SET_2DA_ENTRY">SET_2DA_ENTRY</A></TT> tutorial by Idobek before reading this one.</P><P>The main difference between the standard <TT><A HREF="#SET_2DA_ENTRY">SET_2DA_ENTRY</A></TT> and these new
variants is that S_2_E changes the file each instance, while the LATER
variant stores a list of changes in the memory and then the NOW part flushes
them in one go, resulting faster processing than S_2_E. According to Weimer&#X2019;s
calculations, using LATER/NOW gives an edge when 5 or more S_2_E are to be
applied to the same file.</P><P>We&#X2019;ll begin with a side-by-side confrontation of the code, for a mod which
allows Thieves, Cleric/Thieves and Mage/Thieves to use 3 proficiency points
in Two Weapon Fighting:</P><P>using S_2_E:
</P><PRE CLASS="verbatim">COPY_EXISTING ~weapprof.2da~ ~override~
  SET_2DA_ENTRY 34 7  1 3
  SET_2DA_ENTRY 34 39 1 3
  SET_2DA_ENTRY 34 40 1 3
</PRE><P>using S_2_E_L/N:
</P><PRE CLASS="verbatim">COPY_EXISTING ~weapprof.2da~ ~override~
  SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 7  3
  SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 39 3
  SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 40 3
  SET_2DA_ENTRIES_NOW ~_#_#_#weapprof~ 1
</PRE><P>The things to change are the following:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
you have to replace SET_2DA_ENTRY with SET_2DA_ENTRY_LATER
</LI><LI CLASS="li-itemize">in S_2_E_L you don&#X2019;t have to specify the required column count parameter
(in the example, the &#X2019;1&#X2019;)
</LI><LI CLASS="li-itemize">in S_2_E_L you have to specify a string (in the example,
<CODE>~_#_#_#weapprof~</CODE>) before other parameters.
</LI><LI CLASS="li-itemize">finally, after all your SET_2DA_ENTRY_LATER commands, you have to put
SET_2DA_ENTRIES_NOW, the string you put after each S_2_E_L, and the required
column count.
</LI></UL><P>You can also split S_2_E_L sessions across multiple parts - but it is easy to shoot
yourself in the foot:
</P><PRE CLASS="verbatim">// this is OK and works
  COPY_EXISTING ~weapprof.2da~ ~override~
    SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 7  3
    SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 39 3
  DO_SOMETHING_ELSE
  COPY_EXISTING ~weapprof.2da~ ~override~
    SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 40 3
    SET_2DA_ENTRIES_NOW ~_#_#_#weapprof~ 1

// this, however, is a bug:
  COPY_EXISTING ~weapprof.2da~ ~override~
    SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 7  3 /* (*) */
  DO_SOMETHING_ELSE
  COPY_EXISTING ~kitlist.2da~ ~override~
    SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 40 3
    SET_2DA_ENTRIES_NOW ~_#_#_#weapprof~ 1
    // BUG: the (*) action is processed to kitlist.2da, not to weapprof.2da.
    // you can use this to scare off newbies if you're mean.
</PRE><P>Now, the formalities - which could be useful to avoid hopelessly crashing of your tp2.</P><P><CODE>SET_2DA_ENTRY_LATER ~string~ row col value</CODE>
does the following variable associations (<TT>%i%</TT> is a counter which increases with
each S_2_E_L instruction):
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<CODE>SET string%i%r = row</CODE>
</LI><LI CLASS="li-itemize"><CODE>SET string%i%c = col</CODE>
</LI><LI CLASS="li-itemize"><CODE>SPRINT string%i%v value</CODE>
</LI></UL><P>
<CODE>SET_2DA_ENTRIES_NOW ~string~ row_count</CODE>
begins scanning all variables of the form string<TT>%i%</TT>r, string<TT>%i%</TT>c and
string<TT>%i%</TT>v which I spoke about earlier, applies their changes and erases
all those variables (so you can use the same string again).</P><P>So it is possible to cheat and/or introduce bugs:
</P><PRE CLASS="verbatim">COPY_EXISTING ~weapprof.2da~ ~override~
  SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 7  3
  SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 39 3
  SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 40 3
  SET _#_#_#weapprof1v = 5
  // BUG: you're doing SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 39 5 (and not 3)
  SET_2DA_ENTRIES_NOW ~_#_#_#weapprof~ 1
</PRE><P>SUGGESTION: prefix your S_2_E_L/N strings (which can accept <TT>%variables%</TT>,
by the way) with a standard prefix (and don&#X2019;t use variables starting with that
prefix), to avoid accidental overwrites. I like to use, as a string,
<CODE>_#_#_#FILE_NAME</CODE> where FILE_NAME is the name of the file I&#X2019;m editing.</P><!--TOC subsection <TT><B>READ_2DA_ENTRIES_NOW</B></TT> and <TT><B>READ_2DA_ENTRY_FORMER</B></TT> (Last Update: v188)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc36">9.16</A>&#XA0;&#XA0;<B><TT>READ_2DA_ENTRIES_NOW</TT></B><A NAME="READ_2DA_ENTRIES_NOW"></A><A NAME="@default526"></A> and <B><TT>READ_2DA_ENTRY_FORMER</TT></B><A NAME="READ_2DA_ENTRY_FORMER"></A><A NAME="@default527"></A> (Last Update: v188)</H3><!--SEC END --><P>READ_2DA_ENTRIES_NOW and READ_2DA_ENTRY_FORMER are a derivation of
<TT><A HREF="#READ_2DA_ENTRY">READ_2DA_ENTRY</A></TT> pretty much the same way that <TT><A HREF="#SET_2DA_ENTRY_LATER">SET_2DA_ENTRY_LATER</A></TT>
and <TT><A HREF="#SET_2DA_ENTRIES_NOW">SET_2DA_ENTRIES_NOW</A></TT> are a derivation of <TT><A HREF="#SET_2DA_ENTRY">SET_2DA_ENTRY</A></TT>, so
you are advised to be familiar with how <TT><A HREF="#READ_2DA_ENTRY">READ_2DA_ENTRY</A></TT>,
<TT><A HREF="#SET_2DA_ENTRY_LATER">SET_2DA_ENTRY_LATER</A></TT>, and <TT><A HREF="#SET_2DA_ENTRIES_NOW">SET_2DA_ENTRIES_NOW</A></TT> work. Ready? Let&#X2019;s go!</P><P>Here&#X2019;s a comparison of a R_2_E_N/F with R_2_E:</P><P>using R_2_E:
</P><PRE CLASS="verbatim">COPY_EXISTING ~kitlist.2da~ ~override~
  READ_2DA_ENTRY 0 1 9 somevar
  // somevar will be "RESERVE"
</PRE><P>using R_2_E_N/F:
</P><PRE CLASS="verbatim">COPY_EXISTING ~kitlist.2da~ ~override~
  READ_2DA_ENTRIES_NOW ~_#_#_#read_kitlist~ 9
  READ_2DA_ENTRY_FORMER ~_#_#_#read_kitlist~ 0 1 somevar
  // somevar will be "RESERVE"
</PRE><P>If you have read the tutorial about <TT><A HREF="#SET_2DA_ENTRY_LATER">SET_2DA_ENTRY_LATER</A></TT> and
<TT><A HREF="#SET_2DA_ENTRIES_NOW">SET_2DA_ENTRIES_NOW</A></TT> you should already be familiar with the way to
translate this, so I&#X2019;ll only explain the technicalities.</P><P><CODE>READ_2DA_ENTRIES_NOW string col_count</CODE>
will store inside the variable <CODE>%string_row_col%</CODE> the contents of the
cell at row <TT>%row%</TT> and column <TT>%col%</TT>, for all rows
with at least <CODE>col_count</CODE> items.
The variable <CODE>%string%</CODE> will be set to the number of large enough
rows (so, in effect, you also have processed <TT><A HREF="#COUNT_2DA_ROWS">COUNT_2DA_ROWS</A></TT> freely).</P><P><CODE>READ_2DA_ENTRY_FORMER string row col variable</CODE>
will store inside <CODE>variable</CODE> the contents of <CODE>%string_row_col%</CODE>
which should be the content of the cell <CODE>row col col_count</CODE> as defined
by <TT><A HREF="#READ_2DA_ENTRY">READ_2DA_ENTRY</A></TT>, unless the user edited the variable on his own.
Here, <CODE>col_count</CODE> is defined by READ_2DA_ENTRIES_NOW.</P><P>Differently from <TT><A HREF="#SET_2DA_ENTRIES_NOW">SET_2DA_ENTRIES_NOW</A></TT>, neither of these two patches
will clear variables from former <TT><A HREF="#READ_2DA_ENTRIES_NOW">READ_2DA_ENTRIES_NOW</A></TT>, so be extra-careful
in choosing the string to be unique.</P><P>As you can see, I use <CODE>_#_#_#read_FILE_NAME</CODE> as a string (the <CODE>read_</CODE>
part is to proactively avoid possible overlappings with
<TT><A HREF="#SET_2DA_ENTRY_LATER">SET_2DA_ENTRY_LATER</A></TT>, while the WeiDU code also makes sure that these
problems to not occur accidentally).</P><!--TOC subsection DEFINE,LAUNCH,LOCAL and everything else about personal macros (Last Update: v188)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc37">9.17</A>&#XA0;&#XA0;DEFINE,LAUNCH,LOCAL and everything else about personal macros (Last Update: v188)</H3><!--SEC END --><P>Macros were originally intended as a way to repeat a certain tp2 block
with small or no changes without resorting to copy-and-paste.</P><P>First, disclaimers: it&#X2019;s very easy to shoot yourself in the foot, since
there aren&#X2019;t any limits to the variable scoping of macros. Due to this reason, this tutorial
will skip on most basic stuff - if you&#X2019;re going to consider this, you should
already be a master of patching.<BR>
Also, for brevity, I&#X2019;ll give only examples involving tp2 actions. You can
do everything you&#X2019;re about to read here by substituting DEFINE_ACTION_MACRO
and LAUNCH_ACTION_MACRO with DEFINE_PATCH_MACRO and LAUNCH_PATH_MACRO. There
is no change in the treatment of LOCAL_SPRINT/LOCAL_SET.</P><P>For starters, you might want to define a macro that prints "Hello World!" to
the screen.</P><PRE CLASS="verbatim">// at the tp2 flag level, IE after AUTHOR but before components.
DEFINE_ACTION_MACRO ~HW~ BEGIN
  PRINT ~Hello World!~
END

/* ... */

// a component
BEGIN ~Print Hello World and do nothing~
LAUNCH_ACTION_MACRO ~HW~
</PRE><P>So, the syntax is quite simple:
</P><PRE CLASS="verbatim">DEFINE_ACTION_MACRO name-of-the-macro BEGIN
  local variables list
  action list
END
</PRE><P>will bind the action listed here with name-of-the-macro. We&#X2019;ll deal with
local variables later. After that, LAUNCH_ACTION_MACRO name-of-the-macro
will work like if you copy-pasted there the action list defined in
DEFINE_ACTION_MACRO.</P><P>Well, suppose you wanted to say &#X2019;Hello Jon!&#X2019; or &#X2019;Hello Jack!&#X2019; or any other
name, rather than only &#X2019;Hello World!&#X2019;. Do you have to define a macro for each
of these? Of course not, since all variables defined before the LAUNCH_ACTION_MACRO
instruction is called are not cleared, and so can be read (or written) during execution of the macro.</P><PRE CLASS="verbatim">// before calling, have the string ~HW_Name~ contain the name of the person
// to greet.
DEFINE_ACTION_MACRO ~HW~ BEGIN
  PRINT ~Hello %HW_Name%!~
END

/* ... */
OUTER_SPRINT ~HW_Name~ ~Jon~
LAUNCH_ACTION_MACRO ~HW~
OUTER_SPRINT ~HW_Name~ ~Jack~
LAUNCH_ACTION_MACRO ~HW~
</PRE><P>Variables inside macros that are changed keep their new value once the
macro has finished being computed. This is bad and good at the same time.
For example, you might want to calculate a factorial:
</P><PRE CLASS="verbatim">// set ~%factorial_index%~ to the factorial you'd like to compute,
// ~%factorial_result%~ to 1,
// keep a backup copy of ~%factorial_index%~
// ~%factorial_result%~ will yield the resulting factorial.
DEFINE_ACTION_MACRO ~factorial~ BEGIN
  ACTION_IF ~%factorial_index%~ != 1 THEN
  BEGIN
    OUTER_SET ~factorial_result~ = ~%factorial_result%~ * ~%factorial_index%~
    OUTER_SET ~factorial_index~ = ~%factorial_index%~ - 1
     LAUNCH_ACTION_MACRO ~factorial~
  END
END

/* ... */
OUTER_SET ~factorial_index_old~ = 5
OUTER_SET ~factorial_index~ = 5
OUTER_SET ~factorial_result~ = 1
LAUNCH_ACTION_MACRO ~factorial~
PRINT ~%factorial_index_old%! = %factorial_result%~
</PRE><P>The fact that variables are kept through the entire tp2 execution (formally,
that they are global) is good, since you have a way of &#X2019;remembering&#X2019; the result;
however, the bad part is that it may happen that variables are changed even if you
didn&#X2019;t want them to.<BR>
Note: risks grow exponentially as you use macros by somebody else.</P><P>By the way, another (rarely) useful feature of macros used here is that they
can call themselves (formally, they are recursive).</P><P>To solve the problem with variables being changed inside a macro, I provided
a rudimentary form of scoping: the aforementioned local variables list part.</P><P>Note: if &#X2019;global&#X2019; and &#X2019;local&#X2019; variables mean nothing to you (for example, if you
don&#X2019;t have experience in programming in real life languages) you might have
problems in understanding the logic beneath the rest of this tutorial. You&#X2019;ll do
fine with the tutorials about standard macros.</P><P>Basically, at the beginning of the macro declaration, you may use
</P><PRE CLASS="verbatim">LOCAL_SET name = value
LOCAL_SPRINT variable string
</PRE><P>to declare a variable as local, and assign it a new value. Use this for all variables
that don&#X2019;t need to be changed by the macro. After computing the macro, these variables
are set to the value they had before the macro was processed. They work for both
actions and patches. For example, here is a corrected
factorial macro (also converted to patch):
</P><PRE CLASS="verbatim">// set ~%tb#factorial_index%~ to the factorial you'd like to compute,
// ~%tb#factorial_result%~ to 1,
// ~%ftb#actorial_result%~ will yield the resulting factorial.
DEFINE_PATCH_MACRO ~tb#factorial~ BEGIN
  LOCAL_SET ~tb#factorial_index~ = ~%factorial_index%~
  PATCH_IF ~%tb#factorial_index%~ != 1 THEN
  BEGIN
    SET ~tb#factorial_result~ = ~%tb#factorial_result%~ * ~%tb#factorial_index%~
    SET ~tb#factorial_index~ = ~%tb#factorial_index%~ - 1
    LAUNCH_PATCH_MACRO ~tb#factorial~
  END
END

/* ... */
SET ~tb#factorial_index~ = 5
SET ~tb#factorial_result~ = 1
LAUNCH_PATCH_MACRO ~tb#factorial~
PATCH_PRINT ~%tb#factorial_index%! = %tb#factorial_result%~
</PRE><!--TOC subsection standard macros (Last Update: v188)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc38">9.18</A>&#XA0;&#XA0;standard macros (Last Update: v188)</H3><!--SEC END --><P>For your convenience, WeiDU includes some standard macros for you to use.
See <TT><A HREF="#Macros Listing">Macros Listing</A></TT> for a listing of all macros and how to invoke
them in detail. Here I&#X2019;ll describe the standard syntax.</P><P>In our example, we&#X2019;ll use the tb#factorial macro (which is the same as the
last example in the preceding tutorial).</P><P>Description (from <TT><A HREF="#Macros Listing">Macros Listing</A></TT>):
<CODE>tb#factorial</CODE>: computes the factorial of a number.<BR>
This is a PATCH macro.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET <CODE>tb#factorial_index</CODE> to the factorial you&#X2019;d like to compute.
</LI><LI CLASS="li-itemize">SET <CODE>tb#factorial_result</CODE> to 1;
</LI><LI CLASS="li-itemize">The result is <CODE>tb#factorial_result</CODE>.
</LI></UL><P>Read the instructions on the variables to set:
</P><PRE CLASS="verbatim">SET ~tb#factorial_index~ = 5
SET ~tb#factorial_result~ = 1
LAUNCH_PATCH_MACRO ~tb#factorial~
PATCH_PRINT ~%tb#factorial_index%! = %tb#factorial_result%~
</PRE><P>(since you&#X2019;ve read the warnings from the previous tutorial, standard macros
make use of LOCAL_SET/SPRINT to avoid overwriting variables that shouldn&#X2019;t
change).</P><P>Another example:</P><P><CODE>tb#fix_file_size</CODE>: overwrites all files matching a certain regexp with a
certain standard file, if they are under a certain size.<BR>
This is an ACTION macro.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET <CODE>tb#fix_file_size_min</CODE> to the maximum allowed size
(files whose size is exactly this value are NOT overwritten).
</LI><LI CLASS="li-itemize">SPRINT <CODE>tb#fix_file_size_target</CODE> to the standard file used to replace file(s) that match the regexp.
</LI><LI CLASS="li-itemize">SPRINT <CODE>tb#fix_file_size_category</CODE> to a descriptive name.
</LI><LI CLASS="li-itemize">SPRINT <CODE>tb#fix_file_size_regexp</CODE> to the regexp for the file(s) to be checked for a match.
</LI></UL><P>
So, to overwrite all item files that are smaller than 0x72 with sw1h01.itm
(for example the corrupted iplot*.itm files)
</P><PRE CLASS="verbatim">OUTER_SET tb#fix_file_size_min = 0x72
OUTER_SPRINT tb#fix_file_size_target "SW1H01.ITM"
OUTER_SPRINT tb#fix_file_size_category "items"
OUTER_SPRINT tb#fix_file_size_regexp "^.*\.itm$"
LAUNCH_ACTION_MACRO ~tb#fix_file_size~
</PRE><!--TOC subsection <TT><B>GROUP</B></TT> (Last update: V221)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc39">9.19</A>&#XA0;&#XA0;<B><TT>GROUP</TT></B><A NAME="GROUP"></A><A NAME="@default528"></A> (Last update: V221)</H3><!--SEC END --><P>The GROUP flag came about in discussing component management with an
abnormally large number of independent components, e.g. BG2 Tweaks. Previously
WeiDU lacked a satisfactory way to organize such a mod. The closest feature
would be the top level ASK_EVERY_COMPONENT, which only allows for a single
all-or-none approach.</P><P>The solution is a new component flag, GROUP, with the following syntax (and example):</P><P>Code:
</P><PRE CLASS="verbatim">GROUP string

Code:
BEGIN ~100% Learn Spells~
GROUP ~Convenience Tweaks~
// component code

BEGIN ~Identify All Items~
GROUP ~Convenience Tweaks~
// component code

BEGIN ~Give Edwin his BG2 Stats~
GROUP ~NPC Tweaks~
// component code

BEGIN ~ Give Jaheira her BG2 Stats~
GROUP ~NPC Tweaks~
// component code
</PRE><P>Upon installing the mod, the player is now presented with meta-options on
each group at a high level:</P><P>Code:
</P><PRE CLASS="verbatim">Would you like to display the category [Convenience Tweaks]? [Y]es/[N]o
Would you like to display the category [NPC Tweaks]? [Y]es/[N]o
</PRE><P>Selecting <CODE>[N]o</CODE> on any group suppresses those options from being
displayed, leading to a simpler and more controlled installer experience for
the player. In the provided example, selecting <CODE>[N]o</CODE> to Convenience
Tweaks and <CODE>[Y]es</CODE> to NPC Tweaks would result in WeiDU starting
installation by asking to install the Give Edwin his BG2 Stats component.</P><P>GROUP operates independently of SUBCOMPONENT, meaning you can use both to
organize the mod as needed. A few other items of note:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
A component can belong to multiple GROUPs; a component is not offered
for install if and only if none of its member groups are selected
</LI><LI CLASS="li-itemize">You could, in theory, have two components in the same SUBCOMPONENT
grouping but different GROUPs. Don&#X2019;t do this.
</LI><LI CLASS="li-itemize">You can give a GROUP a condition, by adding a patch_expression after the
GROUP definition. This way, the user will not be asked about that GROUP (and
its components will be automatically skipped). If you give different conditions
to the components in a GROUP, these conditions are OR()red.
</LI><LI CLASS="li-itemize">Because of a couple of issues with ordering and/or GROUPs not appearing,
you are encouraged to put, at the end of your tp2, a dummy component for each
GROUP, in the order you&#X2019;d like to show them to the user. For the above example,
if you want to ask about the &#X2019;Convenience Tweaks&#X2019; group before the &#X2019;NPC Tweaks&#X2019;
one, the code becomes:
<PRE CLASS="verbatim">BEGIN ~100% Learn Spells~
GROUP ~Convenience Tweaks~
// component code

BEGIN ~Identify All Items~
GROUP ~Convenience Tweaks~
// component code

BEGIN ~Give Edwin his BG2 Stats~
GROUP ~NPC Tweaks~
// component code

BEGIN ~ Give Jaheira her BG2 Stats~
GROUP ~NPC Tweaks~
// component code

BEGIN ~Dummy component because it's too hard to fix this in WeiDU~
DEPRECATED ~Dummy component~
GROUP ~Convenience Tweaks~

BEGIN ~Dummy component because it's too hard to fix this in WeiDU~
DEPRECATED ~Dummy component~
GROUP ~NPC Tweaks~ GAME_IS ~bg2 tob~ // will not be asked for in Tutu
</PRE>This isn&#X2019;t needed for the above example, but it might be needed in more complex
scenarios.
</LI><LI CLASS="li-itemize">If some components of a mod are in a GROUP, but others are not, the
non-GROUPed components will always be presented.
</LI><LI CLASS="li-itemize">Using a GROUP anywhere in your mod will act as an implied
ASK_EVERY_COMPONENT tp2 flag.
</LI></UL><!--TOC subsection <TT><B>array construct</B></TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc40">9.20</A>&#XA0;&#XA0;<B><TT>array construct</TT></B><A NAME="array construct"></A><A NAME="@default529"></A></H3><!--SEC END --><P>The array construct (for lack of a better term) can be used to create with
ease arrays at the install time. The construct is formed as follows:</P><P><CODE>$variable(modifier list)</CODE></P><P>It is equivalent to saying</P><P><CODE>~variable_%modifier1%_%modifier2%_etc.~</CODE></P><P>When it is on the right handed side of a SPRINT or SET statement, the contents of
a variable with the resulting name, if existing, is used in place of the variable name.
This does not happen on the left handed side (this is good for you).</P><P>Example dummy use:</P><PRE CLASS="verbatim">OUTER_SPRINT ~var_1_sbar~ ~300~
OUTER_SPRINT ~var_1~ ~bar~
OUTER_SPRINT $asd(doo) ~f00~
  // equivalent to OUTER_SPRINT ~asd_doo~ ~f00~
OUTER_SET $s(x) = 4
  // equivalent to OUTER_SET ~s_x~ = 4
OUTER_SET one = 1
OUTER_SPRINT two ~sbar~

OUTER_SET ~x~ = $var("%one%" "%two%")
  // equivalent to OUTER_SET ~x~ = ~var_%one%_%two%~
  // which is again equivalent to OUTER_SET ~x~ = ~var_1_sbar~  (which is 300)
OUTER_SPRINT ~y~ $var("%one%")
  // equivalent to OUTER_SPRINT ~y~ (the contents of variable ~var_%one%~/~var_1~ )
OUTER_SPRINT ~z~ $asd(doo)
  // equivalent to OUTER_SPRINT ~z~ (the contents of variable ~asd_doo~ )
OUTER_SPRINT ~t~ $miss(ing)
  // equivalent to OUTER_SPRINT ~t~ (the contents of variable ~miss_ing~
 // there's no variable "miss_ing", so we default to the "miss_ing" text instead )
OUTER_SET ~f~ = $s(x)
  // equivalent to OUTER_SET ~f~ = ~s_%x%~

OUTER_SPRINT $var(x) ~p~
  // equivalent to OUTER_SPRINT ~var_x~ ~p~
OUTER_SPRINT $var(x) ~y~
  // equivalent to OUTER_SPRINT ~var_x~ ~y~
  // notice that the ~var_x~ variable is not checked, so this doesn't become OUTER_SPRINT ~p~ ~y~

PRINT ~"%x% %y% %z% %t% %f% %var_x%" should yeld "300 bar f00 miss_ing 4 y"~
</PRE><P>We expect somebody to actually write a mod which uses this form more seriously
this construct and use their code as a more useful example.</P><!--TOC subsection <TT><B>MODDER</B></TT> (Last update: v230)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc41">9.21</A>&#XA0;&#XA0;<B><TT>MODDER</TT></B><A NAME="MODDER"></A><A NAME="@default530"></A> (Last update: v230)</H3><!--SEC END --><P>The MODDER flag allows for more debugging info to be reported. It is suggested to
leave MODDER enabled while you&#X2019;re developing your mod and then disable it before
you ship it to the players. However, given different coding styles, it is possible
that something gets interpreted as a critical bug for some users and as expected
behavior for others. For this reason, it&#X2019;s possible to fine-tune the reporting level
for some of the bugs that are found. This is done by writing additional modifiers
after your MODDER statement, for example:
</P><PRE CLASS="verbatim">MODDER setup_tra fail area_variables none missing_extern warn
</PRE><P>Each option can be set to either NONE, WARN or FAIL with the above syntax,
with the obvious meaning. If none are chosen, WARN is assumed. WARN may generate false positives.
In this case, "INSTALLED WITH WARNINGS" is not displayed.</P><P>Options set via the the command line supercede options set via the MODDER statement.</P><P>Here the list of feedback options that you can configure, along with use cases when you
should deactivate them. In all other cases, using FAIL or WARN is a case of personal
preference (for example, use WARN early in the development process and FAIL when you&#X2019;re
near the beta status).
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
setup_tra: a dialogue/script uses @references that aren&#X2019;t available from
its own tra file, but are taken instead from the tp2-level setup.tra.<BR>
 When to use NONE: you&#X2019;re knowingly using references from
setup.tra into scripts and/or dialogues, rather than using file-specific TRA files.
</LI><LI CLASS="li-itemize">area_variables: the variable scope in a BAF/D <CODE>*Global*("varname","scope")</CODE>
statement is six characters long, but not GLOBAL, MYAREA, LOCALS, or a valid area name.<BR>
 When to use NONE: you biff your .are files using bat files, or you copy them to
		 the override after compiling your scripts.
</LI><LI CLASS="li-itemize">missing_extern: an EXTERN transition in a D file references a DLG file that
doesn&#X2019;t exist, nor is created in the current file.<BR>
 When to use NONE: you have two separate D files that EXTERN to each other.
</LI><LI CLASS="li-itemize">missing_resref: a file referenced by a scripting command (EG a CRE file for a
CreateCreature action) is not available.<BR>
 When to use NONE: you biff your files using bat files, or you copy them to
		 the override after compiling your scripts.
</LI><LI CLASS="li-itemize">ict2_actions: you call an I_C_T2 into a state which has different actions.
		 If the different actions look like they&#X2019;re caused by another mod ICT2&#X2019;ing in
		 the same state, only the warning is printed, further actions are not processed.<BR>
 When to use NONE: you want to ICT2 into a state with different exit actions.
</LI><LI CLASS="li-itemize">missing_eval: WeiDU thinks that you forgot to use EVALUATE_BUFFER to evaluate
variables in a command. Currently used for:
<UL CLASS="itemize"><LI CLASS="li-itemize">
WRITE_ASCII (vs. WRITE_ASCIIE)
</LI><LI CLASS="li-itemize">STR_VAR
</LI><LI CLASS="li-itemize">COMPILE
</LI><LI CLASS="li-itemize">arrays
</LI></UL>
</LI><LI CLASS="li-itemize">overwriting_file: you are writing to a file that exists (physically and/or in biffs).
</LI></UL><P>An important note: if a tp2 sets MODDER, the debugging mode might propagate to
other mods. As such, <EM>REMEMBER TO TURN MODDER OFF WHEN YOU RELEASE YOUR MOD.</EM></P><!--TOC subsection <TT><B>READLN</B></TT> (Last update: v203)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc42">9.22</A>&#XA0;&#XA0;<B><TT>READLN</TT></B><A NAME="READLN"></A><A NAME="@default531"></A> (Last update: v203)</H3><!--SEC END --><P>This tutorial has been brought to you by plainab.</P><P>The goal of this tutorial is to explain the use of READLN within the tp2 structure.
READLN can be used as an action or as a patch. My experience has been in using it
as an action command. I will describe the usage of READLN and then give you some
examples of its use. To put it bluntly READLN stands for "read line" and it&#X2019;s use
causes WeiDU to pause and read any information entered by the user on the interface
screen and to then store that information within the given variable.</P><P>Syntax:
</P><PRE CLASS="verbatim">ACTION_READLN ~variable~
PATCH_READLN ~variable~
</PRE><P>Lets build an example from scratch:</P><P>First we need to have something we want to change. For this example we will use the
stack amount for item files. We could pick a high number and simply use:</P><PRE CLASS="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
 WRITE_SHORT 0x38 9999 //stack value
BUT_ONLY_IF_IT_CHANGES
</PRE><P>Or we can let the end user choose how many items they want in their stacks. 
To do that we first need to ask the user a question.</P><PRE CLASS="verbatim">PRINT ~How many of one item do you want to be able to be stacked?~
</PRE><P>If we leave it at this, weidu will display the question, but keep running.
We have to make weidu pause and that is where READLN comes in. So we now have:</P><PRE CLASS="verbatim">PRINT ~How many of one item do you want to be able to be stacked?~
ACTION_READLN ~new_stack~
</PRE><P>We can then take this entered value and use it on our copy block.</P><P>So the usage in this example would be:</P><PRE CLASS="verbatim">BEGIN ~Modify the stack value of all items~
PRINT ~How many of one item do you want to be able to be stacked?~
ACTION_READLN ~new_stack~

COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
 WRITE_SHORT 0x38 %new_stack% //stack value
BUT_ONLY_IF_IT_CHANGES
</PRE><P>You could leave it at this and it will work, but I will tell you now that the end
user can input any character from their keyboard. READLN doesn&#X2019;t care what is
entered, but weidu may have problems if it is expecting an integer rather than text.
To get around that issue we need to add a loop that will re-ask the question when the
user enters the incorrect type of information.</P><PRE CLASS="verbatim">BEGIN ~Modify the stack value of all items~
PRINT ~How many of one item do you want to be able to be stacked?~
ACTION_READLN ~new_stack~

OUTER_WHILE NOT(IS_AN_INT %new_stack%) BEGIN
 PRINT ~How many of one item do you want to be able to be stacked?~
 ACTION_READLN ~new_stack~
END

COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
 WRITE_SHORT 0x38 %new_stack% //stack value
BUT_ONLY_IF_IT_CHANGES
</PRE><P>The loop we added looks to see if the entered value is an integer and if the
entered value is not an integer then it will re-ask the question. This loop
will go indefinitely until the user inputs the correct type of information.
Should your user not understand why they keep getting asked the question you may
wish to add new text to your questions to help them to understand what it is
you are looking for. As in this example:</P><PRE CLASS="verbatim">BEGIN ~Modify the stack value of all items~
PRINT ~How many of one item do you want to be able to be stacked?
Please enter your answer as an integer.~
ACTION_READLN ~new_stack~

OUTER_WHILE NOT(IS_AN_INT %new_stack%) BEGIN
 PRINT ~Your answer was not an integer.
Please enter your answer as an integer.
How many of one item do you want to be able to be stacked?~
 ACTION_READLN ~new_stack~
END

COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
 WRITE_SHORT 0x38 %new_stack% //stack value
BUT_ONLY_IF_IT_CHANGES
</PRE><P>That is the basics on asking for information from the user and then applying that
information later on in the install process. PATCH_READLN works just like
ACTION_READLN only it&#X2019;s location of use within the tp2 is different.</P><P><BR>

Another use of READLN is to create options that the user can choose from.
Top level options are taken care of by the use of SUBCOMPONENT and/or GROUP, but since
WeiDU cannot nest subcomponents, you can use READLN to offer additional choices beneath
the first set of subcomponents. Here&#X2019;s an example of a finished product where READLN is
used to offer additional choices to a subcomponent. The relevant parts to this discussion
were taken from iiProjectileRetrievalMod. I helped to create this portion of the mod.
It works. I have however since learned of better methods that would eliminate some of the
READLN usage from this example.</P><PRE CLASS="verbatim">BEGIN ~Easy TUTU~
SUBCOMPONENT ~Projectile Retrieval Mod~
INCLUDE ~iiprojectiler/E22.tph~  // Easy TUTU version of mod

BEGIN ~All other Infinity Engine Games~
SUBCOMPONENT ~Projectile Retrieval Mod~

PRINT ~Please tell me how you'd like to modify your files.

1. I want to modify ALL thrown/projectiles at once.
2. I want to modify each thrown/projectile one at a time.

PLEASE ENTER  1 OR 2  ~
ACTION_READLN how
OUTER_WHILE NOT(IS_AN_INT %how%) || (%how% &gt; 2) || (%how% &lt; 1) BEGIN
 PRINT ~Please tell me how you'd like to modify your files.

1. I want to modify ALL thrown/projectiles at once.
2. I want to modify each thrown/projectile one at a time.

PLEASE ENTER  1 OR 2  ~
 ACTION_READLN how
END

ACTION_IF (%how% = 1) THEN BEGIN
 PRINT ~Please choose how you'd like ALL your projectiles retrieved.

1. Plain projectile only -&gt; Plain projectile only
2. All projectiles       -&gt; Plain projectile only
3. Each projectile       -&gt; Each projectile
4. Magical projectiles   -&gt; Reduced Magical/Plain projectiles

PLEASE ENTER  1, 2, 3, OR 4  ~
 ACTION_READLN choice
 OUTER_WHILE NOT(IS_AN_INT %choice%) OR (%choice% &gt; 4) OR (%choice% &lt; 1) BEGIN
  PRINT ~Please choose how you'd like ALL your projectiles retrieved.

1. Plain projectile only -&gt; Plain projectile only
2. All projectiles       -&gt; Plain projectile only
3. Each projectile       -&gt; Each projectile
4. Magical projectiles   -&gt; Reduced Magical/Plain projectiles

PLEASE ENTER  1, 2, 3, OR 4  ~
  ACTION_READLN choice
 END
</PRE><P>The only drawback to using READLN when offering additional choices to the user is
that there is no record within the weidu.log file as to which choices were made.
Should a problem arise during game play it may be difficult to determine which choice
is causing the problem, especially if the player has forgotten which choices they made.
This could be solved by creating your own log file, but that is another tutorial...</P><!--TOC subsection <TT><B>Functions</B></TT> (Last update: V210)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc43">9.23</A>&#XA0;&#XA0;<B><TT>Functions</TT></B><A NAME="Functions"></A><A NAME="@default532"></A> (Last update: V210)</H3><!--SEC END --><P>Macros can have unintended side effects because they change the global variable environment.
You have to be extremely careful when interacting with the &#X201C;outside&#X201D;.</P><P>That&#X2019;s why functions were introduced in v209. Any changes to the variables are only visible
inside the function. You can also provide default arguments and return values.</P><P>As with macros these functions come in an ACTION and a PATCH variant. So the corresponding
commands are: DEFINE_ACTION_FUNCTION / DEFINE_PATCH_FUNCTION (both actions) and
LAUNCH_ACTION_FUNCTION (action) / LAUNCH_PATCH_FUNCTION (patch).</P><P>Before you can use a function you have to DEFINE it:
</P><PRE CLASS="verbatim">DEFINE_PATCH_FUNCTION count_spells INT_VAR level = 1 STR_VAR type = "WI" RET num BEGIN
    SET num = 0
    PATCH_IF (~%SOURCE_EXT%~ STRING_EQUAL_CASE ~CRE~) THEN BEGIN
        // do some magic here that actually counts the number of spells and sets
        // the variable num to that number.
    END
END
</PRE><P>After that you can LAUNCH it:
</P><PRE CLASS="verbatim">COPY_EXISTING ~my.cre~ ~override~
    // count number of level 1 wizard spells (default arguments of the function)
    LAUNCH_PATCH_FUNCTION count_spells RET lvl1_wizard = num END
    // and now the level 5 priest spells
    SET level = 5
    SPRINT type = "PR"
    LAUNCH_PATCH_FUNCTION count_spells RET lvl5_priest = num END

    PATCH_PRINT ~This CRE has %lvl1_wizard% level 1 wizard spells and %lvl5_priest% level 5 priest spells~
</PRE><P>Notice that arguments are passed indirectly to the function.
It inherits the variable environment from the caller. So when you launch it,
all variables that are visible at that point are also visible from within the function.</P><P>You can provide default values for variables with INT_VAR (integers) and STR_VAR (strings).
If the variable was not defined in the caller&#X2019;s environment the default value is used.</P><P>Any variables you change inside the function will revert back to their old value
after the function finishes.
That&#X2019;s why you have to specify what values should be return values.
You can do this in the RET part of the function definition (<CODE>RET num</CODE>).
When you launch the function you can use these variables to import the value
into your current variable environment (<CODE>RET lvl1_wizard = num</CODE>).
Separate the variables with a space character if you have multiple return values.</P><P>If you don&#X2019;t need certain features simply omit them:
</P><PRE CLASS="verbatim">DEFINE_ACTION_FUNCTION xyz INT_VAR x = 1 y = 2 z = 3 BEGIN
    PRINT ~x: %x%, y: %y%, z: %z%~
END

LAUNCH_ACTION_FUNCTION xyz END
</PRE><P>Starting from V210, you can also specify a variable that will be local to the
function environment, without being passed back to the calling environment,
by adding either STR_VAR or INT_VAR to the LAUNCH bit:
</P><PRE CLASS="verbatim">DEFINE_ACTION_FUNCTION xyz INT_VAR x = 1 y = 2 z = 3 BEGIN
    PRINT ~x: %x%, y: %y%, z: %z%~
END

LAUNCH_ACTION_FUNCTION xyz INT_VAR x = 0 END

OUTER_SET y = 5
LAUNCH_ACTION_FUNCTION xyz INT_VAR y END // synonym for INT_VAR y = y
</PRE><!--TOC subsection <TT><B>GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2</B></TT> (last edit: 218)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc44">9.24</A>&#XA0;&#XA0;<B><TT>GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2</TT></B><A NAME="GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2"></A><A NAME="@default533"></A> (last edit: 218)</H3><!--SEC END --><P>Many thanks to Wisp for providing this tutorial.</P><P>GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2 are means for obtaining information about certain types of file structures without using the usual READs, FORs etc. GET_OFFSET_ARRAY can, for example, be used to find the starting offsets for all the extended headers (abilities) in an item, while GET_OFFSET_ARRAY2 can be used to find the starting offsets for all extended effects in the item. Since the effect structure is organised by the ability structure, GET_OFFSET_ARRAY2 is conventionally used together with GET_OFFSET_ARRAY.</P><P>The seven values required by GET_OFFSET_ARRAY are:
</P><PRE CLASS="verbatim">1. Offset
2. Read length of "Offset"
3. Iterations
4. Read length of "Iterations"
5. Index
6. Read length of "Index"
7. Length between iterations.
</PRE><P>Acceptable values for read length are 0 (don&#X2019;t read), 2 (SHORT) and 4 (LONG). Length between iterations depends on the file structure you are working with. In our item example, length between iterations is 0x38 while we are using GET_OFFSET_ARRAY. If we were working with a spell instead, it would be 0x28.</P><P>In the item example, "Offset" is 0x64, which gives the ability offset when read.
The value read from "Iterations" is the number reads that should be performed. "Iterations" is 0x68 in the item example, which gives the number of abilities when read.
The value read from "Index" is the number of iterations into the file the current read should be made. This is not always relevant for GET_OFFSET_ARRAY, but for reading general effects (on-equip effects), this is 0x6e.</P><P>GET_OFFSET_ARRAY2 requires an additional value. Let&#X2019;s call it Offset2. This value is normally obtained as the result from GET_OFFSET_ARRAY. In our item example this value is the starting offset for the current ability. The value of "Offset" is now 0x6a, which gives the effect offset. The value of "Iterations" is now 0x1e, which gives the number of effects, the value of "Index" is now 0x20 and both are read from Offset2 + value (unlike GET_OFFSET_ARRAY where they are read from the start of the file).</P><P>For example, if we wanted to know how many levels Blackrazor can drain, we could use this code:
</P><PRE CLASS="verbatim">COPY_EXISTING miscbc.itm override
  GET_OFFSET_ARRAY ab_array 0x64 4 0x68 2 0 0 0x38
  PHP_EACH ab_array AS int =&gt; ab_off BEGIN
    GET_OFFSET_ARRAY2 fx_array ab_off ITM_V10_HEAD_EFFECTS
    PHP_EACH fx_array AS int =&gt; fx_off BEGIN
      READ_SHORT fx_off fx_type
      PATCH_IF fx_type = 216 BEGIN
        READ_LONG fx_off + 0x4 amount
        PATCH_PRINT "I drain %amount% level(s)"
      END
    END
  END
BUT_ONLY
</PRE><!--TOC subsection <TT><B>MATCH and TRY</B></TT> (last edit: 225)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc45">9.25</A>&#XA0;&#XA0;<B><TT>MATCH and TRY</TT></B><A NAME="MATCH and TRY"></A><A NAME="@default534"></A> (last edit: 225)</H3><!--SEC END --><P><CODE>MATCH</CODE> is the equivalent of switch..case in mainstream languages (except
it also works on strings, similar to OCaml&#X2019;s match..with). This is a type of
selection control statement whose purpose is to allow the value of a variable
or expression to control the flow of program execution via a multiway branch. 
The main reasons for using this type of statement include improving clarity
and reducing otherwise repetitive coding.</P><P><CODE>TRY</CODE> is used to detect TP2 failures (= anything that blocks the installation
and prints "NOT INSTALLED DUE TO ERRORS") and allows the modder to run custom
code (without forcibly failing the installation). The syntax is very similar
to <CODE>MATCH</CODE>, which is why these two commands are presented together.</P><P>This tutorial documents <CODE>ACTION_MATCH</CODE> and <CODE>ACTION_TRY</CODE>, but the
patch equivalents (<CODE>PATCH_MATCH</CODE> and <CODE>PATCH_TRY</CODE>) are also
available.</P><P>This is a sample code for <CODE>MATCH</CODE>:
</P><PRE CLASS="verbatim">ACTION_MATCH 12 + 14 // value
WITH
  15 16 // guards
  BEGIN
    PRINT ~15 or 16~ // guarded actions
  END
  15 + 5 ~str.*with%vars% and regexp~
  BEGIN
    PRINT ~15 + 5 or matches "str.*with%vars% and regexp"~
  END
  DEFAULT
    PRINT ~default~ // default actions
END
</PRE><P>To begin with, the value (12 + 14) is evaluated (can be any integer or a string).
After that, it is compared against each guard: it is neither 15 nor 16, so its
guarded action is not executed. Similarly, it is neither 15 + 5 (= 20)
nor does it match the regexp <CODE>~str.*with%vars% and regexp~</CODE> after evaluating
variables and case-insensitive regexp, so its guarded actions aren&#X2019;t executed either.
Since no listed value is printed, the default action(s) are executed (in this case,
<CODE>PRINT ~default~</CODE>).</P><P><CODE>MATCH</CODE> can also compare against strings:
</P><PRE CLASS="verbatim">OUTER_SET var = 15
ACTION_MATCH ~string%var%~
WITH
  ~string12~ ~string2.*~
  BEGIN
    PRINT ~string12 or string2.*~
  END
  ~string1[12345]~
  BEGIN
    PRINT ~string1[12345]~
  END
  DEFAULT
    PRINT ~default~
END
</PRE><P>In this case, <CODE>PRINT ~string1[12345]~</CODE> is executed.</P><P>Guards can also have a condition associated; in that case, the value must match
against one of the guards and the condition must be true:
</P><PRE CLASS="verbatim">ACTION_MATCH ~%something%~
WITH
  ~none~ WHEN GAME_IS ~BG1 TotSC~
  BEGIN
    // ~none~ and the game is BG1
  END
  ~none~
  BEGIN
    // ~none~ and the game is not BG1
  END
  DEFAULT
    // not ~none~
END
</PRE><P>It is also possible to have a condition without a guard, in which case the
syntax is:
</P><PRE CLASS="verbatim">ACTION_MATCH ~%something%~
WITH
  ANY GAME_IS ~BG1 TotSC~
  BEGIN
    // the game is BG1
  END
  ANY GAME_IS ~SoA ToB~
  BEGIN
    // the game is BG2
  END
  DEFAULT
    // not BG1 or BG2
END
</PRE><P>Specific cases that might be worth mentioning:
it is possible for a guarded action to be empty, to have no default actions,
or to only have default actions, as per the following examples:
</P><PRE CLASS="verbatim">ACTION_MATCH ~%something%~
WITH
  ~no action~ ~none~ ~empty~ ~~
  BEGIN
    // empty guarded action: default action never executed
  END
  ~error~
  BEGIN
    FAIL ~error~
  END
  DEFAULT
    DO_THIS_AND_THAT
END

ACTION_MATCH ~%something%~
WITH
  ~value1~ ~value2~ ~value3~
  BEGIN
    DO_SOMETHING
  END
  ~error~
  BEGIN
    FAIL ~error~
  END
  DEFAULT
    // no default action: nothing is done for unmatched values
END

ACTION_MATCH ~%something%~
WITH
  DEFAULT
    // no guarded actions, only default actions: always executed
    DO_THIS_AND_THAT
END
</PRE><P>Also, no more than one group of actions is executed:
</P><PRE CLASS="verbatim">ACTION_MATCH ~string123~
WITH
  ~string123~
  BEGIN
    DO_THIS // executed
  END
  ~string123~
  BEGIN
    DO_THAT // not executed
  END
  DEFAULT
    DO_BOTH // also not executed
END
</PRE><P><BR><BR><BR><BR>
<CODE>TRY</CODE> is similar to <CODE>MATCH</CODE>:
</P><PRE CLASS="verbatim">ACTION_TRY
  COPY ~override/sw1h01.itm~ ~override~
  DO_SOMETHING_ELSE
WITH
  ~Unix.Unix_error(20, "stat", "override/sw1h01.itm")~
  BEGIN
    PRINT ~I caught sw1h01.itm not found!~
  END
  ~Unix.Unix_error(20, "stat", "override/.*.itm")~
  BEGIN
    PRINT ~I caught another missing item!~
  END
  DEFAULT
    PRINT ~I caught another error!~
END
</PRE><P>The actions in <CODE>ACTION_TRY</CODE> are executed. If none of those fails, the
<CODE>WITH</CODE> part is skipped; otherwise, the error message is printed as usual
(use <TT><A HREF="#SILENT">SILENT</A></TT>), the exception text (from the ERROR: blah blah line) is
saved to the <CODE>%ERROR_MESSAGE%</CODE> variable, and a <CODE>MATCH</CODE> is executed
on that.</P><P>After running the correct error handling code, execution continues after the
end of the <CODE>ACTION_TRY</CODE> block. If you still want to block the
installation, use <CODE>ACTION_RERAISE</CODE> (in theory, you could use
<CODE>FAIL ~%ERROR_MESSAGE%~</CODE>, but this changes the exception and its text,
which would cause you headaches when nesting multiple <CODE>TRY</CODE>s).</P><!--TOC subsection <TT><B>QUICK_MENU</B></TT> (last edit: 227)-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc46">9.26</A>&#XA0;&#XA0;<B><TT>QUICK_MENU</TT></B><A NAME="QUICK_MENU"></A><A NAME="@default535"></A> (last edit: 227)</H3><!--SEC END --><P>This tp2 flag is used to define groups of components that the user will be
offered to install in a single step. Sample code:</P><PRE CLASS="verbatim">QUICK_MENU
  ALWAYS_ASK 5 END
  ~Red~ BEGIN 1 2 END
  ~Green~ BEGIN 2 3 END
  ~Blue~ BEGIN 4 6 END
END
</PRE><P>The user will be presented with the following prompt:</P><PRE CLASS="verbatim">The test/test.tp2 mod has 13 distinct optional components.
To save time, you can choose what to do with them at a high level rather than being asked about each one.

[A]sk about each component, [S]kip all, or choose a pre-defined selection:
 1] Red
 2] Green
 3] Blue
</PRE><P>If some mod components were already installed, the option to [U]ninstall
or [R]einstall the currently installed components will also be offered.</P><P>If the user chooses to install a pre-defined selection, then its components
will be installed, and ALL other components of the mod will be uninstalled
if already installed.</P><P>Components in ALWAYS_ASK will always be asked for individually if the user
chose to install one of the pre-defined selections (or, of course, if he chose
[A]). If the user chose [S], [R] or [U] the same action will be applied to the
components in ALWAYS_ASK.</P><P>Caveats:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
If a component is in both ALWAYS_ASK and a pre-defined selection the mod
will refuse to install.
</LI><LI CLASS="li-itemize">Because of a complex problem whose details are too technical for this
document, component 0 of your mod must be empty (or your mod will refuse to
install), must not be in any pre-defined selection or in ALWAYS_ASK (or your
mod will refuse to install) and will always be (re)installed (unless the user
chooses [S]kip all). <P>This also means that your mod&#X2019;s components will always be grouped together (you
can&#X2019;t install a component from your mod, then a second mod, and then other
components of your mod).
</P></LI><LI CLASS="li-itemize">Some of the listed failure points are not checked for when the mod is
installed non-interactively (--yes, --force-install and friends). Test the menu
system at least once before releasing your mod, even if you do the bulk of the
development of your mod using --yes and the like.
</LI></UL><!--TOC section <TT><B>Code dumps</B></TT>-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc47">10</A>&#XA0;&#XA0;<B><TT>Code dumps</TT></B><A NAME="Code dumps"></A><A NAME="@default536"></A></H2><!--SEC END --><P>
This section contains code snippets that serve to document functionality
not covered elsewhere.</P><P>These snippets are provided by Miloch.
</P><PRE CLASS="verbatim">//For each dialogue, change GivePartyGold() to GiveGoldForce() actions
ACTION_FOR_EACH dialog IN ~arkion~ ~ardrou~ ~berrun~ ~brevli~ ~brielb~ ~forthe~ ~gurke~ BEGIN
  ACTION_IF FILE_EXISTS_IN_GAME ~%dialog%.dlg~ BEGIN
    COPY_EXISTING ~%dialog%.dlg~ ~override~
      PATCH_IF SOURCE_SIZE &gt; 0x34 BEGIN
        DECOMPILE_DLG_TO_D
        REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~GivePartyGold~ ~GiveGoldForce~
        COMPILE_D_TO_DLG
      END
    BUT_ONLY
  END
END

//Compress a BAM
COPY ~bambatch/bam~ ~bambatch/bam~
  READ_ASCII 0x0 sg (4) //Signature
  PATCH_IF (~%sg%~ STRING_EQUAL_CASE ~BAM ~ = 1) BEGIN
    dl = SOURCE_SIZE //Data length
    COMPRESS_REPLACE_FILE 0 dl 9
    INSERT_BYTES 0x0 0xc
    WRITE_ASCII 0x0 ~BAMCV1  ~
    WRITE_LONG 0x8 dl
  END ELSE BEGIN
    PATCH_PRINT ~%SOURCE_FILE% is not an uncompressed BAM.~
  END
BUT_ONLY

//Decompress a BAM
COPY ~bambatch/bam~ ~bambatch/bam~
  READ_ASCII 0x0 sg (4) //Signature
  PATCH_IF (~%sg%~ STRING_EQUAL_CASE ~BAMC~ = 1) BEGIN
    READ_LONG 0x8 dl //Uncompressed data length
    DECOMPRESS_REPLACE_FILE 0xc (SOURCE_SIZE - 0xc) dl
  END ELSE BEGIN
    PATCH_PRINT ~%SOURCE_FILE% is not a compressed BAM.~
  END
BUT_ONLY

//Defines an array associating creatures with a new amount of gold
ACTION_DEFINE_ASSOCIATIVE_ARRAY newgold BEGIN
  ~arkion~ =&gt; 100
  ~ardrou~ =&gt; 10
  ~berrun~ =&gt; 58
  ~brevli~ =&gt; 5
  ~brielb~ =&gt; 200
  ~gurke~ =&gt; 20
  ~oublek~ =&gt; 1000
  ~perdue%~ =&gt; 75
  ~pheirk%~ =&gt; 38
  ~scar~ =&gt; 1026
  ~sonner~ =&gt; 150
  ~wenric~ =&gt; 170
  ~jarlaxle~ =&gt; 25
  ~ppsime~ =&gt; 50
  ~yschearl~ =&gt; 150
END

//Writes the new amount of gold for each creature above if it exists
ACTION_PHP_EACH newgold AS crename =&gt; gold BEGIN
  ACTION_IF FILE_EXISTS_IN_GAME ~%crename%.cre~ BEGIN
    COPY_EXISTING ~%crename%.cre~ ~override~
      PATCH_IF SOURCE_SIZE &gt; 0x2d3 BEGIN
        WRITE_LONG 0x1c gold
      END
    BUT_ONLY
  END
END
</PRE><!--TOC section <TT><B>Macros Listing</B></TT>-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc48">11</A>&#XA0;&#XA0;<B><TT>Macros Listing</TT></B><A NAME="Macros Listing"></A><A NAME="@default537"></A></H2><!--SEC END --><P>
These macros are automatically shipped with WeiDU.</P><P><CODE>tb#factorial</CODE>: computes the factorial of a number.<BR>
This is a PATCH macro.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET <CODE>tb#factorial_index</CODE> to the factorial you&#X2019;d like to compute.
</LI><LI CLASS="li-itemize">SET <CODE>tb#factorial_result</CODE> to 1;
</LI><LI CLASS="li-itemize">The result is <CODE>tb#factorial_result</CODE>.
</LI></UL><P><CODE>tb#fix_file_size</CODE>: overwrites all files matching a certain regexp with a
certain standard file, if they are under a certain size.<BR>
This is an ACTION macro.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET <CODE>tb#fix_file_size_min</CODE> to the maximum allowed size
(files whose size is exactly this value are NOT overwritten).
</LI><LI CLASS="li-itemize">SPRINT <CODE>tb#fix_file_size_target</CODE> to the standard file used to replace file(s) that match the regexp.
</LI><LI CLASS="li-itemize">SPRINT <CODE>tb#fix_file_size_category</CODE> to a descriptive name.
</LI><LI CLASS="li-itemize">SPRINT <CODE>tb#fix_file_size_regexp</CODE> to the regexp for the file(s) to be checked for a match.
</LI></UL><P><BR>

The following macros were provided by Gort. Note that, differently from the standalone versions, you <EM>need</EM>
to set all the needed values - they aren&#X2019;t initialized automatically. This is untrue in the FUNCTION version
(they are initialized to either 0 or the empty string, except for probability1 which is initialized to 100).</P><P><CODE>DELETE_SPELL_EFFECT</CODE>: deletes all extended effects with specified opcode from a spell.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET opcode_to_delete to the opcode of the effect you want to delete. Opcode of (-1) will match all effects.
</LI></UL><P><CODE>DELETE_ITEM_EFFECT</CODE>: deletes all extended effects with specified opcode from an item.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET opcode_to_delete to the opcode of the effect you want to delete. Opcode of (-1) will match all effects.
</LI></UL><P><CODE>DELETE_ITEM_EQEFFECT</CODE>: deletes all equipping effects with specified opcode from an item.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET opcode_to_delete to the opcode of the effect you want to delete. Opcode of (-1) will match all effects.
</LI></UL><P><CODE>DELETE_CRE_EFFECT</CODE>: deletes all effects with specified opcode from a creature. (Warning: doesn&#X2019;t check EFF version)
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET opcode_to_delete to the opcode of the effect you want to delete. Opcode of (-1) will match all effects.
</LI></UL><P><CODE>ITEM_EFFECT_TO_SPELL</CODE>: copies all extended effects from the current item to the first extended header of a spell.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET type to the header type to copy the effect from (use 99 to specify &#X2019;all types&#X2019;).
</LI><LI CLASS="li-itemize">SET header to number of extended header the effect should be copied from (use 99 to specify &#X2019;every header&#X2019;).
</LI><LI CLASS="li-itemize">SPRINT &#XA0;new_itm_spl&#XA0; to a spell you want to copy effects to.
</LI></UL><P><CODE>ADD_SPELL_EFFECT</CODE>: adds an extended effect to a spell. All variables except probability1 and insert_point are 0 by default.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET opcode to opcode
</LI><LI CLASS="li-itemize">SET target to target type
</LI><LI CLASS="li-itemize">SET timing to timing type
</LI><LI CLASS="li-itemize">SET parameter1 to first parameter
</LI><LI CLASS="li-itemize">SET parameter2 to second parameter
</LI><LI CLASS="li-itemize">SET power to power
</LI><LI CLASS="li-itemize">SET resist_dispel to magic resistance/dispel type
</LI><LI CLASS="li-itemize">SET duration to duration
</LI><LI CLASS="li-itemize">SET probability1 to probability1 (default 100)
</LI><LI CLASS="li-itemize">SET probability2 to probability2
</LI><LI CLASS="li-itemize">SPRINT resource to resource (8 chars max)
</LI><LI CLASS="li-itemize">SET dicenumber to number of dices to be thrown
</LI><LI CLASS="li-itemize">SET dicesize to size of dices to be thrown
</LI><LI CLASS="li-itemize">SET savingthrow to type of savingthrow to be allowed against the effect
</LI><LI CLASS="li-itemize">SET savebonus to saving throw bonus
</LI><LI CLASS="li-itemize">SET header to number of extended header (starting from 1) the effect should be added to (by default the effect is added to every header).
</LI><LI CLASS="li-itemize">SET insert_point to the position of the effect. If this variable is 0 the effect will be inserted as the first effect of the extended header. If this variable is negative or greater than the number of effects, the effect will be inserted as the last effect. The effect is added as the last effect by default.
</LI></UL><P><CODE>ADD_ITEM_EFFECT</CODE>: adds an extended effect to an item.
This is a PATCH macro and function.
</P><DL CLASS="list"><DT CLASS="dt-list">

</DT><DD CLASS="dd-list">Syntax is the same as of ADD_SPELL_EFFECT
</DD><DT CLASS="dt-list"></DT><DD CLASS="dd-list">Additionally: SET type to the type of header to which the effect should be added or 99 for all types. Defaults to 3 (magic).
</DD></DL><P><CODE>ADD_ITEM_EQEFFECT</CODE>: adds an equipping effect to an item.
This is a PATCH macro and function.
</P><DL CLASS="list"><DT CLASS="dt-list">

</DT><DD CLASS="dd-list">Syntax is the same as of ADD_SPELL_EFFECT
</DD></DL><P><CODE>ADD_CRE_EFFECT</CODE>: adds an effect to a creature. All variables except probability1 are 0 by default.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET opcode to opcode
</LI><LI CLASS="li-itemize">SET timing to timing type
</LI><LI CLASS="li-itemize">SET target to target type
</LI><LI CLASS="li-itemize">SET parameter1 to first parameter
</LI><LI CLASS="li-itemize">SET parameter2 to second parameter
</LI><LI CLASS="li-itemize">SET parameter3 to third parameter
</LI><LI CLASS="li-itemize">SET parameter4 to forth parameter
</LI><LI CLASS="li-itemize">SET power to power
</LI><LI CLASS="li-itemize">SET resist_dispel to magic resistance/dispel type
</LI><LI CLASS="li-itemize">SET duration to duration
</LI><LI CLASS="li-itemize">SET probability1 to probability1 (default 100)
</LI><LI CLASS="li-itemize">SET probability2 to probability2
</LI><LI CLASS="li-itemize">SPRINT resource to resource (8 chars max)
</LI><LI CLASS="li-itemize">SPRINT resource2 to second resource (8 chars max)
</LI><LI CLASS="li-itemize">SPRINT vvcresource to VVC resource (8 chars max)
</LI><LI CLASS="li-itemize">SPRINT effsource to effect source
</LI><LI CLASS="li-itemize">SPRINT effvar to effect variable
</LI><LI CLASS="li-itemize">SET dicenumber to number of dices to be thrown
</LI><LI CLASS="li-itemize">SET dicesize to size of dices to be thrown
</LI><LI CLASS="li-itemize">SET savingthrow to type of savingthrow to be allowed against the effect
</LI><LI CLASS="li-itemize">SET savebonus to saving throw bonus
</LI><LI CLASS="li-itemize">SET school to magical school
</LI><LI CLASS="li-itemize">SET lowestafflvl to lowest affected level
</LI><LI CLASS="li-itemize">SET highestafflvl to highest affected level
</LI><LI CLASS="li-itemize">SET casterx to caster X position
</LI><LI CLASS="li-itemize">SET castery to caster Y position
</LI><LI CLASS="li-itemize">SET targetx to target X position
</LI><LI CLASS="li-itemize">SET targety to target Y position
</LI><LI CLASS="li-itemize">SET restype to source resource type
</LI><LI CLASS="li-itemize">SET sourceslot to source resource slot
</LI><LI CLASS="li-itemize">SET casterlvl to caster level
</LI><LI CLASS="li-itemize">SET sectype to secondary type
</LI></UL><P><CODE>DELETE_CRE_ITEM</CODE>: deletes all matching items from a creature. Regexp allowed.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT item_to_delete to the item you want to delete.
</LI></UL><P><CODE>DELETE_STORE_ITEM</CODE>: deletes all matching items from a store. Regexp allowed.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT item_to_delete to the item you want to delete.
</LI></UL><P><CODE>DELETE_AREA_ITEM</CODE>: deletes all matching items from an area. Regexp allowed.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT item_to_delete to the item you want to delete.
</LI></UL><P><CODE>REPLACE_STORE_ITEM</CODE>: replaces all matching items in a store with another item. Regexp allowed.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT old_item to the item you want to be replaced
</LI><LI CLASS="li-itemize">SPRINT new_item to the new item
</LI><LI CLASS="li-itemize">SET number_in_stock to number of new items in stock (default 0)
</LI><LI CLASS="li-itemize">SPRINT flags to flags new item should have (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc). Default - no flags.
</LI><LI CLASS="li-itemize">SET charges1 to number of charges of first magical ability (default 0)
</LI><LI CLASS="li-itemize">SET charges2 to number of charges of second magical ability (default 0)
</LI><LI CLASS="li-itemize">SET charges3 to number of charges of third magical ability (default 0)
</LI></UL><P><CODE>REPLACE_AREA_ITEM</CODE>: replaces all matching items in an area with another item. Regexp allowed.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT old_item to the item you want to be replaced
</LI><LI CLASS="li-itemize">SPRINT new_item to the new item
</LI><LI CLASS="li-itemize">SPRINT flags to flags the new item should have (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc). Default - no flags.
</LI><LI CLASS="li-itemize">SET charges1 to amount in stock/number of charges of first magical ability (default 0)
</LI><LI CLASS="li-itemize">SET charges2 to number of charges of second magical ability (default 0)
</LI><LI CLASS="li-itemize">SET charges3 to number of charges of third magical ability (default 0)
</LI></UL><P><CODE>ADD_AREA_ITEM</CODE>: adds an item to a container of an area.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET item_to_add to the item you want to add 
</LI><LI CLASS="li-itemize">SET container_to_add_to to number of container the item should be added to.
</LI><LI CLASS="li-itemize">SPRINT flags to flags the item should have (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc). Default - no flags.
</LI><LI CLASS="li-itemize">SET charges1 to amount in stock/number of charges of first magical ability (default 0)
</LI><LI CLASS="li-itemize">SET charges2 to number of charges of second magical ability (default 0)
</LI><LI CLASS="li-itemize">SET charges3 to number of charges of third magical ability (default 0)
</LI></UL><P><CODE>ADD_CRE_ITEM_FLAGS</CODE>: adds flags to all matching items possessed by a creature. Regexp allowed.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT item_to_change to the item the flags should be added to
</LI><LI CLASS="li-itemize">SPRINT flags to flags you need to add (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc).
</LI></UL><P><CODE>REMOVE_CRE_ITEM_FLAGS</CODE>: removes flags from all matching items possessed by a creature. Regexp allowed.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT item_to_change to the item the flags should be removed from
</LI><LI CLASS="li-itemize">SPRINT flags to flags you need to remove (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc).
</LI></UL><P><CODE>SET_CRE_ITEM_FLAGS</CODE>: set flags to all matching items possessed by a creature. Regexp allowed.
This is a PATCH macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT item_to_change to the item which flags should be set
</LI><LI CLASS="li-itemize">SPRINT flags to flags you need to set (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc).
</LI></UL><P><CODE>READ_SOUNDSET</CODE>: reads soundset of a creature and stores it as an array of string references This is an ACTION macro.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT npc to the target creature (with .cre extension)
</LI><LI CLASS="li-itemize">SPRINT soundset to the name of soundset you want.
</LI></UL><P><CODE>WRITE_SOUNDSET</CODE>: writes soundset to all matching creatures. Regexp allowed.
This is an ACTION macro.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT npc to a creature in question (with .cre extension)
</LI><LI CLASS="li-itemize">SPRINT soundset to name of soundset you have.
</LI><LI CLASS="li-itemize">SET overwrite to 2 if you want new soundset to overwrite the old one completely. Set it to 1 if you want to overwrite old string references only with non-empty new references (may keep some old). Set it to 0 it you want to overwrite only empty old references with new ones.
</LI></UL><P><CODE>FJ_CRE_VALIDITY</CODE>: Checks whether a CRE file is well-formed or not, fixes some common bugs, and reports whether the CRE file is still broken or not. In particular:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
reports invalidity if it is charbase.cre, shorter than the minimum size, the signature mismatches, or a sub-structure has members and its offset is in the header.
</LI><LI CLASS="li-itemize">if a empty sub-structure&#X2019;s offset is in the header, point them to the end of the header.
</LI><LI CLASS="li-itemize">if the cre is valid, force it to use proper order (known spells, spell memorization info, memorized spells, effects, items, item slot).
</LI><LI CLASS="li-itemize">forces the CRE file to use EFF V2 effects internally (or EFF V1 if on BG1).
</LI></UL><P>
This is a PATCH function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
INT_VAR do_message to 1 if you want explicit an explicit message regarding the cre invalidity. Defaults to 0.
</LI><LI CLASS="li-itemize">INT_VAR do_reindex to 0 if you don&#X2019;t want the creature file to be reindexed. Defaults to 1.
</LI><LI CLASS="li-itemize">INT_VAR do_eff to 0 if you don&#X2019;t want EFFv1 &lt;-&gt; EFFv2 conversion to be applied. Defaults to 1.
</LI><LI CLASS="li-itemize">RET valid returns 1 if the CRE is well-formed, 0 otherwise.
</LI></UL><P><CODE>FJ_CRE_REINDEX</CODE>: reorders creatures with nonstandard offset orders. Called by FJ_CRE_VALIDITY automatically if relevant.<BR><BR>
This is a PATCH function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
INT_VAR do_reindex to 0 if you don&#X2019;t want the creature file to be reindexed. Defaults to 1.
</LI><LI CLASS="li-itemize">INT_VAR do_eff to 0 if you don&#X2019;t want EFFv1 &lt;-&gt; EFFv2 conversion to be applied. Defaults to 1.
</LI></UL><P><CODE>FJ_CRE_EFF_V2</CODE>: Converts creatures using version 1 effects to version 2. Called by FJ_CRE_VALIDITY or FJ_CRE_REINDEX automatically if relevant.<BR>
This is a PATCH function.</P><P><CODE>T-CRE_EFF_V1</CODE>: Converts creatures using version 2 effects to version 1. Called by FJ_CRE_VALIDITY or FJ_CRE_REINDEX automatically if relevant.<BR>
This is a PATCH function.</P><P><CODE>ADD_AREA_REGION_TRIGGER</CODE>: adds an area region to the current are file.
This is a PATCH macro and function. Unlike other macros you do not need to set every variable. You are only required to set those values that you need to write. 
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT ab_RT_Name -- Name to assign to new region
</LI><LI CLASS="li-itemize">SET ab_RT_Type -- Type of trigger -- 0=proximity;1=info;2=travel 
</LI><LI CLASS="li-itemize">SET ab_RT_BbLX -- Bounding Box - low x value - LEFT
</LI><LI CLASS="li-itemize">SET ab_RT_BbLY -- Bounding Box - low y value - TOP
</LI><LI CLASS="li-itemize">SET ab_RT_BbHX -- Bounding Box - High x value - RIGHT
</LI><LI CLASS="li-itemize">SET ab_RT_BbHY -- Bounding Box - High y value - BOTTOM
</LI><LI CLASS="li-itemize">SET ab_RT_VxPr -- Number of Vertex Pairs for current region
</LI><LI CLASS="li-itemize">SET ab_RT_CuId -- Cursor Index - points to a graphic in cursors.bam
</LI><LI CLASS="li-itemize">SPRINT ab_RT_Dest -- Destination Area
</LI><LI CLASS="li-itemize">SPRINT ab_RT_EntN -- Entrance Name
</LI><LI CLASS="li-itemize">SET ab_RT_Fbit -- Flag bits set in bit format which are read right to left - 0=off; 1=on
</LI><LI CLASS="li-itemize">SET ab_RT_Itxt -- Info text
</LI><LI CLASS="li-itemize">SET ab_RT_TDtD -- Trap Detection Difficulty
</LI><LI CLASS="li-itemize">SET ab_RT_TRmD -- Trap Removal Difficulty
</LI><LI CLASS="li-itemize">SET ab_RT_TSet -- Trap is set - 0=no; 1=yes
</LI><LI CLASS="li-itemize">SET ab_RT_TDet -- Trap is detected - 0=no; 1=yes
</LI><LI CLASS="li-itemize">SET ab_RT_LPoX -- Launch Point X
</LI><LI CLASS="li-itemize">SET ab_RT_LPoY -- Launch Point Y
</LI><LI CLASS="li-itemize">SPRINT ab_RT_KeyI -- Key Item
</LI><LI CLASS="li-itemize">SET ab_RT_Rbcs -- Region Script file
</LI><LI CLASS="li-itemize">SET ab_RT_ALPX -- Alternate Launch Point X
</LI><LI CLASS="li-itemize">SET ab_RT_ALPY -- Alternate Launch Point Y
</LI><LI CLASS="li-itemize">SET ab_RT_Dial -- Dialog file (used only in PST)
</LI></UL><P><BR>
The vertex points are separated by their XY values
You may have as many pairs as you need. Just copy this set and increment the #.
Example: For the X values: ab_RT_Vx_X_0, ab_RT_Vx_X_1, ab_RT_Vx_X_2
For the Y values: ab_RT_Vx_Y_0, ab_RT_Vx_Y_1, ab_RT_Vx_Y_2
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET ab_RT_Vx_X_0 -- Point #0 X value
</LI><LI CLASS="li-itemize">SET ab_RT_Vx_Y_0 -- Point #0 Y value
</LI></UL><P><BR>
NOTE: The original code released in WeiDU v211 has been overhauled and re-released in v212. Therefore, the user defined variable names have been changed. If you used the 211 version you will need to update your mod to use the variables in this version. Sorry for the inconvenience...</P><P><BR>
<CODE>RES_NUM_OF_SPELL_NAME</CODE>: converts a spell.ids reference to resource name.
This is an ACTION macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT spell_name to the IDS symbolic reference of a spell.
</LI><LI CLASS="li-itemize">RETURNS spell_num to the IDS numerical reference of that spell.
</LI><LI CLASS="li-itemize">RETURNS spell_res to the resource name for the referenced spell.
</LI></UL><P><BR>

<CODE>RES_NAME_OF_SPELL_NUM</CODE>: converts a spell.ids reference to resource name.
This is an ACTION macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SET spell_num to the IDS numerical reference of that spell.
</LI><LI CLASS="li-itemize">RETURNS spell_name to the IDS symbolic reference of a spell.
</LI><LI CLASS="li-itemize">RETURNS spell_res to the resource name for the referenced spell.
</LI></UL><P><BR>

<CODE>NAME_NUM_OF_SPELL_RES</CODE>: converts a spell resource name to a spell.ids reference.
This is an ACTION macro and function.
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
SPRINT spell_res to the resource name for the referenced spell.
</LI><LI CLASS="li-itemize">RETURNS spell_num to the IDS numerical reference of that spell.
</LI><LI CLASS="li-itemize">RETURNS spell_name to the IDS symbolic reference of a spell.
</LI></UL><P><BR>

<CODE>GET_UNIQUE_FILE_NAME</CODE>: Creates a file name that is currently unallocated.
This is a PATCH and ACTION function.
This function will create a filename using __ as a prefix. __ is reserved by
The Bigg and writeable by anybody, as long as you dynamically create the file
name (either by using this function or other code of your devising). The algorithm
creates file names in base 36, going from __0000.ext to __zzzz.ext; this allows for
36 ^ 4 = 1679616 unique file names.</P><P>To allow users to reinstall your mod without breaking the identity of these files, you
can use the &#X2019;base&#X2019; parameter to ensure that the same thing will be mapped to the same
file on reinstalls. For instance, if you&#X2019;re iterating through Mages to give each of
them a spellbook, base should contain your modder prefix, an identifier for the purpose
of the call, and the file name you&#X2019;re working on, for instance:
<CODE>~tb#spellbooks_%SOURCE_RES%~</CODE>
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR extension to the desired extension (required).
</LI><LI CLASS="li-itemize">STR_VAR base to a string unique to your mod and current file (optional).
</LI><LI CLASS="li-itemize">RET filename the currently unallocated file name (sans the extension).
</LI></UL><P><BR>

</P><!--TOC subsection <TT><B>fj_are_structure</B></TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc49">11.1</A>&#XA0;&#XA0;<B><TT>fj_are_structure</TT></B><A NAME="fj_are_structure"></A><A NAME="@default538"></A></H3><!--SEC END --><P>
Adds a structure to an area file. All variables are zero or blank by default unless otherwise indicated. Fields designated by an asterisk are typically required; all others are optional.
This is a PATCH function.</P><P>Universal structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_structure_type</CODE> to the type of area structure to be added (actor, region, spawn, entrance, container, itm, ambient, variable, door, animation, explored bitmask, songlist, rest interrupt table, note or projectile)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_delete_mode</CODE> to the index of the structure to be deleted (if deleting rather than adding a new structure);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_delete</CODE> to 1 to enable feedback
</LI><LI CLASS="li-itemize">RET <CODE>fj_return_offset</CODE> returns the position of the structure in the area file;
</LI></UL><P>
Actor structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the actor&#X2019;s name*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_x</CODE> to the starting X (horizontal) coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_y</CODE> to the starting Y (vertical) coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_dest_x</CODE> to the destination X coordinate (normally the same as fj_loc_x)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_dest_y</CODE> to the destination Y coordinate (normally the same as fj_loc_y)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loading</CODE> to whether the .cre file is loaded (0=attached, 1=loaded, default 1);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_spawned</CODE> to whether the creature has been spawned (0=no, 1=yes);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_animation</CODE> to the actor&#X2019;s animation number (from animate.ids, though the engine uses the animation set on the .cre file);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_orientation</CODE> to the facing direction (0-15 where 0=south, 4=west, 8=north, 12=east)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_expiry</CODE> to the actor removal timer in absolute ticks (default -1 to avoid removal);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_wander_dist_actor</CODE> to the actor&#X2019;s random walk distance limit;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_mvmt_dist_actor</CODE> to the actor&#X2019;s movement distance limit;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_schedule</CODE> to the hourly appearance schedule (bits 0-23, default -1 or always);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_num_talked</CODE> to the NumTimesTalkedTo (in .sav files);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_dlg_resref</CODE> to the actor&#X2019;s dialogue file (normally obtained from .cre files);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_bcs_override</CODE> to the actor&#X2019;s override script (normally obtained from .cre files);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_bcs_general</CODE> to the actor&#X2019;s general script (normally obtained from .cre files);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_bcs_class</CODE> to the actor&#X2019;s class script (normally obtained from .cre files);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_bcs_race</CODE> to the actor&#X2019;s race script (normally obtained from .cre files);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_bcs_default</CODE> to the actor&#X2019;s default script (normally obtained from .cre files);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_bcs_specific</CODE> to the actor&#X2019;s specific script (normally obtained from .cre files);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_cre_resref</CODE> to the actor&#X2019;s resource reference (creature filename)*;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_cre_embedded</CODE> to &#XA0;path/to/file.cre&#XA0; if embedding a new creature (defaults to fj_cre_resref if not set);
</LI></UL><P>
Region structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the region&#X2019;s name*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_type</CODE> to the region type (0=trap, 1=info, 2=travel)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_box_left</CODE> to the leftmost X coordinate of the region&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_box_top</CODE> to the topmost Y coordinate of the region&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_box_right</CODE> to the rightmost X coordinate of the region&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_box_bottom</CODE> to the bottommost Y coordinate of the region&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_cursor_idx</CODE> to the region&#X2019;s mouse cursor index (from cursors.bam)*;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_destination_area</CODE> to the destination area resource reference (for travel regions);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_destination_name</CODE> to the entrance name in the destination area (for travel regions);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_flags</CODE> to the bitwise region flags;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_info_point_strref</CODE> to the information text string reference (for info points, default -1);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_detect</CODE> to the trap detection difficulty percentage;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_remove</CODE> to the trap removal difficulty percentage;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_active</CODE> to whether the region is trapped (0=no, 1=yes);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_status</CODE> to whether the trap is detected (0=no, 1=yes);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_x</CODE> to the trap launch X coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_y</CODE> to the trap launch Y coordinate*;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_key_resref</CODE> to the filename of the region&#X2019;s key;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_reg_script</CODE> to the region script;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_alt_x</CODE> to the activation point X coordinate;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_alt_y</CODE> to the activation point Y coordinate;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_vertex_0</CODE> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each vertex pair*;
</LI></UL><P>
Spawn structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the spawn point&#X2019;s name*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_x</CODE> to the spawning X coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_y</CODE> to the spawning Y coordinate*;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_cre_resref0</CODE> to the resource reference of each creature spawned (0-9)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_spawn_num</CODE> to the count of spawn creatures*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_base_num</CODE> to the base number of creatures to spawn (encounter difficulty)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_delay</CODE> to the number of seconds between spawning (default 10);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_method</CODE> to the spawn method;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_duration</CODE> to the creature duration (default 1000);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_wander_dist_spawn</CODE> to the creature&#X2019;s random walk distance limit (default 1000);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_mvmt_dist_spawn</CODE> to the creature&#X2019;s movement distance limit (default 1000);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_max_num</CODE> to the maximum number of creatures to spawn*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_enable</CODE> to the spawn point status (0=inactive, 1=active, default 1);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_schedule</CODE> to the hourly appearance schedule (bits 0-23, default -1 or always);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_day_prob</CODE> to the spawn point daytime probability (default 100);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_night_prob</CODE> to the spawn point nighttime probability (default 100);
</LI></UL><P>
Entrance structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the entrance&#X2019;s name*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_x</CODE> to the X coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_y</CODE> to the Y coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_orientation</CODE> to the facing direction (0-15 where 0=south, 4=west, 8=north, 12=east)*;
</LI></UL><P>
Container structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the container&#X2019;s name*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_x</CODE> to the X coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_y</CODE> to the Y coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_type</CODE> to the container type (1=bag, 2=chest, 3=drawer, 4=pile, 5=table, 6=shelf, 7=altar, 8=nonvisible, 9=spellbook, 10=body, 11=barrel, 12=crate)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_lock_diff</CODE> to the lock difficulty (default 100);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_flags</CODE> to the bitwise container flags (bit0=locked, bit3=trap resets, bit5=disabled);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_detect</CODE> to the trap detection difficulty percentage;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_remove_diff</CODE> to the trap removal difficulty percentage (default 100);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_active</CODE> to whether the container is trapped (0=no, 1=yes);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_status</CODE> to whether the trap is detected (0=no, 1=yes);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_loc_x</CODE> to the trap launch X coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_loc_y</CODE> to the trap launch Y coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_box_left</CODE> to the leftmost X coordinate of the trap&#X2019;s bounding box;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_box_top</CODE> to the topmost Y coordinate of the trap&#X2019;s bounding box;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_box_right</CODE> to the rightmost X coordinate of the trap&#X2019;s bounding box;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_box_bottom</CODE> to the bottommost Y coordinate of the trap&#X2019;s bounding box;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_trap_script</CODE> to the trap&#X2019;s script;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_vertex_0</CODE> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each vertex pair*;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_key_resref</CODE> to the filename of the container&#X2019;s key;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_lockpick_strref</CODE> to the lockpick string reference (default -1);
</LI></UL><P>
Item structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the item&#X2019;s resource reference (filename)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_con_itm_idx</CODE> to the index of the container to which the item is added;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_itm_expiry</CODE> to the item expiration time;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_charge0</CODE> to the charges of the 1st ability (item quantity for stackables);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_charge1</CODE> to the charges of the 2nd ability;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_charge1</CODE> to the charges of the 3rd ability;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_flags</CODE> to the bitwise item flags (bit0=identified, bit1=unstealable, bit2=stolen, bit3=undroppable);
</LI></UL><P>
Ambient structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the ambient&#X2019;s name*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_x</CODE> to the X coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_y</CODE> to the Y coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_radius</CODE> to the sound radius (default 500);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_z</CODE> to the Z coordinate (height);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_volume</CODE> to the volume percentage (default 80);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_wav_resref0</CODE> to the resource reference of each sound (0-9)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_sound_num</CODE> to the number of sounds*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_delay</CODE> to the base interval in seconds between sounds from this ambient list;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_variation</CODE> to the base deviation from the base interval;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_schedule</CODE> to the hourly appearance schedule (bits 0-23, default -1 or always);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_flags</CODE> to the bitwise ambient flags*;
</LI></UL><P>
Variable structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the variable&#X2019;s name*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_variable_value</CODE> to the variable&#X2019;s value*;
</LI></UL><P>
Door structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the door&#X2019;s name*;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_door_wed_id</CODE> to the door ID linked to the .wed file*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_flags</CODE> to the bitwise door flags*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_open_box_left</CODE> to the leftmost X coordinate of the open door&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_open_box_top</CODE> to the topmost Y coordinate of the open door&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_open_box_right</CODE> to the rightmost X coordinate of the open door&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_open_box_bottom</CODE> to the bottommost Y coordinate of the open door&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_closed_box_left</CODE> to the leftmost X coordinate of the closed door&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_closed_box_top</CODE> to the topmost Y coordinate of the closed door&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_closed_box_right</CODE> to the rightmost X coordinate of the closed door&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_closed_box_bottom</CODE> to the bottommost Y coordinate of the closed door&#X2019;s bounding box*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_door_open_vert_0</CODE> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each vertex pair of the open door*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_door_closed_vert_0</CODE> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each vertex pair of the closed door*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_cell_open_vert_0</CODE> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each impeded search map cell of the open door*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_cell_closed_vert_0</CODE> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each impeded search map cell of the closed door*;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_door_open_wav</CODE> to the door open sound;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_door_close_wav</CODE> to the door closed sound;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_cursor_idx</CODE> to the door&#X2019;s mouse cursor index (from cursors.bam)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_detect</CODE> to the trap detection difficulty percentage;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_remove</CODE> to the trap removal difficulty percentage;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_active</CODE> to whether the door is trapped (0=no, 1=yes);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_status</CODE> to whether the trap is detected (0=no, 1=yes);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_loc_x</CODE> to the trap launch X coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_trap_loc_y</CODE> to the trap launch Y coordinate*;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_key_resref</CODE> to the filename of the door&#X2019;s key;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_door_script</CODE> to the door script;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_detect_diff</CODE> to the detection difficulty (for secret doors);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_locked_diff</CODE> to the lock difficulty;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_open_loc_x</CODE> to the X coordinate for toggling the door&#X2019;s open state*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_open_loc_y</CODE> to the Y coordinate for toggling the door&#X2019;s open state*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_closed_loc_x</CODE> to the X coordinate for toggling the door&#X2019;s closed state*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_closed_loc_y</CODE> to the Y coordinate for toggling the door&#X2019;s closed state*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_lockpick_strref</CODE> to the lockpick string reference (default -1);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_travel_trigger</CODE> to the travel region name*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_dlg_strref</CODE> to the dialogue string reference (default -1);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_dlg_resref</CODE> to the door&#X2019;s dialogue file;
</LI></UL><P>
Animation structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the animation name*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_x</CODE> to the X coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_y</CODE> to the Y coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_schedule</CODE> to the hourly appearance schedule (bits 0-23, default -1 or always);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_bam_resref</CODE> to the animation resource reference (filename)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_bam_seq</CODE> to the BAM sequence number;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_bam_frame</CODE> to the BAM frame number;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_flags</CODE> to the bitwise animation flags*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_z</CODE> to the height;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_transparent</CODE> to the BAM transparency;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_init_frame</CODE> to the starting frame;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loop_chance</CODE> to the chance of looping;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_skip_cycles</CODE> to start delay in frames;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_bmp_resref</CODE> to the palette bitmap;
</LI></UL><P>
Bitmask structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_bitmask</CODE> to &#XA0;path/to/binary.file&#XA0;*;
</LI></UL><P>
Songlist structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
INT_VAR <CODE>fj_song_day</CODE> to the day SONGLIST.2DA entry;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_song_night</CODE> to the night SONGLIST.2DA entry;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_song_victory</CODE> to the victory SONGLIST.2DA entry;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_song_battle</CODE> to the battle SONGLIST.2DA entry;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_song_defeat</CODE> to the defeat SONGLIST.2DA entry;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_song_day0</CODE> to the day song WAV resref;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_song_day1</CODE> to the night song WAV resref;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_song_day_vol</CODE> to the day songs volume (default 100);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_song_night0</CODE> to the night song WAV resref;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_song_night1</CODE> to the second night song WAV resref;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_song_night_vol</CODE> to the night songs volume (default 100);
</LI></UL><P>
Rest interrupt structure variables
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the name of the rest interrupts (for editor use only);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_cre_strref0...fj_cre_strref9</CODE> to string displayed upon party ambush (default -1);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_cre_resref0...fj_cre_resref9</CODE> to creature resref;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_spawn_num</CODE> to the number of spawned attackers;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_difficulty</CODE> to the difficulty of the encounter;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_duration</CODE> to the creature&#X2019;s duration (default 1000);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_wander_distance</CODE> to the creature&#X2019;s random walk distance limit (default 1000);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_mvmt_distance</CODE> to the creature&#X2019;s movement distance limit (default 1000);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_max_num</CODE> to maximum number of spawned creatures;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_enable</CODE> to whether rest interrupts are enabled (0=no, 1=yes);
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_day_prob</CODE> to probability of daytime ambush;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_night_prob</CODE> to probability of nightime ambush;
</LI></UL><P>
Map note structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
INT_VAR <CODE>fj_loc_x</CODE> to the X coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_y</CODE> to the Y coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_note_strref</CODE> to the note string reference (default -1, BGII only)*;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_note_text</CODE> to the note text (PST only)*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_strref_loc</CODE> to the strref location (0=external, 1=dialog.tlk, default 1);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_color</CODE> to the map marker color (0-7);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_note_id</CODE> to the note ID;
</LI></UL><P>
Projectile trap structure variables:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
STR_VAR <CODE>fj_name</CODE> to the projectile filename*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_eff_off</CODE> to the effect block offset;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_eff_size</CODE> to the effect block size;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_missile_num</CODE> to the missile.ids reference (projectl.ids - 1);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_frequency to the explosion length (in frames);
\item INT_VAR \verb</CODE>fj_duration+ to the number of explosions;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_x</CODE> to the X coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_y</CODE> to the Y coordinate*;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_loc_z</CODE> to the height;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>fj_target</CODE> to the target ID;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>fj_embedded_eff0</CODE> to &#XA0;path/to/v2.eff&#XA0; or eff resref containing to projectile&#X2019;s effects*;
</LI></UL><P>
A few examples best illustrate the use of this function.</P><P>Example 1: add an actor to an area
</P><PRE CLASS="verbatim">COPY_EXISTING ar0500.are override
  LPF fj_are_structure
    INT_VAR
    fj_loc_x          = 2780
    fj_loc_y          = 1955
    fj_dest_x         = 2780
    fj_dest_y         = 1955
    fj_animation      = 0x6110 //fighter female human
    fj_orientation    = 15     //SSE
    STR_VAR
    fj_structure_type = actor
    fj_name           = Aurora
    fj_cre_resref     = agaurora
  END
</PRE><P>Example 2: add a region to an area (in this case, a travel trigger to another area)
</P><PRE CLASS="verbatim">  LPF fj_are_structure
    INT_VAR
    fj_type         = 2    //travel
    fj_box_left     = 3415
    fj_box_top      = 625
    fj_box_right    = 3450
    fj_box_bottom   = 700
    fj_cursor_idx   = 30   //door
    fj_vertex_0     = 3415 + (625 &lt;&lt; 16)
    fj_vertex_1     = 3450 + (650 &lt;&lt; 16)
    fj_vertex_2     = 3450 + (700 &lt;&lt; 16)
    fj_vertex_3     = 3415 + (676 &lt;&lt; 16)
    STR_VAR
    fj_structure_type   = region
    fj_name             = Tran0540
    fj_destination_area = ag0540
    fj_destination_name = Exit0500
  END
</PRE><P>Example 3: add an entrance (from another area) to an area
</P><PRE CLASS="verbatim">  LPF fj_are_structure
    INT_VAR
    fj_loc_x       = 3490
    fj_loc_y       = 655
    fj_orientation = 10   //NE
    STR_VAR
    fj_structure_type = entrance
    fj_name           = Exit0540
  END
</PRE><P>Example 4: add a container to an area, then add an item to the new container
</P><PRE CLASS="verbatim">  LPF fj_are_structure
    INT_VAR
    fj_type        = 8 //nonvisible
    fj_loc_x       = 4388
    fj_loc_y       = 2876
    fj_box_left    = 4372
    fj_box_top     = 2826
    fj_box_right   = 4420
    fj_box_bottom  = 2858
    fj_trap_loc_x  = 4380
    fj_trap_loc_y  = 2870
    fj_vertex_0    = 4411 + (2858 &lt;&lt; 16)
    fj_vertex_1    = 4372 + (2845 &lt;&lt; 16)
    fj_vertex_2    = 4382 + (2826 &lt;&lt; 16)
    fj_vertex_3    = 4420 + (2839 &lt;&lt; 16)
    STR_VAR
    fj_structure_type = container
    fj_name           = ~Cornerstone~
  END
  LPF fj_are_structure
    INT_VAR
    fj_con_itm_idx    = SHORT_AT 0x74 - 1 // a new container will be last in the file
    fj_flags          = 1 // identified
    STR_VAR
    fj_name           = c6lantho
    fj_structure_type = itm
  END
</PRE><P>Example 5: add a door to an area
</P><PRE CLASS="verbatim">  LPF fj_are_structure
    INT_VAR
    fj_flags               = 0b100000000
    fj_open_box_left       = 520
    fj_open_box_top        = 724
    fj_open_box_right      = 545
    fj_open_box_bottom     = 830
    fj_closed_box_left     = 507
    fj_closed_box_top      = 761
    fj_closed_box_right    = 562
    fj_closed_box_bottom   = 869
    fj_cursor_idx          = 30
    fj_trap_loc_x          = 500
    fj_trap_loc_y          = 852
    fj_open_loc_x          = 517
    fj_open_loc_y          = 881
    fj_closed_loc_x        = 562
    fj_closed_loc_y        = 814
    fj_door_open_vert_0    = 520 + (826 &lt;&lt; 16)
    fj_door_open_vert_1    = 527 + (830 &lt;&lt; 16)
    fj_door_open_vert_2    = 545 + (798 &lt;&lt; 16)
    fj_door_open_vert_3    = 545 + (727 &lt;&lt; 16)
    fj_door_open_vert_4    = 539 + (724 &lt;&lt; 16)
    fj_door_open_vert_5    = 520 + (750 &lt;&lt; 16)
    fj_door_closed_vert_0  = 507 + (831 &lt;&lt; 16)
    fj_door_closed_vert_1  = 562 + (869 &lt;&lt; 16)
    fj_door_closed_vert_2  = 562 + (799 &lt;&lt; 16)
    fj_door_closed_vert_3  = 507 + (761 &lt;&lt; 16)
    fj_cell_open_vert_0    = 32 + (68 &lt;&lt; 16)
    fj_cell_open_vert_1    = 33 + (67 &lt;&lt; 16)
    fj_cell_open_vert_2    = 32 + (67 &lt;&lt; 16)
    fj_cell_closed_vert_0  = 32 + (70 &lt;&lt; 16)
    fj_cell_closed_vert_1  = 33 + (71 &lt;&lt; 16)
    fj_cell_closed_vert_2  = 34 + (72 &lt;&lt; 16)
    fj_cell_closed_vert_3  = 34 + (71 &lt;&lt; 16)
    fj_cell_closed_vert_4  = 33 + (70 &lt;&lt; 16)
    fj_cell_closed_vert_5  = 32 + (69 &lt;&lt; 16)
    fj_cell_closed_vert_6  = 32 + (68 &lt;&lt; 16)
    fj_cell_closed_vert_7  = 33 + (69 &lt;&lt; 16)
    fj_cell_closed_vert_8  = 34 + (70 &lt;&lt; 16)
    STR_VAR
    fj_structure_type      = door
    fj_name                = Door10
    fj_door_wed_id         = DOOR10
  END
</PRE><P>Example 6: add an animation to an area
</P><PRE CLASS="verbatim">  LPF fj_are_structure
    INT_VAR
    fj_loc_x       = 2785
    fj_loc_y       = 949
    fj_flags       = 0b00000000000000000001000110000101
    //visible, not illuminated, invisible in dark, covered by actors, shown in combat
    STR_VAR
    fj_structure_type = animation
    fj_name           = Cave1
    fj_bam_resref     = ag1100c1
  END
</PRE><P>Example 7: delete all ambients from an area
</P><PRE CLASS="verbatim">  FOR( i = SHORT_AT 0x82 ; i ; --i )BEGIN
    LPF fj_are_structure
      INT_VAR fj_delete_mode = i - 1
      STR_VAR fj_structure_type = ambient
    END
  END
</PRE><!--TOC subsection <TT><B>sc#addWmpAre</B></TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc50">11.2</A>&#XA0;&#XA0;<B><TT>sc#addWmpAre</TT></B><A NAME="sc#addWmpAre"></A><A NAME="@default539"></A></H3><!--SEC END --><P>
Adds an area to the worldmap. All variables are zero or blank by default unless otherwise indicated.
This is an ACTION function.</P><UL CLASS="itemize"><LI CLASS="li-itemize">
ACTION_DEFINE_ASSOCIATIVE_ARRAY <CODE>toNewArea</CODE> to the area references that lead to the new area;
</LI><LI CLASS="li-itemize">ACTION_DEFINE_ASSOCIATIVE_ARRAY <CODE>fromNewArea</CODE> to the area references that lead away from the new area;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>areName</CODE> to the resource reference of the area to add (like "ar0700");
</LI><LI CLASS="li-itemize">STR_VAR <CODE>strName</CODE> to the descriptive name of the area (like "Waukeen&#X2019;s Promenade");
</LI><LI CLASS="li-itemize">STR_VAR <CODE>strDesc</CODE> to the area description that will show up when hovering the cursor over the area on the worldmap;
</LI><LI CLASS="li-itemize">STR_VAR <CODE>worldmap</CODE> to the name of the .wmp file you want patched (default is "worldmap");
</LI><LI CLASS="li-itemize">INT_VAR <CODE>mapIcon</CODE> to the area&#X2019;s map icon index (from mapicons.bam);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>xCoord</CODE> to the area&#X2019;s X (east-west) coordinate;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>yCoord</CODE> to the area&#X2019;s Y (north-south) coordinate;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>tTime</CODE> to the area&#X2019;s travel time in hours * 4 (so 2 = 8 hours);
</LI><LI CLASS="li-itemize">INT_VAR <CODE>inclSv</CODE> to 1 to patch saved game worldmaps as well as the master worldmap;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>visible</CODE> to 1 if you want the &#X2019;visible&#X2019; flag to be set;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>visibleAdjacent</CODE> to 1 if you want the &#X2019;visible from adjacent&#X2019; flag to be set;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>reachable</CODE> to 1 if you want the &#X2019;reachable&#X2019; flag to be set;
</LI><LI CLASS="li-itemize">INT_VAR <CODE>visited</CODE> to 1 if you want the &#X2019;visited&#X2019; flag to be set;
</LI><LI CLASS="li-itemize">RET <CODE>areNum</CODE> returns the worldmap entry number for the new area;
</LI></UL><P>
An example best illustrates the use of this function.</P><PRE CLASS="verbatim">// add links from these area(s) to the new area
ACTION_DEFINE_ASSOCIATIVE_ARRAY toNewArea BEGIN
  "AR0020" =&gt; "Exitwmp"       // City Gates
  "AR0300" =&gt; "Exitwmp"       // Docks
  "AR0400" =&gt; "Exitwmp"       // Slums
  "AR0500" =&gt; "Exitwmp"       // Bridge District
  "AR0700" =&gt; "Exitwmp"       // Waukeen's Promenade
  "AR0800" =&gt; "Exitwmp"       // Graveyard
  "AR0900" =&gt; "Exitwmp"       // Temple District
  "AR1000" =&gt; "Exitwmp"       // Government
  "AR1100" =&gt; "Exitwmp"       // Umar Hills
  "AR1300" =&gt; "Exitwmp"       // d'Arnise Keep
  "AR1304" =&gt; "Exitwmp"       // d'Arnise Keep
  "AR2000" =&gt; "Exitwmp"       // Trademeet
  "AR1200" =&gt; "Exitwmp"       // Windspear Hills
END

// add links from the new area to these area(s)
ACTION_DEFINE_ASSOCIATIVE_ARRAY fromNewArea BEGIN
  "AR0020" =&gt; "ExitNE"      // City Gates
  "AR0300" =&gt; "ExitN"       // Docks
  "AR0400" =&gt; "ExitN"       // Slums
  "AR0500" =&gt; "ExitNE"      // Bridge District
  "AR0700" =&gt; "ExitE"       // Waukeen's Promenade
  "AR0800" =&gt; "ExitS"       // Graveyard
  "AR0900" =&gt; "ExitNW"      // Temple District
  "AR1000" =&gt; "ExitN"       // Government
  "AR1100" =&gt; "ExitSE"      // Umar Hills
  "AR1300" =&gt; "ExitSE"      // d'Arnise Keep
  "AR1304" =&gt; "ExitSE"      // d'Arnise Keep
  "AR2000" =&gt; "ExitSW"      // Trademeet
  "AR1200" =&gt; "ExitW"       // Windspear Hills
END

// calls the function and returns the worldmap entry number for the new area
LAUNCH_ACTION_FUNCTION sc#addWmpAre
    INT_VAR mapIcon = 21           // map icon
            xCoord  = 240          // x coordinate
            yCoord  = 130          // y coordinate
            tTime   = 0            // travel time *4, so two means eight hours
            inclSv  = 1            // include saved games bool: 1 means yes and 0 means no

    STR_VAR areName = "YS0390"     // area reference, like "AR0700"
            strName = "Govt. West" // area name, like "Waukeen's Promenade"
            strDesc = "Govt. West" // area description which will show up when hovering the area on the worldmap

    RET areNum = areNum
END
PRINT "Government District Westside patched. New area number is: %areNum%"
</PRE><!--TOC section <TT><B>Module Distribution</B></TT>: <TT>Setup-MyMod.exe</TT>-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc51">12</A>&#XA0;&#XA0;<B><TT>Module Distribution</TT></B><A NAME="Module Distribution"></A><A NAME="@default540"></A>: <TT>Setup-MyMod.exe</TT></H2><!--SEC END --><P>If you rename <TT>WeiDU.EXE</TT> to something of the form <TT>Setup-MyMod.exe</TT>,
it will behave as if the following arguments were present:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<TT>--tlkout DIALOG.<A HREF="#TLK">TLK</A></TT>
</LI><LI CLASS="li-itemize"><TT>--ftlkout DIALOGF.<A HREF="#TLK">TLK</A></TT> (if <TT>DIALOGF.<A HREF="#TLK">TLK</A></TT> is present)
</LI><LI CLASS="li-itemize"><TT>--log Setup-MyMod.DEBUG</TT>
</LI><LI CLASS="li-itemize"><TT>Setup-MyMod.tp2</TT>
</LI><LI CLASS="li-itemize"><TT>MyMod.tp2</TT>
</LI><LI CLASS="li-itemize"><TT>Mymod/Setup-MyMod.tp2</TT>
</LI><LI CLASS="li-itemize"><TT>Mymod/MyMod.tp2</TT>
</LI></UL><!--TOC subsection Module Distribution Conventions-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc52">12.1</A>&#XA0;&#XA0;Module Distribution Conventions</H3><!--SEC END --><P>To distribute your mod, rename <TT>WeiDU.EXE</TT> to <TT>Setup-MyMod.EXE</TT> (or
whatever), put <TT>Setup-MyMod.TP2</TT> file in the same directory and go!
Typically mods are distributed a ZIP files or self-extracting archives that
put the <TT>EXE</TT>, <TT><A HREF="#TP2">TP2</A></TT> and module data files in the main BGII
directory.</P><P>If your mod adds new resources to the game (e.g., via <TT><A HREF="#COPY">COPY</A></TT>) you
should be careful to pick a unique name so that you resource will not
conflict with one created by another mod. For example (and I speak from
personal experience here), naming a creature <TT>BOO2.CRE</TT> is just asking
for trouble. One common approach here is to pick a special prefix that uses
a character not found in normal game resources. For example, I might use
the prefix <TT>W#</TT> and call a sword <TT>W#SWORD.ITM</TT>
and a new spell <TT>W#SPELL.SPL</TT>. However, it it still possible to run into
conflicts, so I recommend that you check out the
Community Mod Filename Prefix Reservations project at
<TT><A HREF="http://forums.blackwyrmlair.net/index.php?showtopic=113">http://forums.blackwyrmlair.net/index.php?showtopic=113</A></TT> and
register your own unique prefix.</P><!--TOC subsection WeiDU Return Values-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc53">12.2</A>&#XA0;&#XA0;WeiDU Return Values</H3><!--SEC END --><P>The <TT>WeiDU.exe</TT> (or <TT>Setup-MyMod.exe</TT>) process will terminate with
a &#X201C;return value&#X201D; (or &#X201C;exit code&#X201D; or &#X201C;status code&#X201D; or &#X201C;error level&#X201D;)
based on the success or failure of certain operations. Depending on your
operating system you can use this value to guide shell scripts or batch
files that include WeiDU. In general, WeiDU returns 0 on success and
non-zero on failure. Here is a concrete list of return values.</P><UL CLASS="itemize"><LI CLASS="li-itemize">
0. General Success. No other error on this list was noticed.
</LI><LI CLASS="li-itemize">1. A <TT><A HREF="#TP2">TP2</A></TT> <TT><A HREF="#Component">Component</A></TT> failed to install.
A failed installation is one that displays a message like
&#X201C;<TT>Stopping installation because of error</TT>&#X201D; or
&#X201C;<TT>ERROR Installing [Component], rolling back to previous state</TT>&#X201D; or
&#X201C;<TT>PLEASE email the file SETUP-MYMOD.DEBUG to AUTHOR</TT>&#X201D; or
&#X201C;<TT>ERROR Re-Installing [MyMod] component 1</TT>&#X201D;.
</LI><LI CLASS="li-itemize">2. Auto-Update Error.
</LI><LI CLASS="li-itemize">3. Auto-Update Retry. The <TT>WeiDU.exe</TT> auto-update succeeded, but
you must re-run <TT>WeiDU.exe</TT>.
</LI><LI CLASS="li-itemize">4. Invalid command-line argument.
</LI></UL><!--TOC section Regular Expressions-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc54">13</A>&#XA0;&#XA0;Regular Expressions</H2><!--SEC END --><P>A regular expression or <B><TT>regexp</TT></B><A NAME="regexp"></A><A NAME="@default541"></A> is "somewhat" like a DOS wildcard
but not quite. The big difference is that if you would say * in DOS you say
.* in regexp-land. Here&#X2019;s a definition:</P><P>The syntax for regular expressions is the same as in Gnu Emacs. The special
characters are:
</P><PRE CLASS="verbatim">$^.*+?[]\
</PRE><P>The following constructs are recognized:
</P><PRE CLASS="verbatim">   .      matches any character except newline
   *      (postfix) matches the previous expression zero, one or several times
   +      (postfix) matches the previous expression one or several times
   ?      (postfix) matches the previous expression once or not at all
   [..]   character set; ranges are denoted with -, as in [a-z];
          an initial ^, as in [^0-9], complements the set
   ^      matches at beginning of line
   $      matches at end of line
   \|     (infix) alternative between two expressions
   \(..\) grouping and naming of the enclosed expression
   \1     the text matched by the first \(...\) expression
          (\2 for the second expression, etc)
   \b     matches word boundaries
   \      quotes special characters.
</PRE><P>So spe.* matches "sper01.itm" and "sper.eff" and "special".</P><P>Hopefully this is understandable to most people.</P><!--TOC section WeiDU <TT><B>constant</B></TT>s-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc55">14</A>&#XA0;&#XA0;WeiDU <B><TT>constant</TT></B><A NAME="constant"></A><A NAME="@default542"></A>s</H2><!--SEC END --><P>The following keywords can be used in <TT>value</TT>s and evaluate to the given
integer (usually an offset in a <TT><A HREF="#CRE">CRE</A></TT> file).</P><PRE CLASS="verbatim">// KEYWORD VALUE
AREA_CITY 0252
AREA_DAY 0260
AREA_DUNGEON 0256
AREA_FOREST 0248
AREA_NIGHT 0264
ATTACK1 0220
ATTACK2 0224
ATTACK3 0228
ATTACK4 0232
BATTLE_CRY1 0200
BATTLE_CRY2 0204
BATTLE_CRY3 0208
BATTLE_CRY4 0212
BATTLE_CRY5 0216
BIO  0x1cc
BORED 0196
COMPLIMENT1 0352
COMPLIMENT2 0356
COMPLIMENT3 0360
CRITICAL_HIT 0424
CRITICAL_MISS 0428
DAMAGE 0236
DESC  0x54
DIALOGUE_DEFAULT 0412
DIALOGUE_HOSTILE 0408
DYING 0240
EXISTANCE1 0444
EXISTANCE2 0448
EXISTANCE3 0452
EXISTANCE4 0456
EXISTANCE5 0460
HAPPY 0172
HURT 0244
IDENTIFIED_DESC  0x54
INITIAL_MEETING 0164
INSULT 0340
INTERACTION1 0320
INTERACTION2 0324
INTERACTION3 0328
INTERACTION4 0332
INTERACTION5 0336
INVENTORY_FULL 0436
LEADER 0188
MISCELLANEOUS 0384
MORALE 0168
NAME1 8
NAME2 12
PICKED_POCKET 0440
REACT_TO_DIE_GENERAL 0376
REACT_TO_DIE_SPECIFIC 0380
RESPONSE_TO_COMPLIMENT2 0388
RESPONSE_TO_COMPLIMENT3 0392
RESPONSE_TO_INSULT1 0396
RESPONSE_TO_INSULT2 0400
RESPONSE_TO_INSULT3 0404
SELECT_ACTION1 0292
SELECT_ACTION2 0296
SELECT_ACTION3 0300
SELECT_ACTION4 0304
SELECT_ACTION5 0308
SELECT_ACTION6 0312
SELECT_ACTION7 0316
SELECT_COMMON1 0268
SELECT_COMMON2 0272
SELECT_COMMON3 0276
SELECT_COMMON4 0280
SELECT_COMMON5 0284
SELECT_COMMON6 0288
SELECT_RARE1 0416
SELECT_RARE2 0420
SPECIAL1 0364
SPECIAL2 0368
SPECIAL3 0372
TARGET_IMMUNE 0432
TIRED 0192
UNHAPPY_ANNOYED 0176
UNHAPPY_BREAKING 0184
UNHAPPY_SERIOUS 0180
UNIDENTIFIED_DESC 0080
HIDDEN_IN_SHADOWS 0444
SPELL_DISRUPTED 0448
SET_A_TRAP 0452
STORE_NAME 12

SCRIPT_OVERRIDE 0x248
SCRIPT_CLASS 0x250
SCRIPT_RACE 0x258
SCRIPT_GENERAL 0x260
SCRIPT_DEFAULT 0x268
DEATHVAR 0x280
DIALOG 0x2cc
AREA_SCRIPT 0x94

BIT0  0b00000000000000000000000000000001
BIT1  0b00000000000000000000000000000010
&lt;snip&gt;
BIT31 0b10000000000000000000000000000000

WNL "\r\n" // Windows new line
MNL "\r" // (pre-OSX) Macintosh new line
LNL "\n" // Linux/Unix/OSX new line
TAB "\t" // tabulation character

REGISTRY_BG1_PATH the path of BG1 (as read from the registry), or empty if not available.
REGISTRY_BG2_PATH ditto for BG2.
REGISTRY_PST_PATH ditto for PST.
REGISTRY_IWD1_PATH ditto for IWD1.
REGISTRY_IWD2_PATH ditto for IWD2.
</PRE><!--TOC section Common File Formats-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc56">15</A>&#XA0;&#XA0;Common File Formats</H2><!--SEC END --><P>This section briefly explains some common file formats. The definitive
reference is
<TT><A HREF="http://iesdp.gibberlings3.net/">http://iesdp.gibberlings3.net/</A></TT>.</P><UL CLASS="itemize"><LI CLASS="li-itemize"><B><TT>2DA</TT></B><A NAME="2DA"></A><A NAME="@default543"></A>. A 2DA file is a text file that includes some game rules
or file information. Kits, music, weapon proficiencies and experience point
caps are all controlled by 2DA files.</LI><LI CLASS="li-itemize"><B><TT>BIFF</TT></B><A NAME="BIFF"></A><A NAME="@default544"></A>. A BIFF file is like a big ZIP file that contains other
files. Basically every file used by an Infinity Engine game is either in a
BIFF somewhere or in the <TT>override</TT> folder.</LI><LI CLASS="li-itemize"><B><TT>BCS</TT></B><A NAME="BCS"></A><A NAME="@default545"></A>. An Infinity Engine script. These are used to control
the actions of creatures and areas. They are basically big lists of
<TT>IF</TT>s. <TT><A HREF="#D">D</A></TT> files (and also <TT><A HREF="#DLG">DLG</A></TT> files) use the same
predicate and action syntax as BCS files.</LI><LI CLASS="li-itemize"><B><TT>EFF</TT></B><A NAME="EFF"></A><A NAME="@default546"></A>. An Infinity Engine effect file. These are sometimes used
by <TT><A HREF="#ITM">ITM</A></TT>s or <TT><A HREF="#SPL">SPL</A></TT>s to do one specific thing. You probably
won&#X2019;t use them.</LI><LI CLASS="li-itemize"><B><TT>ITM</TT></B><A NAME="ITM"></A><A NAME="@default547"></A>. An Infinity Engine item definition file. Notably,
<TT><A HREF="#ITM">ITM</A></TT> files have identified and unidentified names that are often set
using the <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <TT><A HREF="#COPY">COPY</A></TT>.</LI><LI CLASS="li-itemize"><B><TT>KEY</TT></B><A NAME="KEY"></A><A NAME="@default548"></A>. A KEY file is an index into <TT><A HREF="#BIFF">BIFF</A></TT> files. Given a
resource (like <TT>sw1h01.itm</TT>) you can use the KEY file to find out where
it is in the <TT><A HREF="#BIFF">BIFF</A></TT>s. The default KEY file is <TT>CHITIN.KEY</TT>.</LI><LI CLASS="li-itemize"><B><TT>SPL</TT></B><A NAME="SPL"></A><A NAME="@default549"></A>. An Infinity Engine spell definition file. Spells have
names that are often set using the <TT><A HREF="#TP2 Action">TP2 Action</A></TT> <TT><A HREF="#COPY">COPY</A></TT>.</LI><LI CLASS="li-itemize"><B><TT>TLK</TT></B><A NAME="TLK"></A><A NAME="@default550"></A>. A TLK file is basically a big array of strings. Items
and spells and dialogues in the game have references into this big array
instead of having actual text in them. So a sword item doesn&#X2019;t have the
text "Longsword" anywhere in it. Instead if says "use strref #1234 for my
name". The game looks up the #1234th entry in the TLK file and prints that
on the screen. The default TLK file is called <TT>DIALOG.<A HREF="#TLK">TLK</A></TT>.</LI></UL><!--TOC section The Source Code-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc57">16</A>&#XA0;&#XA0;The Source Code</H2><!--SEC END --><P>The source code to WeiDU is available under the GNU General Public License,
as detailed in the file <TT>COPYING</TT>. If for some reason you are unable to
obtain a copy of the GPL, merely announce that fact on some public forum
and your mailbox will be full of copies of it for life. It&#X2019;s a great way to
meet new people.</P><P>Since this is the world of Windows, I distribute a pre-compiled binary.
WeiDU is written in OCaml, a functional programming language that includes
automatic memory management, higher-order functions and efficient native
code generation. If these terms mean nothing to you, you probably won&#X2019;t be
able to modify the source code.</P><P>However, if you do want to modify the source and then recompile WeiDU, it&#X2019;s
quite easy. Make sure that you have OCaml 3.10 (or newer), sed (or Perl
5.6), make and either gcc or (optionally) cl (the Microsoft Visual C
Compiler).</P><P>Edit the <TT>Configuration</TT> file and pick your configuration. If you&#X2019;re not
x86/windows/cygwin or x86/linux, you&#X2019;ll have to do some tweaking. Then just
type <TT>make clean</TT> and then <TT>make</TT>. Presto, you&#X2019;ve recompiled it.</P><P>WeiDU uses the GPL&#X2019;d <TT>zlib</TT> and <TT>xdiff</TT> libraries, as well as portions from
the BSD&#X2019;d <TT>Elkhound</TT> program.</P><!--TOC section Special Thanks-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc58">17</A>&#XA0;&#XA0;Special Thanks</H2><!--SEC END --><P>
<EM>Weimer&#X2019;s thank you</EM>:
I would like to thank the fine folks at the Infinity Engine File Format
Hacking Project, without which this would not have been possible:
<TT><A HREF="http://iesdp.gibberlings3.net/">http://iesdp.gibberlings3.net/</A></TT>.</P><P>In addition, I make heavy use of Near Infinity for general IE mods: <TT><A HREF="http://www.idi.ntnu.no/~joh/ni/">http://www.idi.ntnu.no/~joh/ni/</A></TT>.</P><P>The Infinity Engine Editor Pro was very good at changing <TT><A HREF="#ITM">ITM</A></TT>s and
<TT><A HREF="#SPL">SPL</A></TT>s, but DLTCEP is now a better choice:
<TT><A HREF="http://www.gibberlings3.net/tools/dltcep.php">http://www.gibberlings3.net/tools/dltcep.php</A></TT>.</P><P>Kudos to my main out-of-house developer:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
Fred S. Richardson (he slices, he dices, he sends diffs!)
</LI><LI CLASS="li-itemize">Japheth (also sends diffs!)
</LI></UL><P>Special thanks to my main bug-finders *cough* I mean beta-testers:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Jason Compton </EM> (and his witty wife)
</LI><LI CLASS="li-itemize">Ghreyfain
</LI><LI CLASS="li-itemize">Michael Lyashenko
</LI><LI CLASS="li-itemize">Quitch
</LI><LI CLASS="li-itemize">Dyara
</LI><LI CLASS="li-itemize">M
</LI><LI CLASS="li-itemize">Rene Heroux
</LI><LI CLASS="li-itemize">Avenger TeamBG
</LI><LI CLASS="li-itemize">Sim
</LI><LI CLASS="li-itemize">devSin</LI></UL><P>Special thanks to Greg Henry for being the first person to mention WeiDU to
me in a face-to-face conversation. I was quite impressed. Jason Compton is
the first person to mention WeiDU to me in a telephone conversation. Scott
McPeak is the first person to discuss my modding hobby with me in a
face-to-face conversation (and he was quite well-informed).</P><P>The Bigg would additionally like to thank the following contributors:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
DevSin (also sends diffs and tests and compiles!)
</LI><LI CLASS="li-itemize">cmorgan for his excellent throughput while testing.
</LI><LI CLASS="li-itemize">Taimon (also sends diffs and tests!)
</LI><LI CLASS="li-itemize">Gort (sends tp2 macros!)
</LI><LI CLASS="li-itemize">vit-mg (sends documentation!)
</LI><LI CLASS="li-itemize">Mike1072 (sends documentation and tp2 macros/functions!)
</LI><LI CLASS="li-itemize">plainab sends tp2 macros!
</LI><LI CLASS="li-itemize">wisp (sends documentation and tp2 macros/functions!)
</LI><LI CLASS="li-itemize">Miloch (sends documentation and tp2 macros/functions!)
</LI><LI CLASS="li-itemize">SConrad (sends tp2 functions!)
</LI><LI CLASS="li-itemize">Nythrun (sends tp2 functions!)
</LI><LI CLASS="li-itemize">Galactycon (sends tp2 macros!)
</LI></UL><P>
and additionally
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
<EM>Weimer</EM> for having written (and maintained) the excellent WeiDU,
and having offered it freely (both as free beer and freedom) to the gaming
community.
</LI><LI CLASS="li-itemize">All the people I&#X2019;ve been modding with, all the people who played my mods,
and all of the BG modding community, for having been a very friendly community
(and, in some cases, even very good friends) in these last four years (or more,
this part was written in Jun 2008). It&#X2019;s for you that I&#X2019;ve learned OcaML and
started editing WeiDU.
</LI></UL><!--TOC section Informal Copyright Notice-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc59">18</A>&#XA0;&#XA0;Informal Copyright Notice</H2><!--SEC END --><P>
WeiDU was originally made by Westley Weimer.
I (Valerio Bigiani, AKA The Bigg) decided to maintain the &#X2019;WeiDU&#X2019; software
according to the GPL terms, under which WeiDU is distributed, starting from
version 186 (which was a closed beta, while the first public release was the
187 one).</P><P>What this means is that all praise and credits should go to Weimer, but all
bug reports and feature requests should go to Valerio Bigiani (AKA &#X2019;The Bigg&#X2019;).</P><P>Since WeiDU was released under GPL, with an added notice that you are also
allowed to distribute unmodified binaries, I assume the same holds true for
mods distributed with this version of WeiDU. However, if you feel like being
nice add a line in your readme stating that the current WeiDU may be downloaded
from &lt;insert link&gt;. Current authorized mirrors include (but may not be limited to)
all those from IEGMC, the Dragon&#X2019;s Hoard Download Centre, and the SHS Download Centre.</P><!--TOC section Undocumented Features-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc60">19</A>&#XA0;&#XA0;Undocumented Features</H2><!--SEC END --><P>Currently undocumented:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
We might want to mention somewhere that we compile BAF files.
</LI><LI CLASS="li-itemize"><TT>IF_EVAL</TT>.
</LI><LI CLASS="li-itemize"><TT>REPLACE_BCS_BLOCK_REGEXP</TT>.
</LI><LI CLASS="li-itemize">Fred&#X2019;s BCS diff stuff.
</LI><LI CLASS="li-itemize"><TT>--trbify</TT>, <TT>TRB</TT> files.
</LI><LI CLASS="li-itemize"><TT>EDIT_SAV_FILE</TT>.
</LI><LI CLASS="li-itemize"><TT>EXTEND_MOS</TT>.
</LI></UL><!--TOC section Index of Terms-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc61">20</A>&#XA0;&#XA0;Index of Terms</H2><!--SEC END --><!--TOC section Index-->
<H2 CLASS="section"><!--SEC ANCHOR -->Index</H2><!--SEC END --><P></P><TABLE CELLSPACING=6 CELLPADDING=0><TR><TD VALIGN=top ALIGN=left><UL CLASS="indexenv"><LI CLASS="li-indexenv">
**, <A HREF="#@default443">8</A>, <A HREF="#@default444">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">--append, <A HREF="#@default101">5</A>
</LI><LI CLASS="li-indexenv">--args, <A HREF="#@default83">5</A>
</LI><LI CLASS="li-indexenv">--args-list, <A HREF="#@default85">5</A>
</LI><LI CLASS="li-indexenv">--args-rest, <A HREF="#@default84">5</A>
</LI><LI CLASS="li-indexenv">--ask-every, <A HREF="#@default81">5</A>
</LI><LI CLASS="li-indexenv">--autolog, <A HREF="#@default158">5</A>
</LI><LI CLASS="li-indexenv">--automate, <A HREF="#@default153">5</A>
</LI><LI CLASS="li-indexenv">--automate-min, <A HREF="#@default154">5</A>
</LI><LI CLASS="li-indexenv">--backup, <A HREF="#@default102">5</A>
</LI><LI CLASS="li-indexenv">--bcmp-from, <A HREF="#@default147">5</A>
</LI><LI CLASS="li-indexenv">--bcmp-orig, <A HREF="#@default149">5</A>
</LI><LI CLASS="li-indexenv">--bcmp-patch, <A HREF="#@default150">5</A>
</LI><LI CLASS="li-indexenv">--bcmp-to, <A HREF="#@default148">5</A>
</LI><LI CLASS="li-indexenv">--biff, <A HREF="#@default127">5</A>
</LI><LI CLASS="li-indexenv">--biff-get, <A HREF="#@default128">5</A>
</LI><LI CLASS="li-indexenv">--biff-get-list, <A HREF="#@default130">5</A>
</LI><LI CLASS="li-indexenv">--biff-get-rest, <A HREF="#@default129">5</A>
</LI><LI CLASS="li-indexenv">--biff-name, <A HREF="#@default135">5</A>
</LI><LI CLASS="li-indexenv">--biff-str, <A HREF="#@default131">5</A>
</LI><LI CLASS="li-indexenv">--biff-type, <A HREF="#@default134">5</A>
</LI><LI CLASS="li-indexenv">--biff-value, <A HREF="#@default132">5</A>
</LI><LI CLASS="li-indexenv">--biff-value-at, <A HREF="#@default133">5</A>
</LI><LI CLASS="li-indexenv">--clear-memory, <A HREF="#@default89">5</A>
</LI><LI CLASS="li-indexenv">--cmp-from, <A HREF="#@default138">5</A>
</LI><LI CLASS="li-indexenv">--cmp-to, <A HREF="#@default139">5</A>
</LI><LI CLASS="li-indexenv">--continue, <A HREF="#@default82">5</A>
</LI><LI CLASS="li-indexenv">--dcmp-from, <A HREF="#@default140">5</A>
</LI><LI CLASS="li-indexenv">--dcmp-to, <A HREF="#@default141">5</A>
</LI><LI CLASS="li-indexenv">--debug-assign, <A HREF="#@default86">5</A>
</LI><LI CLASS="li-indexenv">--debug-value, <A HREF="#@default87">5</A>
</LI><LI CLASS="li-indexenv">--extract-kits, <A HREF="#@default155">5</A>
</LI><LI CLASS="li-indexenv">--force-install, <A HREF="#@default71">5</A>
</LI><LI CLASS="li-indexenv">--force-install-list, <A HREF="#@default75">5</A>
</LI><LI CLASS="li-indexenv">--force-install-rest, <A HREF="#@default73">5</A>
</LI><LI CLASS="li-indexenv">--force-uninstall, <A HREF="#@default72">5</A>
</LI><LI CLASS="li-indexenv">--force-uninstall-list, <A HREF="#@default76">5</A>
</LI><LI CLASS="li-indexenv">--force-uninstall-rest, <A HREF="#@default74">5</A>
</LI><LI CLASS="li-indexenv">--forceify, <A HREF="#@default121">5</A>
</LI><LI CLASS="li-indexenv">--ftlkin, <A HREF="#@default98">5</A>
</LI><LI CLASS="li-indexenv">--ftlkout, <A HREF="#@default104">5</A>
</LI><LI CLASS="li-indexenv">--full-from, <A HREF="#@default107">5</A>
</LI><LI CLASS="li-indexenv">--game, <A HREF="#@default93">5</A>
</LI><LI CLASS="li-indexenv">--game-by-type, <A HREF="#@default95">5</A>
</LI><LI CLASS="li-indexenv">--language, <A HREF="#@default70">5</A>
</LI><LI CLASS="li-indexenv">--list-biffs, <A HREF="#@default125">5</A>
</LI><LI CLASS="li-indexenv">--list-eff, <A HREF="#@default156">5</A>
</LI><LI CLASS="li-indexenv">--list-files, <A HREF="#@default126">5</A>
</LI><LI CLASS="li-indexenv">--log, <A HREF="#@default157">5</A>
</LI><LI CLASS="li-indexenv">--logapp, <A HREF="#@default159">5</A>
</LI><LI CLASS="li-indexenv">--make-biff, <A HREF="#@default136">5</A>, <A HREF="#@default160">6</A>
</LI><LI CLASS="li-indexenv">--make-tlk, <A HREF="#@default119">5</A>
</LI><LI CLASS="li-indexenv">--max, <A HREF="#@default152">5</A>
</LI><LI CLASS="li-indexenv">--min, <A HREF="#@default151">5</A>
</LI><LI CLASS="li-indexenv">--modder, <A HREF="#@default88">5</A>
</LI><LI CLASS="li-indexenv">--noautoupdate, <A HREF="#@default91">5</A>
</LI><LI CLASS="li-indexenv">--nocom, <A HREF="#@default108">5</A>
</LI><LI CLASS="li-indexenv">--nofrom, <A HREF="#@default106">5</A>
</LI><LI CLASS="li-indexenv">--nogame, <A HREF="#@default94">5</A>
</LI><LI CLASS="li-indexenv">--noheader, <A HREF="#@default105">5</A>
</LI><LI CLASS="li-indexenv">--noselfupdatemsg, <A HREF="#@default92">5</A>
</LI><LI CLASS="li-indexenv">--out, <A HREF="#@default100">5</A>
</LI><LI CLASS="li-indexenv">--quick-menu, <A HREF="#@default77">5</A>
</LI><LI CLASS="li-indexenv">--reinstall, <A HREF="#@default69">5</A>
</LI><LI CLASS="li-indexenv">--remove-biff, <A HREF="#@default137">5</A>, <A HREF="#@default161">6</A>
</LI><LI CLASS="li-indexenv">--safe-exit, <A HREF="#@default79">5</A>
</LI><LI CLASS="li-indexenv">--save-components-name, <A HREF="#@default80">5</A>
</LI><LI CLASS="li-indexenv">--script-style, <A HREF="#@default65">5</A>
</LI><LI CLASS="li-indexenv">--search, <A HREF="#@default96">5</A>
</LI><LI CLASS="li-indexenv">--skip-at-view, <A HREF="#@default78">5</A>
</LI><LI CLASS="li-indexenv">--strapp, <A HREF="#@default124">5</A>
</LI><LI CLASS="li-indexenv">--strfind, <A HREF="#@default123">5</A>
</LI><LI CLASS="li-indexenv">--string, <A HREF="#@default122">5</A>
</LI><LI CLASS="li-indexenv">--tcmp-from, <A HREF="#@default142">5</A>
</LI><LI CLASS="li-indexenv">--tcmp-to, <A HREF="#@default143">5</A>
</LI><LI CLASS="li-indexenv">--testtrans, <A HREF="#@default120">5</A>
</LI><LI CLASS="li-indexenv">--text, <A HREF="#@default109">5</A>
</LI><LI CLASS="li-indexenv">--tlkcmp-from, <A HREF="#@default144">5</A>
</LI><LI CLASS="li-indexenv">--tlkcmp-to, <A HREF="#@default145">5</A>
</LI><LI CLASS="li-indexenv">--tlkcmp-use-strings, <A HREF="#@default146">5</A>
</LI><LI CLASS="li-indexenv">--tlkin, <A HREF="#@default97">5</A>
</LI><LI CLASS="li-indexenv">--tlkmerge, <A HREF="#@default99">5</A>
</LI><LI CLASS="li-indexenv">--tlkout, <A HREF="#@default103">5</A>
</LI><LI CLASS="li-indexenv">--toplevel, <A HREF="#@default111">5</A>
</LI><LI CLASS="li-indexenv">--traify, <A HREF="#@default112">5</A>
</LI><LI CLASS="li-indexenv">--traify-old-tra, <A HREF="#@default113">5</A>
</LI><LI CLASS="li-indexenv">--traify-tlk, <A HREF="#@default118">5</A>
</LI><LI CLASS="li-indexenv">--trans, <A HREF="#@default116">5</A>
</LI><LI CLASS="li-indexenv">--transin, <A HREF="#@default66">5</A>
</LI><LI CLASS="li-indexenv">--transitive, <A HREF="#@default110">5</A>, <A HREF="#@default162">6</A>
</LI><LI CLASS="li-indexenv">--transref, <A HREF="#@default117">5</A>
</LI><LI CLASS="li-indexenv">--uninstall, <A HREF="#@default68">5</A>
</LI><LI CLASS="li-indexenv">--untraify-d, <A HREF="#@default114">5</A>
</LI><LI CLASS="li-indexenv">--untraify-tra, <A HREF="#@default115">5</A>
</LI><LI CLASS="li-indexenv">--update-all, <A HREF="#@default90">5</A>
</LI><LI CLASS="li-indexenv">--yes, <A HREF="#@default67">5</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">2DA, <A HREF="#@default543">15</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">&lt;, <A HREF="#@default469">8</A>
</LI><LI CLASS="li-indexenv">&lt;&lt;, <A HREF="#@default463">8</A>
</LI><LI CLASS="li-indexenv">&lt;=, <A HREF="#@default470">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">=, <A HREF="#@default445">8</A>
</LI><LI CLASS="li-indexenv">==, <A HREF="#@default446">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">&gt;, <A HREF="#@default467">8</A>
</LI><LI CLASS="li-indexenv">&gt;=, <A HREF="#@default468">8</A>
</LI><LI CLASS="li-indexenv">&gt;&gt;, <A HREF="#@default465">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">?, <A HREF="#@default471">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">&amp;, <A HREF="#@default455">8</A>
</LI><LI CLASS="li-indexenv">&amp;&amp;, <A HREF="#@default453">8</A>
</LI><LI CLASS="li-indexenv">!=, <A HREF="#@default449">8</A>
</LI><LI CLASS="li-indexenv">|, <A HREF="#@default457">8</A>
</LI><LI CLASS="li-indexenv">||, <A HREF="#@default451">8</A>
</LI><LI CLASS="li-indexenv"><CODE>`</CODE>, <A HREF="#@default461">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">^^, <A HREF="#@default459">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">ABS, <A HREF="#@default448">8</A>
</LI><LI CLASS="li-indexenv">ACTION_BASH_FOR, <A HREF="#@default287">8</A>
</LI><LI CLASS="li-indexenv">ACTION_CLEAR_ARRAY, <A HREF="#@default229">8</A>
</LI><LI CLASS="li-indexenv">ACTION_DEFINE_ARRAY, <A HREF="#@default288">8</A>
</LI><LI CLASS="li-indexenv">ACTION_DEFINE_ASSOCIATIVE_ARRAY, <A HREF="#@default291">8</A>
</LI><LI CLASS="li-indexenv">ACTION_FOR_EACH, <A HREF="#@default292">8</A>
</LI><LI CLASS="li-indexenv">ACTION_GET_STRREF, <A HREF="#@default301">8</A>
</LI><LI CLASS="li-indexenv">ACTION_IF, <A HREF="#@default243">8</A>
</LI><LI CLASS="li-indexenv">ACTION_INCLUDE, <A HREF="#@default295">8</A>
</LI><LI CLASS="li-indexenv">ACTION_MATCH, <A HREF="#@default244">8</A>
</LI><LI CLASS="li-indexenv">ACTION_PHP_EACH, <A HREF="#@default293">8</A>
</LI><LI CLASS="li-indexenv">ACTION_READLN, <A HREF="#@default234">8</A>
</LI><LI CLASS="li-indexenv">ACTION_REINCLUDE, <A HREF="#@default297">8</A>
</LI><LI CLASS="li-indexenv">ACTION_RERAISE, <A HREF="#@default246">8</A>
</LI><LI CLASS="li-indexenv">ACTION_TO_LOWER, <A HREF="#@default300">8</A>
</LI><LI CLASS="li-indexenv">ACTION_TO_UPPER, <A HREF="#@default299">8</A>
</LI><LI CLASS="li-indexenv">ACTION_TRY, <A HREF="#@default245">8</A>
</LI><LI CLASS="li-indexenv">ADD_AREA_TYPE, <A HREF="#@default263">8</A>
</LI><LI CLASS="li-indexenv">ADD_CRE_ITEM, <A HREF="#@default411">8</A>, <A HREF="#@default520">9.12</A>
</LI><LI CLASS="li-indexenv">ADD_GAM_NPC, <A HREF="#@default404">8</A>, <A HREF="#@default516">9.6</A>
</LI><LI CLASS="li-indexenv">ADD_KIT, <A HREF="#@default259">8</A>
</LI><LI CLASS="li-indexenv">ADD_KNOWN_SPELL, <A HREF="#@default406">8</A>
</LI><LI CLASS="li-indexenv">ADD_MAP_NOTE, <A HREF="#@default405">8</A>
</LI><LI CLASS="li-indexenv">ADD_MEMORIZED_SPELL, <A HREF="#@default407">8</A>
</LI><LI CLASS="li-indexenv">ADD_MUSIC, <A HREF="#@default260">8</A>
</LI><LI CLASS="li-indexenv">ADD_PROJECTILE, <A HREF="#@default264">8</A>
</LI><LI CLASS="li-indexenv">ADD_SCHOOL, <A HREF="#@default261">8</A>
</LI><LI CLASS="li-indexenv">ADD_SECTYPE, <A HREF="#@default262">8</A>
</LI><LI CLASS="li-indexenv">ADD_SPELL, <A HREF="#@default265">8</A>
</LI><LI CLASS="li-indexenv">ADD_STATE_TRIGGER, <A HREF="#@default15">4</A>
</LI><LI CLASS="li-indexenv">ADD_STORE_ITEM, <A HREF="#@default386">8</A>, <A HREF="#@default515">9.5</A>
</LI><LI CLASS="li-indexenv">ADD_TRANS_ACTION, <A HREF="#@default17">4</A>
</LI><LI CLASS="li-indexenv">ADD_TRANS_TRIGGER, <A HREF="#@default16">4</A>
</LI><LI CLASS="li-indexenv">ALLOW_MISSING, <A HREF="#@default175">8</A>
</LI><LI CLASS="li-indexenv">ALTER_TLK, <A HREF="#@default271">8</A>
</LI><LI CLASS="li-indexenv">ALTER_TLK_LIST, <A HREF="#@default270">8</A>
</LI><LI CLASS="li-indexenv">ALTER_TLK_RANGE, <A HREF="#@default269">8</A>
</LI><LI CLASS="li-indexenv">ALTER_TRANS, <A HREF="#@default20">4</A>, <A HREF="#@default166">7.11</A>
</LI><LI CLASS="li-indexenv">ALWAYS, <A HREF="#@default177">8</A>
</LI><LI CLASS="li-indexenv">AND, <A HREF="#@default452">8</A>
</LI><LI CLASS="li-indexenv">APPEND, <A HREF="#@default5">4</A>, <A HREF="#@default235">8</A>
</LI><LI CLASS="li-indexenv">APPEND_COL, <A HREF="#@default237">8</A>
</LI><LI CLASS="li-indexenv">APPEND_COL_OUTER, <A HREF="#@default238">8</A>
</LI><LI CLASS="li-indexenv">APPEND_EARLY, <A HREF="#@default6">4</A>
</LI><LI CLASS="li-indexenv">APPEND_FILE, <A HREF="#@default343">8</A>
</LI><LI CLASS="li-indexenv">APPEND_FILE_EVALUATE, <A HREF="#@default344">8</A>
</LI><LI CLASS="li-indexenv">APPEND_OUTER, <A HREF="#@default236">8</A>
</LI><LI CLASS="li-indexenv">APPENDI, <A HREF="#@default41">4</A>
</LI><LI CLASS="li-indexenv">APPLY_BCS_PATCH, <A HREF="#@default332">8</A>
</LI><LI CLASS="li-indexenv">APPLY_BCS_PATCH_OR_COPY, <A HREF="#@default333">8</A>
</LI><LI CLASS="li-indexenv">ASK_EVERY_COMPONENT, <A HREF="#@default176">8</A>
</LI><LI CLASS="li-indexenv">AT_EXIT, <A HREF="#@default247">8</A>
</LI><LI CLASS="li-indexenv">AT_INTERACTIVE_EXIT, <A HREF="#@default248">8</A>
</LI><LI CLASS="li-indexenv">AT_INTERACTIVE_NOW, <A HREF="#@default254">8</A>
</LI><LI CLASS="li-indexenv">AT_INTERACTIVE_UNINSTALL, <A HREF="#@default250">8</A>
</LI><LI CLASS="li-indexenv">AT_INTERACTIVE_UNINSTALL_EXIT, <A HREF="#@default252">8</A>
</LI><LI CLASS="li-indexenv">AT_NOW, <A HREF="#@default253">8</A>
</LI><LI CLASS="li-indexenv">AT_UNINSTALL, <A HREF="#@default249">8</A>
</LI><LI CLASS="li-indexenv">AT_UNINSTALL_EXIT, <A HREF="#@default251">8</A>
</LI><LI CLASS="li-indexenv">AUTHOR, <A HREF="#@default170">8</A>
</LI><LI CLASS="li-indexenv">AUTO_TRA, <A HREF="#@default174">8</A>
</LI><LI CLASS="li-indexenv">array construct, <A HREF="#@default529">9.20</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">BACKUP, <A HREF="#@default169">8</A>
</LI><LI CLASS="li-indexenv">BAND, <A HREF="#@default454">8</A>
</LI><LI CLASS="li-indexenv">BASR, <A HREF="#@default466">8</A>
</LI><LI CLASS="li-indexenv">BCS, <A HREF="#@default545">15</A>
</LI><LI CLASS="li-indexenv">BEGIN, <A HREF="#@default3">4</A>, <A HREF="#@default188">8</A>
</LI><LI CLASS="li-indexenv">BIFF, <A HREF="#@default544">15</A>
</LI><LI CLASS="li-indexenv">BIFF_IS_COMPRESSED, <A HREF="#@default507">8</A>
</LI><LI CLASS="li-indexenv">BLSL, <A HREF="#@default462">8</A>
</LI><LI CLASS="li-indexenv">BLSR, <A HREF="#@default464">8</A>
</LI><LI CLASS="li-indexenv">BNOT, <A HREF="#@default460">8</A>
</LI><LI CLASS="li-indexenv">BOR, <A HREF="#@default456">8</A>
</LI><LI CLASS="li-indexenv">BUFFER_LENGTH, <A HREF="#@default495">8</A>
</LI><LI CLASS="li-indexenv">BUT_ONLY_IF_IT_CHANGES, <A HREF="#@default434">8</A>
</LI><LI CLASS="li-indexenv">BXOR, <A HREF="#@default458">8</A>
</LI><LI CLASS="li-indexenv">BYTE_AT, <A HREF="#@default437">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">CASE_INSENSITIVE, <A HREF="#@default309">8</A>
</LI><LI CLASS="li-indexenv">CASE_SENSITIVE, <A HREF="#@default308">8</A>
</LI><LI CLASS="li-indexenv">CHAIN, <A HREF="#@default7">4</A>
</LI><LI CLASS="li-indexenv">CHAIN2, <A HREF="#@default42">4</A>
</LI><LI CLASS="li-indexenv">CLEAR_ARRAY, <A HREF="#@default369">8</A>
</LI><LI CLASS="li-indexenv">CLEAR_ARRAYS, <A HREF="#@default224">8</A>
</LI><LI CLASS="li-indexenv">CLEAR_CODES, <A HREF="#@default225">8</A>
</LI><LI CLASS="li-indexenv">CLEAR_EVERYTHING, <A HREF="#@default227">8</A>
</LI><LI CLASS="li-indexenv">CLEAR_IDS_MAP, <A HREF="#@default228">8</A>
</LI><LI CLASS="li-indexenv">CLEAR_INLINED, <A HREF="#@default226">8</A>
</LI><LI CLASS="li-indexenv">CLEAR_MEMORY, <A HREF="#@default223">8</A>
</LI><LI CLASS="li-indexenv">COMPILE, <A HREF="#@default221">8</A>
</LI><LI CLASS="li-indexenv">COMPILE_BAF_TO_BCS, <A HREF="#@default395">8</A>
</LI><LI CLASS="li-indexenv">COMPILE_D_TO_DLG, <A HREF="#@default398">8</A>
</LI><LI CLASS="li-indexenv">COMPONENT_NUMBER, <A HREF="#@default512">8</A>
</LI><LI CLASS="li-indexenv">COMPRESS_INTO_FILE, <A HREF="#@default428">8</A>
</LI><LI CLASS="li-indexenv">COMPRESS_INTO_VAR, <A HREF="#@default429">8</A>
</LI><LI CLASS="li-indexenv">COMPRESS_REPLACE_FILE, <A HREF="#@default427">8</A>
</LI><LI CLASS="li-indexenv">COPY, <A HREF="#@default202">8</A>
</LI><LI CLASS="li-indexenv">COPY_ALL_GAM_FILES, <A HREF="#@default218">8</A>
</LI><LI CLASS="li-indexenv">COPY_EXISTING, <A HREF="#@default214">8</A>
</LI><LI CLASS="li-indexenv">COPY_EXISTING_REGEXP, <A HREF="#@default215">8</A>
</LI><LI CLASS="li-indexenv">COPY_KIT, <A HREF="#@default258">8</A>
</LI><LI CLASS="li-indexenv">COPY_LARGE, <A HREF="#@default216">8</A>
</LI><LI CLASS="li-indexenv">COPY_RANDOM, <A HREF="#@default217">8</A>
</LI><LI CLASS="li-indexenv">COPY_TRANS, <A HREF="#@default47">4</A>
</LI><LI CLASS="li-indexenv">COPY_TRANS_LATE, <A HREF="#@default48">4</A>
</LI><LI CLASS="li-indexenv">COUNT_2DA_COLS, <A HREF="#@default392">8</A>
</LI><LI CLASS="li-indexenv">COUNT_2DA_ROWS, <A HREF="#@default391">8</A>
</LI><LI CLASS="li-indexenv">COUNT_REGEXP_INSTANCES, <A HREF="#@default393">8</A>
</LI><LI CLASS="li-indexenv">Code dumps, <A HREF="#@default536">10</A>
</LI><LI CLASS="li-indexenv">Component, <A HREF="#@default187">8</A>
</LI><LI CLASS="li-indexenv">Component Flag, <A HREF="#@default189">8</A>
</LI><LI CLASS="li-indexenv">chainEpilogue, <A HREF="#@default34">4</A>
</LI><LI CLASS="li-indexenv">chainText, <A HREF="#@default61">4</A>
</LI><LI CLASS="li-indexenv">constant, <A HREF="#@default542">14</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">D Action, <A HREF="#@default2">4</A>
</LI><LI CLASS="li-indexenv">D File, <A HREF="#@default1">4</A>
</LI><LI CLASS="li-indexenv">DECOMPILE_AND_PATCH, <A HREF="#@default399">8</A>
</LI><LI CLASS="li-indexenv">DECOMPILE_BCS_TO_BAF, <A HREF="#@default396">8</A>
</LI><LI CLASS="li-indexenv">DECOMPILE_DLG_TO_D, <A HREF="#@default397">8</A>
</LI><LI CLASS="li-indexenv">DECOMPRESS_INTO_FILE, <A HREF="#@default425">8</A>
</LI><LI CLASS="li-indexenv">DECOMPRESS_INTO_VAR, <A HREF="#@default426">8</A>
</LI><LI CLASS="li-indexenv">DECOMPRESS_REPLACE_FILE, <A HREF="#@default424">8</A>
</LI><LI CLASS="li-indexenv">DEFINE_ARRAY, <A HREF="#@default364">8</A>
</LI><LI CLASS="li-indexenv">DEFINE_ASSOCIATIVE_ARRAY, <A HREF="#@default358">8</A>
</LI><LI CLASS="li-indexenv">DELETE_BYTES, <A HREF="#@default347">8</A>
</LI><LI CLASS="li-indexenv">DEPRECATED, <A HREF="#@default190">8</A>
</LI><LI CLASS="li-indexenv">DESIGNATED, <A HREF="#@default198">8</A>
</LI><LI CLASS="li-indexenv">DEST_DIRECTORY, <A HREF="#@default208">8</A>
</LI><LI CLASS="li-indexenv">DEST_EXT, <A HREF="#@default212">8</A>
</LI><LI CLASS="li-indexenv">DEST_FILE, <A HREF="#@default210">8</A>
</LI><LI CLASS="li-indexenv">DEST_FILESPEC, <A HREF="#@default209">8</A>
</LI><LI CLASS="li-indexenv">DEST_RES, <A HREF="#@default211">8</A>
</LI><LI CLASS="li-indexenv">DISABLE_FROM_KEY, <A HREF="#@default220">8</A>
</LI><LI CLASS="li-indexenv">DLG, <A HREF="#@default0">3</A>
</LI><LI CLASS="li-indexenv">DO, <A HREF="#@default51">4</A>
</LI><LI CLASS="li-indexenv">dActionWhen, <A HREF="#@default31">4</A>
</LI><LI CLASS="li-indexenv">directory-file-regexp, <A HREF="#@default303">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">EFF, <A HREF="#@default546">15</A>
</LI><LI CLASS="li-indexenv">ENGINE_IS, <A HREF="#@default481">8</A>
</LI><LI CLASS="li-indexenv">EVALUATE_BUFFER, <A HREF="#@default331">8</A>, <A HREF="#@default509">8</A>
</LI><LI CLASS="li-indexenv">EVALUATE_BUFFER_SPECIAL, <A HREF="#@default330">8</A>
</LI><LI CLASS="li-indexenv">EVALUATE_REGEXP, <A HREF="#@default312">8</A>
</LI><LI CLASS="li-indexenv">EXACT_MATCH, <A HREF="#@default311">8</A>
</LI><LI CLASS="li-indexenv">EXIT, <A HREF="#@default60">4</A>
</LI><LI CLASS="li-indexenv">EXTEND_BOTTOM, <A HREF="#@default14">4</A>, <A HREF="#@default240">8</A>
</LI><LI CLASS="li-indexenv">EXTEND_BOTTOM_REGEXP, <A HREF="#@default242">8</A>
</LI><LI CLASS="li-indexenv">EXTEND_TOP, <A HREF="#@default13">4</A>, <A HREF="#@default239">8</A>
</LI><LI CLASS="li-indexenv">EXTEND_TOP_REGEXP, <A HREF="#@default241">8</A>
</LI><LI CLASS="li-indexenv">EXTERN, <A HREF="#@default59">4</A>
</LI></UL></TD><TD VALIGN=top ALIGN=left><UL CLASS="indexenv"><LI CLASS="li-indexenv">FAIL, <A HREF="#@default274">8</A>
</LI><LI CLASS="li-indexenv">FILE_CONTAINS, <A HREF="#@default501">8</A>
</LI><LI CLASS="li-indexenv">FILE_CONTAINS_EVALUATED, <A HREF="#@default502">8</A>
</LI><LI CLASS="li-indexenv">FILE_EXISTS, <A HREF="#@default503">8</A>
</LI><LI CLASS="li-indexenv">FILE_EXISTS_IN_GAME, <A HREF="#@default504">8</A>
</LI><LI CLASS="li-indexenv">FILE_IS_IN_COMPRESSED_BIFF, <A HREF="#@default506">8</A>
</LI><LI CLASS="li-indexenv">FILE_MD5, <A HREF="#@default505">8</A>
</LI><LI CLASS="li-indexenv">FILE_SIZE, <A HREF="#@default508">8</A>
</LI><LI CLASS="li-indexenv">FLAGS, <A HREF="#@default56">4</A>
</LI><LI CLASS="li-indexenv">FOR, <A HREF="#@default362">8</A>
</LI><LI CLASS="li-indexenv">FORBID_COMPONENT, <A HREF="#@default192">8</A>
</LI><LI CLASS="li-indexenv">FORBID_FILE, <A HREF="#@default273">8</A>
</LI><LI CLASS="li-indexenv">FORCED_SUBCOMPONENT, <A HREF="#@default195">8</A>
</LI><LI CLASS="li-indexenv">Forced String Reference, <A HREF="#@default63">4</A>
</LI><LI CLASS="li-indexenv">Functions, <A HREF="#@default532">9.23</A>
</LI><LI CLASS="li-indexenv">fj_are_structure, <A HREF="#@default538">11.1</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">GAME_IS, <A HREF="#@default480">8</A>
</LI><LI CLASS="li-indexenv">GET_DIRECTORY_ARRAY, <A HREF="#@default290">8</A>
</LI><LI CLASS="li-indexenv">GET_FILE_ARRAY, <A HREF="#@default289">8</A>
</LI><LI CLASS="li-indexenv">GET_OFFSET_ARRAY, <A HREF="#@default356">8</A>
</LI><LI CLASS="li-indexenv">GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2, <A HREF="#@default533">9.24</A>
</LI><LI CLASS="li-indexenv">GET_OFFSET_ARRAY2, <A HREF="#@default357">8</A>
</LI><LI CLASS="li-indexenv">GET_STRREF, <A HREF="#@default359">8</A>
</LI><LI CLASS="li-indexenv">GLOB, <A HREF="#@default305">8</A>
</LI><LI CLASS="li-indexenv">GOTO, <A HREF="#@default58">4</A>
</LI><LI CLASS="li-indexenv">GROUP, <A HREF="#@default196">8</A>, <A HREF="#@default528">9.19</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">ID_OF_LABEL, <A HREF="#@default490">8</A>
</LI><LI CLASS="li-indexenv">IDS_OF_SYMBOL, <A HREF="#@default482">8</A>
</LI><LI CLASS="li-indexenv">IF, <A HREF="#@default32">4</A>, <A HREF="#@default432">8</A>
</LI><LI CLASS="li-indexenv">IF_SIZE_IS, <A HREF="#@default431">8</A>
</LI><LI CLASS="li-indexenv">INCLUDE, <A HREF="#@default294">8</A>
</LI><LI CLASS="li-indexenv">INDEX, <A HREF="#@default496">8</A>
</LI><LI CLASS="li-indexenv">INDEX_BUFFER, <A HREF="#@default498">8</A>
</LI><LI CLASS="li-indexenv">INNER_ACTION, <A HREF="#@default423">8</A>, <A HREF="#@default523">9.14</A>
</LI><LI CLASS="li-indexenv">INNER_PATCH, <A HREF="#@default420">8</A>
</LI><LI CLASS="li-indexenv">INNER_PATCH_FILE, <A HREF="#@default422">8</A>
</LI><LI CLASS="li-indexenv">INNER_PATCH_SAVE, <A HREF="#@default421">8</A>
</LI><LI CLASS="li-indexenv">INSERT_2DA_ROW, <A HREF="#@default382">8</A>
</LI><LI CLASS="li-indexenv">INSERT_BYTES, <A HREF="#@default346">8</A>
</LI><LI CLASS="li-indexenv">INSERT_FILE, <A HREF="#@default342">8</A>
</LI><LI CLASS="li-indexenv">INSTALL_BY_DEFAULT, <A HREF="#@default197">8</A>
</LI><LI CLASS="li-indexenv">INSTALL_ORDER, <A HREF="#@default488">8</A>, <A HREF="#@default489">8</A>
</LI><LI CLASS="li-indexenv">INTERACTIVE, <A HREF="#@default513">8</A>
</LI><LI CLASS="li-indexenv">INTERJECT, <A HREF="#@default8">4</A>
</LI><LI CLASS="li-indexenv">INTERJECT_COPY_TRANS, <A HREF="#@default9">4</A>, <A HREF="#@default163">7.5</A>
</LI><LI CLASS="li-indexenv">INTERJECT_COPY_TRANS2, <A HREF="#@default10">4</A>, <A HREF="#@default164">7.6</A>
</LI><LI CLASS="li-indexenv">INTERJECT_COPY_TRANS3, <A HREF="#@default11">4</A>
</LI><LI CLASS="li-indexenv">INTERJECT_COPY_TRANS4, <A HREF="#@default12">4</A>
</LI><LI CLASS="li-indexenv">IS_AN_INT, <A HREF="#@default484">8</A>
</LI><LI CLASS="li-indexenv">IS_SILENT, <A HREF="#@default486">8</A>
</LI><LI CLASS="li-indexenv">ITM, <A HREF="#@default547">15</A>
</LI><LI CLASS="li-indexenv">inlined, <A HREF="#@default298">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">JOURNAL, <A HREF="#@default53">4</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">KEY, <A HREF="#@default548">15</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">LABEL, <A HREF="#@default200">8</A>
</LI><LI CLASS="li-indexenv">LANGUAGE, <A HREF="#@default186">8</A>
</LI><LI CLASS="li-indexenv">Language, <A HREF="#@default185">8</A>
</LI><LI CLASS="li-indexenv">LOAD_TRA, <A HREF="#@default256">8</A>
</LI><LI CLASS="li-indexenv">LOG, <A HREF="#@default277">8</A>
</LI><LI CLASS="li-indexenv">LONG_AT, <A HREF="#@default441">8</A>
</LI><LI CLASS="li-indexenv">LOOKUP_IDS_SYMBOL_OF_INT, <A HREF="#@default394">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">MAKE_BIFF, <A HREF="#@default255">8</A>
</LI><LI CLASS="li-indexenv">MATCH and TRY, <A HREF="#@default534">9.25</A>
</LI><LI CLASS="li-indexenv">Macros Listing, <A HREF="#@default537">11</A>
</LI><LI CLASS="li-indexenv">MKDIR, <A HREF="#@default232">8</A>
</LI><LI CLASS="li-indexenv">MOD_IS_INSTALLED, <A HREF="#@default487">8</A>
</LI><LI CLASS="li-indexenv">MODDER, <A HREF="#@default180">8</A>, <A HREF="#@default530">9.21</A>
</LI><LI CLASS="li-indexenv">MOVE, <A HREF="#@default219">8</A>
</LI><LI CLASS="li-indexenv">Module Distribution, <A HREF="#@default540">12</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">NO_IF_EVAL_BUG, <A HREF="#@default183">8</A>
</LI><LI CLASS="li-indexenv">NO_LOG_RECORD, <A HREF="#@default199">8</A>
</LI><LI CLASS="li-indexenv">NOGLOB, <A HREF="#@default306">8</A>
</LI><LI CLASS="li-indexenv">NOT, <A HREF="#@default447">8</A>
</LI><LI CLASS="li-indexenv">nonPausing, <A HREF="#@default4">4</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">OR, <A HREF="#@default450">8</A>
</LI><LI CLASS="li-indexenv">OUTER_FOR, <A HREF="#@default286">8</A>
</LI><LI CLASS="li-indexenv">OUTER_INNER_PATCH, <A HREF="#@default281">8</A>
</LI><LI CLASS="li-indexenv">OUTER_INNER_PATCH_SAVE, <A HREF="#@default283">8</A>
</LI><LI CLASS="li-indexenv">OUTER_PATCH, <A HREF="#@default282">8</A>
</LI><LI CLASS="li-indexenv">OUTER_PATCH_SAVE, <A HREF="#@default284">8</A>
</LI><LI CLASS="li-indexenv">OUTER_SET, <A HREF="#@default280">8</A>
</LI><LI CLASS="li-indexenv">OUTER_SPRINT, <A HREF="#@default279">8</A>
</LI><LI CLASS="li-indexenv">OUTER_TEXT_SPRINT, <A HREF="#@default278">8</A>
</LI><LI CLASS="li-indexenv">OUTER_WHILE, <A HREF="#@default285">8</A>
</LI><LI CLASS="li-indexenv">offset, <A HREF="#@default435">8</A>
</LI><LI CLASS="li-indexenv">optcase, <A HREF="#@default307">8</A>
</LI><LI CLASS="li-indexenv">optexact, <A HREF="#@default310">8</A>
</LI><LI CLASS="li-indexenv">optGlob, <A HREF="#@default304">8</A>
</LI><LI CLASS="li-indexenv">optNoBackup, <A HREF="#@default302">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">PATCH_BASH_FOR, <A HREF="#@default363">8</A>
</LI><LI CLASS="li-indexenv">PATCH_CLEAR_ARRAY, <A HREF="#@default370">8</A>
</LI><LI CLASS="li-indexenv">PATCH_DEFINE_ARRAY, <A HREF="#@default365">8</A>
</LI><LI CLASS="li-indexenv">PATCH_FAIL, <A HREF="#@default315">8</A>
</LI><LI CLASS="li-indexenv">PATCH_FOR_EACH, <A HREF="#@default366">8</A>
</LI><LI CLASS="li-indexenv">PATCH_IF, <A HREF="#@default371">8</A>
</LI><LI CLASS="li-indexenv">PATCH_INCLUDE, <A HREF="#@default375">8</A>
</LI><LI CLASS="li-indexenv">PATCH_LOG, <A HREF="#@default318">8</A>
</LI><LI CLASS="li-indexenv">PATCH_MATCH, <A HREF="#@default372">8</A>
</LI><LI CLASS="li-indexenv">PATCH_PHP_EACH, <A HREF="#@default368">8</A>
</LI><LI CLASS="li-indexenv">PATCH_PRINT, <A HREF="#@default317">8</A>
</LI><LI CLASS="li-indexenv">PATCH_RANDOM_SEED, <A HREF="#@default385">8</A>
</LI><LI CLASS="li-indexenv">PATCH_READLN, <A HREF="#@default384">8</A>
</LI><LI CLASS="li-indexenv">PATCH_REINCLUDE, <A HREF="#@default376">8</A>
</LI><LI CLASS="li-indexenv">PATCH_RERAISE, <A HREF="#@default374">8</A>
</LI><LI CLASS="li-indexenv">PATCH_SILENT, <A HREF="#@default418">8</A>
</LI><LI CLASS="li-indexenv">PATCH_TRY, <A HREF="#@default373">8</A>
</LI><LI CLASS="li-indexenv">PATCH_VERBOSE, <A HREF="#@default419">8</A>
</LI><LI CLASS="li-indexenv">PATCH_WARN, <A HREF="#@default316">8</A>
</LI><LI CLASS="li-indexenv">PHP_EACH, <A HREF="#@default367">8</A>
</LI><LI CLASS="li-indexenv">PRETTY_PRINT_2DA, <A HREF="#@default380">8</A>, <A HREF="#@default381">8</A>
</LI><LI CLASS="li-indexenv">PRINT, <A HREF="#@default276">8</A>
</LI><LI CLASS="li-indexenv">Prompt Customization, <A HREF="#@default521">9.13</A>
</LI><LI CLASS="li-indexenv">patch, <A HREF="#@default313">8</A>
</LI><LI CLASS="li-indexenv">prompts.tra, <A HREF="#@default522">9.13</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">QUICK_MENU, <A HREF="#@default184">8</A>, <A HREF="#@default535">9.26</A>
</LI><LI CLASS="li-indexenv">QUOTE, <A HREF="#@default327">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">R_A_T_P_R, <A HREF="#@default30">4</A>
</LI><LI CLASS="li-indexenv">RANDOM, <A HREF="#@default494">8</A>
</LI><LI CLASS="li-indexenv">RANDOM_SEED, <A HREF="#@default233">8</A>
</LI><LI CLASS="li-indexenv">READ_2DA_ENTRIES_NOW, <A HREF="#@default389">8</A>, <A HREF="#@default526">9.16</A>
</LI><LI CLASS="li-indexenv">READ_2DA_ENTRY, <A HREF="#@default388">8</A>
</LI><LI CLASS="li-indexenv">READ_2DA_ENTRY_FORMER, <A HREF="#@default390">8</A>, <A HREF="#@default527">9.16</A>
</LI><LI CLASS="li-indexenv">READ_ASCII, <A HREF="#@default354">8</A>
</LI><LI CLASS="li-indexenv">READ_BYTE, <A HREF="#@default348">8</A>
</LI><LI CLASS="li-indexenv">READ_LONG, <A HREF="#@default352">8</A>
</LI><LI CLASS="li-indexenv">READ_SBYTE, <A HREF="#@default349">8</A>
</LI><LI CLASS="li-indexenv">READ_SHORT, <A HREF="#@default350">8</A>
</LI><LI CLASS="li-indexenv">READ_SLONG, <A HREF="#@default353">8</A>
</LI><LI CLASS="li-indexenv">READ_SSHORT, <A HREF="#@default351">8</A>
</LI><LI CLASS="li-indexenv">READ_STRREF, <A HREF="#@default355">8</A>
</LI><LI CLASS="li-indexenv">READLN, <A HREF="#@default531">9.22</A>
</LI><LI CLASS="li-indexenv">README, <A HREF="#@default178">8</A>
</LI><LI CLASS="li-indexenv">REFACTOR_BAF_TRIGGER, <A HREF="#@default401">8</A>
</LI><LI CLASS="li-indexenv">REFACTOR_D_TRIGGER, <A HREF="#@default402">8</A>
</LI><LI CLASS="li-indexenv">REFACTOR_TRIGGER, <A HREF="#@default400">8</A>
</LI><LI CLASS="li-indexenv">REINCLUDE, <A HREF="#@default296">8</A>
</LI><LI CLASS="li-indexenv">REMOVE_2DA_ROW, <A HREF="#@default383">8</A>
</LI><LI CLASS="li-indexenv">REMOVE_CRE_EFFECTS, <A HREF="#@default415">8</A>
</LI><LI CLASS="li-indexenv">REMOVE_CRE_ITEM, <A HREF="#@default413">8</A>
</LI><LI CLASS="li-indexenv">REMOVE_CRE_ITEMS, <A HREF="#@default414">8</A>
</LI><LI CLASS="li-indexenv">REMOVE_KNOWN_SPELL, <A HREF="#@default408">8</A>
</LI><LI CLASS="li-indexenv">REMOVE_KNOWN_SPELLS, <A HREF="#@default416">8</A>
</LI><LI CLASS="li-indexenv">REMOVE_MEMORIZED_SPELL, <A HREF="#@default409">8</A>
</LI><LI CLASS="li-indexenv">REMOVE_MEMORIZED_SPELLS, <A HREF="#@default417">8</A>
</LI><LI CLASS="li-indexenv">REMOVE_STORE_ITEM, <A HREF="#@default387">8</A>
</LI><LI CLASS="li-indexenv">REPLACE, <A HREF="#@default21">4</A>, <A HREF="#@default328">8</A>
</LI><LI CLASS="li-indexenv">REPLACE_ACTION_TEXT, <A HREF="#@default27">4</A>
</LI><LI CLASS="li-indexenv">REPLACE_ACTION_TEXT_PROCESS, <A HREF="#@default29">4</A>
</LI><LI CLASS="li-indexenv">REPLACE_ACTION_TEXT_REGEXP, <A HREF="#@default28">4</A>
</LI><LI CLASS="li-indexenv">REPLACE_BCS_BLOCK, <A HREF="#@default345">8</A>
</LI><LI CLASS="li-indexenv">REPLACE_CRE_ITEM, <A HREF="#@default412">8</A>
</LI><LI CLASS="li-indexenv">REPLACE_EVALUATE, <A HREF="#@default403">8</A>
</LI><LI CLASS="li-indexenv">REPLACE_SAY, <A HREF="#@default23">4</A>
</LI><LI CLASS="li-indexenv">REPLACE_STATE_TRIGGER, <A HREF="#@default24">4</A>
</LI><LI CLASS="li-indexenv">REPLACE_TEXTUALLY, <A HREF="#@default329">8</A>
</LI><LI CLASS="li-indexenv">REPLACE_TRANS_ACTION, <A HREF="#@default18">4</A>
</LI><LI CLASS="li-indexenv">REPLACE_TRANS_TRIGGER, <A HREF="#@default19">4</A>
</LI><LI CLASS="li-indexenv">REPLACE_TRIGGER_TEXT, <A HREF="#@default25">4</A>
</LI><LI CLASS="li-indexenv">REPLACE_TRIGGER_TEXT_REGEXP, <A HREF="#@default26">4</A>
</LI><LI CLASS="li-indexenv">REPLY, <A HREF="#@default50">4</A>
</LI><LI CLASS="li-indexenv">REQUIRE_COMPONENT, <A HREF="#@default191">8</A>
</LI><LI CLASS="li-indexenv">REQUIRE_FILE, <A HREF="#@default272">8</A>
</LI><LI CLASS="li-indexenv">REQUIRE_PREDICATE, <A HREF="#@default193">8</A>
</LI><LI CLASS="li-indexenv">RESOLVE_STR_REF, <A HREF="#@default493">8</A>
</LI><LI CLASS="li-indexenv">RINDEX, <A HREF="#@default497">8</A>
</LI><LI CLASS="li-indexenv">RINDEX_BUFFER, <A HREF="#@default499">8</A>
</LI><LI CLASS="li-indexenv">regexp, <A HREF="#@default541">13</A>
</LI><LI CLASS="li-indexenv">replyText, <A HREF="#@default44">4</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">SAY, <A HREF="#@default39">4</A>, <A HREF="#@default314">8</A>
</LI><LI CLASS="li-indexenv">SAY_EVALUATED, <A HREF="#@default319">8</A>
</LI><LI CLASS="li-indexenv">SBYTE_AT, <A HREF="#@default438">8</A>
</LI><LI CLASS="li-indexenv">SCRIPT_STYLE, <A HREF="#@default182">8</A>
</LI><LI CLASS="li-indexenv">SET, <A HREF="#@default360">8</A>
</LI><LI CLASS="li-indexenv">SET_2DA_ENTRIES_NOW, <A HREF="#@default379">8</A>, <A HREF="#@default525">9.15</A>
</LI><LI CLASS="li-indexenv">SET_2DA_ENTRY, <A HREF="#@default377">8</A>, <A HREF="#@default517">9.7</A>
</LI><LI CLASS="li-indexenv">SET_2DA_ENTRY_LATER, <A HREF="#@default378">8</A>, <A HREF="#@default524">9.15</A>
</LI><LI CLASS="li-indexenv">SET_BG2_PROFICIENCY, <A HREF="#@default410">8</A>
</LI><LI CLASS="li-indexenv">SET_WEIGHT, <A HREF="#@default22">4</A>
</LI><LI CLASS="li-indexenv">SHORT_AT, <A HREF="#@default439">8</A>
</LI><LI CLASS="li-indexenv">SILENT, <A HREF="#@default230">8</A>
</LI><LI CLASS="li-indexenv">SLONG_AT, <A HREF="#@default442">8</A>
</LI><LI CLASS="li-indexenv">SNPRINT, <A HREF="#@default324">8</A>
</LI><LI CLASS="li-indexenv">SOLVED_JOURNAL, <A HREF="#@default54">4</A>
</LI><LI CLASS="li-indexenv">SOURCE_BIFF, <A HREF="#@default325">8</A>
</LI><LI CLASS="li-indexenv">SOURCE_DIRECTORY, <A HREF="#@default203">8</A>
</LI><LI CLASS="li-indexenv">SOURCE_EXT, <A HREF="#@default207">8</A>
</LI><LI CLASS="li-indexenv">SOURCE_FILE, <A HREF="#@default205">8</A>
</LI><LI CLASS="li-indexenv">SOURCE_FILESPEC, <A HREF="#@default204">8</A>
</LI><LI CLASS="li-indexenv">SOURCE_RES, <A HREF="#@default206">8</A>
</LI><LI CLASS="li-indexenv">SOURCE_SIZE, <A HREF="#@default213">8</A>
</LI><LI CLASS="li-indexenv">SPACES, <A HREF="#@default326">8</A>
</LI><LI CLASS="li-indexenv">SPL, <A HREF="#@default549">15</A>
</LI><LI CLASS="li-indexenv">SPRINT, <A HREF="#@default323">8</A>
</LI><LI CLASS="li-indexenv">SSHORT_AT, <A HREF="#@default440">8</A>
</LI><LI CLASS="li-indexenv">STATE_WHICH_SAYS, <A HREF="#@default491">8</A>, <A HREF="#@default492">8</A>
</LI><LI CLASS="li-indexenv">STR_CMP, <A HREF="#@default473">8</A>
</LI><LI CLASS="li-indexenv">STRING_COMPARE, <A HREF="#@default472">8</A>
</LI><LI CLASS="li-indexenv">STRING_COMPARE_CASE, <A HREF="#@default474">8</A>
</LI><LI CLASS="li-indexenv">STRING_COMPARE_REGEXP, <A HREF="#@default478">8</A>
</LI><LI CLASS="li-indexenv">STRING_CONTAINS_REGEXP, <A HREF="#@default479">8</A>
</LI><LI CLASS="li-indexenv">STRING_EQUAL, <A HREF="#@default475">8</A>
</LI><LI CLASS="li-indexenv">STRING_EQUAL_CASE, <A HREF="#@default476">8</A>
</LI><LI CLASS="li-indexenv">STRING_LENGTH, <A HREF="#@default500">8</A>
</LI><LI CLASS="li-indexenv">STRING_MATCHES_REGEXP, <A HREF="#@default477">8</A>
</LI><LI CLASS="li-indexenv">STRING_SET, <A HREF="#@default266">8</A>
</LI><LI CLASS="li-indexenv">STRING_SET_EVALUATE, <A HREF="#@default267">8</A>
</LI><LI CLASS="li-indexenv">STRING_SET_RANGE, <A HREF="#@default268">8</A>
</LI><LI CLASS="li-indexenv">String, <A HREF="#@default64">4</A>
</LI><LI CLASS="li-indexenv">SUBCOMPONENT, <A HREF="#@default194">8</A>, <A HREF="#@default519">9.11</A>
</LI><LI CLASS="li-indexenv">sayText, <A HREF="#@default43">4</A>
</LI><LI CLASS="li-indexenv">sc#addWmpAre, <A HREF="#@default539">11.2</A>
</LI><LI CLASS="li-indexenv">state, <A HREF="#@default35">4</A>
</LI><LI CLASS="li-indexenv">stateActionString, <A HREF="#@default52">4</A>
</LI><LI CLASS="li-indexenv">stateLabel, <A HREF="#@default38">4</A>
</LI><LI CLASS="li-indexenv">stateNumber, <A HREF="#@default40">4</A>
</LI><LI CLASS="li-indexenv">stateTriggerString, <A HREF="#@default37">4</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">TEXT_SPRINT, <A HREF="#@default322">8</A>
</LI><LI CLASS="li-indexenv">TLK, <A HREF="#@default550">15</A>
</LI><LI CLASS="li-indexenv">TO_LOWER, <A HREF="#@default321">8</A>
</LI><LI CLASS="li-indexenv">TO_UPPER, <A HREF="#@default320">8</A>
</LI><LI CLASS="li-indexenv">TP2, <A HREF="#@default167">8</A>
</LI><LI CLASS="li-indexenv">TP2 Action, <A HREF="#@default201">8</A>
</LI><LI CLASS="li-indexenv">TP2 File, <A HREF="#@default168">8</A>
</LI><LI CLASS="li-indexenv">TP2 Flag, <A HREF="#@default173">8</A>
</LI><LI CLASS="li-indexenv">TP2_AUTHOR, <A HREF="#@default171">8</A>
</LI><LI CLASS="li-indexenv">TP2_FILE_NAME, <A HREF="#@default172">8</A>
</LI><LI CLASS="li-indexenv">TRA, <A HREF="#@default165">7.8</A>
</LI><LI CLASS="li-indexenv">TRA_ENTRY_EXISTS, <A HREF="#@default485">8</A>
</LI><LI CLASS="li-indexenv">text, <A HREF="#@default62">4</A>
</LI><LI CLASS="li-indexenv">transFeature, <A HREF="#@default49">4</A>
</LI><LI CLASS="li-indexenv">transition, <A HREF="#@default45">4</A>
</LI><LI CLASS="li-indexenv">transNext, <A HREF="#@default57">4</A>
</LI><LI CLASS="li-indexenv">transTriggerString, <A HREF="#@default46">4</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">UNINSTALL, <A HREF="#@default257">8</A>
</LI><LI CLASS="li-indexenv">UNINSTALL_ORDER, <A HREF="#@default179">8</A>
</LI><LI CLASS="li-indexenv">UNLESS, <A HREF="#@default33">4</A>, <A HREF="#@default433">8</A>
</LI><LI CLASS="li-indexenv">UNSOLVED_JOURNAL, <A HREF="#@default55">4</A>
</LI><LI CLASS="li-indexenv">USING, <A HREF="#@default222">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">VARIABLE_IS_SET, <A HREF="#@default483">8</A>
</LI><LI CLASS="li-indexenv">VERBOSE, <A HREF="#@default231">8</A>
</LI><LI CLASS="li-indexenv">VERSION, <A HREF="#@default181">8</A>
</LI><LI CLASS="li-indexenv">value, <A HREF="#@default436">8</A>
</LI><LI CLASS="li-indexenv">variable, <A HREF="#@default514">8</A>
<BR>
<BR>
</LI><LI CLASS="li-indexenv">WARN, <A HREF="#@default275">8</A>
</LI><LI CLASS="li-indexenv">WEIDU_ARCH, <A HREF="#@default510">8</A>
</LI><LI CLASS="li-indexenv">WEIDU_OS, <A HREF="#@default511">8</A>
</LI><LI CLASS="li-indexenv">WEIGHT, <A HREF="#@default36">4</A>
</LI><LI CLASS="li-indexenv">WHILE, <A HREF="#@default361">8</A>, <A HREF="#@default518">9.8</A>
</LI><LI CLASS="li-indexenv">WRITE_ASCII, <A HREF="#@default337">8</A>
</LI><LI CLASS="li-indexenv">WRITE_ASCII_LIST, <A HREF="#@default338">8</A>
</LI><LI CLASS="li-indexenv">WRITE_ASCII_TERMINATE, <A HREF="#@default339">8</A>
</LI><LI CLASS="li-indexenv">WRITE_BYTE, <A HREF="#@default334">8</A>
</LI><LI CLASS="li-indexenv">WRITE_EVALUATED_ASCII, <A HREF="#@default340">8</A>
</LI><LI CLASS="li-indexenv">WRITE_FILE, <A HREF="#@default341">8</A>
</LI><LI CLASS="li-indexenv">WRITE_LONG, <A HREF="#@default336">8</A>
</LI><LI CLASS="li-indexenv">WRITE_SHORT, <A HREF="#@default335">8</A>
</LI><LI CLASS="li-indexenv">when, <A HREF="#@default430">8</A>
</LI></UL></TD></TR>
</TABLE><!--TOC section Changes-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc62">21</A>&#XA0;&#XA0;Changes</H2><!--SEC END --><P>
See the file
<TT><A HREF="README-WeiDU-Changes.txt">README-WeiDU-Changes.txt</A></TT>
for a description of how WeiDU
has changed over time.
</P><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<HR SIZE=2><BLOCKQUOTE CLASS="quote"><EM>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
<A HREF="http://hevea.inria.fr/index.html">H<FONT SIZE=2><sup>E</sup></FONT>V<FONT SIZE=2><sup>E</sup></FONT>A</A>.</EM></BLOCKQUOTE></BODY>
</HTML>
